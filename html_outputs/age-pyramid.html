<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>33 Tháp dân số và thang đo Likert | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="33 Tháp dân số và thang đo Likert | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="33 Tháp dân số và thang đo Likert | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="age-pyramid" class="section level1" number="33">
<h1><span class="header-section-number">33</span> Tháp dân số và thang đo Likert</h1>
<p><img src="images/pop_pyramid_baseline.png" width="50%" /><img src="images/likert.png" width="50%" /></p>
<p>Kim tự tháp nhân khẩu học rất hữu ích khi bạn muốn hiển thị sự phân bố về độ tuổi và giới tính. Code tương tự cũng có thể được sử dụng để trực quan hóa kết quả của các câu hỏi khảo sát kiểu Likert (ví dụ: “Hoàn toàn đồng ý”, “Đồng ý”, “Trung lập”, “Không đồng ý”, “Hoàn toàn không đồng ý”). Trong chương này, chúng tôi đề cập đến những điều sau</p>
<ul>
<li>Tạo một tháp dân số nhanh &amp; dễ dàng với package <strong>apyramid</strong><br />
</li>
<li>Tùy biến tháp dân số với <code>ggplot()</code><br />
</li>
<li>Hiển thị dữ liệu nhân khẩu học “nền” trong tháp dân số<br />
</li>
<li>Sử dụng các biểu đồ kiểu kim tự tháp để hiển thị các loại dữ liệu khác (ví dụ: câu trả lời cho các câu hỏi khảo sát <strong>kiểu Likert</strong>)</li>
</ul>
<!-- ======================================================= -->
<div id="chuẩn-bị-24" class="section level2" number="33.1">
<h2><span class="header-section-number">33.1</span> Chuẩn bị</h2>
<div id="gọi-package-9" class="section level3 unnumbered">
<h3>Gọi package</h3>
<p>Đoạn code này hiển thị việc gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh việc sử dụng hàm <code>p_load()</code> từ package <strong>pacman</strong>, giúp cài đặt các package cần thiết <em>và</em> gọi chúng ra để sử dụng. Bạn cũng có thể gọi các packages đã cài đặt với hàm <code>library()</code> của <strong>base</strong> R. Xem thêm chương <a href="basics.html#basics">R cơ bản</a> để có thêm thông tin về các packages trong R.</p>
<div class="sourceCode" id="cb1564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1564-1"><a href="age-pyramid.html#cb1564-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rio,       <span class="co"># to import data</span></span>
<span id="cb1564-2"><a href="age-pyramid.html#cb1564-2" tabindex="-1"></a>               here,      <span class="co"># to locate files</span></span>
<span id="cb1564-3"><a href="age-pyramid.html#cb1564-3" tabindex="-1"></a>               tidyverse, <span class="co"># to clean, handle, and plot the data (includes ggplot2 package)</span></span>
<span id="cb1564-4"><a href="age-pyramid.html#cb1564-4" tabindex="-1"></a>               apyramid,  <span class="co"># a package dedicated to creating age pyramids</span></span>
<span id="cb1564-5"><a href="age-pyramid.html#cb1564-5" tabindex="-1"></a>               janitor,   <span class="co"># tables and cleaning data</span></span>
<span id="cb1564-6"><a href="age-pyramid.html#cb1564-6" tabindex="-1"></a>               stringr)   <span class="co"># working with strings for titles, captions, etc.</span></span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-18" class="section level3 unnumbered">
<h3>Nhập dữ liệu</h3>
<p>Để bắt đầu, chúng ta nhập bộ dữ liệu có tên linelist đã làm sạch bao gồm các trường hợp từ vụ dịch Ebola mô phỏng. Để tiện theo dõi, <a href='https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>bấm để tải dữ liệu linelist “đã được làm sạch” </a> (dưới dạng tệp .rds). Nhập dữ liệu bằng hàm <code>import()</code> từ package <strong>rio</strong> (nó xử lý nhiều loại tệp như .xlsx, .csv, .rds - xem thêm chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết thêm chi tiết.</p>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1565-1"><a href="age-pyramid.html#cb1565-1" tabindex="-1"></a><span class="co"># import case linelist </span></span>
<span id="cb1565-2"><a href="age-pyramid.html#cb1565-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>50 hàng đầu tiên của bộ dữ liệu được hiển thị như bên dưới.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-debabe61c45f6d0ed44c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-debabe61c45f6d0ed44c">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"age","targets":8},{"name":"age_unit","targets":9},{"name":"age_years","targets":10},{"name":"age_cat","targets":11},{"name":"age_cat5","targets":12},{"name":"hospital","targets":13},{"name":"lon","targets":14},{"name":"lat","targets":15},{"name":"infector","targets":16},{"name":"source","targets":17},{"name":"wt_kg","targets":18},{"name":"ht_cm","targets":19},{"name":"ct_blood","targets":20},{"name":"fever","targets":21},{"name":"chills","targets":22},{"name":"cough","targets":23},{"name":"aches","targets":24},{"name":"vomit","targets":25},{"name":"temp","targets":26},{"name":"time_admission","targets":27},{"name":"bmi","targets":28},{"name":"days_onset_hosp","targets":29}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="làm-sạch" class="section level3 unnumbered">
<h3>Làm sạch</h3>
<p>Để tạo tháp nhân khẩu học theo độ tuổi/giới tính truyền thống, trước tiên dữ liệu phải được làm sạch theo những cách sau:</p>
<ul>
<li>Cột gender phải được làm sạch.<br />
</li>
<li>Tùy thuộc vào phương pháp của bạn, độ tuổi phải được lưu trữ dưới dạng số hoặc trong cột <em>age category</em>.</li>
</ul>
<p>Nếu sử dụng nhóm tuổi, các giá trị trong cột phải được sắp xếp thứ tự, hoặc là thứ tự chữ-số mặc định hoặc được đặt có chủ ý bằng cách chuyển đổi thành kiểu factor.</p>
<p>Sau đây chúng ta sử dụng hàm <code>tabyl()</code> từ package <strong>janitor</strong> để khảo sát hai cột <code>gender</code> và <code>age_cat5</code>.</p>
<div class="sourceCode" id="cb1566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1566-1"><a href="age-pyramid.html#cb1566-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1566-2"><a href="age-pyramid.html#cb1566-2" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat5, gender)</span></code></pre></div>
<pre><code>##  age_cat5   f   m NA_
##       0-4 640 416  39
##       5-9 641 412  42
##     10-14 518 383  40
##     15-19 359 364  20
##     20-24 305 316  17
##     25-29 163 259  13
##     30-34 104 213   9
##     35-39  42 157   3
##     40-44  25 107   1
##     45-49   8  80   5
##     50-54   2  37   1
##     55-59   0  30   0
##     60-64   0  12   0
##     65-69   0  12   1
##     70-74   0   4   0
##     75-79   0   0   1
##     80-84   0   1   0
##       85+   0   0   0
##      &lt;NA&gt;   0   0  86</code></pre>
<p>Chúng ta có thể vẽ biểu đồ histogram đối với cột <code>age</code> để chắc chắn rằng nó đã được làm sạch và phân loại chính xác:</p>
<div class="sourceCode" id="cb1568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1568-1"><a href="age-pyramid.html#cb1568-1" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>age)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1196-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="apyramid-package" class="section level2" number="33.2">
<h2><span class="header-section-number">33.2</span> <strong>apyramid</strong> package</h2>
<p>Package <strong>apyramid</strong> là một sản phẩm của dự án <a href="https://r4epis.netlify.com/">R4Epis</a>. Bạn có thể đọc thêm về package này <a href="https://cran.r-project.org/web/packages/apyramid/vignettes/intro.html">tại đây</a>. Nó cho phép bạn nhanh chóng tạo một tháp tuổi. Để tùy biến đẹp hơn, xem mục <a href="age-pyramid.html#demo_pyr_gg">sử dụng <code>ggplot()</code></a>. Bạn có thể đọc thêm về package <strong>apyramid</strong> tại trang Help bằng cách nhập <code>?age_pyramid</code> vào R console.</p>
<div id="dữ-liệu-linelist-1" class="section level3 unnumbered">
<h3>Dữ liệu Linelist</h3>
<p>Sử dụng dữ liệu <code>linelist</code> đã làm sạch, chúng ta có thể tạo một tháp tuổi chỉ với một lệnh <code>age_pyramid()</code> cơ bản. Trong lệnh này:</p>
<ul>
<li>Đối số <code>data =</code> sử dụng bộ dữ liệu <code>linelist</code><br />
</li>
<li>Đối số <code>age_group =</code> (trục y) lấy thông tin từ cột nhóm tuổi (trong ngoặc kép)<br />
</li>
<li>Đối số <code>split_by =</code> (trục x) lấy thông tin từ cột giới</li>
</ul>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1569-1"><a href="age-pyramid.html#cb1569-1" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(<span class="at">data =</span> linelist,</span>
<span id="cb1569-2"><a href="age-pyramid.html#cb1569-2" tabindex="-1"></a>                      <span class="at">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb1569-3"><a href="age-pyramid.html#cb1569-3" tabindex="-1"></a>                      <span class="at">split_by =</span> <span class="st">&quot;gender&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1197-1.png" width="672" /></p>
<p>Tháp có thể hiện thị phần trăm của tất cả các trường hợp trên trục x, thay vì chỉ số lượng, bằng cách thêm <code>proportional = TRUE</code>.</p>
<div class="sourceCode" id="cb1570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1570-1"><a href="age-pyramid.html#cb1570-1" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(<span class="at">data =</span> linelist,</span>
<span id="cb1570-2"><a href="age-pyramid.html#cb1570-2" tabindex="-1"></a>                      <span class="at">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb1570-3"><a href="age-pyramid.html#cb1570-3" tabindex="-1"></a>                      <span class="at">split_by =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb1570-4"><a href="age-pyramid.html#cb1570-4" tabindex="-1"></a>                      <span class="at">proportional =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1198-1.png" width="672" /></p>
<p>Khi sử dụng package <strong>agepyramid</strong>, nếu cột được phân chia <code>split_by</code> là nhị phân (vd. nam/nữ, hoặc có/không), thì kết quả sẽ xuất hiện dưới dạng một kim tự tháp. Tuy nhiên nếu có nhiều hơn hai giá trị trong cột được phân chia <code>split_by</code> (không bao gồm <code>NA</code>), kim tự tháp sẽ xuất hiện dưới dạng nhiều biểu đồ cột ngang với các thanh màu xám trong “background” cho biết phạm vi của dữ liệu không có mặt cho nhóm tuổi đó. Trong trường hợp này, giá trị của <code>split_by =</code> sẽ xuất hiện dưới dạng nhãn ở đỉnh mỗi biểu đồ. Chẳng hạn, bên dưới là những gì xảy ra nếu <code>split_by =</code> được chỉ định tới cột <code>hospital</code>.</p>
<div class="sourceCode" id="cb1571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1571-1"><a href="age-pyramid.html#cb1571-1" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(<span class="at">data =</span> linelist,</span>
<span id="cb1571-2"><a href="age-pyramid.html#cb1571-2" tabindex="-1"></a>                      <span class="at">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb1571-3"><a href="age-pyramid.html#cb1571-3" tabindex="-1"></a>                      <span class="at">split_by =</span> <span class="st">&quot;hospital&quot;</span>)  </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1199-1.png" width="672" /></p>
<div id="giá-trị-missing-2" class="section level4 unnumbered">
<h4>Giá trị Missing</h4>
<p>Các hàng chứa giá trị missing <code>NA</code> của các cột <code>split_by =</code> hoặc <code>age_group =</code>, nếu được mã hóa là <code>NA</code>, sẽ không tự động kích hoạt việc phân chia biểu đồ như được hiển thị ở trên. Mặc định những hàng này không được hiển thị. Tuy nhiên, bạn có thể chỉ định các giá trị missing hiển thị, trong một biểu đồ liền kề và dưới dạng một nhóm tuổi riêng biệt, bằng cách chỉ định <code>na.rm = FALSE</code>.</p>
<div class="sourceCode" id="cb1572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1572-1"><a href="age-pyramid.html#cb1572-1" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(<span class="at">data =</span> linelist,</span>
<span id="cb1572-2"><a href="age-pyramid.html#cb1572-2" tabindex="-1"></a>                      <span class="at">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb1572-3"><a href="age-pyramid.html#cb1572-3" tabindex="-1"></a>                      <span class="at">split_by =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb1572-4"><a href="age-pyramid.html#cb1572-4" tabindex="-1"></a>                      <span class="at">na.rm =</span> <span class="cn">FALSE</span>)         <span class="co"># show patients missing age or gender</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1200-1.png" width="672" /></p>
</div>
<div id="tỷ-lệ-màu-sắc-thẩm-mỹ" class="section level4 unnumbered">
<h4>Tỷ lệ, màu sắc, &amp; thẩm mỹ</h4>
<p>Theo mặc định, các cột hiển thị số lượng (không phải %), đường gạch ngang giữa cho mỗi nhóm được hiển thị và màu sắc là xanh lục/tím. Các thông số này có thể được điều chỉnh, như được trình bày dưới đây:</p>
<p>Bạn cũng có thể thêm các lệnh <code>ggplot()</code> vào biểu đồ bằng cách sử dụng các cú pháp chuẩn của <code>ggplot()</code> “+” , chẳng hạn như chủ đề trang trí và điều chỉnh nhãn:</p>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1573-1"><a href="age-pyramid.html#cb1573-1" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(</span>
<span id="cb1573-2"><a href="age-pyramid.html#cb1573-2" tabindex="-1"></a>  <span class="at">data =</span> linelist,</span>
<span id="cb1573-3"><a href="age-pyramid.html#cb1573-3" tabindex="-1"></a>  <span class="at">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,</span>
<span id="cb1573-4"><a href="age-pyramid.html#cb1573-4" tabindex="-1"></a>  <span class="at">split_by =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb1573-5"><a href="age-pyramid.html#cb1573-5" tabindex="-1"></a>  <span class="at">proportional =</span> <span class="cn">TRUE</span>,              <span class="co"># show percents, not counts</span></span>
<span id="cb1573-6"><a href="age-pyramid.html#cb1573-6" tabindex="-1"></a>  <span class="at">show_midpoint =</span> <span class="cn">FALSE</span>,            <span class="co"># remove bar mid-point line</span></span>
<span id="cb1573-7"><a href="age-pyramid.html#cb1573-7" tabindex="-1"></a>  <span class="co">#pal = c(&quot;orange&quot;, &quot;purple&quot;)      # can specify alt. colors here (but not labels)</span></span>
<span id="cb1573-8"><a href="age-pyramid.html#cb1573-8" tabindex="-1"></a>  )<span class="sc">+</span>                 </span>
<span id="cb1573-9"><a href="age-pyramid.html#cb1573-9" tabindex="-1"></a>  </span>
<span id="cb1573-10"><a href="age-pyramid.html#cb1573-10" tabindex="-1"></a>  <span class="co"># additional ggplot commands</span></span>
<span id="cb1573-11"><a href="age-pyramid.html#cb1573-11" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                               <span class="co"># simplfy background</span></span>
<span id="cb1573-12"><a href="age-pyramid.html#cb1573-12" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(                             <span class="co"># specify colors AND labels</span></span>
<span id="cb1573-13"><a href="age-pyramid.html#cb1573-13" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;orange&quot;</span>, <span class="st">&quot;purple&quot;</span>),              </span>
<span id="cb1573-14"><a href="age-pyramid.html#cb1573-14" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;m&quot;</span> <span class="ot">=</span> <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;f&quot;</span> <span class="ot">=</span> <span class="st">&quot;Female&quot;</span>))<span class="sc">+</span></span>
<span id="cb1573-15"><a href="age-pyramid.html#cb1573-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Percent of all cases&quot;</span>,              <span class="co"># note x and y labs are switched</span></span>
<span id="cb1573-16"><a href="age-pyramid.html#cb1573-16" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age categories&quot;</span>,                          </span>
<span id="cb1573-17"><a href="age-pyramid.html#cb1573-17" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">&quot;Gender&quot;</span>, </span>
<span id="cb1573-18"><a href="age-pyramid.html#cb1573-18" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;My data source and caption here&quot;</span>,</span>
<span id="cb1573-19"><a href="age-pyramid.html#cb1573-19" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Title of my plot&quot;</span>,</span>
<span id="cb1573-20"><a href="age-pyramid.html#cb1573-20" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Subtitle with </span><span class="sc">\n</span><span class="st"> a second line...&quot;</span>)<span class="sc">+</span></span>
<span id="cb1573-21"><a href="age-pyramid.html#cb1573-21" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1573-22"><a href="age-pyramid.html#cb1573-22" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,                          <span class="co"># legend to bottom</span></span>
<span id="cb1573-23"><a href="age-pyramid.html#cb1573-23" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),  <span class="co"># fonts/sizes</span></span>
<span id="cb1573-24"><a href="age-pyramid.html#cb1573-24" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1201-1.png" width="672" /></p>
</div>
</div>
<div id="dữ-liệu-được-tổng-hợp" class="section level3 unnumbered">
<h3>Dữ liệu được tổng hợp</h3>
<p>Ví dụ bên trên giả định rằng dữ liệu của bạn có định dạng mỗi hàng cho một quan sát. Nếu dữ liệu của bạn đã được tổng hợp thành số lượng theo nhóm tuổi, bạn vẫn có thể sử dụng package <strong>apyramid</strong>, như được trình bày dưới đây.</p>
<p>Để minh họa, chúng ta sẽ tổng hợp dữ liệu linelist theo số lượng đối với nhóm tuổi và giới, dưới định dạng “ngang”. Việc này sẽ mô phỏng như thể dữ liệu ban đầu của bạn đang được trình bày dưới dạng số lượng. Tìm hiểu thêm về <a href="grouping.html#grouping">Nhóm dữ liệu</a> và <a href="pivoting.html#pivoting">Xoay trục dữ liệu</a> ở các chương tương ứng.</p>
<div class="sourceCode" id="cb1574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1574-1"><a href="age-pyramid.html#cb1574-1" tabindex="-1"></a>demo_agg <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1574-2"><a href="age-pyramid.html#cb1574-2" tabindex="-1"></a>  <span class="fu">count</span>(age_cat5, gender, <span class="at">name =</span> <span class="st">&quot;cases&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1574-3"><a href="age-pyramid.html#cb1574-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb1574-4"><a href="age-pyramid.html#cb1574-4" tabindex="-1"></a>    <span class="at">id_cols =</span> age_cat5,</span>
<span id="cb1574-5"><a href="age-pyramid.html#cb1574-5" tabindex="-1"></a>    <span class="at">names_from =</span> gender,</span>
<span id="cb1574-6"><a href="age-pyramid.html#cb1574-6" tabindex="-1"></a>    <span class="at">values_from =</span> cases) <span class="sc">%&gt;%</span> </span>
<span id="cb1574-7"><a href="age-pyramid.html#cb1574-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">missing_gender</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">NA</span><span class="st">`</span>)</span></code></pre></div>
<p>…lệnh trên sẽ khiến bộ dữ liệu trông như thế này: bao gồm các cột nhóm tuổi, số lượng nam, nữ, và missing.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-364b99d8b8451a7d8a90" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-364b99d8b8451a7d8a90">{"x":{"filter":"none","vertical":false,"data":[["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84",null],[640,641,518,359,305,163,104,42,25,8,2,null,null,null,null,null,null,null],[416,412,383,364,316,259,213,157,107,80,37,30,12,12,4,null,1,null],[39,42,40,20,17,13,9,3,1,5,1,null,null,1,null,1,null,86]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>f<\/th>\n      <th>m<\/th>\n      <th>missing_gender<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"name":"age_cat5","targets":0},{"name":"f","targets":1},{"name":"m","targets":2},{"name":"missing_gender","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Để thiết lập chủ đề cho tháp tuổi, chúng ta sẽ xoay trục dữ liệu sang dạng “dọc” bằng hàm <code>pivot_longer()</code> trong package <strong>dplyr</strong>. Đó là bởi vì <code>ggplot()</code> thường thích dữ liệu được bố trí ở dạng “dọc”, và package <strong>apyramid</strong> đang sử dụng <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb1575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1575-1"><a href="age-pyramid.html#cb1575-1" tabindex="-1"></a><span class="co"># pivot the aggregated data into long format</span></span>
<span id="cb1575-2"><a href="age-pyramid.html#cb1575-2" tabindex="-1"></a>demo_agg_long <span class="ot">&lt;-</span> demo_agg <span class="sc">%&gt;%</span> </span>
<span id="cb1575-3"><a href="age-pyramid.html#cb1575-3" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb1575-4"><a href="age-pyramid.html#cb1575-4" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(f, m, missing_gender),            <span class="co"># cols to elongate</span></span>
<span id="cb1575-5"><a href="age-pyramid.html#cb1575-5" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;gender&quot;</span>,                <span class="co"># name for new col of categories</span></span>
<span id="cb1575-6"><a href="age-pyramid.html#cb1575-6" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span>           <span class="co"># name for new col of counts</span></span>
<span id="cb1575-7"><a href="age-pyramid.html#cb1575-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1575-8"><a href="age-pyramid.html#cb1575-8" tabindex="-1"></a>    <span class="at">gender =</span> <span class="fu">na_if</span>(gender, <span class="st">&quot;missing_gender&quot;</span>)) <span class="co"># convert &quot;missing_gender&quot; to NA</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-2aebb60f4db1a40e8b81" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-2aebb60f4db1a40e8b81">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"641\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["0-4","0-4","0-4","5-9","5-9","5-9","10-14","10-14","10-14","15-19","15-19","15-19","20-24","20-24","20-24","25-29","25-29","25-29","30-34","30-34","30-34","35-39","35-39","35-39","40-44","40-44","40-44","45-49","45-49","45-49","50-54","50-54","50-54","55-59","55-59","55-59","60-64","60-64","60-64","65-69","65-69","65-69","70-74","70-74","70-74","75-79","75-79","75-79","80-84","80-84","80-84",null,null,null],["f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null],[640,416,39,641,412,42,518,383,40,359,364,20,305,316,17,163,259,13,104,213,9,42,157,3,25,107,1,8,80,5,2,37,1,null,30,null,null,12,null,null,12,1,null,4,null,null,null,1,null,1,null,null,null,86]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>gender<\/th>\n      <th>counts<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2},{"name":"age_cat5","targets":0},{"name":"gender","targets":1},{"name":"counts","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Sau đó sử dụng các đối số <code>split_by =</code> và <code>count =</code> của hàm <code>age_pyramid()</code> để chỉ định các cột tương ứng trong bộ dữ liệu:</p>
<div class="sourceCode" id="cb1576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1576-1"><a href="age-pyramid.html#cb1576-1" tabindex="-1"></a>apyramid<span class="sc">::</span><span class="fu">age_pyramid</span>(<span class="at">data =</span> demo_agg_long,</span>
<span id="cb1576-2"><a href="age-pyramid.html#cb1576-2" tabindex="-1"></a>                      <span class="at">age_group =</span> <span class="st">&quot;age_cat5&quot;</span>,<span class="co"># column name for age category</span></span>
<span id="cb1576-3"><a href="age-pyramid.html#cb1576-3" tabindex="-1"></a>                      <span class="at">split_by =</span> <span class="st">&quot;gender&quot;</span>,   <span class="co"># column name for gender</span></span>
<span id="cb1576-4"><a href="age-pyramid.html#cb1576-4" tabindex="-1"></a>                      <span class="at">count =</span> <span class="st">&quot;counts&quot;</span>)      <span class="co"># column name for case counts</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1206-1.png" width="672" /></p>
<p>Lưu ý rằng ở trên, thứ tự của “m” và “f” là khác nhau (tháp bị đảo ngược). Để điều chỉnh thự tự, bạn phải định nghĩa lại cột giới trong dữ liệu được tổng hợp thành kiểu Factor và sắp xếp thứ tự như mong muốn. Xem chương <a href="factors.html#factors">Factors</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="demo_pyr_gg" class="section level2" number="33.3">
<h2><span class="header-section-number">33.3</span> <code>ggplot()</code></h2>
<p>Sử dụng <code>ggplot()</code> cho phép bạn xây dựng tháp tuổi một cách linh hoạt hơn, nhưng đòi hỏi nhiều nỗ lực và hiểu biết hơn về cách hoạt động của <code>ggplot()</code>. Việc vô tình mắc sai lầm cũng dễ dàng hơn.</p>
<p>Để sử dụng <code>ggplot()</code> tạo tháp nhân khẩu học, bạn tạo hai biểu đồ cột (cho từng giới tính), chuyển đổi các giá trị trong một biểu đồ thành âm và cuối cùng lật các trục x và y để hiển thị các biểu đồ cột theo chiều dọc, xuất phát điểm của chúng gặp nhau ở chính giữa biểu đồ.</p>
<div id="chuẩn-bị-25" class="section level3 unnumbered">
<h3>Chuẩn bị</h3>
<p>Cách tiếp cận này sử dụng cột tuổi ở dạng <em>numeric</em>, không phải cột nhóm tuổi <code>age_cat5</code> dạng <em>categorical</em>. Vì vậy, chúng ta cần kiểm tra để đảm bảo rằng kiểu của cột này thực sự là dạng số.</p>
<div class="sourceCode" id="cb1577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1577-1"><a href="age-pyramid.html#cb1577-1" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Bạn có thể sử dụng logic tương tự như dưới đây để xây dựng một kim tự tháp từ dữ liệu dạng danh mục sử dụng <code>geom_col()</code> thay vì <code>geom_histogram()</code>.</p>
<!-- ======================================================= -->
</div>
<div id="xây-dựng-biểu-đồ" class="section level3 unnumbered">
<h3>Xây dựng biểu đồ</h3>
<p>Trước tiên, hãy hiểu rằng để tạo một kim tự tháp như vậy bằng cách sử dụng <code>ggplot()</code>, cách tiếp cận sẽ là như sau:</p>
<ul>
<li><p>Bên trong hàm <code>ggplot()</code>, tạo <strong>hai</strong> biểu đồ histograms sử dụng cột tuổi dạng numeric, tương ứng cho hai nhóm (trong trường hợp này là giới nam và nữ). Để thực hiện việc này, dữ liệu cho mỗi biểu đồ được chỉ định trong các lệnh <code>geom_histogram()</code> tương ứng của chúng, với các bộ lọc tương ứng được áp dụng cho bộ dữ liệu <code>linelist</code>.</p></li>
<li><p>Một biểu đồ sẽ có các giá trị dương, trong khi biểu đồ kia sẽ có các giá trị được chuyển thành giá trị âm - điều này tạo ra “kim tự tháp” với giá trị <code>0</code> ở giữa biểu đồ. Các giá trị âm được tạo bằng cách sử dụng thuật ngữ đặc biệt của <strong>ggplot2</strong> là <code>..count..</code> và nhân với -1.</p></li>
<li><p>Lệnh <code>coord_flip()</code> chuyển trục X và Y, dẫn đến các đồ thị quay dọc và tạo ra hình kim tự tháp.</p></li>
<li><p>Cuối cùng, các nhãn giá trị trục đếm phải được thay đổi để chúng xuất hiện dưới dạng số “dương” trên cả hai mặt của kim tự tháp (mặc dù các giá trị thực tế ở một mặt là âm).</p></li>
</ul>
<p>Một phiên bản <strong>đơn giản</strong> của biểu đồ, sử dụng hàm <code>geom_histogram()</code>, như dưới đây:</p>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1579-1"><a href="age-pyramid.html#cb1579-1" tabindex="-1"></a>  <span class="co"># begin ggplot</span></span>
<span id="cb1579-2"><a href="age-pyramid.html#cb1579-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">fill =</span> gender)) <span class="sc">+</span></span>
<span id="cb1579-3"><a href="age-pyramid.html#cb1579-3" tabindex="-1"></a>  </span>
<span id="cb1579-4"><a href="age-pyramid.html#cb1579-4" tabindex="-1"></a>  <span class="co"># female histogram</span></span>
<span id="cb1579-5"><a href="age-pyramid.html#cb1579-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span>),</span>
<span id="cb1579-6"><a href="age-pyramid.html#cb1579-6" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">85</span>,<span class="dv">5</span>),</span>
<span id="cb1579-7"><a href="age-pyramid.html#cb1579-7" tabindex="-1"></a>                 <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1579-8"><a href="age-pyramid.html#cb1579-8" tabindex="-1"></a>  </span>
<span id="cb1579-9"><a href="age-pyramid.html#cb1579-9" tabindex="-1"></a>  <span class="co"># male histogram (values converted to negative)</span></span>
<span id="cb1579-10"><a href="age-pyramid.html#cb1579-10" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">data =</span> linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span>),</span>
<span id="cb1579-11"><a href="age-pyramid.html#cb1579-11" tabindex="-1"></a>                 <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">85</span>,<span class="dv">5</span>),</span>
<span id="cb1579-12"><a href="age-pyramid.html#cb1579-12" tabindex="-1"></a>                 <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> ..count..<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb1579-13"><a href="age-pyramid.html#cb1579-13" tabindex="-1"></a>                 <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1579-14"><a href="age-pyramid.html#cb1579-14" tabindex="-1"></a>  </span>
<span id="cb1579-15"><a href="age-pyramid.html#cb1579-15" tabindex="-1"></a>  <span class="co"># flip the X and Y axes</span></span>
<span id="cb1579-16"><a href="age-pyramid.html#cb1579-16" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1579-17"><a href="age-pyramid.html#cb1579-17" tabindex="-1"></a>  </span>
<span id="cb1579-18"><a href="age-pyramid.html#cb1579-18" tabindex="-1"></a>  <span class="co"># adjust counts-axis scale</span></span>
<span id="cb1579-19"><a href="age-pyramid.html#cb1579-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">900</span>),</span>
<span id="cb1579-20"><a href="age-pyramid.html#cb1579-20" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">600</span>,<span class="dv">900</span>,<span class="dv">100</span>),</span>
<span id="cb1579-21"><a href="age-pyramid.html#cb1579-21" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">abs</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">600</span>, <span class="dv">900</span>, <span class="dv">100</span>)))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1208-1.png" width="672" /></p>
<p><span style="color: red;"><strong><em>NGUY HIỂM:</em></strong> Nếu như <strong>giới hạn</strong> của trục counts được thiết lập quá nhỏ, và cột số lượng vượt quá giá trị đó, cột sẽ biến mất hoàn toàn hoặc bị rút ngắn một cách không tự nhiên! Hãy chú ý điều này nếu dữ liệu phân tích thường xuyên được cập nhật. Có thể ngăn chặn điều này bằng cách tự động điều chỉnh các giới hạn trục count cho phù hợp với dữ liệu của bạn, như dưới đây.</span></p>
<p>Có nhiều thứ bạn có thể thay đổi/thêm vào phiên bản đơn giản này, bao gồm:</p>
<ul>
<li>Tự động điều chỉnh tỷ lệ trục count cho dữ liệu của bạn (tránh các lỗi được thảo luận trong cảnh báo bên dưới)<br />
</li>
<li>Chỉ định màu sắc và nhãn chú giải một cách thủ công</li>
</ul>
<p><strong>Chuyển đổi số lượng thành tỷ lệ phần trăm</strong></p>
<p>Để chuyển đổi số lượng thành phần trăm (của tổng số), hãy thực hiện điều này với dữ liệu của bạn trước khi vẽ biểu đồ. Dưới đây, chúng ta lấy số lượng của age-gender, sau đó <code>ungroup()</code>, và tiếp tục <code>mutate()</code> để tạo cột phần trăm mới. Nếu bạn muốn phần trăm theo giới tính, hãy bỏ qua bước hủy nhóm.</p>
<div class="sourceCode" id="cb1580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1580-1"><a href="age-pyramid.html#cb1580-1" tabindex="-1"></a><span class="co"># create dataset with proportion of total</span></span>
<span id="cb1580-2"><a href="age-pyramid.html#cb1580-2" tabindex="-1"></a>pyramid_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb1580-3"><a href="age-pyramid.html#cb1580-3" tabindex="-1"></a>  <span class="fu">count</span>(age_cat5,</span>
<span id="cb1580-4"><a href="age-pyramid.html#cb1580-4" tabindex="-1"></a>        gender,</span>
<span id="cb1580-5"><a href="age-pyramid.html#cb1580-5" tabindex="-1"></a>        <span class="at">name =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1580-6"><a href="age-pyramid.html#cb1580-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>                 <span class="co"># ungroup so percents are not by group</span></span>
<span id="cb1580-7"><a href="age-pyramid.html#cb1580-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>(counts <span class="sc">/</span> <span class="fu">sum</span>(counts, <span class="at">na.rm=</span>T)), <span class="at">digits =</span> <span class="dv">1</span>), </span>
<span id="cb1580-8"><a href="age-pyramid.html#cb1580-8" tabindex="-1"></a>         <span class="at">percent =</span> <span class="fu">case_when</span>(</span>
<span id="cb1580-9"><a href="age-pyramid.html#cb1580-9" tabindex="-1"></a>            gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span> <span class="sc">~</span> percent,</span>
<span id="cb1580-10"><a href="age-pyramid.html#cb1580-10" tabindex="-1"></a>            gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">~</span> <span class="sc">-</span>percent,     <span class="co"># convert male to negative</span></span>
<span id="cb1580-11"><a href="age-pyramid.html#cb1580-11" tabindex="-1"></a>            <span class="cn">TRUE</span>          <span class="sc">~</span> <span class="cn">NA_real_</span>))    <span class="co"># NA val must by numeric as well</span></span></code></pre></div>
<p>Quan trọng là, chúng ta lưu các giá trị lớn nhất vầ nhỏ nhất để chúng ta biết giới hạn của thang đo. Chúng sẽ được sử dụng trong lệnh <code>ggplot()</code> dưới đây.</p>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1581-1"><a href="age-pyramid.html#cb1581-1" tabindex="-1"></a>max_per <span class="ot">&lt;-</span> <span class="fu">max</span>(pyramid_data<span class="sc">$</span>percent, <span class="at">na.rm=</span>T)</span>
<span id="cb1581-2"><a href="age-pyramid.html#cb1581-2" tabindex="-1"></a>min_per <span class="ot">&lt;-</span> <span class="fu">min</span>(pyramid_data<span class="sc">$</span>percent, <span class="at">na.rm=</span>T)</span>
<span id="cb1581-3"><a href="age-pyramid.html#cb1581-3" tabindex="-1"></a></span>
<span id="cb1581-4"><a href="age-pyramid.html#cb1581-4" tabindex="-1"></a>max_per</span></code></pre></div>
<pre><code>## [1] 10.9</code></pre>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1583-1"><a href="age-pyramid.html#cb1583-1" tabindex="-1"></a>min_per</span></code></pre></div>
<pre><code>## [1] -7.1</code></pre>
<p>Cuối cùng, chúng ta dùng hàm <code>ggplot()</code> trên dữ liệu phần trăm. Chúng ta chỉ rõ <code>scale_y_continuous()</code> để mở rộng độ dài được xác định trước theo mỗi hướng (dương và “âm”). Chúng ta sử dụng hàm <code>floor()</code> vả <code>ceiling()</code> để làm tròn số thập phân theo cách thích hợp (làm tròn xuống hoặc lên).</p>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1585-1"><a href="age-pyramid.html#cb1585-1" tabindex="-1"></a><span class="co"># begin ggplot</span></span>
<span id="cb1585-2"><a href="age-pyramid.html#cb1585-2" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span>  <span class="co"># default x-axis is age in years;</span></span>
<span id="cb1585-3"><a href="age-pyramid.html#cb1585-3" tabindex="-1"></a></span>
<span id="cb1585-4"><a href="age-pyramid.html#cb1585-4" tabindex="-1"></a>  <span class="co"># case data graph</span></span>
<span id="cb1585-5"><a href="age-pyramid.html#cb1585-5" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">data =</span> pyramid_data,</span>
<span id="cb1585-6"><a href="age-pyramid.html#cb1585-6" tabindex="-1"></a>           <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1585-7"><a href="age-pyramid.html#cb1585-7" tabindex="-1"></a>             <span class="at">x =</span> age_cat5,</span>
<span id="cb1585-8"><a href="age-pyramid.html#cb1585-8" tabindex="-1"></a>             <span class="at">y =</span> percent,</span>
<span id="cb1585-9"><a href="age-pyramid.html#cb1585-9" tabindex="-1"></a>             <span class="at">fill =</span> gender),         </span>
<span id="cb1585-10"><a href="age-pyramid.html#cb1585-10" tabindex="-1"></a>           <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>)<span class="sc">+</span>       <span class="co"># white around each bar</span></span>
<span id="cb1585-11"><a href="age-pyramid.html#cb1585-11" tabindex="-1"></a>  </span>
<span id="cb1585-12"><a href="age-pyramid.html#cb1585-12" tabindex="-1"></a>  <span class="co"># flip the X and Y axes to make pyramid vertical</span></span>
<span id="cb1585-13"><a href="age-pyramid.html#cb1585-13" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb1585-14"><a href="age-pyramid.html#cb1585-14" tabindex="-1"></a>  </span>
<span id="cb1585-15"><a href="age-pyramid.html#cb1585-15" tabindex="-1"></a></span>
<span id="cb1585-16"><a href="age-pyramid.html#cb1585-16" tabindex="-1"></a>  <span class="co"># adjust the axes scales</span></span>
<span id="cb1585-17"><a href="age-pyramid.html#cb1585-17" tabindex="-1"></a>  <span class="co"># scale_x_continuous(breaks = seq(0,100,5), labels = seq(0,100,5)) +</span></span>
<span id="cb1585-18"><a href="age-pyramid.html#cb1585-18" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1585-19"><a href="age-pyramid.html#cb1585-19" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(min_per, max_per),</span>
<span id="cb1585-20"><a href="age-pyramid.html#cb1585-20" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">floor</span>(min_per),                <span class="co"># sequence of values, by 2s</span></span>
<span id="cb1585-21"><a href="age-pyramid.html#cb1585-21" tabindex="-1"></a>                 <span class="at">to =</span> <span class="fu">ceiling</span>(max_per),</span>
<span id="cb1585-22"><a href="age-pyramid.html#cb1585-22" tabindex="-1"></a>                 <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb1585-23"><a href="age-pyramid.html#cb1585-23" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">abs</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">floor</span>(min_per),     <span class="co"># sequence of absolute values, by 2s, with &quot;%&quot;</span></span>
<span id="cb1585-24"><a href="age-pyramid.html#cb1585-24" tabindex="-1"></a>                            <span class="at">to =</span> <span class="fu">ceiling</span>(max_per),</span>
<span id="cb1585-25"><a href="age-pyramid.html#cb1585-25" tabindex="-1"></a>                            <span class="at">by =</span> <span class="dv">2</span>)),</span>
<span id="cb1585-26"><a href="age-pyramid.html#cb1585-26" tabindex="-1"></a>                    <span class="st">&quot;%&quot;</span>))<span class="sc">+</span>  </span>
<span id="cb1585-27"><a href="age-pyramid.html#cb1585-27" tabindex="-1"></a></span>
<span id="cb1585-28"><a href="age-pyramid.html#cb1585-28" tabindex="-1"></a>  <span class="co"># designate colors and legend labels manually</span></span>
<span id="cb1585-29"><a href="age-pyramid.html#cb1585-29" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb1585-30"><a href="age-pyramid.html#cb1585-30" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>,</span>
<span id="cb1585-31"><a href="age-pyramid.html#cb1585-31" tabindex="-1"></a>               <span class="st">&quot;m&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkgreen&quot;</span>),</span>
<span id="cb1585-32"><a href="age-pyramid.html#cb1585-32" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1585-33"><a href="age-pyramid.html#cb1585-33" tabindex="-1"></a>  </span>
<span id="cb1585-34"><a href="age-pyramid.html#cb1585-34" tabindex="-1"></a>  <span class="co"># label values (remember X and Y flipped now)</span></span>
<span id="cb1585-35"><a href="age-pyramid.html#cb1585-35" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1585-36"><a href="age-pyramid.html#cb1585-36" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Age and gender of cases&quot;</span>,</span>
<span id="cb1585-37"><a href="age-pyramid.html#cb1585-37" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age group&quot;</span>,</span>
<span id="cb1585-38"><a href="age-pyramid.html#cb1585-38" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percent of total&quot;</span>,</span>
<span id="cb1585-39"><a href="age-pyramid.html#cb1585-39" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb1585-40"><a href="age-pyramid.html#cb1585-40" tabindex="-1"></a>    <span class="at">caption =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;Data are from linelist </span><span class="sc">\n</span><span class="st">n = {nrow(linelist)} (age or sex missing for {sum(is.na(linelist$gender) | is.na(linelist$age_years))} cases) </span><span class="sc">\n</span><span class="st">Data as of: {format(Sys.Date(), &#39;%d %b %Y&#39;)}&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1585-41"><a href="age-pyramid.html#cb1585-41" tabindex="-1"></a>  </span>
<span id="cb1585-42"><a href="age-pyramid.html#cb1585-42" tabindex="-1"></a>  <span class="co"># display themes</span></span>
<span id="cb1585-43"><a href="age-pyramid.html#cb1585-43" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1585-44"><a href="age-pyramid.html#cb1585-44" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1585-45"><a href="age-pyramid.html#cb1585-45" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1585-46"><a href="age-pyramid.html#cb1585-46" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1585-47"><a href="age-pyramid.html#cb1585-47" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb1585-48"><a href="age-pyramid.html#cb1585-48" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>), </span>
<span id="cb1585-49"><a href="age-pyramid.html#cb1585-49" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">size=</span><span class="dv">11</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>)</span>
<span id="cb1585-50"><a href="age-pyramid.html#cb1585-50" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1211-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="so-sánh-với-đường-cơ-sở" class="section level3 unnumbered">
<h3>So sánh với đường cơ sở</h3>
<p>With the flexibility of <code>ggplot()</code>, you can have a second layer of bars in the background that represent the “true” or “baseline” population pyramid. This can provide a nice visualization to compare the observed with the baseline.</p>
<p>Với sự linh hoạt của <code>ggplot()</code>, bạn có thể có lớp thanh thứ hai trong nền đại diện cho tháp dân số “chuẩn” hoặc “đường cơ sở”. Điều này có thể cung cấp khả năng trực quan hóa tốt để so sánh những gì quan sát được với đường cơ sở.</p>
<p>Nhập và xem dữ liệu dân số (xem chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a>):</p>
<div class="sourceCode" id="cb1586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1586-1"><a href="age-pyramid.html#cb1586-1" tabindex="-1"></a><span class="co"># import the population demographics data</span></span>
<span id="cb1586-2"><a href="age-pyramid.html#cb1586-2" tabindex="-1"></a>pop <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;country_demographics.csv&quot;</span>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f61dc9a86335ae4caaac" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f61dc9a86335ae4caaac">{"x":{"filter":"none","vertical":false,"data":[["0-4","5-9","10-14","15-19","20-24","25-29","30-34","35-39","40-44","45-49","50-54","55-59","60-64","65-69","70-74","75-79","80-84","85+"],[7828087,6705882,5601230,4576430,3734111,3111651,2571215,2121247,1735468,1418749,1145345,900239,685141,500248,347093,202240,94325,40402],[7674675,6592449,5522555,4533885,3726537,3118040,2592416,2150490,1771213,1459439,1193903,956070,745682,563894,416543,258538,130479,64656]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>m<\/th>\n      <th>f<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"age_cat5","targets":0},{"name":"m","targets":1},{"name":"f","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Đầu tiên là một số bước quản lý dữ liệu:</p>
<p>Ở đây chúng ta sắp xếp lại thứ tự của các danh mục tuổi mà chúng ta muốn chúng xuất hiện. Do một số điểm khác biệt trong cách thực thi <code>ggplot()</code>, trong trường hợp cụ thể này, dễ dàng nhất là lưu trữ chúng dưới dạng vectơ ký tự và sử dụng chúng sau này trong hàm vẽ đồ thị.</p>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1587-1"><a href="age-pyramid.html#cb1587-1" tabindex="-1"></a><span class="co"># record correct age cat levels</span></span>
<span id="cb1587-2"><a href="age-pyramid.html#cb1587-2" tabindex="-1"></a>age_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;0-4&quot;</span>,<span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-24&quot;</span>,</span>
<span id="cb1587-3"><a href="age-pyramid.html#cb1587-3" tabindex="-1"></a>                <span class="st">&quot;25-29&quot;</span>,<span class="st">&quot;30-34&quot;</span>, <span class="st">&quot;35-39&quot;</span>, <span class="st">&quot;40-44&quot;</span>, <span class="st">&quot;45-49&quot;</span>,</span>
<span id="cb1587-4"><a href="age-pyramid.html#cb1587-4" tabindex="-1"></a>                <span class="st">&quot;50-54&quot;</span>, <span class="st">&quot;55-59&quot;</span>, <span class="st">&quot;60-64&quot;</span>, <span class="st">&quot;65-69&quot;</span>, <span class="st">&quot;70-74&quot;</span>,</span>
<span id="cb1587-5"><a href="age-pyramid.html#cb1587-5" tabindex="-1"></a>                <span class="st">&quot;75-79&quot;</span>, <span class="st">&quot;80-84&quot;</span>, <span class="st">&quot;85+&quot;</span>)</span></code></pre></div>
<p>Kết hợp dữ liệu quần thể và dữ liệu trường hợp thông qua hàm <code>bind_rows()</code> của package <strong>dplyr</strong>:</p>
<ul>
<li>Trước tiên, hãy đảm bảo hai bộ dữ liệu có tên cột <em>giống nhau</em>, các giá trị nhóm tuổi và giá trị giới tính<br />
</li>
<li>Làm cho chúng có cấu trúc dữ liệu giống nhau: cột nhóm tuổi, giới tính, số lượng và phần trăm tổng số</li>
<li>Gắn chúng lại với nhau, một bộ dữ liệu này ở trên bộ dữ liệu kia (<code>bind_rows()</code>)</li>
</ul>
<div class="sourceCode" id="cb1588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1588-1"><a href="age-pyramid.html#cb1588-1" tabindex="-1"></a><span class="co"># create/transform populaton data, with percent of total</span></span>
<span id="cb1588-2"><a href="age-pyramid.html#cb1588-2" tabindex="-1"></a><span class="do">########################################################</span></span>
<span id="cb1588-3"><a href="age-pyramid.html#cb1588-3" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> pop <span class="sc">%&gt;%</span> </span>
<span id="cb1588-4"><a href="age-pyramid.html#cb1588-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(      <span class="co"># pivot gender columns longer</span></span>
<span id="cb1588-5"><a href="age-pyramid.html#cb1588-5" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(m, f),</span>
<span id="cb1588-6"><a href="age-pyramid.html#cb1588-6" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;gender&quot;</span>,</span>
<span id="cb1588-7"><a href="age-pyramid.html#cb1588-7" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1588-8"><a href="age-pyramid.html#cb1588-8" tabindex="-1"></a>  </span>
<span id="cb1588-9"><a href="age-pyramid.html#cb1588-9" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1588-10"><a href="age-pyramid.html#cb1588-10" tabindex="-1"></a>    <span class="at">percent  =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>(counts <span class="sc">/</span> <span class="fu">sum</span>(counts, <span class="at">na.rm=</span>T)),<span class="dv">1</span>),  <span class="co"># % of total</span></span>
<span id="cb1588-11"><a href="age-pyramid.html#cb1588-11" tabindex="-1"></a>    <span class="at">percent  =</span> <span class="fu">case_when</span>(                                                        </span>
<span id="cb1588-12"><a href="age-pyramid.html#cb1588-12" tabindex="-1"></a>     gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span> <span class="sc">~</span> percent,</span>
<span id="cb1588-13"><a href="age-pyramid.html#cb1588-13" tabindex="-1"></a>     gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">~</span> <span class="sc">-</span>percent,               <span class="co"># if male, convert % to negative</span></span>
<span id="cb1588-14"><a href="age-pyramid.html#cb1588-14" tabindex="-1"></a>     <span class="cn">TRUE</span>          <span class="sc">~</span> <span class="cn">NA_real_</span>))</span></code></pre></div>
<p>Xem lại bộ dữ liệu dân số đã thay đổi</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e2fec86ab5d3cba55f5c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e2fec86ab5d3cba55f5c">{"x":{"filter":"none","vertical":false,"data":[["0-4","0-4","5-9","5-9","10-14","10-14","15-19","15-19","20-24","20-24","25-29","25-29","30-34","30-34","35-39","35-39","40-44","40-44","45-49","45-49","50-54","50-54","55-59","55-59","60-64","60-64","65-69","65-69","70-74","70-74","75-79","75-79","80-84","80-84","85+","85+"],["m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f","m","f"],[7828087,7674675,6705882,6592449,5601230,5522555,4576430,4533885,3734111,3726537,3111651,3118040,2571215,2592416,2121247,2150490,1735468,1771213,1418749,1459439,1145345,1193903,900239,956070,685141,745682,500248,563894,347093,416543,202240,258538,94325,130479,40402,64656],[-9,8.800000000000001,-7.7,7.6,-6.5,6.4,-5.3,5.2,-4.3,4.3,-3.6,3.6,-3,3,-2.4,2.5,-2,2,-1.6,1.7,-1.3,1.4,-1,1.1,-0.8,0.9,-0.6,0.6,-0.4,0.5,-0.2,0.3,-0.1,0.2,-0,0.1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>gender<\/th>\n      <th>counts<\/th>\n      <th>percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"name":"age_cat5","targets":0},{"name":"gender","targets":1},{"name":"counts","targets":2},{"name":"percent","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Bây giờ thực hiện tương tự cho bộ linelist. Sẽ hơi khác một chút bởi vì nó bắt đầu với các trường hợp theo hàng, không phải số lượng.</p>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1589-1"><a href="age-pyramid.html#cb1589-1" tabindex="-1"></a><span class="co"># create case data by age/gender, with percent of total</span></span>
<span id="cb1589-2"><a href="age-pyramid.html#cb1589-2" tabindex="-1"></a><span class="do">#######################################################</span></span>
<span id="cb1589-3"><a href="age-pyramid.html#cb1589-3" tabindex="-1"></a>case_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb1589-4"><a href="age-pyramid.html#cb1589-4" tabindex="-1"></a>  <span class="fu">count</span>(age_cat5, gender, <span class="at">name =</span> <span class="st">&quot;counts&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># counts by age-gender groups</span></span>
<span id="cb1589-5"><a href="age-pyramid.html#cb1589-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1589-6"><a href="age-pyramid.html#cb1589-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1589-7"><a href="age-pyramid.html#cb1589-7" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>(counts <span class="sc">/</span> <span class="fu">sum</span>(counts, <span class="at">na.rm=</span>T)),<span class="dv">1</span>),  <span class="co"># calculate % of total for age-gender groups</span></span>
<span id="cb1589-8"><a href="age-pyramid.html#cb1589-8" tabindex="-1"></a>    <span class="at">percent =</span> <span class="fu">case_when</span>(                                     <span class="co"># convert % to negative if male</span></span>
<span id="cb1589-9"><a href="age-pyramid.html#cb1589-9" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span> <span class="sc">~</span> percent,</span>
<span id="cb1589-10"><a href="age-pyramid.html#cb1589-10" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">~</span> <span class="sc">-</span>percent,</span>
<span id="cb1589-11"><a href="age-pyramid.html#cb1589-11" tabindex="-1"></a>      <span class="cn">TRUE</span>          <span class="sc">~</span> <span class="cn">NA_real_</span>))</span></code></pre></div>
<p>Xem lại bộ dữ liệu trường hợp đã thay đổi</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-dd69c9bea4a02a3423d2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-dd69c9bea4a02a3423d2">{"x":{"filter":"none","vertical":false,"data":[["0-4","0-4","0-4","5-9","5-9","5-9","10-14","10-14","10-14","15-19","15-19","15-19","20-24","20-24","20-24","25-29","25-29","25-29","30-34","30-34","30-34","35-39","35-39","35-39","40-44","40-44","40-44","45-49","45-49","45-49","50-54","50-54","50-54","55-59","60-64","65-69","65-69","70-74","75-79","80-84",null],["f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"f","m",null,"m","m","m",null,"m",null,"m",null],[640,416,39,641,412,42,518,383,40,359,364,20,305,316,17,163,259,13,104,213,9,42,157,3,25,107,1,8,80,5,2,37,1,30,12,12,1,4,1,1,86],[10.9,-7.1,null,10.9,-7,null,8.800000000000001,-6.5,null,6.1,-6.2,null,5.2,-5.4,null,2.8,-4.4,null,1.8,-3.6,null,0.7,-2.7,null,0.4,-1.8,null,0.1,-1.4,null,0,-0.6,null,-0.5,-0.2,-0.2,null,-0.1,null,-0,null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_cat5<\/th>\n      <th>gender<\/th>\n      <th>counts<\/th>\n      <th>percent<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"name":"age_cat5","targets":0},{"name":"gender","targets":1},{"name":"counts","targets":2},{"name":"percent","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Bây giờ hai data frame sẽ được kết hợp, cái này ở trên cái kia (chúng có cùng tên cột). Chúng ta có thể “đặt tên” cho từng data frame, và sử dụng đối số <code>.id =</code> để tạo một cột mới “data_source” sẽ cho biết dữ liệu có nguồn gốc từ data frame nào. Chúng tôi có thể sử dụng cột này để lọc với hàm <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb1590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1590-1"><a href="age-pyramid.html#cb1590-1" tabindex="-1"></a><span class="co"># combine case and population data (same column names, age_cat values, and gender values)</span></span>
<span id="cb1590-2"><a href="age-pyramid.html#cb1590-2" tabindex="-1"></a>pyramid_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="st">&quot;cases&quot;</span> <span class="ot">=</span> case_data, <span class="st">&quot;population&quot;</span> <span class="ot">=</span> pop_data, <span class="at">.id =</span> <span class="st">&quot;data_source&quot;</span>)</span></code></pre></div>
<p>Lưu trữ các giá trị phần trăm tối đa và tối thiểu, được sử dụng trong hàm vẽ biểu đồ để xác định phạm vi của biểu đồ (và không cắt ngắn bất kỳ cột nào!)</p>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1591-1"><a href="age-pyramid.html#cb1591-1" tabindex="-1"></a><span class="co"># Define extent of percent axis, used for plot limits</span></span>
<span id="cb1591-2"><a href="age-pyramid.html#cb1591-2" tabindex="-1"></a>max_per <span class="ot">&lt;-</span> <span class="fu">max</span>(pyramid_data<span class="sc">$</span>percent, <span class="at">na.rm=</span>T)</span>
<span id="cb1591-3"><a href="age-pyramid.html#cb1591-3" tabindex="-1"></a>min_per <span class="ot">&lt;-</span> <span class="fu">min</span>(pyramid_data<span class="sc">$</span>percent, <span class="at">na.rm=</span>T)</span></code></pre></div>
<p>Bây giờ biểu đồ được tạo bởi <code>ggplot()</code> có:</p>
<ul>
<li>Một biểu đồ cột ngang của dữ liệu dan số (rộng hơn, trong suốt)</li>
<li>Một biểu đồ cột ngang của dữ liệu các trường hợp (nhỏ hơn, đậm hơn)</li>
</ul>
<div class="sourceCode" id="cb1592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1592-1"><a href="age-pyramid.html#cb1592-1" tabindex="-1"></a><span class="co"># begin ggplot</span></span>
<span id="cb1592-2"><a href="age-pyramid.html#cb1592-2" tabindex="-1"></a><span class="do">##############</span></span>
<span id="cb1592-3"><a href="age-pyramid.html#cb1592-3" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span>  <span class="co"># default x-axis is age in years;</span></span>
<span id="cb1592-4"><a href="age-pyramid.html#cb1592-4" tabindex="-1"></a></span>
<span id="cb1592-5"><a href="age-pyramid.html#cb1592-5" tabindex="-1"></a>  <span class="co"># population data graph</span></span>
<span id="cb1592-6"><a href="age-pyramid.html#cb1592-6" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb1592-7"><a href="age-pyramid.html#cb1592-7" tabindex="-1"></a>    <span class="at">data =</span> pyramid_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(data_source <span class="sc">==</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1592-8"><a href="age-pyramid.html#cb1592-8" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1592-9"><a href="age-pyramid.html#cb1592-9" tabindex="-1"></a>      <span class="at">x =</span> age_cat5,</span>
<span id="cb1592-10"><a href="age-pyramid.html#cb1592-10" tabindex="-1"></a>      <span class="at">y =</span> percent,</span>
<span id="cb1592-11"><a href="age-pyramid.html#cb1592-11" tabindex="-1"></a>      <span class="at">fill =</span> gender),</span>
<span id="cb1592-12"><a href="age-pyramid.html#cb1592-12" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,                               <span class="co"># black color around bars</span></span>
<span id="cb1592-13"><a href="age-pyramid.html#cb1592-13" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>,                                    <span class="co"># more transparent</span></span>
<span id="cb1592-14"><a href="age-pyramid.html#cb1592-14" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1</span>)<span class="sc">+</span>                                     <span class="co"># full width</span></span>
<span id="cb1592-15"><a href="age-pyramid.html#cb1592-15" tabindex="-1"></a>  </span>
<span id="cb1592-16"><a href="age-pyramid.html#cb1592-16" tabindex="-1"></a>  <span class="co"># case data graph</span></span>
<span id="cb1592-17"><a href="age-pyramid.html#cb1592-17" tabindex="-1"></a>  <span class="fu">geom_col</span>(</span>
<span id="cb1592-18"><a href="age-pyramid.html#cb1592-18" tabindex="-1"></a>    <span class="at">data =</span> pyramid_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(data_source <span class="sc">==</span> <span class="st">&quot;cases&quot;</span>), </span>
<span id="cb1592-19"><a href="age-pyramid.html#cb1592-19" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1592-20"><a href="age-pyramid.html#cb1592-20" tabindex="-1"></a>      <span class="at">x =</span> age_cat5,                               <span class="co"># age categories as original X axis</span></span>
<span id="cb1592-21"><a href="age-pyramid.html#cb1592-21" tabindex="-1"></a>      <span class="at">y =</span> percent,                                <span class="co"># % as original Y-axis</span></span>
<span id="cb1592-22"><a href="age-pyramid.html#cb1592-22" tabindex="-1"></a>      <span class="at">fill =</span> gender),                             <span class="co"># fill of bars by gender</span></span>
<span id="cb1592-23"><a href="age-pyramid.html#cb1592-23" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,                               <span class="co"># black color around bars</span></span>
<span id="cb1592-24"><a href="age-pyramid.html#cb1592-24" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="dv">1</span>,                                      <span class="co"># not transparent </span></span>
<span id="cb1592-25"><a href="age-pyramid.html#cb1592-25" tabindex="-1"></a>    <span class="at">width =</span> <span class="fl">0.3</span>)<span class="sc">+</span>                                   <span class="co"># half width</span></span>
<span id="cb1592-26"><a href="age-pyramid.html#cb1592-26" tabindex="-1"></a>  </span>
<span id="cb1592-27"><a href="age-pyramid.html#cb1592-27" tabindex="-1"></a>  <span class="co"># flip the X and Y axes to make pyramid vertical</span></span>
<span id="cb1592-28"><a href="age-pyramid.html#cb1592-28" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb1592-29"><a href="age-pyramid.html#cb1592-29" tabindex="-1"></a>  </span>
<span id="cb1592-30"><a href="age-pyramid.html#cb1592-30" tabindex="-1"></a>  <span class="co"># manually ensure that age-axis is ordered correctly</span></span>
<span id="cb1592-31"><a href="age-pyramid.html#cb1592-31" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> age_levels)<span class="sc">+</span>     <span class="co"># defined in chunk above</span></span>
<span id="cb1592-32"><a href="age-pyramid.html#cb1592-32" tabindex="-1"></a>  </span>
<span id="cb1592-33"><a href="age-pyramid.html#cb1592-33" tabindex="-1"></a>  <span class="co"># set percent-axis </span></span>
<span id="cb1592-34"><a href="age-pyramid.html#cb1592-34" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1592-35"><a href="age-pyramid.html#cb1592-35" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(min_per, max_per),                                          <span class="co"># min and max defined above</span></span>
<span id="cb1592-36"><a href="age-pyramid.html#cb1592-36" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">floor</span>(min_per), <span class="fu">ceiling</span>(max_per), <span class="at">by =</span> <span class="dv">2</span>),                <span class="co"># from min% to max% by 2 </span></span>
<span id="cb1592-37"><a href="age-pyramid.html#cb1592-37" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">paste0</span>(                                                       <span class="co"># for the labels, paste together... </span></span>
<span id="cb1592-38"><a href="age-pyramid.html#cb1592-38" tabindex="-1"></a>              <span class="fu">abs</span>(<span class="fu">seq</span>(<span class="fu">floor</span>(min_per), <span class="fu">ceiling</span>(max_per), <span class="at">by =</span> <span class="dv">2</span>)), <span class="st">&quot;%&quot;</span>))<span class="sc">+</span>                                                  </span>
<span id="cb1592-39"><a href="age-pyramid.html#cb1592-39" tabindex="-1"></a></span>
<span id="cb1592-40"><a href="age-pyramid.html#cb1592-40" tabindex="-1"></a>  <span class="co"># designate colors and legend labels manually</span></span>
<span id="cb1592-41"><a href="age-pyramid.html#cb1592-41" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb1592-42"><a href="age-pyramid.html#cb1592-42" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span> <span class="ot">=</span> <span class="st">&quot;orange&quot;</span>,         <span class="co"># assign colors to values in the data</span></span>
<span id="cb1592-43"><a href="age-pyramid.html#cb1592-43" tabindex="-1"></a>               <span class="st">&quot;m&quot;</span> <span class="ot">=</span> <span class="st">&quot;darkgreen&quot;</span>),</span>
<span id="cb1592-44"><a href="age-pyramid.html#cb1592-44" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;f&quot;</span> <span class="ot">=</span> <span class="st">&quot;Female&quot;</span>,</span>
<span id="cb1592-45"><a href="age-pyramid.html#cb1592-45" tabindex="-1"></a>               <span class="st">&quot;m&quot;</span><span class="ot">=</span> <span class="st">&quot;Male&quot;</span>),      <span class="co"># change labels that appear in legend, note order</span></span>
<span id="cb1592-46"><a href="age-pyramid.html#cb1592-46" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1592-47"><a href="age-pyramid.html#cb1592-47" tabindex="-1"></a></span>
<span id="cb1592-48"><a href="age-pyramid.html#cb1592-48" tabindex="-1"></a>  <span class="co"># plot labels, titles, caption    </span></span>
<span id="cb1592-49"><a href="age-pyramid.html#cb1592-49" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1592-50"><a href="age-pyramid.html#cb1592-50" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Case age and gender distribution,</span><span class="sc">\n</span><span class="st">as compared to baseline population&quot;</span>,</span>
<span id="cb1592-51"><a href="age-pyramid.html#cb1592-51" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1592-52"><a href="age-pyramid.html#cb1592-52" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Age category&quot;</span>,</span>
<span id="cb1592-53"><a href="age-pyramid.html#cb1592-53" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Percent of total&quot;</span>,</span>
<span id="cb1592-54"><a href="age-pyramid.html#cb1592-54" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb1592-55"><a href="age-pyramid.html#cb1592-55" tabindex="-1"></a>    <span class="at">caption =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;Cases shown on top of country demographic baseline</span><span class="sc">\n</span><span class="st">Case data are from linelist, n = {nrow(linelist)}</span><span class="sc">\n</span><span class="st">Age or gender missing for {sum(is.na(linelist$gender) | is.na(linelist$age_years))} cases</span><span class="sc">\n</span><span class="st">Case data as of: {format(max(linelist$date_onset, na.rm=T), &#39;%d %b %Y&#39;)}&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1592-56"><a href="age-pyramid.html#cb1592-56" tabindex="-1"></a>  </span>
<span id="cb1592-57"><a href="age-pyramid.html#cb1592-57" tabindex="-1"></a>  <span class="co"># optional aesthetic themes</span></span>
<span id="cb1592-58"><a href="age-pyramid.html#cb1592-58" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1592-59"><a href="age-pyramid.html#cb1592-59" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,                             <span class="co"># move legend to bottom</span></span>
<span id="cb1592-60"><a href="age-pyramid.html#cb1592-60" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1592-61"><a href="age-pyramid.html#cb1592-61" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1592-62"><a href="age-pyramid.html#cb1592-62" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1592-63"><a href="age-pyramid.html#cb1592-63" tabindex="-1"></a>    <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb1592-64"><a href="age-pyramid.html#cb1592-64" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>), </span>
<span id="cb1592-65"><a href="age-pyramid.html#cb1592-65" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">size=</span><span class="dv">11</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1222-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="thang-đo-likert" class="section level2" number="33.4">
<h2><span class="header-section-number">33.4</span> Thang đo Likert</h2>
<p>Các kỹ thuật được sử dụng để tạo tháp dân số với <code>ggplot()</code> cũng có thể được sử dụng để lập các biểu đồ của dữ liệu khảo sát từ thang đo Likert.</p>
<p>Nhập dữ liệu (xem chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a> nếu cần).</p>
<div class="sourceCode" id="cb1593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1593-1"><a href="age-pyramid.html#cb1593-1" tabindex="-1"></a><span class="co"># import the likert survey response data</span></span>
<span id="cb1593-2"><a href="age-pyramid.html#cb1593-2" tabindex="-1"></a>likert_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;likert_data.csv&quot;</span>)</span></code></pre></div>
<p>Bắt đầu với dữ liệu giống như sau, với một biến phân loại từng người trả lời (<code>status</code>) và câu trả lời của họ cho 8 câu hỏi trên thang điểm Likert 4 mức độ (“Rất kém”, “Kém”, “Tốt”, “Rất tốt”).</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1a3140f7e3c46dcd12c2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1a3140f7e3c46dcd12c2">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Senior","Junior","Intermediate","Intermediate","Senior","Junior","Senior","Senior","Senior","Senior","Senior","Junior","Senior","Junior","Senior","Junior","Intermediate","Intermediate","Junior","Senior","Senior","Junior","Senior","Senior","Junior","Intermediate","Junior","Senior","Intermediate","Senior","Senior","Junior","Intermediate","Senior","Intermediate","Junior","Senior","Junior"],["Very Good","Very Good","Good","Good","Very Good","Good","Very Good","Good","Good","Good","Good","Good","Good","Good","Very Good","Good","Poor","Very Good","Very Good","Not applicable","Very Good","Good","Very Good","Very Good","Very Good","Very Good","Good","Good","Very Good","Very Good","Not applicable","Good","Very Good","Good","Good","Good","Not applicable","Good"],["Very Good","Very Good","Good","Poor","Very Poor","Very Good","Very Good","Good","Very Good","Very Good","Very Good","Very Good","Good","Very Good","Very Good","Good","Poor","Good","Very Good","Very Good","Very Good","Good","Very Good","Very Good","Very Good","Good","Good","Poor","Very Good","Very Good","Not applicable","Good","Very Good","Very Good","Good","Very Good","Good","Good"],["Good","Very Good","Good","Poor","Good","Good","Very Good","Very Good","Very Good","Good","Very Good","Very Good","Poor","Good","Good","Good","Good","Very Good","Very Good","Very Good","Very Good","Good","Very Good","Good","Very Good","Good","Poor","Poor","Very Good","Very Good","Not applicable","Good","Very Good","Good","Good","Good","Good","Good"],["Very Poor","Very Good","Very Good","Very Poor","Poor","Very Poor","","Very Good","Very Poor","Very Poor","Very Poor","Good","Very Poor","Very Good","Good","","Very Poor","Very Poor","Good","Poor","Very Poor","Good","Good","Very Poor","Very Poor","Good","Good","Good","Very Poor","Very Poor","Very Poor","Good","Good","Good","Good","Very Poor","Good","Good"],["Not applicable","Very Good","Not applicable","Not applicable","Poor","Not applicable","","Poor","Not applicable","Poor","Not applicable","Good","Not applicable","Poor","Good","","Not applicable","Not applicable","Very Good","Poor","Not applicable","Good","Poor","Not applicable","Not applicable","Good","Good","Poor","Not applicable","Very Poor","Not applicable","Poor","Good","Good","Poor","Not applicable","Poor","Good"],["Not applicable","Very Good","Not applicable","Not applicable","Very Poor","Not applicable","","Not applicable","Not applicable","Not applicable","Not applicable","Good","Not applicable","Poor","Good","","Not applicable","Not applicable","Good","Good","Not applicable","Good","Poor","Good","Not applicable","Very Good","Very Good","Good","Not applicable","Not applicable","Not applicable","Good","Good","Good","Good","Not applicable","Good","Not applicable"],["Very Good","Very Good","Good","Good","Good","Good","","Very Good","Not applicable","Very Good","Good","Good","Poor","Good","Good","Poor","Very Good","Good","Good","Very Good","Good","Good","Good","Good","Good","Very Good","Good","Poor","Very Good","Very Good","Not applicable","Very Good","Good","Poor","Good","Poor","Not applicable","Good"],["Very Good","Very Good","Good","Good","Good","Good","Very Good","Very Good","Good","Very Good","Good","Very Good","Good","Very Good","Good","Poor","Very Good","Good","Good","Very Good","Very Good","Good","Good","Good","Very Good","Poor","Good","Poor","Very Good","Very Good","Not applicable","Good","Good","Good","Good","Poor","Not applicable","Good"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>status<\/th>\n      <th>Q1<\/th>\n      <th>Q2<\/th>\n      <th>Q3<\/th>\n      <th>Q4<\/th>\n      <th>Q5<\/th>\n      <th>Q6<\/th>\n      <th>Q7<\/th>\n      <th>Q8<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"name":"status","targets":0},{"name":"Q1","targets":1},{"name":"Q2","targets":2},{"name":"Q3","targets":3},{"name":"Q4","targets":4},{"name":"Q5","targets":5},{"name":"Q6","targets":6},{"name":"Q7","targets":7},{"name":"Q8","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Đầu tiên là một vài bước quản lý số liệu:</p>
<ul>
<li>Xoay trục dữ liệu dài hơn</li>
<li>Tạo cột mới <code>direction</code> tùy thuộc vào việc phản hồi “tích cực” hay “tiêu cực”</li>
<li>Thiết lập thứ bậc kiểu factor cho cột <code>status</code> và cột <code>Response</code><br />
</li>
<li>Lưu trữ giá trị đếm tối đa để các giới hạn của biểu đồ là phù hợp</li>
</ul>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1594-1"><a href="age-pyramid.html#cb1594-1" tabindex="-1"></a>melted <span class="ot">&lt;-</span> likert_data <span class="sc">%&gt;%</span> </span>
<span id="cb1594-2"><a href="age-pyramid.html#cb1594-2" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb1594-3"><a href="age-pyramid.html#cb1594-3" tabindex="-1"></a>    <span class="at">cols =</span> Q1<span class="sc">:</span>Q8,</span>
<span id="cb1594-4"><a href="age-pyramid.html#cb1594-4" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;Question&quot;</span>,</span>
<span id="cb1594-5"><a href="age-pyramid.html#cb1594-5" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;Response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-6"><a href="age-pyramid.html#cb1594-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1594-7"><a href="age-pyramid.html#cb1594-7" tabindex="-1"></a>    </span>
<span id="cb1594-8"><a href="age-pyramid.html#cb1594-8" tabindex="-1"></a>    <span class="at">direction =</span> <span class="fu">case_when</span>(</span>
<span id="cb1594-9"><a href="age-pyramid.html#cb1594-9" tabindex="-1"></a>      Response <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Poor&quot;</span>,<span class="st">&quot;Very Poor&quot;</span>)  <span class="sc">~</span> <span class="st">&quot;Negative&quot;</span>,</span>
<span id="cb1594-10"><a href="age-pyramid.html#cb1594-10" tabindex="-1"></a>      Response <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Very Good&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Positive&quot;</span>,</span>
<span id="cb1594-11"><a href="age-pyramid.html#cb1594-11" tabindex="-1"></a>      <span class="cn">TRUE</span>                                 <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb1594-12"><a href="age-pyramid.html#cb1594-12" tabindex="-1"></a>    </span>
<span id="cb1594-13"><a href="age-pyramid.html#cb1594-13" tabindex="-1"></a>    <span class="at">status =</span> <span class="fu">fct_relevel</span>(status, <span class="st">&quot;Junior&quot;</span>, <span class="st">&quot;Intermediate&quot;</span>, <span class="st">&quot;Senior&quot;</span>),</span>
<span id="cb1594-14"><a href="age-pyramid.html#cb1594-14" tabindex="-1"></a>    </span>
<span id="cb1594-15"><a href="age-pyramid.html#cb1594-15" tabindex="-1"></a>    <span class="co"># must reverse &#39;Very Poor&#39; and &#39;Poor&#39; for ordering to work</span></span>
<span id="cb1594-16"><a href="age-pyramid.html#cb1594-16" tabindex="-1"></a>    <span class="at">Response =</span> <span class="fu">fct_relevel</span>(Response, <span class="st">&quot;Very Good&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Very Poor&quot;</span>, <span class="st">&quot;Poor&quot;</span>)) </span>
<span id="cb1594-17"><a href="age-pyramid.html#cb1594-17" tabindex="-1"></a></span>
<span id="cb1594-18"><a href="age-pyramid.html#cb1594-18" tabindex="-1"></a><span class="co"># get largest value for scale limits</span></span>
<span id="cb1594-19"><a href="age-pyramid.html#cb1594-19" tabindex="-1"></a>melted_max <span class="ot">&lt;-</span> melted <span class="sc">%&gt;%</span> </span>
<span id="cb1594-20"><a href="age-pyramid.html#cb1594-20" tabindex="-1"></a>  <span class="fu">count</span>(status, Question) <span class="sc">%&gt;%</span> <span class="co"># get counts</span></span>
<span id="cb1594-21"><a href="age-pyramid.html#cb1594-21" tabindex="-1"></a>  <span class="fu">pull</span>(n) <span class="sc">%&gt;%</span>                 <span class="co"># column &#39;n&#39;</span></span>
<span id="cb1594-22"><a href="age-pyramid.html#cb1594-22" tabindex="-1"></a>  <span class="fu">max</span>(<span class="at">na.rm=</span>T)                <span class="co"># get max</span></span></code></pre></div>
<p>Bây giờ hãy cùng vẽ biểu đồ. Tương tự các tháp tuổi ở trên, chúng ta đang tạo hai biểu đồ thanh và đảo các giá trị của một trong số chúng thành âm.</p>
<p>Chúng ta sử dụng hàm <code>geom_bar()</code> bởi vì dữ liệu của chúng ta mỗi quan sát nằm trên một hàng, không phải là số lượng tổng hợp. Chúng ta sử dụng thuật ngữ đặc biệt của <strong>ggplot2</strong> là <code>..count..</code> ở một biểu đồ thanh để đảo ngược các giá trị thành âm(*-1), sau đó chúng ta thiết lập <code>position = "stack"</code> để các giá trị xếp chồng lên nhau.</p>
<div class="sourceCode" id="cb1595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1595-1"><a href="age-pyramid.html#cb1595-1" tabindex="-1"></a><span class="co"># make plot</span></span>
<span id="cb1595-2"><a href="age-pyramid.html#cb1595-2" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb1595-3"><a href="age-pyramid.html#cb1595-3" tabindex="-1"></a>     </span>
<span id="cb1595-4"><a href="age-pyramid.html#cb1595-4" tabindex="-1"></a>  <span class="co"># bar graph of the &quot;negative&quot; responses </span></span>
<span id="cb1595-5"><a href="age-pyramid.html#cb1595-5" tabindex="-1"></a>     <span class="fu">geom_bar</span>(</span>
<span id="cb1595-6"><a href="age-pyramid.html#cb1595-6" tabindex="-1"></a>       <span class="at">data =</span> melted <span class="sc">%&gt;%</span> <span class="fu">filter</span>(direction <span class="sc">==</span> <span class="st">&quot;Negative&quot;</span>),</span>
<span id="cb1595-7"><a href="age-pyramid.html#cb1595-7" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1595-8"><a href="age-pyramid.html#cb1595-8" tabindex="-1"></a>         <span class="at">x =</span> status,</span>
<span id="cb1595-9"><a href="age-pyramid.html#cb1595-9" tabindex="-1"></a>         <span class="at">y =</span> ..count..<span class="sc">*</span>(<span class="sc">-</span><span class="dv">1</span>),    <span class="co"># counts inverted to negative</span></span>
<span id="cb1595-10"><a href="age-pyramid.html#cb1595-10" tabindex="-1"></a>         <span class="at">fill =</span> Response),</span>
<span id="cb1595-11"><a href="age-pyramid.html#cb1595-11" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1595-12"><a href="age-pyramid.html#cb1595-12" tabindex="-1"></a>       <span class="at">closed =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb1595-13"><a href="age-pyramid.html#cb1595-13" tabindex="-1"></a>       <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="sc">+</span></span>
<span id="cb1595-14"><a href="age-pyramid.html#cb1595-14" tabindex="-1"></a>     </span>
<span id="cb1595-15"><a href="age-pyramid.html#cb1595-15" tabindex="-1"></a>     <span class="co"># bar graph of the &quot;positive responses</span></span>
<span id="cb1595-16"><a href="age-pyramid.html#cb1595-16" tabindex="-1"></a>     <span class="fu">geom_bar</span>(</span>
<span id="cb1595-17"><a href="age-pyramid.html#cb1595-17" tabindex="-1"></a>       <span class="at">data =</span> melted <span class="sc">%&gt;%</span> <span class="fu">filter</span>(direction <span class="sc">==</span> <span class="st">&quot;Positive&quot;</span>),</span>
<span id="cb1595-18"><a href="age-pyramid.html#cb1595-18" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1595-19"><a href="age-pyramid.html#cb1595-19" tabindex="-1"></a>         <span class="at">x =</span> status,</span>
<span id="cb1595-20"><a href="age-pyramid.html#cb1595-20" tabindex="-1"></a>         <span class="at">fill =</span> Response),</span>
<span id="cb1595-21"><a href="age-pyramid.html#cb1595-21" tabindex="-1"></a>       <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1595-22"><a href="age-pyramid.html#cb1595-22" tabindex="-1"></a>       <span class="at">closed =</span> <span class="st">&quot;left&quot;</span>,</span>
<span id="cb1595-23"><a href="age-pyramid.html#cb1595-23" tabindex="-1"></a>       <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)<span class="sc">+</span></span>
<span id="cb1595-24"><a href="age-pyramid.html#cb1595-24" tabindex="-1"></a>     </span>
<span id="cb1595-25"><a href="age-pyramid.html#cb1595-25" tabindex="-1"></a>     <span class="co"># flip the X and Y axes</span></span>
<span id="cb1595-26"><a href="age-pyramid.html#cb1595-26" tabindex="-1"></a>     <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb1595-27"><a href="age-pyramid.html#cb1595-27" tabindex="-1"></a>  </span>
<span id="cb1595-28"><a href="age-pyramid.html#cb1595-28" tabindex="-1"></a>     <span class="co"># Black vertical line at 0</span></span>
<span id="cb1595-29"><a href="age-pyramid.html#cb1595-29" tabindex="-1"></a>     <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1595-30"><a href="age-pyramid.html#cb1595-30" tabindex="-1"></a>     </span>
<span id="cb1595-31"><a href="age-pyramid.html#cb1595-31" tabindex="-1"></a>    <span class="co"># convert labels to all positive numbers</span></span>
<span id="cb1595-32"><a href="age-pyramid.html#cb1595-32" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1595-33"><a href="age-pyramid.html#cb1595-33" tabindex="-1"></a>      </span>
<span id="cb1595-34"><a href="age-pyramid.html#cb1595-34" tabindex="-1"></a>      <span class="co"># limits of the x-axis scale</span></span>
<span id="cb1595-35"><a href="age-pyramid.html#cb1595-35" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fu">ceiling</span>(melted_max<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">11</span>,    <span class="co"># seq from neg to pos by 10, edges rounded outward to nearest 5</span></span>
<span id="cb1595-36"><a href="age-pyramid.html#cb1595-36" tabindex="-1"></a>                 <span class="fu">ceiling</span>(melted_max<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>),   </span>
<span id="cb1595-37"><a href="age-pyramid.html#cb1595-37" tabindex="-1"></a>      </span>
<span id="cb1595-38"><a href="age-pyramid.html#cb1595-38" tabindex="-1"></a>      <span class="co"># values of the x-axis scale</span></span>
<span id="cb1595-39"><a href="age-pyramid.html#cb1595-39" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fu">ceiling</span>(melted_max<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb1595-40"><a href="age-pyramid.html#cb1595-40" tabindex="-1"></a>                   <span class="at">to =</span> <span class="fu">ceiling</span>(melted_max<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb1595-41"><a href="age-pyramid.html#cb1595-41" tabindex="-1"></a>                   <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb1595-42"><a href="age-pyramid.html#cb1595-42" tabindex="-1"></a>      </span>
<span id="cb1595-43"><a href="age-pyramid.html#cb1595-43" tabindex="-1"></a>      <span class="co"># labels of the x-axis scale</span></span>
<span id="cb1595-44"><a href="age-pyramid.html#cb1595-44" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">abs</span>(<span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="fu">ceiling</span>(melted_max<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1595-45"><a href="age-pyramid.html#cb1595-45" tabindex="-1"></a>                            <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">ceiling</span>(melted_max<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>, <span class="dv">10</span>))))) <span class="sc">+</span></span>
<span id="cb1595-46"><a href="age-pyramid.html#cb1595-46" tabindex="-1"></a>     </span>
<span id="cb1595-47"><a href="age-pyramid.html#cb1595-47" tabindex="-1"></a>    <span class="co"># color scales manually assigned </span></span>
<span id="cb1595-48"><a href="age-pyramid.html#cb1595-48" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb1595-49"><a href="age-pyramid.html#cb1595-49" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Very Good&quot;</span>  <span class="ot">=</span> <span class="st">&quot;green4&quot;</span>, <span class="co"># assigns colors</span></span>
<span id="cb1595-50"><a href="age-pyramid.html#cb1595-50" tabindex="-1"></a>                <span class="st">&quot;Good&quot;</span>      <span class="ot">=</span> <span class="st">&quot;green3&quot;</span>,</span>
<span id="cb1595-51"><a href="age-pyramid.html#cb1595-51" tabindex="-1"></a>                <span class="st">&quot;Poor&quot;</span>      <span class="ot">=</span> <span class="st">&quot;yellow&quot;</span>,</span>
<span id="cb1595-52"><a href="age-pyramid.html#cb1595-52" tabindex="-1"></a>                <span class="st">&quot;Very Poor&quot;</span> <span class="ot">=</span> <span class="st">&quot;red3&quot;</span>),</span>
<span id="cb1595-53"><a href="age-pyramid.html#cb1595-53" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Very Good&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Poor&quot;</span>, <span class="st">&quot;Very Poor&quot;</span>))<span class="sc">+</span> <span class="co"># orders the legend</span></span>
<span id="cb1595-54"><a href="age-pyramid.html#cb1595-54" tabindex="-1"></a>     </span>
<span id="cb1595-55"><a href="age-pyramid.html#cb1595-55" tabindex="-1"></a>    </span>
<span id="cb1595-56"><a href="age-pyramid.html#cb1595-56" tabindex="-1"></a>     </span>
<span id="cb1595-57"><a href="age-pyramid.html#cb1595-57" tabindex="-1"></a>    <span class="co"># facet the entire plot so each question is a sub-plot</span></span>
<span id="cb1595-58"><a href="age-pyramid.html#cb1595-58" tabindex="-1"></a>    <span class="fu">facet_wrap</span>( <span class="sc">~</span> Question, <span class="at">ncol =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb1595-59"><a href="age-pyramid.html#cb1595-59" tabindex="-1"></a>     </span>
<span id="cb1595-60"><a href="age-pyramid.html#cb1595-60" tabindex="-1"></a>    <span class="co"># labels, titles, caption</span></span>
<span id="cb1595-61"><a href="age-pyramid.html#cb1595-61" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb1595-62"><a href="age-pyramid.html#cb1595-62" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">str_glue</span>(<span class="st">&quot;Likert-style responses</span><span class="sc">\n</span><span class="st">n = {nrow(likert_data)}&quot;</span>),</span>
<span id="cb1595-63"><a href="age-pyramid.html#cb1595-63" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Respondent status&quot;</span>,</span>
<span id="cb1595-64"><a href="age-pyramid.html#cb1595-64" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Number of responses&quot;</span>,</span>
<span id="cb1595-65"><a href="age-pyramid.html#cb1595-65" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb1595-66"><a href="age-pyramid.html#cb1595-66" tabindex="-1"></a></span>
<span id="cb1595-67"><a href="age-pyramid.html#cb1595-67" tabindex="-1"></a>     <span class="co"># display adjustments </span></span>
<span id="cb1595-68"><a href="age-pyramid.html#cb1595-68" tabindex="-1"></a>     <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb1595-69"><a href="age-pyramid.html#cb1595-69" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb1595-70"><a href="age-pyramid.html#cb1595-70" tabindex="-1"></a>           <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1595-71"><a href="age-pyramid.html#cb1595-71" tabindex="-1"></a>           <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),  <span class="co"># facet sub-titles</span></span>
<span id="cb1595-72"><a href="age-pyramid.html#cb1595-72" tabindex="-1"></a>           <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1595-73"><a href="age-pyramid.html#cb1595-73" tabindex="-1"></a>           <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) <span class="co"># black box around each facet</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1228-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="nguồn-8" class="section level2" number="33.5">
<h2><span class="header-section-number">33.5</span> Nguồn</h2>
<p><a href="https://cran.r-project.org/web/packages/apyramid/vignettes/intro.html">apyramid documentation</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
