<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>32 Đường cong dịch bệnh | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="32 Đường cong dịch bệnh | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="32 Đường cong dịch bệnh | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="epicurves" class="section level1" number="32">
<h1><span class="header-section-number">32</span> Đường cong dịch bệnh</h1>
<p><img src="images/epicurve_top.png" width="75%" /></p>
<p>Đường cong dịch bệnh (còn được gọi là “đường cong epi”) là một biểu đồ dịch tễ học cốt lõi thường được sử dụng để trực quan xu hướng khởi phát bệnh theo thời gian trong một cụm hoặc nhóm ca bệnh.</p>
<p>Phân tích đường cong dịch bệnh có thể cho biết xu hướng theo thời gian, giá trị ngoại lai, mức độ bùng phát dịch, khoảng thời gian có khả năng bị phơi nhiễm cao nhất, khoảng thời gian giữa các thế hệ ca bệnh và thậm chí có thể giúp xác định phương thức lây truyền của một căn bệnh không xác định (ví dụ: điểm bắt nguồn, nguồn tiếp diễn phổ biến, lây truyền từ người sang người). Bạn có thể tìm thấy một bài học trực tuyến về giải thích các đường cong dịch bệnh tại trang web của <a href="https://www.cdc.gov/training/quicklearns/epimode/index.html">CDC Hoa Kỳ</a>.</p>
<p>Trong chương này, chúng tôi trình bày hai cách tiếp cận để tạo ra đường cong dịch bệnh trong R:</p>
<ul>
<li>Package <strong>incidence2</strong>, có thể tạo ra đường cong dịch bệnh với các lệnh đơn giản<br />
</li>
<li>Package <strong>ggplot2</strong>, cho phép khả năng tùy chỉnh nâng cao thông qua các lệnh phức tạp hơn</li>
</ul>
<p>Chúng tôi cũng sẽ giải quyết các trường hợp cụ thể như:</p>
<ul>
<li>Lập biểu đồ dữ liệu đếm tổng hợp<br />
</li>
<li>Faceting hoặc tạo nhiều cấu phần nhỏ<br />
</li>
<li>Áp dụng đường trung bình động<br />
</li>
<li>Hiển thị dữ liệu “dự kiến” hoặc có thể bị chậm trễ trong báo cáo<br />
</li>
<li>Thêm tỷ lệ ca nhiễm mới tích lũy bằng cách sử dụng trục thứ hai</li>
</ul>
<!-- ======================================================= -->
<div id="chuẩn-bị-23" class="section level2" number="32.1">
<h2><span class="header-section-number">32.1</span> Chuẩn bị</h2>
<div id="packages-3" class="section level3 unnumbered">
<h3>Packages</h3>
<p>Đoạn code này hiển thị cách gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh đến hàm <code>p_load()</code> từ package <strong>pacman</strong>, sẽ cài đặt package nếu cần <em>và</em> gọi package để sử dụng. Bạn cũng có thể cài đặt package với hàm <code>library()</code> từ <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để biết thêm thông tin về các package trong R.</p>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1513-1"><a href="epicurves.html#cb1513-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1513-2"><a href="epicurves.html#cb1513-2" tabindex="-1"></a>  rio,          <span class="co"># file import/export</span></span>
<span id="cb1513-3"><a href="epicurves.html#cb1513-3" tabindex="-1"></a>  here,         <span class="co"># relative filepaths </span></span>
<span id="cb1513-4"><a href="epicurves.html#cb1513-4" tabindex="-1"></a>  lubridate,    <span class="co"># working with dates/epiweeks</span></span>
<span id="cb1513-5"><a href="epicurves.html#cb1513-5" tabindex="-1"></a>  aweek,        <span class="co"># alternative package for working with dates/epiweeks</span></span>
<span id="cb1513-6"><a href="epicurves.html#cb1513-6" tabindex="-1"></a>  incidence2,   <span class="co"># epicurves of linelist data</span></span>
<span id="cb1513-7"><a href="epicurves.html#cb1513-7" tabindex="-1"></a>  i2extras,     <span class="co"># supplement to incidence2</span></span>
<span id="cb1513-8"><a href="epicurves.html#cb1513-8" tabindex="-1"></a>  stringr,      <span class="co"># search and manipulate character strings</span></span>
<span id="cb1513-9"><a href="epicurves.html#cb1513-9" tabindex="-1"></a>  forcats,      <span class="co"># working with factors</span></span>
<span id="cb1513-10"><a href="epicurves.html#cb1513-10" tabindex="-1"></a>  RColorBrewer, <span class="co"># Color palettes from colorbrewer2.org</span></span>
<span id="cb1513-11"><a href="epicurves.html#cb1513-11" tabindex="-1"></a>  tidyverse     <span class="co"># data management + ggplot2 graphics</span></span>
<span id="cb1513-12"><a href="epicurves.html#cb1513-12" tabindex="-1"></a>) </span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-17" class="section level3 unnumbered">
<h3>Nhập dữ liệu</h3>
<p>Hai bộ dữ liệu mẫu được sử dụng trong chương này:</p>
<ul>
<li>Bộ số liệu <code>linelist</code> về các ca bệnh từ một vụ dịch mô phỏng<br />
</li>
<li>Số lượng tổng hợp theo bệnh viện từ cùng một dịch bệnh mô phỏng bên trên</li>
</ul>
<p>Các bộ dữ liệu được nhập bằng hàm <code>import()</code> từ package <strong>rio</strong>. Xem chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết các cách nhập dữ liệu khác nhau.</p>
<p><strong>Bộ số liệu <code>linelist</code></strong></p>
<p>Chúng ta nhập bộ dữ liệu về các ca bệnh mô phỏng từ một vụ dịch Ebola. Nếu bạn muốn tải xuống dữ liệu để làm theo từng bước, hãy xem hướng dẫn trong chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a>. Chúng tôi giả sử các tệp tin nằm trong thư mục làm việc nên không có thư mục con nào được chỉ định trong đường dẫn này.</p>
<div class="sourceCode" id="cb1514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1514-1"><a href="epicurves.html#cb1514-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.xlsx&quot;</span>)</span></code></pre></div>
<p>50 dòng đầu tiên được hiển thị như bên dưới:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-d3e4b44aca12c90fb670" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d3e4b44aca12c90fb670">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"age","targets":8},{"name":"age_unit","targets":9},{"name":"age_years","targets":10},{"name":"age_cat","targets":11},{"name":"age_cat5","targets":12},{"name":"hospital","targets":13},{"name":"lon","targets":14},{"name":"lat","targets":15},{"name":"infector","targets":16},{"name":"source","targets":17},{"name":"wt_kg","targets":18},{"name":"ht_cm","targets":19},{"name":"ct_blood","targets":20},{"name":"fever","targets":21},{"name":"chills","targets":22},{"name":"cough","targets":23},{"name":"aches","targets":24},{"name":"vomit","targets":25},{"name":"temp","targets":26},{"name":"time_admission","targets":27},{"name":"bmi","targets":28},{"name":"days_onset_hosp","targets":29}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><strong>Số lượng ca bệnh do bệnh viện tổng hợp</strong></p>
<p>Theo mục tiêu của cuốn sách này, bộ dữ liệu về số lượng tổng hợp hàng tuần theo bệnh viện được tạo từ <code>linelist</code> với đoạn code sau.</p>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1515-1"><a href="epicurves.html#cb1515-1" tabindex="-1"></a><span class="co"># import the counts data into R</span></span>
<span id="cb1515-2"><a href="epicurves.html#cb1515-2" tabindex="-1"></a>count_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1515-3"><a href="epicurves.html#cb1515-3" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital, date_hospitalisation) <span class="sc">%&gt;%</span> </span>
<span id="cb1515-4"><a href="epicurves.html#cb1515-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_cases =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1515-5"><a href="epicurves.html#cb1515-5" tabindex="-1"></a>  <span class="fu">filter</span>(date_hospitalisation <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1515-6"><a href="epicurves.html#cb1515-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>50 dòng đầu tiên được hiển thị như bên dưới:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-b6903a5d81c4461eb9b6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-b6903a5d81c4461eb9b6">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2},{"name":"hospital","targets":0},{"name":"date_hospitalisation","targets":1},{"name":"n_cases","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="thiết-lập-các-tham-số" class="section level3 unnumbered">
<h3>Thiết lập các tham số</h3>
<p>Để tạo báo cáo, bạn có thể muốn thiết lập các thông số có thể chỉnh sửa, chẳng hạn như ngày dữ liệu hiện tại (“ngày dữ liệu”). Sau đó, bạn có thể tham chiếu đối tượng <code>data_date</code> trong code khi áp dụng bộ lọc hoặc trong chú thích động.</p>
<div class="sourceCode" id="cb1516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1516-1"><a href="epicurves.html#cb1516-1" tabindex="-1"></a><span class="do">## set the report date for the report</span></span>
<span id="cb1516-2"><a href="epicurves.html#cb1516-2" tabindex="-1"></a><span class="do">## note: can be set to Sys.Date() for the current date</span></span>
<span id="cb1516-3"><a href="epicurves.html#cb1516-3" tabindex="-1"></a>data_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">&quot;2015-05-15&quot;</span>)</span></code></pre></div>
</div>
<div id="xác-minh-ngày" class="section level3 unnumbered">
<h3>Xác minh ngày</h3>
<p>Xác minh rằng mỗi cột ngày có liên quan là phân lớp Ngày và có phạm vi giá trị thích hợp. Bạn có thể thực hiện việc này đơn giản bằng cách sử dụng hàm <code>hist()</code> cho histogram hoặc hàm <code>range()</code> với <code>na.rm=TRUE</code>, hoặc với hàm <code>ggplot()</code> như bên dưới.</p>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1517-1"><a href="epicurves.html#cb1517-1" tabindex="-1"></a><span class="co"># check range of onset dates</span></span>
<span id="cb1517-2"><a href="epicurves.html#cb1517-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span></span>
<span id="cb1517-3"><a href="epicurves.html#cb1517-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> date_onset))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1144-1.png" width="50%" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="đường-cong-dịch-bệnh-với-ggplot2" class="section level2" number="32.2">
<h2><span class="header-section-number">32.2</span> Đường cong dịch bệnh với ggplot2</h2>
<p>Sử dụng <code>ggplot()</code> để xây dựng đường cong dịch bệnh cho phép sự linh hoạt và tùy chỉnh nhiều hơn, nhưng đòi hỏi nhiều nỗ lực và hiểu biết hơn về sử dụng <code>ggplot()</code>.</p>
<p>Không giống như sử dụng package <strong>incidence2</strong>, bạn phải kiểm soát <em>thủ công</em> việc tổng hợp các trường hợp theo thời gian (theo tuần, tháng, v.v.) <em>và</em> khoảng thời gian của các nhãn trên trục ngày thág. Việc này phải được quản lý rất cẩn thận.</p>
<p>Các ví dụ này sử dụng một tập con của bộ dữ liệu <code>linelist</code> - chỉ các trường hợp từ Central Hospital.</p>
<div class="sourceCode" id="cb1518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1518-1"><a href="epicurves.html#cb1518-1" tabindex="-1"></a>central_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1518-2"><a href="epicurves.html#cb1518-2" tabindex="-1"></a>  <span class="fu">filter</span>(hospital <span class="sc">==</span> <span class="st">&quot;Central Hospital&quot;</span>)</span></code></pre></div>
<p>Để tạo ra một đường cong dịch bệnh với <code>ggplot()</code>, có ba yếu tố chính:</p>
<ul>
<li>Một histogram, với các ca bệnh <code>linelist</code> được tổng hợp thành các “bins” được phân biệt bằng các điểm “ngắt” cụ thể<br />
</li>
<li>Cân chỉnh các trục và nhãn<br />
</li>
<li>Chủ đề của biểu đồ, bao gồm tiêu đề, nhãn, chú thích, v.v.</li>
</ul>
<div id="xác-định-bins-của-số-liệu" class="section level3 unnumbered">
<h3>Xác định bins của số liệu</h3>
<p>Ở đây chúng ta trình bày cách xác định các ca bệnh sẽ được tổng hợp thành các bins của một histogram (“cột”). Điều quan trọng cần nhận ra là việc tổng hợp số ca bệnh thành các bins của một histogram không nhất thiết phải có cùng khoảng với thời gian xuất hiện trên trục x.</p>
<p>Dưới đây có lẽ là đoạn code đơn giản nhất để tạo ra các đường cong dịch bệnh hàng ngày và hàng tuần.</p>
<p>Trong lệnh <code>ggplot()</code> tổng quát, bộ dữ liệu được đưa vào <code>data =</code>. Trên nền tảng này, dạng hình học của histogram được thêm bằng một dấu <code>+</code>. Trong <code>geom_histogram()</code>, chúng ta ánh xạ các yếu tố thẩm mỹ sao cho cột <code>date_onset</code> được ánh xạ tới trục x. Cũng trong hàm <code>geom_histogram()</code> nhưng <em>không</em> phải trong đối số <code>aes()</code>, chúng ta đặt <code>binwidth =</code> bằng số bins của histogram, tính bằng ngày. Nếu cú pháp <strong>ggplot2</strong> này khó hiểu, hãy xem lại chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a>.</p>
<p><span style="color: orange;"><strong><em>THẬN TRỌNG</em></strong>: Lập biểu đồ các trường hợp hàng tuần bằng cách sử dụng <code>binwidth = 7</code> bắt đầu cột 7 ngày đầu tiên ở ca bệnh đầu tiên, mà có thể là bất kỳ ngày nào trong tuần! Để tạo các tuần cụ thể, hãy xem phần bên dưới.</span></p>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1519-1"><a href="epicurves.html#cb1519-1" tabindex="-1"></a><span class="co"># daily </span></span>
<span id="cb1519-2"><a href="epicurves.html#cb1519-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> central_data) <span class="sc">+</span>          <span class="co"># set data</span></span>
<span id="cb1519-3"><a href="epicurves.html#cb1519-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(                      <span class="co"># add histogram</span></span>
<span id="cb1519-4"><a href="epicurves.html#cb1519-4" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),     <span class="co"># map date column to x-axis</span></span>
<span id="cb1519-5"><a href="epicurves.html#cb1519-5" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span>                     <span class="co"># cases binned by 1 day </span></span>
<span id="cb1519-6"><a href="epicurves.html#cb1519-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Central Hospital - Daily&quot;</span>)                <span class="co"># title</span></span>
<span id="cb1519-7"><a href="epicurves.html#cb1519-7" tabindex="-1"></a></span>
<span id="cb1519-8"><a href="epicurves.html#cb1519-8" tabindex="-1"></a><span class="co"># weekly</span></span>
<span id="cb1519-9"><a href="epicurves.html#cb1519-9" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> central_data) <span class="sc">+</span>          <span class="co"># set data </span></span>
<span id="cb1519-10"><a href="epicurves.html#cb1519-10" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(                      <span class="co"># add histogram</span></span>
<span id="cb1519-11"><a href="epicurves.html#cb1519-11" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),   <span class="co"># map date column to x-axis</span></span>
<span id="cb1519-12"><a href="epicurves.html#cb1519-12" tabindex="-1"></a>      <span class="at">binwidth =</span> <span class="dv">7</span>)<span class="sc">+</span>                   <span class="co"># cases binned every 7 days, starting from first case (!) </span></span>
<span id="cb1519-13"><a href="epicurves.html#cb1519-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Central Hospital - 7-day bins, starting at first case&quot;</span>) <span class="co"># title</span></span></code></pre></div>
<p><img src="_main_files/figure-html/ggplot_simple-1.png" width="50%" /><img src="_main_files/figure-html/ggplot_simple-2.png" width="50%" /></p>
<p>Chúng tôi xin lưu ý rằng ca bệnh đầu tiên trong bộ dữ liệu của Central Hospital có triệu chứng khởi phát vào ngày:</p>
<div class="sourceCode" id="cb1520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1520-1"><a href="epicurves.html#cb1520-1" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;%A %d %b, %Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Thursday 01 May, 2014&quot;</code></pre>
<p><strong>Để chỉ định thủ công chia biểu đồ cột, <em>không</em> sử dụng argument <code>binwidth =</code> và thay vào đó cung cấp vectơ ngày để <code>breaks =</code>.</strong></p>
<p>Tạo vectơ ngày tháng với hàm <code>seq.Date()</code> trong <strong>base</strong> R. Hàm này sử dụng các đối số <code>to =</code>, <code>from =</code>, và <code>by =</code>. Ví dụ: lệnh bên dưới trả về ngày mỗi tháng bắt đầu từ ngày 15 Tháng 1 và kết thúc trước ngày 28 Tháng 6.</p>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1522-1"><a href="epicurves.html#cb1522-1" tabindex="-1"></a>monthly_breaks <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2014-02-01&quot;</span>),</span>
<span id="cb1522-2"><a href="epicurves.html#cb1522-2" tabindex="-1"></a>                           <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2015-07-15&quot;</span>),</span>
<span id="cb1522-3"><a href="epicurves.html#cb1522-3" tabindex="-1"></a>                           <span class="at">by =</span> <span class="st">&quot;months&quot;</span>)</span>
<span id="cb1522-4"><a href="epicurves.html#cb1522-4" tabindex="-1"></a></span>
<span id="cb1522-5"><a href="epicurves.html#cb1522-5" tabindex="-1"></a>monthly_breaks   <span class="co"># print</span></span></code></pre></div>
<pre><code>##  [1] &quot;2014-02-01&quot; &quot;2014-03-01&quot; &quot;2014-04-01&quot; &quot;2014-05-01&quot; &quot;2014-06-01&quot; &quot;2014-07-01&quot;
##  [7] &quot;2014-08-01&quot; &quot;2014-09-01&quot; &quot;2014-10-01&quot; &quot;2014-11-01&quot; &quot;2014-12-01&quot; &quot;2015-01-01&quot;
## [13] &quot;2015-02-01&quot; &quot;2015-03-01&quot; &quot;2015-04-01&quot; &quot;2015-05-01&quot; &quot;2015-06-01&quot; &quot;2015-07-01&quot;</code></pre>
<p>Vectơ này có được cung cấp cho hàm <code>geom_histogram()</code> dưới dạng <code>breaks =</code>:</p>
<div class="sourceCode" id="cb1524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1524-1"><a href="epicurves.html#cb1524-1" tabindex="-1"></a><span class="co"># monthly </span></span>
<span id="cb1524-2"><a href="epicurves.html#cb1524-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> central_data) <span class="sc">+</span>  </span>
<span id="cb1524-3"><a href="epicurves.html#cb1524-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1524-4"><a href="epicurves.html#cb1524-4" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1524-5"><a href="epicurves.html#cb1524-5" tabindex="-1"></a>    <span class="at">breaks =</span> monthly_breaks)<span class="sc">+</span>         <span class="co"># provide the pre-defined vector of breaks                    </span></span>
<span id="cb1524-6"><a href="epicurves.html#cb1524-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Monthly case bins&quot;</span>)   <span class="co"># title</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1150-1.png" width="672" /></p>
<p>Một chuỗi ngày hàng tuần đơn giản có thể được trả về bằng cách đặt <code>by = "week"</code>. Ví dụ:</p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1525-1"><a href="epicurves.html#cb1525-1" tabindex="-1"></a>weekly_breaks <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2014-02-01&quot;</span>),</span>
<span id="cb1525-2"><a href="epicurves.html#cb1525-2" tabindex="-1"></a>                          <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2015-07-15&quot;</span>),</span>
<span id="cb1525-3"><a href="epicurves.html#cb1525-3" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">&quot;week&quot;</span>)</span></code></pre></div>
<p>Một giải pháp thay thế cho việc xác định ngày bắt đầu và ngày kết thúc cụ thể là viết code <em>động</em> để các cột hàng tuần bắt đầu vào <em>thứ Hai trước ca đầu tiên</em>. <strong>Chúng tôi sẽ sử dụng các vectơ ngày này trong suốt các ví dụ dưới đây</strong>.</p>
<div class="sourceCode" id="cb1526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1526-1"><a href="epicurves.html#cb1526-1" tabindex="-1"></a><span class="co"># Sequence of weekly Monday dates for CENTRAL HOSPITAL</span></span>
<span id="cb1526-2"><a href="epicurves.html#cb1526-2" tabindex="-1"></a>weekly_breaks_central <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1526-3"><a href="epicurves.html#cb1526-3" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">1</span>), <span class="co"># monday before first case</span></span>
<span id="cb1526-4"><a href="epicurves.html#cb1526-4" tabindex="-1"></a>  <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">1</span>), <span class="co"># monday after last case</span></span>
<span id="cb1526-5"><a href="epicurves.html#cb1526-5" tabindex="-1"></a>  <span class="at">by   =</span> <span class="st">&quot;week&quot;</span>)</span></code></pre></div>
<p>Hãy giải mã đoạn code khá “khoai” ở trên:</p>
<ul>
<li>Giá trị “from” (ngày sớm nhất của chuỗi) được tạo như sau: giá trị ngày nhỏ nhất (<code>min()</code> với <code>na.rm=TRUE</code>) trong cột <code>date_onset</code> được đưa vào hàm <code>floor_date()</code> thuộc package <strong>lubridate</strong>. <code>floor_date()</code> được đặt thành “tuần” trả về ngày bắt đầu của “tuần” của trường hợp đó, với điều kiện là ngày bắt đầu của mỗi tuần là Thứ Hai (<code>week_start = 1</code>).<br />
</li>
<li>Tương tự như vậy, giá trị “to” (ngày kết thúc của chuỗi) được tạo bằng cách sử dụng hàm ngược lại <code>ceiling_date()</code> để trả về thứ hai <em>sau</em> ca cuối cùng.<br />
</li>
<li>Đối số “by” của <code>seq.Date()</code> có thể được đặt thành bất kỳ số ngày, tuần hoặc tháng nào.<br />
</li>
<li>Sử dụng <code>week_start = 7</code> cho tuần bắt đầu vào Chủ nhật</li>
</ul>
<p>Vì chúng ta sẽ sử dụng các vectơ ngày dạng này trong toàn bộ chương này, chúng ta cũng xác định một vectơ cho toàn bộ đợt bùng phát (ở trên chỉ dành cho Central Hospital).</p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1527-1"><a href="epicurves.html#cb1527-1" tabindex="-1"></a><span class="co"># Sequence for the entire outbreak</span></span>
<span id="cb1527-2"><a href="epicurves.html#cb1527-2" tabindex="-1"></a>weekly_breaks_all <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1527-3"><a href="epicurves.html#cb1527-3" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(linelist<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">1</span>), <span class="co"># monday before first case</span></span>
<span id="cb1527-4"><a href="epicurves.html#cb1527-4" tabindex="-1"></a>  <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(linelist<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">1</span>), <span class="co"># monday after last case</span></span>
<span id="cb1527-5"><a href="epicurves.html#cb1527-5" tabindex="-1"></a>  <span class="at">by   =</span> <span class="st">&quot;week&quot;</span>)</span></code></pre></div>
<p>Các kết quả trả về của <code>seq.Date()</code> có thể được sử dụng để tạo các khoảng chia bins trong histogram, cũng như khoảng chia cho các nhãn ngày mà có thể độc lập với các bins. Đọc thêm về nhãn ngày trong các phần sau.</p>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Đối với lệnh <code>ggplot()</code> đơn giản hơn, hãy lưu các khoảng chia bins và khoảng chia nhãn ngày dưới dạng các vectơ đã đặt tên trước và gán tên này vào đối số <code>breaks =</code>.</span></p>
</div>
<div id="ví-dụ-về-đường-cong-dịch-bệnh-theo-tuần" class="section level3 unnumbered">
<h3>Ví dụ về đường cong dịch bệnh theo tuần</h3>
<p><strong>Dưới đây là code ví dụ chi tiết để tạo đường cong dịch bệnh hàng tuần cho các tuần bắt đầu vào Thứ Hai, với các cột, nhãn ngày và đường lưới dọc đã được căn chỉnh</strong>. Phần này dành cho người dùng có nhu cầu code nhanh. Để hiểu sâu từng khía cạnh (chủ đề, nhãn ngày, v.v.), hãy tiếp tục xem các phần tiếp theo. Chú ý:</p>
<ul>
<li>Các <em>đoạn chia bins của histogram</em> được xác định bằng hàm <code>seq.Date()</code> như được giải thích ở trên để bắt đầu vào thứ Hai trước ca sớm nhất và kết thúc vào thứ Hai sau ca cuối cùng<br />
</li>
<li>Khoảng <em>nhãn ngày</em> được xác định bởi <code>date_breaks =</code> bên trong <code>scale_x_date()</code><br />
</li>
<li>Khoảng đường lưới dọc nhỏ giữa các nhãn ngày được xác định bởi <code>date_minor_breaks =</code><br />
</li>
<li><code>expand = c(0,0)</code> trong trục x và y loại bỏ không gian thừa trên mỗi cạnh của trục, điều này cũng đảm bảo các nhãn ngày bắt đầu từ cột đầu tiên.</li>
</ul>
<div class="sourceCode" id="cb1528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1528-1"><a href="epicurves.html#cb1528-1" tabindex="-1"></a><span class="co"># TOTAL MONDAY WEEK ALIGNMENT</span></span>
<span id="cb1528-2"><a href="epicurves.html#cb1528-2" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb1528-3"><a href="epicurves.html#cb1528-3" tabindex="-1"></a><span class="co"># Define sequence of weekly breaks</span></span>
<span id="cb1528-4"><a href="epicurves.html#cb1528-4" tabindex="-1"></a>weekly_breaks_central <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1528-5"><a href="epicurves.html#cb1528-5" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">1</span>), <span class="co"># Monday before first case</span></span>
<span id="cb1528-6"><a href="epicurves.html#cb1528-6" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">1</span>), <span class="co"># Monday after last case</span></span>
<span id="cb1528-7"><a href="epicurves.html#cb1528-7" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">&quot;week&quot;</span>)    <span class="co"># bins are 7-days </span></span>
<span id="cb1528-8"><a href="epicurves.html#cb1528-8" tabindex="-1"></a></span>
<span id="cb1528-9"><a href="epicurves.html#cb1528-9" tabindex="-1"></a></span>
<span id="cb1528-10"><a href="epicurves.html#cb1528-10" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> central_data) <span class="sc">+</span> </span>
<span id="cb1528-11"><a href="epicurves.html#cb1528-11" tabindex="-1"></a>  </span>
<span id="cb1528-12"><a href="epicurves.html#cb1528-12" tabindex="-1"></a>  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span></span>
<span id="cb1528-13"><a href="epicurves.html#cb1528-13" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1528-14"><a href="epicurves.html#cb1528-14" tabindex="-1"></a>    </span>
<span id="cb1528-15"><a href="epicurves.html#cb1528-15" tabindex="-1"></a>    <span class="co"># mapping aesthetics</span></span>
<span id="cb1528-16"><a href="epicurves.html#cb1528-16" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),  <span class="co"># date column mapped to x-axis</span></span>
<span id="cb1528-17"><a href="epicurves.html#cb1528-17" tabindex="-1"></a>    </span>
<span id="cb1528-18"><a href="epicurves.html#cb1528-18" tabindex="-1"></a>    <span class="co"># histogram bin breaks</span></span>
<span id="cb1528-19"><a href="epicurves.html#cb1528-19" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central, <span class="co"># histogram bin breaks defined previously</span></span>
<span id="cb1528-20"><a href="epicurves.html#cb1528-20" tabindex="-1"></a>    </span>
<span id="cb1528-21"><a href="epicurves.html#cb1528-21" tabindex="-1"></a>    <span class="co"># bars</span></span>
<span id="cb1528-22"><a href="epicurves.html#cb1528-22" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,     <span class="co"># color of lines around bars</span></span>
<span id="cb1528-23"><a href="epicurves.html#cb1528-23" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>      <span class="co"># color of fill within bars</span></span>
<span id="cb1528-24"><a href="epicurves.html#cb1528-24" tabindex="-1"></a>  )<span class="sc">+</span> </span>
<span id="cb1528-25"><a href="epicurves.html#cb1528-25" tabindex="-1"></a>    </span>
<span id="cb1528-26"><a href="epicurves.html#cb1528-26" tabindex="-1"></a>  <span class="co"># x-axis labels</span></span>
<span id="cb1528-27"><a href="epicurves.html#cb1528-27" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1528-28"><a href="epicurves.html#cb1528-28" tabindex="-1"></a>    <span class="at">expand            =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),           <span class="co"># remove excess x-axis space before and after case bars</span></span>
<span id="cb1528-29"><a href="epicurves.html#cb1528-29" tabindex="-1"></a>    <span class="at">date_breaks       =</span> <span class="st">&quot;4 weeks&quot;</span>,        <span class="co"># date labels and major vertical gridlines appear every 3 Monday weeks</span></span>
<span id="cb1528-30"><a href="epicurves.html#cb1528-30" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,           <span class="co"># minor vertical lines appear every Monday week</span></span>
<span id="cb1528-31"><a href="epicurves.html#cb1528-31" tabindex="-1"></a>    <span class="at">date_labels       =</span> <span class="st">&quot;%a</span><span class="sc">\n</span><span class="st">%d %b</span><span class="sc">\n</span><span class="st">%Y&quot;</span>)<span class="sc">+</span> <span class="co"># date labels format</span></span>
<span id="cb1528-32"><a href="epicurves.html#cb1528-32" tabindex="-1"></a>  </span>
<span id="cb1528-33"><a href="epicurves.html#cb1528-33" tabindex="-1"></a>  <span class="co"># y-axis</span></span>
<span id="cb1528-34"><a href="epicurves.html#cb1528-34" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1528-35"><a href="epicurves.html#cb1528-35" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>             <span class="co"># remove excess y-axis space below 0 (align histogram flush with x-axis)</span></span>
<span id="cb1528-36"><a href="epicurves.html#cb1528-36" tabindex="-1"></a>  </span>
<span id="cb1528-37"><a href="epicurves.html#cb1528-37" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1528-38"><a href="epicurves.html#cb1528-38" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                <span class="co"># simplify plot background</span></span>
<span id="cb1528-39"><a href="epicurves.html#cb1528-39" tabindex="-1"></a>  </span>
<span id="cb1528-40"><a href="epicurves.html#cb1528-40" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1528-41"><a href="epicurves.html#cb1528-41" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>,        <span class="co"># caption on left side</span></span>
<span id="cb1528-42"><a href="epicurves.html#cb1528-42" tabindex="-1"></a>                                <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>), <span class="co"># caption in italics</span></span>
<span id="cb1528-43"><a href="epicurves.html#cb1528-43" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))<span class="sc">+</span>    <span class="co"># axis titles in bold</span></span>
<span id="cb1528-44"><a href="epicurves.html#cb1528-44" tabindex="-1"></a>  </span>
<span id="cb1528-45"><a href="epicurves.html#cb1528-45" tabindex="-1"></a>  <span class="co"># labels including dynamic caption</span></span>
<span id="cb1528-46"><a href="epicurves.html#cb1528-46" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1528-47"><a href="epicurves.html#cb1528-47" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&quot;Weekly incidence of cases (Monday weeks)&quot;</span>,</span>
<span id="cb1528-48"><a href="epicurves.html#cb1528-48" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Note alignment of bars, vertical gridlines, and axis labels on Monday weeks&quot;</span>,</span>
<span id="cb1528-49"><a href="epicurves.html#cb1528-49" tabindex="-1"></a>    <span class="at">x        =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1528-50"><a href="epicurves.html#cb1528-50" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&quot;Weekly incident cases reported&quot;</span>,</span>
<span id="cb1528-51"><a href="epicurves.html#cb1528-51" tabindex="-1"></a>    <span class="at">caption  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)} to {format(max(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)}</span><span class="sc">\n</span><span class="st">{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1154-1.png" width="672" /></p>
<div id="tuần-bắt-đầu-bằng-chủ-nhật" class="section level4 unnumbered">
<h4>Tuần bắt đầu bằng Chủ nhật</h4>
<p>Để vẽ được biểu đồ cho các tuần bắt đầu bằng Chủ nhật, cần có một số sửa đổi, vì <code>date_breaks = "weeks"</code> chỉ hoạt động cho các tuần bắt đầu bằng thứ Hai.</p>
<ul>
<li>Các điểm ngắt của các <em>histogram bins</em> phải được đặt thành Chủ nhật (<code>week_start = 7</code>)<br />
</li>
<li>Trong <code>scale_x_date()</code>, các đoạn ngắt ngày tương tự nên được gắn với <code>breaks =</code> và <code>minor_breaks =</code> để đảm bảo các nhãn ngày và đường lưới dọc căn chỉnh vào ngày Chủ nhật.</li>
</ul>
<p>Ví dụ: lệnh <code>scale_x_date()</code> cho các tuần bắt đầu vào Chủ nhật có thể trông như sau:</p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1529-1"><a href="epicurves.html#cb1529-1" tabindex="-1"></a><span class="fu">scale_x_date</span>(</span>
<span id="cb1529-2"><a href="epicurves.html#cb1529-2" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb1529-3"><a href="epicurves.html#cb1529-3" tabindex="-1"></a>    </span>
<span id="cb1529-4"><a href="epicurves.html#cb1529-4" tabindex="-1"></a>    <span class="co"># specify interval of date labels and major vertical gridlines</span></span>
<span id="cb1529-5"><a href="epicurves.html#cb1529-5" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1529-6"><a href="epicurves.html#cb1529-6" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday before first case</span></span>
<span id="cb1529-7"><a href="epicurves.html#cb1529-7" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday after last case</span></span>
<span id="cb1529-8"><a href="epicurves.html#cb1529-8" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">&quot;4 weeks&quot;</span>),</span>
<span id="cb1529-9"><a href="epicurves.html#cb1529-9" tabindex="-1"></a>    </span>
<span id="cb1529-10"><a href="epicurves.html#cb1529-10" tabindex="-1"></a>    <span class="co"># specify interval of minor vertical gridline </span></span>
<span id="cb1529-11"><a href="epicurves.html#cb1529-11" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1529-12"><a href="epicurves.html#cb1529-12" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday before first case</span></span>
<span id="cb1529-13"><a href="epicurves.html#cb1529-13" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>), <span class="co"># Sunday after last case</span></span>
<span id="cb1529-14"><a href="epicurves.html#cb1529-14" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">&quot;week&quot;</span>),</span>
<span id="cb1529-15"><a href="epicurves.html#cb1529-15" tabindex="-1"></a>   </span>
<span id="cb1529-16"><a href="epicurves.html#cb1529-16" tabindex="-1"></a>    <span class="co"># date label format</span></span>
<span id="cb1529-17"><a href="epicurves.html#cb1529-17" tabindex="-1"></a>    <span class="co">#date_labels = &quot;%a\n%d %b\n%Y&quot;)+         # day, above month abbrev., above 2-digit year</span></span>
<span id="cb1529-18"><a href="epicurves.html#cb1529-18" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())      <span class="co"># automatic label formatting</span></span></code></pre></div>
</div>
</div>
<div id="nhómtô-màu-theo-giá-trị" class="section level3 unnumbered">
<h3>Nhóm/tô màu theo giá trị</h3>
<p>Các cột histogram có thể được tô màu theo nhóm và “xếp chồng lên nhau”. Để chỉ định cột nhóm, hãy thực hiện các thay đổi sau. Xem chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a> để biết thêm chi tiết.</p>
<ul>
<li>Bên trong đối số <code>aes()</code> của hàm vẽ histogram, ánh xạ tên cột tới đối số <code>group =</code> và <code>fill =</code><br />
</li>
<li>Loại bỏ bất kỳ tham số <code>fill =</code> nào bên ngoài đối số <code>aes()</code>, vì nó sẽ ghi đè giá trị bên trong<br />
</li>
<li>Đối số <em>bên trong</em> <code>aes()</code> sẽ áp dụng <em>theo nhóm</em>, trong khi bất kỳ đối số <em>bên ngoài</em> nào đều sẽ áp dụng cho tất cả các cột (ví dụ: bạn có thể vẫn muốn tô màu <code>color =</code> bên ngoài, vì vậy mỗi cột có cùng một đường viền)</li>
</ul>
<p>Đây là lệnh <code>aes()</code> hiển thị nhóm và tô màu các cột theo giới tính:</p>
<div class="sourceCode" id="cb1530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1530-1"><a href="epicurves.html#cb1530-1" tabindex="-1"></a><span class="fu">aes</span>(<span class="at">x =</span> date_onset, <span class="at">group =</span> gender, <span class="at">fill =</span> gender)</span></code></pre></div>
<p>Đây là kết quả khi áp dụng:</p>
<div class="sourceCode" id="cb1531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1531-1"><a href="epicurves.html#cb1531-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist) <span class="sc">+</span>     <span class="co"># begin with linelist (many hospitals)</span></span>
<span id="cb1531-2"><a href="epicurves.html#cb1531-2" tabindex="-1"></a>  </span>
<span id="cb1531-3"><a href="epicurves.html#cb1531-3" tabindex="-1"></a>  <span class="co"># make histogram: specify bin break points: starts the Monday before first case, end Monday after last case</span></span>
<span id="cb1531-4"><a href="epicurves.html#cb1531-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1531-5"><a href="epicurves.html#cb1531-5" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1531-6"><a href="epicurves.html#cb1531-6" tabindex="-1"></a>      <span class="at">x =</span> date_onset,</span>
<span id="cb1531-7"><a href="epicurves.html#cb1531-7" tabindex="-1"></a>      <span class="at">group =</span> hospital,       <span class="co"># set data to be grouped by hospital</span></span>
<span id="cb1531-8"><a href="epicurves.html#cb1531-8" tabindex="-1"></a>      <span class="at">fill =</span> hospital),       <span class="co"># bar fill (inside color) by hospital</span></span>
<span id="cb1531-9"><a href="epicurves.html#cb1531-9" tabindex="-1"></a>    </span>
<span id="cb1531-10"><a href="epicurves.html#cb1531-10" tabindex="-1"></a>    <span class="co"># bin breaks are Monday weeks</span></span>
<span id="cb1531-11"><a href="epicurves.html#cb1531-11" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_all,   <span class="co"># sequence of weekly Monday bin breaks for whole outbreak, defined in previous code       </span></span>
<span id="cb1531-12"><a href="epicurves.html#cb1531-12" tabindex="-1"></a>    </span>
<span id="cb1531-13"><a href="epicurves.html#cb1531-13" tabindex="-1"></a>    <span class="co"># Color around bars</span></span>
<span id="cb1531-14"><a href="epicurves.html#cb1531-14" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1157-1.png" width="672" /></p>
</div>
<div id="hiệu-chỉnh-màu" class="section level3 unnumbered">
<h3>Hiệu chỉnh màu</h3>
<ul>
<li><p>Để thiết lập <em>thủ công</em> tô màu cho từng nhóm, hãy sử dụng <code>scale_fill_manual()</code> (lưu ý: <code>scale_color_manual()</code> là một cái khác!)</p>
<ul>
<li>Sử dụng đối số <code>values =</code> để áp dụng một vectơ màu<br />
</li>
<li>Sử dụng <code>na.value =</code> để xác định màu cho giá trị <code>NA</code><br />
</li>
<li>Sử dụng đối số <code>labels =</code> để thay đổi văn bản trong mục chú thích. Để cho an toàn, sử dụng một vectơ được đặt tên kiểu như <code>c("old" = "new", "old" = "new")</code> hoặc điều chỉnh giá trị trong bộ dữ liệu<br />
</li>
<li>Sử dụng <code>name =</code> để đặt một tiêu đề thích hợp cho mục chú thích<br />
</li>
</ul></li>
<li><p>Để biết thêm mẹo về thang màu và bảng màu, hãy xem chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a>.</p></li>
</ul>
<div class="sourceCode" id="cb1532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1532-1"><a href="epicurves.html#cb1532-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> linelist)<span class="sc">+</span>           <span class="co"># begin with linelist (many hospitals)</span></span>
<span id="cb1532-2"><a href="epicurves.html#cb1532-2" tabindex="-1"></a>  </span>
<span id="cb1532-3"><a href="epicurves.html#cb1532-3" tabindex="-1"></a>  <span class="co"># make histogram</span></span>
<span id="cb1532-4"><a href="epicurves.html#cb1532-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1532-5"><a href="epicurves.html#cb1532-5" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset,</span>
<span id="cb1532-6"><a href="epicurves.html#cb1532-6" tabindex="-1"></a>        <span class="at">group =</span> hospital,          <span class="co"># cases grouped by hospital</span></span>
<span id="cb1532-7"><a href="epicurves.html#cb1532-7" tabindex="-1"></a>        <span class="at">fill =</span> hospital),          <span class="co"># bar fill by hospital</span></span>
<span id="cb1532-8"><a href="epicurves.html#cb1532-8" tabindex="-1"></a>    </span>
<span id="cb1532-9"><a href="epicurves.html#cb1532-9" tabindex="-1"></a>    <span class="co"># bin breaks</span></span>
<span id="cb1532-10"><a href="epicurves.html#cb1532-10" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_all,        <span class="co"># sequence of weekly Monday bin breaks, defined in previous code</span></span>
<span id="cb1532-11"><a href="epicurves.html#cb1532-11" tabindex="-1"></a>    </span>
<span id="cb1532-12"><a href="epicurves.html#cb1532-12" tabindex="-1"></a>    <span class="co"># Color around bars</span></span>
<span id="cb1532-13"><a href="epicurves.html#cb1532-13" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span>              <span class="co"># border color of each bar</span></span>
<span id="cb1532-14"><a href="epicurves.html#cb1532-14" tabindex="-1"></a>  </span>
<span id="cb1532-15"><a href="epicurves.html#cb1532-15" tabindex="-1"></a>  <span class="co"># manual specification of colors</span></span>
<span id="cb1532-16"><a href="epicurves.html#cb1532-16" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb1532-17"><a href="epicurves.html#cb1532-17" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;beige&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;brown&quot;</span>),</span>
<span id="cb1532-18"><a href="epicurves.html#cb1532-18" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s&quot;</span>),</span>
<span id="cb1532-19"><a href="epicurves.html#cb1532-19" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Hospital&quot;</span>) <span class="co"># specify fill colors (&quot;values&quot;) - attention to order!</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1158-1.png" width="672" /></p>
</div>
<div id="hiệu-chỉnh-thứ-bậc" class="section level3 unnumbered">
<h3>Hiệu chỉnh thứ bậc</h3>
<p>Thứ tự mà các cột được nhóm xếp chồng lên nhau được điều chỉnh tốt nhất bằng cách phân loại cột nhóm dưới dạng Factor. Sau đó, bạn có thể chỉ định thứ tự cấp độ phân loại (và nhãn hiển thị của chúng). Xem chương về <a href="factors.html#factors">Factors</a> hoặc <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> để biết thêm chi tiết.</p>
<p>Trước khi tạo biểu đồ, hãy sử dụng hàm <code>fct_relevel()</code> từ package <strong>forcats</strong> để chuyển đổi cột phân nhóm thành kiểu Factor và điều chỉnh thứ tự cấp độ theo cách thủ công, như được trình bày chi tiết trong chương về <a href="factors.html#factors">Factors</a>.</p>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="epicurves.html#cb1533-1" tabindex="-1"></a><span class="co"># load forcats package for working with factors</span></span>
<span id="cb1533-2"><a href="epicurves.html#cb1533-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(forcats)</span>
<span id="cb1533-3"><a href="epicurves.html#cb1533-3" tabindex="-1"></a></span>
<span id="cb1533-4"><a href="epicurves.html#cb1533-4" tabindex="-1"></a><span class="co"># Define new dataset with hospital as factor</span></span>
<span id="cb1533-5"><a href="epicurves.html#cb1533-5" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1533-6"><a href="epicurves.html#cb1533-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">fct_relevel</span>(hospital, <span class="fu">c</span>(<span class="st">&quot;Missing&quot;</span>, <span class="st">&quot;Other&quot;</span>))) <span class="co"># Convert to factor and set &quot;Missing&quot; and &quot;Other&quot; as top levels to appear on epicurve top</span></span>
<span id="cb1533-7"><a href="epicurves.html#cb1533-7" tabindex="-1"></a></span>
<span id="cb1533-8"><a href="epicurves.html#cb1533-8" tabindex="-1"></a><span class="fu">levels</span>(plot_data<span class="sc">$</span>hospital) <span class="co"># print levels in order</span></span></code></pre></div>
<pre><code>## [1] &quot;Missing&quot;                              &quot;Other&quot;                               
## [3] &quot;Central Hospital&quot;                     &quot;Military Hospital&quot;                   
## [5] &quot;Port Hospital&quot;                        &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</code></pre>
<p>Trong biểu đồ dưới đây, điểm khác biệt duy nhất so với trước đó là cột <code>hospital</code> đã được hợp nhất như trên và chúng ta sử dụng các <code>guides()</code> để đảo ngược thứ tự chú thích, do đó “nhãn Missing” nằm ở cuối chú thích.</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1535-1"><a href="epicurves.html#cb1535-1" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data) <span class="sc">+</span>                     <span class="co"># Use NEW dataset with hospital as re-ordered factor</span></span>
<span id="cb1535-2"><a href="epicurves.html#cb1535-2" tabindex="-1"></a>  </span>
<span id="cb1535-3"><a href="epicurves.html#cb1535-3" tabindex="-1"></a>  <span class="co"># make histogram</span></span>
<span id="cb1535-4"><a href="epicurves.html#cb1535-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1535-5"><a href="epicurves.html#cb1535-5" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset,</span>
<span id="cb1535-6"><a href="epicurves.html#cb1535-6" tabindex="-1"></a>        <span class="at">group =</span> hospital,               <span class="co"># cases grouped by hospital</span></span>
<span id="cb1535-7"><a href="epicurves.html#cb1535-7" tabindex="-1"></a>        <span class="at">fill =</span> hospital),               <span class="co"># bar fill (color) by hospital</span></span>
<span id="cb1535-8"><a href="epicurves.html#cb1535-8" tabindex="-1"></a>    </span>
<span id="cb1535-9"><a href="epicurves.html#cb1535-9" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_all,         <span class="co"># sequence of weekly Monday bin breaks for whole outbreak, defined at top of ggplot section</span></span>
<span id="cb1535-10"><a href="epicurves.html#cb1535-10" tabindex="-1"></a>    </span>
<span id="cb1535-11"><a href="epicurves.html#cb1535-11" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span>                   <span class="co"># border color around each bar</span></span>
<span id="cb1535-12"><a href="epicurves.html#cb1535-12" tabindex="-1"></a>    </span>
<span id="cb1535-13"><a href="epicurves.html#cb1535-13" tabindex="-1"></a>  <span class="co"># x-axis labels</span></span>
<span id="cb1535-14"><a href="epicurves.html#cb1535-14" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1535-15"><a href="epicurves.html#cb1535-15" tabindex="-1"></a>    <span class="at">expand            =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),           <span class="co"># remove excess x-axis space before and after case bars</span></span>
<span id="cb1535-16"><a href="epicurves.html#cb1535-16" tabindex="-1"></a>    <span class="at">date_breaks       =</span> <span class="st">&quot;3 weeks&quot;</span>,        <span class="co"># labels appear every 3 Monday weeks</span></span>
<span id="cb1535-17"><a href="epicurves.html#cb1535-17" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,           <span class="co"># vertical lines appear every Monday week</span></span>
<span id="cb1535-18"><a href="epicurves.html#cb1535-18" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>()) <span class="sc">+</span> <span class="co"># efficient label formatting</span></span>
<span id="cb1535-19"><a href="epicurves.html#cb1535-19" tabindex="-1"></a>  </span>
<span id="cb1535-20"><a href="epicurves.html#cb1535-20" tabindex="-1"></a>  <span class="co"># y-axis</span></span>
<span id="cb1535-21"><a href="epicurves.html#cb1535-21" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1535-22"><a href="epicurves.html#cb1535-22" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                   <span class="co"># remove excess y-axis space below 0</span></span>
<span id="cb1535-23"><a href="epicurves.html#cb1535-23" tabindex="-1"></a>  </span>
<span id="cb1535-24"><a href="epicurves.html#cb1535-24" tabindex="-1"></a>  <span class="co"># manual specification of colors, ! attention to order</span></span>
<span id="cb1535-25"><a href="epicurves.html#cb1535-25" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb1535-26"><a href="epicurves.html#cb1535-26" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;beige&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;brown&quot;</span>),</span>
<span id="cb1535-27"><a href="epicurves.html#cb1535-27" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s&quot;</span>),</span>
<span id="cb1535-28"><a href="epicurves.html#cb1535-28" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">&quot;Hospital&quot;</span>)<span class="sc">+</span> </span>
<span id="cb1535-29"><a href="epicurves.html#cb1535-29" tabindex="-1"></a>  </span>
<span id="cb1535-30"><a href="epicurves.html#cb1535-30" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1535-31"><a href="epicurves.html#cb1535-31" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                      <span class="co"># simplify plot background</span></span>
<span id="cb1535-32"><a href="epicurves.html#cb1535-32" tabindex="-1"></a>  </span>
<span id="cb1535-33"><a href="epicurves.html#cb1535-33" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1535-34"><a href="epicurves.html#cb1535-34" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="co"># caption on left side in italics</span></span>
<span id="cb1535-35"><a href="epicurves.html#cb1535-35" tabindex="-1"></a>                                <span class="at">hjust =</span> <span class="dv">0</span>), </span>
<span id="cb1535-36"><a href="epicurves.html#cb1535-36" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))<span class="sc">+</span>   <span class="co"># axis titles in bold</span></span>
<span id="cb1535-37"><a href="epicurves.html#cb1535-37" tabindex="-1"></a>  </span>
<span id="cb1535-38"><a href="epicurves.html#cb1535-38" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb1535-39"><a href="epicurves.html#cb1535-39" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1535-40"><a href="epicurves.html#cb1535-40" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&quot;Weekly incidence of cases by hospital&quot;</span>,</span>
<span id="cb1535-41"><a href="epicurves.html#cb1535-41" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Hospital as re-ordered factor&quot;</span>,</span>
<span id="cb1535-42"><a href="epicurves.html#cb1535-42" tabindex="-1"></a>    <span class="at">x        =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1535-43"><a href="epicurves.html#cb1535-43" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&quot;Weekly cases&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1160-1.png" width="672" /></p>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Để chỉ đảo ngược thứ tự của chú thích, hãy thêm lệnh <strong>ggplot2</strong> này: <code>guides(fill = guide_legend(reverse = TRUE))</code>.</span></p>
</div>
<div id="hiệu-chỉnh-chú-thích" class="section level3 unnumbered">
<h3>Hiệu chỉnh chú thích</h3>
<p>Đọc thêm về chú thích và scale trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>. Dưới đây là một vài điểm nổi bật:</p>
<ul>
<li><p>Chỉnh sửa tiêu đề chú thích trong hàm scale hoặc với <code>labs(fill = "Legend title")</code> (nếu bạn đang sử dụng <code>color =</code>, thì hãy sử dụng <code>labs(color = "")</code>)<br />
</p></li>
<li><p><code>theme(legend.title = element_blank())</code> để bỏ trống tiêu đề chú thích<br />
</p></li>
<li><p><code>theme(legend.position = "top")</code> (“bottom”, “left”, “right”, hoặc “none” để bỏ chú thích)</p></li>
<li><p><code>theme(legend.direction = "horizontal")</code> xoay ngang chú thích</p></li>
<li><p><code>guides(fill = guide_legend(reverse = TRUE))</code> để đảo ngược thứ tự các mục chú thích</p></li>
</ul>
</div>
<div id="cột-kề-cột" class="section level3 unnumbered">
<h3>Cột kề cột</h3>
<p>Hiển thị song song các cột nhóm (trái ngược với xếp chồng lên nhau) được chỉ định trong <code>geom_histogram()</code> với <code>position = "dodge"</code> được đặt bên ngoài <code>aes()</code>.</p>
<p>Nếu có nhiều hơn hai nhóm giá trị, nó có thể gây khó đọc. Thay vào đó, hãy cân nhắc sử dụng một biểu đồ được chia nhỏ (gồm nhiều biểu đồ nhỏ). Để dễ xem trong ví dụ này, các giá trị giới tính bị thiếu sẽ bị xóa.</p>
<div class="sourceCode" id="cb1536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1536-1"><a href="epicurves.html#cb1536-1" tabindex="-1"></a><span class="fu">ggplot</span>(central_data <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>(gender))<span class="sc">+</span>   <span class="co"># begin with Central Hospital cases dropping missing gender</span></span>
<span id="cb1536-2"><a href="epicurves.html#cb1536-2" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(</span>
<span id="cb1536-3"><a href="epicurves.html#cb1536-3" tabindex="-1"></a>        <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1536-4"><a href="epicurves.html#cb1536-4" tabindex="-1"></a>          <span class="at">x =</span> date_onset,</span>
<span id="cb1536-5"><a href="epicurves.html#cb1536-5" tabindex="-1"></a>          <span class="at">group =</span> gender,         <span class="co"># cases grouped by gender</span></span>
<span id="cb1536-6"><a href="epicurves.html#cb1536-6" tabindex="-1"></a>          <span class="at">fill =</span> gender),         <span class="co"># bars filled by gender</span></span>
<span id="cb1536-7"><a href="epicurves.html#cb1536-7" tabindex="-1"></a>        </span>
<span id="cb1536-8"><a href="epicurves.html#cb1536-8" tabindex="-1"></a>        <span class="co"># histogram bin breaks</span></span>
<span id="cb1536-9"><a href="epicurves.html#cb1536-9" tabindex="-1"></a>        <span class="at">breaks =</span> weekly_breaks_central,   <span class="co"># sequence of weekly dates for Central outbreak - defined at top of ggplot section</span></span>
<span id="cb1536-10"><a href="epicurves.html#cb1536-10" tabindex="-1"></a>        </span>
<span id="cb1536-11"><a href="epicurves.html#cb1536-11" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,          <span class="co"># bar edge color</span></span>
<span id="cb1536-12"><a href="epicurves.html#cb1536-12" tabindex="-1"></a>        </span>
<span id="cb1536-13"><a href="epicurves.html#cb1536-13" tabindex="-1"></a>        <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)<span class="sc">+</span>      <span class="co"># SIDE-BY-SIDE bars</span></span>
<span id="cb1536-14"><a href="epicurves.html#cb1536-14" tabindex="-1"></a>                      </span>
<span id="cb1536-15"><a href="epicurves.html#cb1536-15" tabindex="-1"></a>  </span>
<span id="cb1536-16"><a href="epicurves.html#cb1536-16" tabindex="-1"></a>  <span class="co"># The labels on the x-axis</span></span>
<span id="cb1536-17"><a href="epicurves.html#cb1536-17" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">expand            =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),         <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1536-18"><a href="epicurves.html#cb1536-18" tabindex="-1"></a>               <span class="at">date_breaks       =</span> <span class="st">&quot;3 weeks&quot;</span>,      <span class="co"># labels appear every 3 Monday weeks</span></span>
<span id="cb1536-19"><a href="epicurves.html#cb1536-19" tabindex="-1"></a>               <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,         <span class="co"># vertical lines appear every Monday week</span></span>
<span id="cb1536-20"><a href="epicurves.html#cb1536-20" tabindex="-1"></a>               <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># efficient date labels</span></span>
<span id="cb1536-21"><a href="epicurves.html#cb1536-21" tabindex="-1"></a>  </span>
<span id="cb1536-22"><a href="epicurves.html#cb1536-22" tabindex="-1"></a>  <span class="co"># y-axis</span></span>
<span id="cb1536-23"><a href="epicurves.html#cb1536-23" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>             <span class="co"># removes excess y-axis space between bottom of bars and the labels</span></span>
<span id="cb1536-24"><a href="epicurves.html#cb1536-24" tabindex="-1"></a>  </span>
<span id="cb1536-25"><a href="epicurves.html#cb1536-25" tabindex="-1"></a>  <span class="co">#scale of colors and legend labels</span></span>
<span id="cb1536-26"><a href="epicurves.html#cb1536-26" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;brown&quot;</span>, <span class="st">&quot;orange&quot;</span>),  <span class="co"># specify fill colors (&quot;values&quot;) - attention to order!</span></span>
<span id="cb1536-27"><a href="epicurves.html#cb1536-27" tabindex="-1"></a>                    <span class="at">na.value =</span> <span class="st">&quot;grey&quot;</span> )<span class="sc">+</span>     </span>
<span id="cb1536-28"><a href="epicurves.html#cb1536-28" tabindex="-1"></a></span>
<span id="cb1536-29"><a href="epicurves.html#cb1536-29" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1536-30"><a href="epicurves.html#cb1536-30" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                               <span class="co"># a set of themes to simplify plot</span></span>
<span id="cb1536-31"><a href="epicurves.html#cb1536-31" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="co"># caption on left side in italics</span></span>
<span id="cb1536-32"><a href="epicurves.html#cb1536-32" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))<span class="sc">+</span>               <span class="co"># axis titles in bold</span></span>
<span id="cb1536-33"><a href="epicurves.html#cb1536-33" tabindex="-1"></a>  </span>
<span id="cb1536-34"><a href="epicurves.html#cb1536-34" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb1536-35"><a href="epicurves.html#cb1536-35" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title    =</span> <span class="st">&quot;Weekly incidence of cases, by gender&quot;</span>,</span>
<span id="cb1536-36"><a href="epicurves.html#cb1536-36" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>,</span>
<span id="cb1536-37"><a href="epicurves.html#cb1536-37" tabindex="-1"></a>       <span class="at">fill     =</span> <span class="st">&quot;Gender&quot;</span>,                                      <span class="co"># provide new title for legend</span></span>
<span id="cb1536-38"><a href="epicurves.html#cb1536-38" tabindex="-1"></a>       <span class="at">x        =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1536-39"><a href="epicurves.html#cb1536-39" tabindex="-1"></a>       <span class="at">y        =</span> <span class="st">&quot;Weekly incident cases reported&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1161-1.png" width="672" /></p>
</div>
<div id="giới-hạn-trục" class="section level3 unnumbered">
<h3>Giới hạn trục</h3>
<p>Có hai cách để giới hạn phạm vi các giá trị trên trục.</p>
<p>Nói chung, cách khuyến khích sử dụng là lệnh <code>coord_cartesian()</code>, chấp nhận <code>xlim = c(min, max)</code> và <code>ylim = c(min, max)</code> (trong đó bạn cung cấp giá trị nhỏ nhất và lớn nhất). Cách này hoạt động như một “thu phóng kích thước” mà không thực sự loại bỏ bất kỳ dữ liệu nào, điều này rất quan trọng đối với các số liệu thống kê và các thang đo tổng hợp.</p>
<p>Ngoài ra, bạn có thể thiết lập giá trị ngày tối đa và tối thiểu bằng cách sử dụng <code>limits = c()</code> bên trong hàm <code>scale_x_date()</code>. Ví dụ:</p>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1537-1"><a href="epicurves.html#cb1537-1" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2014-04-01&quot;</span>), <span class="cn">NA</span>)) <span class="co"># sets a minimum date but leaves the maximum open.  </span></span></code></pre></div>
<p>Tương tự như vậy, nếu bạn muốn trục x kéo dài đến một ngày cụ thể (ví dụ: ngày hiện tại), ngay cả khi không có trường hợp mới nào được báo cáo, bạn có thể sử dụng:</p>
<div class="sourceCode" id="cb1538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1538-1"><a href="epicurves.html#cb1538-1" tabindex="-1"></a><span class="fu">scale_x_date</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">Sys.Date</span>()) <span class="co"># ensures date axis will extend until current date  </span></span></code></pre></div>
<p><span style="color: red;"><strong><em>LƯU Ý</em></strong>: Hãy thận trọng khi đặt giới hạn hoặc chia tỷ lệ trục y (ví dụ: 0 đến 30 với khoảng là 5: <code>seq(0, 30, 5)</code>). Những con số tĩnh như vậy có thể cắt bớt biểu đồ quá ngắn nếu dữ liệu thay đổi vượt quá giới hạn!.</span></p>
</div>
<div id="nhãnđường-lưới-của-trục-ngày" class="section level3 unnumbered">
<h3>Nhãn/đường lưới của trục ngày</h3>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Hãy nhớ rằng các <strong>nhãn</strong> trục ngày độc lập với việc tổng hợp dữ liệu thành các cột, nhưng về mặt trực quan, điều quan trọng là phải căn chỉnh các cột, nhãn ngày và các đường lưới dọc.</span></p>
<p>Để <strong>sửa đổi nhãn ngày và đường lưới</strong>, hãy sử dụng <code>scale_x_date()</code> theo một trong những cách sau:</p>
<ul>
<li><p><strong>Nếu histogram bins là ngày, tuần bắt đầu vào thứ hai, tháng hoặc năm:</strong></p>
<ul>
<li>Sử dụng <code>date_breaks =</code> để xác định khoảng thời gian của các nhãn và đường lưới chính (ví dụ: “day”, “week”, “3 weeks”, “month” hoặc “year”)</li>
<li>Sử dụng <code>date_minor_breaks =</code> để xác định khoảng của các đường lưới dọc nhỏ (giữa các nhãn ngày)<br />
</li>
<li>Thêm <code>expand = c(0,0)</code> để bắt đầu các nhãn ở cột đầu tiên<br />
</li>
<li>Sử dụng <code>date_labels =</code> để xác định định dạng của nhãn ngày - hãy xem chương Ngày để biết các mẹo (sử dụng <code>\n</code> cho một dòng mới)<br />
</li>
</ul></li>
<li><p><strong>Nếu histogram bins là các tuần bắt đầu vào Chủ nhật:</strong></p>
<ul>
<li>Sử dụng <code>breaks =</code> và <code>minor_breaks =</code> bằng cách cung cấp một chuỗi ngày cho mỗi khoảng chia</li>
<li>Vẫn có thể sử dụng <code>date_labels =</code> và <code>expand =</code> để định dạng như mô tả ở trên</li>
</ul></li>
</ul>
<p>Một số ghi chú:</p>
<ul>
<li>Xem phần mở đầu của mục ggplot về hướng dẫn cách tạo chuỗi ngày bằng <code>seq.Date()</code>.<br />
</li>
<li>Xem <a href="https://rdrr.io/r/base/strptime.html">trang này</a> hoặc chương <a href="dates.html#dates">Làm việc với ngày tháng</a> để biết thêm mẹo tạo nhãn ngày.</li>
</ul>
<div id="minh-họa" class="section level4 unnumbered">
<h4>Minh họa</h4>
<p>Dưới đây là minh họa biểu đồ trong đó các cột và nhãn biểu đồ/đường lưới được căn chỉnh thẳng hàng và không thẳng hàng:</p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb1539-1"><a href="epicurves.html#cb1539-1" tabindex="-1"></a><span class="co"># 7-day bins + Monday labels</span></span>
<span id="cb1539-2"><a href="epicurves.html#cb1539-2" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb1539-3"><a href="epicurves.html#cb1539-3" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span></span>
<span id="cb1539-4"><a href="epicurves.html#cb1539-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1539-5"><a href="epicurves.html#cb1539-5" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1539-6"><a href="epicurves.html#cb1539-6" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,                 <span class="co"># 7-day bins with start at first case</span></span>
<span id="cb1539-7"><a href="epicurves.html#cb1539-7" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb1539-8"><a href="epicurves.html#cb1539-8" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1539-9"><a href="epicurves.html#cb1539-9" tabindex="-1"></a>  </span>
<span id="cb1539-10"><a href="epicurves.html#cb1539-10" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1539-11"><a href="epicurves.html#cb1539-11" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),               <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1539-12"><a href="epicurves.html#cb1539-12" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;3 weeks&quot;</span>,       <span class="co"># Monday every 3 weeks</span></span>
<span id="cb1539-13"><a href="epicurves.html#cb1539-13" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,    <span class="co"># Monday weeks</span></span>
<span id="cb1539-14"><a href="epicurves.html#cb1539-14" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># automatic label formatting</span></span>
<span id="cb1539-15"><a href="epicurves.html#cb1539-15" tabindex="-1"></a>  </span>
<span id="cb1539-16"><a href="epicurves.html#cb1539-16" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1539-17"><a href="epicurves.html#cb1539-17" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>              <span class="co"># remove excess space under x-axis, make flush</span></span>
<span id="cb1539-18"><a href="epicurves.html#cb1539-18" tabindex="-1"></a>  </span>
<span id="cb1539-19"><a href="epicurves.html#cb1539-19" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1539-20"><a href="epicurves.html#cb1539-20" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;MISALIGNED&quot;</span>,</span>
<span id="cb1539-21"><a href="epicurves.html#cb1539-21" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;! CAUTION: 7-day bars start Thursdays at first case</span><span class="sc">\n</span><span class="st">Date labels and gridlines on Mondays</span><span class="sc">\n</span><span class="st">Note how ticks don&#39;t align with bars&quot;</span>)</span>
<span id="cb1539-22"><a href="epicurves.html#cb1539-22" tabindex="-1"></a></span>
<span id="cb1539-23"><a href="epicurves.html#cb1539-23" tabindex="-1"></a></span>
<span id="cb1539-24"><a href="epicurves.html#cb1539-24" tabindex="-1"></a></span>
<span id="cb1539-25"><a href="epicurves.html#cb1539-25" tabindex="-1"></a><span class="co"># 7-day bins + Months</span></span>
<span id="cb1539-26"><a href="epicurves.html#cb1539-26" tabindex="-1"></a><span class="do">#####################</span></span>
<span id="cb1539-27"><a href="epicurves.html#cb1539-27" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span></span>
<span id="cb1539-28"><a href="epicurves.html#cb1539-28" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1539-29"><a href="epicurves.html#cb1539-29" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1539-30"><a href="epicurves.html#cb1539-30" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">7</span>,</span>
<span id="cb1539-31"><a href="epicurves.html#cb1539-31" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb1539-32"><a href="epicurves.html#cb1539-32" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1539-33"><a href="epicurves.html#cb1539-33" tabindex="-1"></a>  </span>
<span id="cb1539-34"><a href="epicurves.html#cb1539-34" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1539-35"><a href="epicurves.html#cb1539-35" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                  <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1539-36"><a href="epicurves.html#cb1539-36" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;months&quot;</span>,           <span class="co"># 1st of month</span></span>
<span id="cb1539-37"><a href="epicurves.html#cb1539-37" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,       <span class="co"># Monday weeks</span></span>
<span id="cb1539-38"><a href="epicurves.html#cb1539-38" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># automatic label formatting</span></span>
<span id="cb1539-39"><a href="epicurves.html#cb1539-39" tabindex="-1"></a>  </span>
<span id="cb1539-40"><a href="epicurves.html#cb1539-40" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1539-41"><a href="epicurves.html#cb1539-41" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                <span class="co"># remove excess space under x-axis, make flush </span></span>
<span id="cb1539-42"><a href="epicurves.html#cb1539-42" tabindex="-1"></a>  </span>
<span id="cb1539-43"><a href="epicurves.html#cb1539-43" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1539-44"><a href="epicurves.html#cb1539-44" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;MISALIGNED&quot;</span>,</span>
<span id="cb1539-45"><a href="epicurves.html#cb1539-45" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;! CAUTION: 7-day bars start Thursdays with first case</span><span class="sc">\n</span><span class="st">Major gridlines and date labels at 1st of each month</span><span class="sc">\n</span><span class="st">Minor gridlines weekly on Mondays</span><span class="sc">\n</span><span class="st">Note uneven spacing of some gridlines and ticks unaligned with bars&quot;</span>)</span>
<span id="cb1539-46"><a href="epicurves.html#cb1539-46" tabindex="-1"></a></span>
<span id="cb1539-47"><a href="epicurves.html#cb1539-47" tabindex="-1"></a></span>
<span id="cb1539-48"><a href="epicurves.html#cb1539-48" tabindex="-1"></a><span class="co"># TOTAL MONDAY ALIGNMENT: specify manual bin breaks to be mondays</span></span>
<span id="cb1539-49"><a href="epicurves.html#cb1539-49" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb1539-50"><a href="epicurves.html#cb1539-50" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span> </span>
<span id="cb1539-51"><a href="epicurves.html#cb1539-51" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1539-52"><a href="epicurves.html#cb1539-52" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1539-53"><a href="epicurves.html#cb1539-53" tabindex="-1"></a>    </span>
<span id="cb1539-54"><a href="epicurves.html#cb1539-54" tabindex="-1"></a>    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span></span>
<span id="cb1539-55"><a href="epicurves.html#cb1539-55" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central,    <span class="co"># defined earlier in this page</span></span>
<span id="cb1539-56"><a href="epicurves.html#cb1539-56" tabindex="-1"></a>    </span>
<span id="cb1539-57"><a href="epicurves.html#cb1539-57" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb1539-58"><a href="epicurves.html#cb1539-58" tabindex="-1"></a>    </span>
<span id="cb1539-59"><a href="epicurves.html#cb1539-59" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1539-60"><a href="epicurves.html#cb1539-60" tabindex="-1"></a>  </span>
<span id="cb1539-61"><a href="epicurves.html#cb1539-61" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1539-62"><a href="epicurves.html#cb1539-62" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                   <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1539-63"><a href="epicurves.html#cb1539-63" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;4 weeks&quot;</span>,           <span class="co"># Monday every 4 weeks</span></span>
<span id="cb1539-64"><a href="epicurves.html#cb1539-64" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,        <span class="co"># Monday weeks </span></span>
<span id="cb1539-65"><a href="epicurves.html#cb1539-65" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1539-66"><a href="epicurves.html#cb1539-66" tabindex="-1"></a>  </span>
<span id="cb1539-67"><a href="epicurves.html#cb1539-67" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1539-68"><a href="epicurves.html#cb1539-68" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                <span class="co"># remove excess space under x-axis, make flush </span></span>
<span id="cb1539-69"><a href="epicurves.html#cb1539-69" tabindex="-1"></a>  </span>
<span id="cb1539-70"><a href="epicurves.html#cb1539-70" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1539-71"><a href="epicurves.html#cb1539-71" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;ALIGNED Mondays&quot;</span>,</span>
<span id="cb1539-72"><a href="epicurves.html#cb1539-72" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;7-day bins manually set to begin Monday before first case (28 Apr)</span><span class="sc">\n</span><span class="st">Date labels and gridlines on Mondays as well&quot;</span>)</span>
<span id="cb1539-73"><a href="epicurves.html#cb1539-73" tabindex="-1"></a></span>
<span id="cb1539-74"><a href="epicurves.html#cb1539-74" tabindex="-1"></a></span>
<span id="cb1539-75"><a href="epicurves.html#cb1539-75" tabindex="-1"></a><span class="co"># TOTAL MONDAY ALIGNMENT WITH MONTHS LABELS:</span></span>
<span id="cb1539-76"><a href="epicurves.html#cb1539-76" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb1539-77"><a href="epicurves.html#cb1539-77" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span> </span>
<span id="cb1539-78"><a href="epicurves.html#cb1539-78" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1539-79"><a href="epicurves.html#cb1539-79" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1539-80"><a href="epicurves.html#cb1539-80" tabindex="-1"></a>    </span>
<span id="cb1539-81"><a href="epicurves.html#cb1539-81" tabindex="-1"></a>    <span class="co"># histogram breaks set to 7 days beginning Monday before first case</span></span>
<span id="cb1539-82"><a href="epicurves.html#cb1539-82" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central,            <span class="co"># defined earlier in this page</span></span>
<span id="cb1539-83"><a href="epicurves.html#cb1539-83" tabindex="-1"></a>    </span>
<span id="cb1539-84"><a href="epicurves.html#cb1539-84" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb1539-85"><a href="epicurves.html#cb1539-85" tabindex="-1"></a>    </span>
<span id="cb1539-86"><a href="epicurves.html#cb1539-86" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1539-87"><a href="epicurves.html#cb1539-87" tabindex="-1"></a>  </span>
<span id="cb1539-88"><a href="epicurves.html#cb1539-88" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1539-89"><a href="epicurves.html#cb1539-89" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                   <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1539-90"><a href="epicurves.html#cb1539-90" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;months&quot;</span>,            <span class="co"># Monday every 4 weeks</span></span>
<span id="cb1539-91"><a href="epicurves.html#cb1539-91" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,        <span class="co"># Monday weeks </span></span>
<span id="cb1539-92"><a href="epicurves.html#cb1539-92" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1539-93"><a href="epicurves.html#cb1539-93" tabindex="-1"></a>  </span>
<span id="cb1539-94"><a href="epicurves.html#cb1539-94" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1539-95"><a href="epicurves.html#cb1539-95" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                <span class="co"># remove excess space under x-axis, make flush </span></span>
<span id="cb1539-96"><a href="epicurves.html#cb1539-96" tabindex="-1"></a>  </span>
<span id="cb1539-97"><a href="epicurves.html#cb1539-97" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>())<span class="sc">+</span>  <span class="co"># Remove major gridlines (fall on 1st of month)</span></span>
<span id="cb1539-98"><a href="epicurves.html#cb1539-98" tabindex="-1"></a>          </span>
<span id="cb1539-99"><a href="epicurves.html#cb1539-99" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1539-100"><a href="epicurves.html#cb1539-100" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;ALIGNED Mondays with MONTHLY labels&quot;</span>,</span>
<span id="cb1539-101"><a href="epicurves.html#cb1539-101" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;7-day bins manually set to begin Monday before first case (28 Apr)</span><span class="sc">\n</span><span class="st">Date labels on 1st of Month</span><span class="sc">\n</span><span class="st">Monthly major gridlines removed&quot;</span>)</span>
<span id="cb1539-102"><a href="epicurves.html#cb1539-102" tabindex="-1"></a></span>
<span id="cb1539-103"><a href="epicurves.html#cb1539-103" tabindex="-1"></a></span>
<span id="cb1539-104"><a href="epicurves.html#cb1539-104" tabindex="-1"></a><span class="co"># TOTAL SUNDAY ALIGNMENT: specify manual bin breaks AND labels to be Sundays</span></span>
<span id="cb1539-105"><a href="epicurves.html#cb1539-105" tabindex="-1"></a><span class="do">############################################################################</span></span>
<span id="cb1539-106"><a href="epicurves.html#cb1539-106" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span> </span>
<span id="cb1539-107"><a href="epicurves.html#cb1539-107" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1539-108"><a href="epicurves.html#cb1539-108" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1539-109"><a href="epicurves.html#cb1539-109" tabindex="-1"></a>    </span>
<span id="cb1539-110"><a href="epicurves.html#cb1539-110" tabindex="-1"></a>    <span class="co"># histogram breaks set to 7 days beginning Sunday before first case</span></span>
<span id="cb1539-111"><a href="epicurves.html#cb1539-111" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>),</span>
<span id="cb1539-112"><a href="epicurves.html#cb1539-112" tabindex="-1"></a>                      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>),</span>
<span id="cb1539-113"><a href="epicurves.html#cb1539-113" tabindex="-1"></a>                      <span class="at">by   =</span> <span class="st">&quot;7 days&quot;</span>),</span>
<span id="cb1539-114"><a href="epicurves.html#cb1539-114" tabindex="-1"></a>    </span>
<span id="cb1539-115"><a href="epicurves.html#cb1539-115" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb1539-116"><a href="epicurves.html#cb1539-116" tabindex="-1"></a>    </span>
<span id="cb1539-117"><a href="epicurves.html#cb1539-117" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1539-118"><a href="epicurves.html#cb1539-118" tabindex="-1"></a>  </span>
<span id="cb1539-119"><a href="epicurves.html#cb1539-119" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1539-120"><a href="epicurves.html#cb1539-120" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb1539-121"><a href="epicurves.html#cb1539-121" tabindex="-1"></a>    <span class="co"># date label breaks and major gridlines set to every 3 weeks beginning Sunday before first case</span></span>
<span id="cb1539-122"><a href="epicurves.html#cb1539-122" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>),</span>
<span id="cb1539-123"><a href="epicurves.html#cb1539-123" tabindex="-1"></a>                      <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>),</span>
<span id="cb1539-124"><a href="epicurves.html#cb1539-124" tabindex="-1"></a>                      <span class="at">by   =</span> <span class="st">&quot;3 weeks&quot;</span>),</span>
<span id="cb1539-125"><a href="epicurves.html#cb1539-125" tabindex="-1"></a>    </span>
<span id="cb1539-126"><a href="epicurves.html#cb1539-126" tabindex="-1"></a>    <span class="co"># minor gridlines set to weekly beginning Sunday before first case</span></span>
<span id="cb1539-127"><a href="epicurves.html#cb1539-127" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">floor_date</span>(<span class="fu">min</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T),   <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>),</span>
<span id="cb1539-128"><a href="epicurves.html#cb1539-128" tabindex="-1"></a>                            <span class="at">to   =</span> <span class="fu">ceiling_date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm=</span>T), <span class="st">&quot;week&quot;</span>, <span class="at">week_start =</span> <span class="dv">7</span>),</span>
<span id="cb1539-129"><a href="epicurves.html#cb1539-129" tabindex="-1"></a>                            <span class="at">by   =</span> <span class="st">&quot;7 days&quot;</span>),</span>
<span id="cb1539-130"><a href="epicurves.html#cb1539-130" tabindex="-1"></a>    </span>
<span id="cb1539-131"><a href="epicurves.html#cb1539-131" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1539-132"><a href="epicurves.html#cb1539-132" tabindex="-1"></a>  </span>
<span id="cb1539-133"><a href="epicurves.html#cb1539-133" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1539-134"><a href="epicurves.html#cb1539-134" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                <span class="co"># remove excess space under x-axis, make flush </span></span>
<span id="cb1539-135"><a href="epicurves.html#cb1539-135" tabindex="-1"></a>  </span>
<span id="cb1539-136"><a href="epicurves.html#cb1539-136" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;ALIGNED Sundays&quot;</span>,</span>
<span id="cb1539-137"><a href="epicurves.html#cb1539-137" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;7-day bins manually set to begin Sunday before first case (27 Apr)</span><span class="sc">\n</span><span class="st">Date labels and gridlines manually set to Sundays as well&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1164-1.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-1164-2.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-1164-3.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-1164-4.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-1164-5.png" width="672" /></p>
</div>
</div>
<div id="dữ-liệu-tổng-hợp" class="section level3 unnumbered">
<h3>Dữ liệu tổng hợp</h3>
<p>Thông thường, thay vì bắt đầu với bộ số liệu <code>linelist</code>, bạn có thể bắt đầu với số lượng tổng hợp từ các cơ sở y tế, quận, huyện, v.v. Bạn có thể tạo đường cong dịch bệnh với <code>ggplot()</code> nhưng code sẽ hơi khác một chút. Phần này sẽ tận dụng bộ dữ liệu <code>count_data</code> đã được nạp trước đó trong mục chuẩn bị dữ liệu. Bộ dữ liệu này là <code>linelist</code> được tổng hợp thành số lượng bệnh viện theo ngày. 50 hàng đầu tiên được hiển thị dưới đây.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-c7eb2bc039057dd10436" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c7eb2bc039057dd10436">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399334400000\" data-max=\"1410307200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1\" data-max=\"3\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital"],["2014-05-06","2014-05-10","2014-05-13","2014-05-28","2014-06-06","2014-06-09","2014-06-14","2014-06-19","2014-07-09","2014-07-10","2014-07-11","2014-07-13","2014-07-14","2014-07-15","2014-07-17","2014-07-19","2014-07-27","2014-07-30","2014-08-01","2014-08-02","2014-08-04","2014-08-05","2014-08-07","2014-08-09","2014-08-12","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-26","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-09","2014-09-10"],[1,1,1,2,1,1,1,1,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,2,1,3,1,1,1,2,3,2,2,2,1,2,2,2,1,2,3,3,2,1,1,2,3,2,2,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>n_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2},{"name":"hospital","targets":0},{"name":"date_hospitalisation","targets":1},{"name":"n_cases","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="vẽ-biểu-đồ-dữ-liệu-đếm-hàng-ngày" class="section level4 unnumbered">
<h4>Vẽ biểu đồ dữ liệu đếm hàng ngày</h4>
<p>Chúng ta có thể vẽ biểu đồ đường cong dịch bệnh từ <em>dữ liệu đếm hàng ngày</em>. Dưới đây là sự khác biệt trong đoạn code:</p>
<ul>
<li><p>Khi ánh xạ các yếu tố trong hàm <code>aes()</code>, hãy cụ thể <code>y =</code> bằng một cột đếm (trong trường hợp này, tên cột là <code>n_cases</code>)</p></li>
<li><p>Thêm đối số <code>stat = "identity"</code> trong <code>geom_histogram()</code>, giúp xác định rằng chiều cao cột phải là giá trị <code>y =</code>, không phải số hàng như mặc định<br />
</p></li>
<li><p>Thêm đối số <code>width =</code> để tránh các đường trắng dọc giữa các cột. Đối với dữ liệu hàng ngày được đặt thành 1. Đối với dữ liệu đếm hàng tuần được đặt thành 7. Đối với dữ liệu đếm hàng tháng, các đường màu trắng là một vấn đề (mỗi tháng có số ngày khác nhau) - hãy xem xét chuyển đổi trục x của bạn thành cột phân loại (factor) theo thứ tự (tháng) và sử dụng <code>geom_col()</code>.</p></li>
</ul>
<div class="sourceCode" id="cb1540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1540-1"><a href="epicurves.html#cb1540-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> count_data)<span class="sc">+</span></span>
<span id="cb1540-2"><a href="epicurves.html#cb1540-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1540-3"><a href="epicurves.html#cb1540-3" tabindex="-1"></a>   <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_hospitalisation, <span class="at">y =</span> n_cases),</span>
<span id="cb1540-4"><a href="epicurves.html#cb1540-4" tabindex="-1"></a>   <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1540-5"><a href="epicurves.html#cb1540-5" tabindex="-1"></a>   <span class="at">width =</span> <span class="dv">1</span>)<span class="sc">+</span>                <span class="co"># for daily counts, set width = 1 to avoid white space between bars</span></span>
<span id="cb1540-6"><a href="epicurves.html#cb1540-6" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1540-7"><a href="epicurves.html#cb1540-7" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Date of report&quot;</span>, </span>
<span id="cb1540-8"><a href="epicurves.html#cb1540-8" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Number of cases&quot;</span>,</span>
<span id="cb1540-9"><a href="epicurves.html#cb1540-9" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Daily case incidence, from daily count data&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1166-1.png" width="672" /></p>
</div>
<div id="vẽ-biểu-đồ-dữ-liệu-đếm-hàng-tuần" class="section level4 unnumbered">
<h4>Vẽ biểu đồ dữ liệu đếm hàng tuần</h4>
<p>Nếu dữ liệu của bạn đã là số lượng ca bệnh đếm theo tuần, chúng có thể trông giống như bộ dữ liệu này (được gọi là <code>count_data_weekly</code>):</p>
<p>50 hàng đầu tiên của <code>count_data_weekly</code> được hiển thị bên dưới. Bạn có thể thấy rằng số lượng đếm đã được tổng hợp thành các tuần. Mỗi tuần được hiển thị theo ngày đầu tiên của tuần (mặc định là Thứ Hai).</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-41b42472aa7e86c00365" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-41b42472aa7e86c00365">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Central Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Military Hospital","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Missing","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)"],["2014-05-04","2014-05-11","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-07-06","2014-07-13","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-13","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-04-20","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26","2014-05-04","2014-05-18","2014-05-25","2014-06-01","2014-06-15","2014-06-22","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[2,1,2,1,2,1,3,7,5,6,6,13,9,15,12,23,24,23,25,26,23,19,25,19,14,9,10,9,8,12,5,10,5,6,6,4,8,9,8,2,5,3,4,5,6,3,6,5,1,6,3,4,2,3,3,2,3,4,6,13,11,17,18,16,18,31,33,46,44,43,42,39,36,39,51,22,15,31,27,23,24,12,15,22,22,20,17,16,8,13,9,15,13,6,10,4,5,4,5,4,2,1,4,2,5,8,5,9,11,7,12,8,10,12,27,21,34,40,48,53,75,79,85,84,80,77,54,43,41,31,33,37,26,39,30,31,24,33,20,21,21,22,19,20,23,10,13,19,18,10,12,12,8,1,1,1,3,3,3,2,4,2,5,3,8,10,8,11,16,11,15,25,23,39,46,50,49,40,53,44,38,29,29,23,26,26,19,17,19,14,18,16,15,14,17,6,6,9,11,8,11,12,5,5,7,6,3,1,4,3,8,6,3,9,9,9,11,14,15,21,25,22,37,59,53,70,93,107,103,87,64,77,74,75,59,56,58,49,46,34,40,24,20,27,27,28,24,22,15,28,24,18,23,13,22,11,10,12,13,2,3,1,3,1,2,5,3,6,5,7,4,8,7,12,20,27,19,22,23,15,18,13,16,20,10,17,6,13,8,8,8,9,1,8,7,6,6,8,6,4,13,5,2,3,5,2,3,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>epiweek<\/th>\n      <th>n_cases_weekly<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":2},{"name":"hospital","targets":0},{"name":"epiweek","targets":1},{"name":"n_cases_weekly","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Bây giờ vẽ biểu đồ sao cho <code>x =</code> cột epiweek. Hãy nhớ thêm <code>y =</code> cột đếm khi ánh xạ trục và thêm <code>stat = "identity"</code> như đã giải thích ở trên.</p>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1541-1"><a href="epicurves.html#cb1541-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> count_data_weekly)<span class="sc">+</span></span>
<span id="cb1541-2"><a href="epicurves.html#cb1541-2" tabindex="-1"></a>  </span>
<span id="cb1541-3"><a href="epicurves.html#cb1541-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1541-4"><a href="epicurves.html#cb1541-4" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1541-5"><a href="epicurves.html#cb1541-5" tabindex="-1"></a>      <span class="at">x =</span> epiweek,           <span class="co"># x-axis is epiweek (as class Date)</span></span>
<span id="cb1541-6"><a href="epicurves.html#cb1541-6" tabindex="-1"></a>      <span class="at">y =</span> n_cases_weekly,    <span class="co"># y-axis height in the weekly case counts</span></span>
<span id="cb1541-7"><a href="epicurves.html#cb1541-7" tabindex="-1"></a>      <span class="at">group =</span> hospital,      <span class="co"># we are grouping the bars and coloring by hospital</span></span>
<span id="cb1541-8"><a href="epicurves.html#cb1541-8" tabindex="-1"></a>      <span class="at">fill =</span> hospital),</span>
<span id="cb1541-9"><a href="epicurves.html#cb1541-9" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span>      <span class="co"># this is also required when plotting count data</span></span>
<span id="cb1541-10"><a href="epicurves.html#cb1541-10" tabindex="-1"></a>     </span>
<span id="cb1541-11"><a href="epicurves.html#cb1541-11" tabindex="-1"></a>  <span class="co"># labels for x-axis</span></span>
<span id="cb1541-12"><a href="epicurves.html#cb1541-12" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1541-13"><a href="epicurves.html#cb1541-13" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;2 months&quot;</span>,      <span class="co"># labels every 2 months </span></span>
<span id="cb1541-14"><a href="epicurves.html#cb1541-14" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="co"># gridlines every month</span></span>
<span id="cb1541-15"><a href="epicurves.html#cb1541-15" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1541-16"><a href="epicurves.html#cb1541-16" tabindex="-1"></a>     </span>
<span id="cb1541-17"><a href="epicurves.html#cb1541-17" tabindex="-1"></a>  <span class="co"># Choose color palette (uses RColorBrewer package)</span></span>
<span id="cb1541-18"><a href="epicurves.html#cb1541-18" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Pastel2&quot;</span>)<span class="sc">+</span> </span>
<span id="cb1541-19"><a href="epicurves.html#cb1541-19" tabindex="-1"></a>  </span>
<span id="cb1541-20"><a href="epicurves.html#cb1541-20" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb1541-21"><a href="epicurves.html#cb1541-21" tabindex="-1"></a>  </span>
<span id="cb1541-22"><a href="epicurves.html#cb1541-22" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1541-23"><a href="epicurves.html#cb1541-23" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Week of onset&quot;</span>, </span>
<span id="cb1541-24"><a href="epicurves.html#cb1541-24" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Weekly case incidence&quot;</span>,</span>
<span id="cb1541-25"><a href="epicurves.html#cb1541-25" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Hospital&quot;</span>,</span>
<span id="cb1541-26"><a href="epicurves.html#cb1541-26" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Weekly case incidence, from aggregated count data by hospital&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1169-1.png" width="672" /></p>
</div>
</div>
<div id="đường-trung-bình-động" class="section level3 unnumbered">
<h3>Đường trung bình động</h3>
<p>Xem chương về <a href="moving-average.html#moving-average">Đường trung bình động</a> để có mô tả chi tiết và một số tùy chọn. Dưới đây là một tùy chọn để tính toán đường trung bình động với package <strong>slider</strong>. Theo cách tiếp cận này, <em>trung bình động được tính toán trong bộ dữ liệu trước khi vẽ biểu đồ</em>:</p>
<ol style="list-style-type: decimal">
<li>Tổng hợp dữ liệu thành số lượng nếu cần thiết (hàng ngày, hàng tuần, v.v.) (xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a>)<br />
</li>
<li>Tạo một cột mới để giữ đường trung bình động, được tạo bằng hàm <code>slide_index()</code> từ package <strong>slider</strong><br />
</li>
<li>Vẽ đường trung bình động dưới dạng một <code>geom_line()</code> ở trên đỉnh (phía sau) histogram đường cong dịch bệnh</li>
</ol>
<p>Tham khảo thêm tại <a href="https://cran.r-project.org/web/packages/slider/vignettes/slider.html">vignette của package <strong>slider</strong></a></p>
<div class="sourceCode" id="cb1542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1542-1"><a href="epicurves.html#cb1542-1" tabindex="-1"></a><span class="co"># load package</span></span>
<span id="cb1542-2"><a href="epicurves.html#cb1542-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(slider)  <span class="co"># slider used to calculate rolling averages</span></span>
<span id="cb1542-3"><a href="epicurves.html#cb1542-3" tabindex="-1"></a></span>
<span id="cb1542-4"><a href="epicurves.html#cb1542-4" tabindex="-1"></a><span class="co"># make dataset of daily counts and 7-day moving average</span></span>
<span id="cb1542-5"><a href="epicurves.html#cb1542-5" tabindex="-1"></a><span class="do">#######################################################</span></span>
<span id="cb1542-6"><a href="epicurves.html#cb1542-6" tabindex="-1"></a>ll_counts_7day <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>    <span class="co"># begin with linelist</span></span>
<span id="cb1542-7"><a href="epicurves.html#cb1542-7" tabindex="-1"></a>  </span>
<span id="cb1542-8"><a href="epicurves.html#cb1542-8" tabindex="-1"></a>  <span class="do">## count cases by date</span></span>
<span id="cb1542-9"><a href="epicurves.html#cb1542-9" tabindex="-1"></a>  <span class="fu">count</span>(date_onset, <span class="at">name =</span> <span class="st">&quot;new_cases&quot;</span>) <span class="sc">%&gt;%</span>   <span class="co"># name new column with counts as &quot;new_cases&quot;</span></span>
<span id="cb1542-10"><a href="epicurves.html#cb1542-10" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span>                     <span class="co"># remove cases with missing date_onset</span></span>
<span id="cb1542-11"><a href="epicurves.html#cb1542-11" tabindex="-1"></a>  </span>
<span id="cb1542-12"><a href="epicurves.html#cb1542-12" tabindex="-1"></a>  <span class="do">## calculate the average number of cases in 7-day window</span></span>
<span id="cb1542-13"><a href="epicurves.html#cb1542-13" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1542-14"><a href="epicurves.html#cb1542-14" tabindex="-1"></a>    <span class="at">avg_7day =</span> slider<span class="sc">::</span><span class="fu">slide_index</span>(    <span class="co"># create new column</span></span>
<span id="cb1542-15"><a href="epicurves.html#cb1542-15" tabindex="-1"></a>      new_cases,                       <span class="co"># calculate based on value in new_cases column</span></span>
<span id="cb1542-16"><a href="epicurves.html#cb1542-16" tabindex="-1"></a>      <span class="at">.i =</span> date_onset,                 <span class="co"># index is date_onset col, so non-present dates are included in window </span></span>
<span id="cb1542-17"><a href="epicurves.html#cb1542-17" tabindex="-1"></a>      <span class="at">.f =</span> <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),    <span class="co"># function is mean() with missing values removed</span></span>
<span id="cb1542-18"><a href="epicurves.html#cb1542-18" tabindex="-1"></a>      <span class="at">.before =</span> <span class="dv">6</span>,                     <span class="co"># window is the day and 6-days before</span></span>
<span id="cb1542-19"><a href="epicurves.html#cb1542-19" tabindex="-1"></a>      <span class="at">.complete =</span> <span class="cn">FALSE</span>),              <span class="co"># must be FALSE for unlist() to work in next step</span></span>
<span id="cb1542-20"><a href="epicurves.html#cb1542-20" tabindex="-1"></a>    <span class="at">avg_7day =</span> <span class="fu">unlist</span>(avg_7day))       <span class="co"># convert class list to class numeric</span></span>
<span id="cb1542-21"><a href="epicurves.html#cb1542-21" tabindex="-1"></a></span>
<span id="cb1542-22"><a href="epicurves.html#cb1542-22" tabindex="-1"></a></span>
<span id="cb1542-23"><a href="epicurves.html#cb1542-23" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb1542-24"><a href="epicurves.html#cb1542-24" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb1542-25"><a href="epicurves.html#cb1542-25" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ll_counts_7day) <span class="sc">+</span>  <span class="co"># begin with new dataset defined above </span></span>
<span id="cb1542-26"><a href="epicurves.html#cb1542-26" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(              <span class="co"># create epicurve histogram</span></span>
<span id="cb1542-27"><a href="epicurves.html#cb1542-27" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1542-28"><a href="epicurves.html#cb1542-28" tabindex="-1"></a>        <span class="at">x =</span> date_onset,          <span class="co"># date column as x-axis</span></span>
<span id="cb1542-29"><a href="epicurves.html#cb1542-29" tabindex="-1"></a>        <span class="at">y =</span> new_cases),          <span class="co"># height is number of daily new cases</span></span>
<span id="cb1542-30"><a href="epicurves.html#cb1542-30" tabindex="-1"></a>        <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,       <span class="co"># height is y value</span></span>
<span id="cb1542-31"><a href="epicurves.html#cb1542-31" tabindex="-1"></a>        <span class="at">fill=</span><span class="st">&quot;#92a8d1&quot;</span>,          <span class="co"># cool color for bars</span></span>
<span id="cb1542-32"><a href="epicurves.html#cb1542-32" tabindex="-1"></a>        <span class="at">colour =</span> <span class="st">&quot;#92a8d1&quot;</span>,      <span class="co"># same color for bar border</span></span>
<span id="cb1542-33"><a href="epicurves.html#cb1542-33" tabindex="-1"></a>        )<span class="sc">+</span> </span>
<span id="cb1542-34"><a href="epicurves.html#cb1542-34" tabindex="-1"></a>    <span class="fu">geom_line</span>(                   <span class="co"># make line for rolling average</span></span>
<span id="cb1542-35"><a href="epicurves.html#cb1542-35" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1542-36"><a href="epicurves.html#cb1542-36" tabindex="-1"></a>        <span class="at">x =</span> date_onset,          <span class="co"># date column for x-axis</span></span>
<span id="cb1542-37"><a href="epicurves.html#cb1542-37" tabindex="-1"></a>        <span class="at">y =</span> avg_7day,            <span class="co"># y-value set to rolling average column</span></span>
<span id="cb1542-38"><a href="epicurves.html#cb1542-38" tabindex="-1"></a>        <span class="at">lty =</span> <span class="st">&quot;7-day </span><span class="sc">\n</span><span class="st">rolling avg&quot;</span>), <span class="co"># name of line in legend</span></span>
<span id="cb1542-39"><a href="epicurves.html#cb1542-39" tabindex="-1"></a>      <span class="at">color=</span><span class="st">&quot;red&quot;</span>,               <span class="co"># color of line</span></span>
<span id="cb1542-40"><a href="epicurves.html#cb1542-40" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>                <span class="co"># width of line</span></span>
<span id="cb1542-41"><a href="epicurves.html#cb1542-41" tabindex="-1"></a>    <span class="fu">scale_x_date</span>(                <span class="co"># date scale</span></span>
<span id="cb1542-42"><a href="epicurves.html#cb1542-42" tabindex="-1"></a>      <span class="at">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>,</span>
<span id="cb1542-43"><a href="epicurves.html#cb1542-43" tabindex="-1"></a>      <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>(), <span class="co"># label formatting</span></span>
<span id="cb1542-44"><a href="epicurves.html#cb1542-44" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1542-45"><a href="epicurves.html#cb1542-45" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(          <span class="co"># y-axis scale</span></span>
<span id="cb1542-46"><a href="epicurves.html#cb1542-46" tabindex="-1"></a>      <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb1542-47"><a href="epicurves.html#cb1542-47" tabindex="-1"></a>      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span>       </span>
<span id="cb1542-48"><a href="epicurves.html#cb1542-48" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb1542-49"><a href="epicurves.html#cb1542-49" tabindex="-1"></a>      <span class="at">x=</span><span class="st">&quot;&quot;</span>,</span>
<span id="cb1542-50"><a href="epicurves.html#cb1542-50" tabindex="-1"></a>      <span class="at">y =</span><span class="st">&quot;Number of confirmed cases&quot;</span>,</span>
<span id="cb1542-51"><a href="epicurves.html#cb1542-51" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">&quot;Legend&quot;</span>)<span class="sc">+</span> </span>
<span id="cb1542-52"><a href="epicurves.html#cb1542-52" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb1542-53"><a href="epicurves.html#cb1542-53" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())  <span class="co"># removes title of legend</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1170-1.png" width="672" /></p>
</div>
<div id="facetingchia-nhỏ-biểu-đồ" class="section level3 unnumbered">
<h3>Faceting/chia nhỏ biểu đồ</h3>
<p>Như với các ggplots khác, bạn có thể tạo các biểu đồ được chia nhỏ (“nhiều biểu đồ con”). Như đã giải thích trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> trong cuốn sách này, bạn có thể sử dụng <code>facet_wrap()</code> hoặc <code>facet_grid()</code>. Ở đây chúng tôi sẽ minh họa bằng hàm <code>facet_wrap()</code>. Đối với đường cong dịch bệnh, sử dụng <code>facet_wrap()</code> thường dễ dàng hơn vì khả năng bạn thường chỉ cần chia nhỏ biểu đồ theo một biến.</p>
<p>Cú pháp chung là <code>facet_wrap(rows ~ cols)</code>, trong đó bên trái dấu ngã (~) là tên của biến sẽ được trải trên các “hàng” của biểu đồ chia nhỏ và ở bên phải dấu ngã là tên của biến sẽ được trải trên các “cột” của biểu đồ chia nhỏ. Đơn giản nhất, chỉ cần sử dụng một tên cột, ở bên phải dấu ngã: <code>facet_wrap(~age_cat)</code>.</p>
<p><strong>Trục tự do</strong><br />
Bạn sẽ cần phải quyết định xem tỷ lệ của các trục cho mỗi biểu đồ nhỏ là “cố định” với cùng một kích thước (mặc định) hay “tự do” (nghĩa là chúng sẽ thay đổi dựa trên dữ liệu của chúng). Thực hiện điều này với đối số <code>scales =</code> trong hàm <code>facet_wrap()</code> bằng cách chỉ định “free_x” hoặc “free_y” hoặc “free”.</p>
<p><strong>Số cột và hàng của các biểu đồ con</strong><br />
Điều này có thể xác định với <code>ncol =</code> và <code>nrow =</code> trong hàm <code>facet_wrap()</code>.</p>
<p><strong>Thứ tự các biểu đồ con</strong><br />
Để thay đổi thứ tự xuất hiện, hãy thay đổi thứ tự cơ bản của các cấp của cột phân loại được sử dụng để tạo các biểu đồ con.</p>
<p><strong>Đinh dạng trục</strong><br />
Kích thước phông chữ và mặt biểu đồ, dải màu, v.v. có thể được sửa đổi thông qua <code>theme()</code> với các đối số như:</p>
<ul>
<li><p><code>strip.text = element_text()</code> (kích thước, màu sắc, mặt, góc …)</p></li>
<li><p><code>strip.background = element_rect()</code> (ví dụ: <code>element_rect(fill = "grey")</code>)<br />
</p></li>
<li><p><code>strip.position =</code> (vị trị “dưới”, “trên”, “trái”, hoặc “phải”)</p></li>
</ul>
<p><strong>Dải nhãn</strong><br />
Nhãn của các biểu đồ con có thể được sửa đổi thông qua “nhãn” của cột như một factor hoặc bằng cách sử dụng một “người dán nhãn - labeller”.</p>
<p>Để tạo một labeller như thế, sử dụng hàm <code>as_labeller()</code> từ <strong>ggplot2</strong>. Sau đó, cung cấp labeller cho đối số <code>labeller =</code> của <code>facet_wrap()</code> như dưới đây.</p>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb1543-1"><a href="epicurves.html#cb1543-1" tabindex="-1"></a>my_labels <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb1543-2"><a href="epicurves.html#cb1543-2" tabindex="-1"></a>     <span class="st">&quot;0-4&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Ages 0-4&quot;</span>,</span>
<span id="cb1543-3"><a href="epicurves.html#cb1543-3" tabindex="-1"></a>     <span class="st">&quot;5-9&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Ages 5-9&quot;</span>,</span>
<span id="cb1543-4"><a href="epicurves.html#cb1543-4" tabindex="-1"></a>     <span class="st">&quot;10-14&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ages 10-14&quot;</span>,</span>
<span id="cb1543-5"><a href="epicurves.html#cb1543-5" tabindex="-1"></a>     <span class="st">&quot;15-19&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ages 15-19&quot;</span>,</span>
<span id="cb1543-6"><a href="epicurves.html#cb1543-6" tabindex="-1"></a>     <span class="st">&quot;20-29&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ages 20-29&quot;</span>,</span>
<span id="cb1543-7"><a href="epicurves.html#cb1543-7" tabindex="-1"></a>     <span class="st">&quot;30-49&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ages 30-49&quot;</span>,</span>
<span id="cb1543-8"><a href="epicurves.html#cb1543-8" tabindex="-1"></a>     <span class="st">&quot;50-69&quot;</span> <span class="ot">=</span> <span class="st">&quot;Ages 50-69&quot;</span>,</span>
<span id="cb1543-9"><a href="epicurves.html#cb1543-9" tabindex="-1"></a>     <span class="st">&quot;70+&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Over age 70&quot;</span>))</span></code></pre></div>
<p><strong>Một ví dụ về chia nhỏ biểu đồ</strong> - chia bằng cột <code>age_cat</code>.</p>
<div class="sourceCode" id="cb1544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1544-1"><a href="epicurves.html#cb1544-1" tabindex="-1"></a><span class="co"># make plot</span></span>
<span id="cb1544-2"><a href="epicurves.html#cb1544-2" tabindex="-1"></a><span class="do">###########</span></span>
<span id="cb1544-3"><a href="epicurves.html#cb1544-3" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span> </span>
<span id="cb1544-4"><a href="epicurves.html#cb1544-4" tabindex="-1"></a>  </span>
<span id="cb1544-5"><a href="epicurves.html#cb1544-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1544-6"><a href="epicurves.html#cb1544-6" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1544-7"><a href="epicurves.html#cb1544-7" tabindex="-1"></a>      <span class="at">x =</span> date_onset,</span>
<span id="cb1544-8"><a href="epicurves.html#cb1544-8" tabindex="-1"></a>      <span class="at">group =</span> age_cat,</span>
<span id="cb1544-9"><a href="epicurves.html#cb1544-9" tabindex="-1"></a>      <span class="at">fill =</span> age_cat),    <span class="co"># arguments inside aes() apply by group</span></span>
<span id="cb1544-10"><a href="epicurves.html#cb1544-10" tabindex="-1"></a>      </span>
<span id="cb1544-11"><a href="epicurves.html#cb1544-11" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,      <span class="co"># arguments outside aes() apply to all data</span></span>
<span id="cb1544-12"><a href="epicurves.html#cb1544-12" tabindex="-1"></a>        </span>
<span id="cb1544-13"><a href="epicurves.html#cb1544-13" tabindex="-1"></a>    <span class="co"># histogram breaks</span></span>
<span id="cb1544-14"><a href="epicurves.html#cb1544-14" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central)<span class="sc">+</span>  <span class="co"># pre-defined date vector (see earlier in this page)</span></span>
<span id="cb1544-15"><a href="epicurves.html#cb1544-15" tabindex="-1"></a>                      </span>
<span id="cb1544-16"><a href="epicurves.html#cb1544-16" tabindex="-1"></a>  <span class="co"># The labels on the x-axis</span></span>
<span id="cb1544-17"><a href="epicurves.html#cb1544-17" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1544-18"><a href="epicurves.html#cb1544-18" tabindex="-1"></a>    <span class="at">expand            =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),         <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1544-19"><a href="epicurves.html#cb1544-19" tabindex="-1"></a>    <span class="at">date_breaks       =</span> <span class="st">&quot;2 months&quot;</span>,     <span class="co"># labels appear every 2 months</span></span>
<span id="cb1544-20"><a href="epicurves.html#cb1544-20" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>,      <span class="co"># vertical lines appear every 1 month </span></span>
<span id="cb1544-21"><a href="epicurves.html#cb1544-21" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1544-22"><a href="epicurves.html#cb1544-22" tabindex="-1"></a>  </span>
<span id="cb1544-23"><a href="epicurves.html#cb1544-23" tabindex="-1"></a>  <span class="co"># y-axis</span></span>
<span id="cb1544-24"><a href="epicurves.html#cb1544-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                       <span class="co"># removes excess y-axis space between bottom of bars and the labels</span></span>
<span id="cb1544-25"><a href="epicurves.html#cb1544-25" tabindex="-1"></a>  </span>
<span id="cb1544-26"><a href="epicurves.html#cb1544-26" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1544-27"><a href="epicurves.html#cb1544-27" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                           <span class="co"># a set of themes to simplify plot</span></span>
<span id="cb1544-28"><a href="epicurves.html#cb1544-28" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1544-29"><a href="epicurves.html#cb1544-29" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="co"># caption on left side in italics</span></span>
<span id="cb1544-30"><a href="epicurves.html#cb1544-30" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1544-31"><a href="epicurves.html#cb1544-31" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1544-32"><a href="epicurves.html#cb1544-32" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1544-33"><a href="epicurves.html#cb1544-33" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;grey&quot;</span>))<span class="sc">+</span>         <span class="co"># axis titles in bold</span></span>
<span id="cb1544-34"><a href="epicurves.html#cb1544-34" tabindex="-1"></a>  </span>
<span id="cb1544-35"><a href="epicurves.html#cb1544-35" tabindex="-1"></a>  <span class="co"># create facets</span></span>
<span id="cb1544-36"><a href="epicurves.html#cb1544-36" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb1544-37"><a href="epicurves.html#cb1544-37" tabindex="-1"></a>    <span class="sc">~</span>age_cat,</span>
<span id="cb1544-38"><a href="epicurves.html#cb1544-38" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">4</span>,</span>
<span id="cb1544-39"><a href="epicurves.html#cb1544-39" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1544-40"><a href="epicurves.html#cb1544-40" tabindex="-1"></a>    <span class="at">labeller =</span> my_labels)<span class="sc">+</span>             </span>
<span id="cb1544-41"><a href="epicurves.html#cb1544-41" tabindex="-1"></a>  </span>
<span id="cb1544-42"><a href="epicurves.html#cb1544-42" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb1544-43"><a href="epicurves.html#cb1544-43" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1544-44"><a href="epicurves.html#cb1544-44" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&quot;Weekly incidence of cases, by age category&quot;</span>,</span>
<span id="cb1544-45"><a href="epicurves.html#cb1544-45" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>,</span>
<span id="cb1544-46"><a href="epicurves.html#cb1544-46" tabindex="-1"></a>    <span class="at">fill     =</span> <span class="st">&quot;Age category&quot;</span>,                                      <span class="co"># provide new title for legend</span></span>
<span id="cb1544-47"><a href="epicurves.html#cb1544-47" tabindex="-1"></a>    <span class="at">x        =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1544-48"><a href="epicurves.html#cb1544-48" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&quot;Weekly incident cases reported&quot;</span>,</span>
<span id="cb1544-49"><a href="epicurves.html#cb1544-49" tabindex="-1"></a>    <span class="at">caption  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)} to {format(max(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)}</span><span class="sc">\n</span><span class="st">{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1172-1.png" width="672" /></p>
<p>Xem <a href="https://ggplot2.tidyverse.org/reference/labellers.html">link</a> để biết thêm thông tin về labellers.</p>
<div id="tổng-vụ-dịch-trong-nền-của-biểu-đồ-con" class="section level4 unnumbered">
<h4>Tổng vụ dịch trong nền của biểu đồ con</h4>
<p>Để hiển thị tổng vụ dịch trong nền của mỗi biểu đồ con, hãy thêm hàm <code>gghighlight()</code> với dấu ngoặc đơn trống vào ggplot. Hàm này thuộc package <strong>gghighlight</strong>. Lưu ý rằng trục y tối đa trong tất cả các biểu đồ con hiện dựa vào đỉnh của toàn bộ vụ dịch. Có nhiều ví dụ hơn về package này trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>.</p>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1545-1"><a href="epicurves.html#cb1545-1" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span> </span>
<span id="cb1545-2"><a href="epicurves.html#cb1545-2" tabindex="-1"></a>  </span>
<span id="cb1545-3"><a href="epicurves.html#cb1545-3" tabindex="-1"></a>  <span class="co"># epicurves by group</span></span>
<span id="cb1545-4"><a href="epicurves.html#cb1545-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1545-5"><a href="epicurves.html#cb1545-5" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1545-6"><a href="epicurves.html#cb1545-6" tabindex="-1"></a>      <span class="at">x =</span> date_onset,</span>
<span id="cb1545-7"><a href="epicurves.html#cb1545-7" tabindex="-1"></a>      <span class="at">group =</span> age_cat,</span>
<span id="cb1545-8"><a href="epicurves.html#cb1545-8" tabindex="-1"></a>      <span class="at">fill =</span> age_cat),  <span class="co"># arguments inside aes() apply by group</span></span>
<span id="cb1545-9"><a href="epicurves.html#cb1545-9" tabindex="-1"></a>    </span>
<span id="cb1545-10"><a href="epicurves.html#cb1545-10" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,    <span class="co"># arguments outside aes() apply to all data</span></span>
<span id="cb1545-11"><a href="epicurves.html#cb1545-11" tabindex="-1"></a>    </span>
<span id="cb1545-12"><a href="epicurves.html#cb1545-12" tabindex="-1"></a>    <span class="co"># histogram breaks</span></span>
<span id="cb1545-13"><a href="epicurves.html#cb1545-13" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central)<span class="sc">+</span>     <span class="co"># pre-defined date vector (see top of ggplot section)                </span></span>
<span id="cb1545-14"><a href="epicurves.html#cb1545-14" tabindex="-1"></a>  </span>
<span id="cb1545-15"><a href="epicurves.html#cb1545-15" tabindex="-1"></a>  <span class="co"># add grey epidemic in background to each facet</span></span>
<span id="cb1545-16"><a href="epicurves.html#cb1545-16" tabindex="-1"></a>  gghighlight<span class="sc">::</span><span class="fu">gghighlight</span>()<span class="sc">+</span></span>
<span id="cb1545-17"><a href="epicurves.html#cb1545-17" tabindex="-1"></a>  </span>
<span id="cb1545-18"><a href="epicurves.html#cb1545-18" tabindex="-1"></a>  <span class="co"># labels on x-axis</span></span>
<span id="cb1545-19"><a href="epicurves.html#cb1545-19" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1545-20"><a href="epicurves.html#cb1545-20" tabindex="-1"></a>    <span class="at">expand            =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),         <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1545-21"><a href="epicurves.html#cb1545-21" tabindex="-1"></a>    <span class="at">date_breaks       =</span> <span class="st">&quot;2 months&quot;</span>,     <span class="co"># labels appear every 2 months</span></span>
<span id="cb1545-22"><a href="epicurves.html#cb1545-22" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>,      <span class="co"># vertical lines appear every 1 month </span></span>
<span id="cb1545-23"><a href="epicurves.html#cb1545-23" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1545-24"><a href="epicurves.html#cb1545-24" tabindex="-1"></a>  </span>
<span id="cb1545-25"><a href="epicurves.html#cb1545-25" tabindex="-1"></a>  <span class="co"># y-axis</span></span>
<span id="cb1545-26"><a href="epicurves.html#cb1545-26" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>  <span class="co"># removes excess y-axis space below 0</span></span>
<span id="cb1545-27"><a href="epicurves.html#cb1545-27" tabindex="-1"></a>  </span>
<span id="cb1545-28"><a href="epicurves.html#cb1545-28" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1545-29"><a href="epicurves.html#cb1545-29" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                           <span class="co"># a set of themes to simplify plot</span></span>
<span id="cb1545-30"><a href="epicurves.html#cb1545-30" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1545-31"><a href="epicurves.html#cb1545-31" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="co"># caption on left side in italics</span></span>
<span id="cb1545-32"><a href="epicurves.html#cb1545-32" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1545-33"><a href="epicurves.html#cb1545-33" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1545-34"><a href="epicurves.html#cb1545-34" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1545-35"><a href="epicurves.html#cb1545-35" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))<span class="sc">+</span>        <span class="co"># axis titles in bold</span></span>
<span id="cb1545-36"><a href="epicurves.html#cb1545-36" tabindex="-1"></a>  </span>
<span id="cb1545-37"><a href="epicurves.html#cb1545-37" tabindex="-1"></a>  <span class="co"># create facets</span></span>
<span id="cb1545-38"><a href="epicurves.html#cb1545-38" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(</span>
<span id="cb1545-39"><a href="epicurves.html#cb1545-39" tabindex="-1"></a>    <span class="sc">~</span>age_cat,                          <span class="co"># each plot is one value of age_cat</span></span>
<span id="cb1545-40"><a href="epicurves.html#cb1545-40" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">4</span>,                          <span class="co"># number of columns</span></span>
<span id="cb1545-41"><a href="epicurves.html#cb1545-41" tabindex="-1"></a>    <span class="at">strip.position =</span> <span class="st">&quot;top&quot;</span>,            <span class="co"># position of the facet title/strip</span></span>
<span id="cb1545-42"><a href="epicurves.html#cb1545-42" tabindex="-1"></a>    <span class="at">labeller =</span> my_labels)<span class="sc">+</span>             <span class="co"># labeller defines above</span></span>
<span id="cb1545-43"><a href="epicurves.html#cb1545-43" tabindex="-1"></a>  </span>
<span id="cb1545-44"><a href="epicurves.html#cb1545-44" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb1545-45"><a href="epicurves.html#cb1545-45" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1545-46"><a href="epicurves.html#cb1545-46" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">&quot;Weekly incidence of cases, by age category&quot;</span>,</span>
<span id="cb1545-47"><a href="epicurves.html#cb1545-47" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>,</span>
<span id="cb1545-48"><a href="epicurves.html#cb1545-48" tabindex="-1"></a>    <span class="at">fill     =</span> <span class="st">&quot;Age category&quot;</span>,                                      <span class="co"># provide new title for legend</span></span>
<span id="cb1545-49"><a href="epicurves.html#cb1545-49" tabindex="-1"></a>    <span class="at">x        =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1545-50"><a href="epicurves.html#cb1545-50" tabindex="-1"></a>    <span class="at">y        =</span> <span class="st">&quot;Weekly incident cases reported&quot;</span>,</span>
<span id="cb1545-51"><a href="epicurves.html#cb1545-51" tabindex="-1"></a>    <span class="at">caption  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)} to {format(max(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)}</span><span class="sc">\n</span><span class="st">{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1173-1.png" width="672" /></p>
</div>
<div id="dữ-liệu-một-biểu-đồ-con" class="section level4 unnumbered">
<h4>Dữ liệu một biểu đồ con</h4>
<p>Nếu bạn muốn có một hộp biểu đồ con chứa tất cả dữ liệu, hãy sao chép toàn bộ dữ liệu và coi các bản sao như một giá trị cho các biểu đồ con. Hàm “trợ giúp” <code>CreateAllFacet()</code> bên dưới có thể hỗ trợ việc này (nhờ bài đăng trên <a href="https://stackoverflow.com/questions/18933575/easily-add-an-all-facet-to-facet-wrap-in-ggplot2">blog</a> này). Khi nó được chạy, số hàng tăng gấp đôi và sẽ có một cột mới được gọi là <code>facet</code>, trong đó các hàng được sao chép sẽ có giá trị “tất cả” và các hàng ban đầu có giá trị ban đầu của cột phân chia. Bây giờ bạn chỉ cần phân chia cột <code>facet</code> .</p>
<p>Dưới đây là hàm trợ giúp. Chạy code này và nó sẽ luôn sẵn sàng để bạn sử dụng.</p>
<div class="sourceCode" id="cb1546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1546-1"><a href="epicurves.html#cb1546-1" tabindex="-1"></a><span class="co"># Define helper function</span></span>
<span id="cb1546-2"><a href="epicurves.html#cb1546-2" tabindex="-1"></a>CreateAllFacet <span class="ot">&lt;-</span> <span class="cf">function</span>(df, col){</span>
<span id="cb1546-3"><a href="epicurves.html#cb1546-3" tabindex="-1"></a>     df<span class="sc">$</span>facet <span class="ot">&lt;-</span> df[[col]]</span>
<span id="cb1546-4"><a href="epicurves.html#cb1546-4" tabindex="-1"></a>     temp <span class="ot">&lt;-</span> df</span>
<span id="cb1546-5"><a href="epicurves.html#cb1546-5" tabindex="-1"></a>     temp<span class="sc">$</span>facet <span class="ot">&lt;-</span> <span class="st">&quot;all&quot;</span></span>
<span id="cb1546-6"><a href="epicurves.html#cb1546-6" tabindex="-1"></a>     merged <span class="ot">&lt;-</span><span class="fu">rbind</span>(temp, df)</span>
<span id="cb1546-7"><a href="epicurves.html#cb1546-7" tabindex="-1"></a>     </span>
<span id="cb1546-8"><a href="epicurves.html#cb1546-8" tabindex="-1"></a>     <span class="co"># ensure the facet value is a factor</span></span>
<span id="cb1546-9"><a href="epicurves.html#cb1546-9" tabindex="-1"></a>     merged[[col]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(merged[[col]])</span>
<span id="cb1546-10"><a href="epicurves.html#cb1546-10" tabindex="-1"></a>     </span>
<span id="cb1546-11"><a href="epicurves.html#cb1546-11" tabindex="-1"></a>     <span class="fu">return</span>(merged)</span>
<span id="cb1546-12"><a href="epicurves.html#cb1546-12" tabindex="-1"></a>}</span></code></pre></div>
<p>Bây giờ hãy áp dụng hàm trợ giúp cho bộ dữ liệu, trên cột <code>age_cat</code>:</p>
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1547-1"><a href="epicurves.html#cb1547-1" tabindex="-1"></a><span class="co"># Create dataset that is duplicated and with new column &quot;facet&quot; to show &quot;all&quot; age categories as another facet level</span></span>
<span id="cb1547-2"><a href="epicurves.html#cb1547-2" tabindex="-1"></a>central_data2 <span class="ot">&lt;-</span> <span class="fu">CreateAllFacet</span>(central_data, <span class="at">col =</span> <span class="st">&quot;age_cat&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1547-3"><a href="epicurves.html#cb1547-3" tabindex="-1"></a>  </span>
<span id="cb1547-4"><a href="epicurves.html#cb1547-4" tabindex="-1"></a>  <span class="co"># set factor levels</span></span>
<span id="cb1547-5"><a href="epicurves.html#cb1547-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">fct_relevel</span>(facet, <span class="st">&quot;all&quot;</span>, <span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>,</span>
<span id="cb1547-6"><a href="epicurves.html#cb1547-6" tabindex="-1"></a>                             <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>,</span>
<span id="cb1547-7"><a href="epicurves.html#cb1547-7" tabindex="-1"></a>                             <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70+&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: There was 1 warning in `mutate()`.
## ℹ In argument: `facet = fct_relevel(...)`.
## Caused by warning:
## ! 1 unknown level in `f`: 70+</code></pre>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1549-1"><a href="epicurves.html#cb1549-1" tabindex="-1"></a><span class="co"># check levels</span></span>
<span id="cb1549-2"><a href="epicurves.html#cb1549-2" tabindex="-1"></a><span class="fu">table</span>(central_data2<span class="sc">$</span>facet, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   all   0-4   5-9 10-14 15-19 20-29 30-49 50-69  &lt;NA&gt; 
##   454    84    84    82    58    73    57     7     9</code></pre>
<p>Những thay đổi đáng chú ý đối với lệnh <code>ggplot()</code> là:</p>
<ul>
<li><p>Dữ liệu được sử dụng bây giờ là <code>central_data2</code> (nhân đôi các hàng, với cột mới là “facet”)</p></li>
<li><p>Labeller sẽ cần được cập nhật, nếu được sử dụng<br />
</p></li>
<li><p>Tùy chọn: để có các biểu đồ con xếp chồng lên nhau theo chiều dọc: cột chia được chuyển sang các hàng bên cạnh của phương trình và ở bên phải được thay thế bằng “.” (<code>facet_wrap(facet~.)</code>), và <code>ncol = 1</code>. Bạn cũng có thể cần điều chỉnh chiều rộng và chiều cao của ảnh biểu đồ đã lưu dưới dạng png (xem <code>ggsave()</code> trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>).</p></li>
</ul>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1551-1"><a href="epicurves.html#cb1551-1" tabindex="-1"></a><span class="fu">ggplot</span>(central_data2) <span class="sc">+</span> </span>
<span id="cb1551-2"><a href="epicurves.html#cb1551-2" tabindex="-1"></a>  </span>
<span id="cb1551-3"><a href="epicurves.html#cb1551-3" tabindex="-1"></a>  <span class="co"># actual epicurves by group</span></span>
<span id="cb1551-4"><a href="epicurves.html#cb1551-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1551-5"><a href="epicurves.html#cb1551-5" tabindex="-1"></a>        <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb1551-6"><a href="epicurves.html#cb1551-6" tabindex="-1"></a>          <span class="at">x =</span> date_onset,</span>
<span id="cb1551-7"><a href="epicurves.html#cb1551-7" tabindex="-1"></a>          <span class="at">group =</span> age_cat,</span>
<span id="cb1551-8"><a href="epicurves.html#cb1551-8" tabindex="-1"></a>          <span class="at">fill =</span> age_cat),  <span class="co"># arguments inside aes() apply by group</span></span>
<span id="cb1551-9"><a href="epicurves.html#cb1551-9" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,    <span class="co"># arguments outside aes() apply to all data</span></span>
<span id="cb1551-10"><a href="epicurves.html#cb1551-10" tabindex="-1"></a>        </span>
<span id="cb1551-11"><a href="epicurves.html#cb1551-11" tabindex="-1"></a>        <span class="co"># histogram breaks</span></span>
<span id="cb1551-12"><a href="epicurves.html#cb1551-12" tabindex="-1"></a>        <span class="at">breaks =</span> weekly_breaks_central)<span class="sc">+</span>    <span class="co"># pre-defined date vector (see top of ggplot section)</span></span>
<span id="cb1551-13"><a href="epicurves.html#cb1551-13" tabindex="-1"></a>                     </span>
<span id="cb1551-14"><a href="epicurves.html#cb1551-14" tabindex="-1"></a>  <span class="co"># Labels on x-axis</span></span>
<span id="cb1551-15"><a href="epicurves.html#cb1551-15" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1551-16"><a href="epicurves.html#cb1551-16" tabindex="-1"></a>    <span class="at">expand            =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),         <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1551-17"><a href="epicurves.html#cb1551-17" tabindex="-1"></a>    <span class="at">date_breaks       =</span> <span class="st">&quot;2 months&quot;</span>,     <span class="co"># labels appear every 2 months</span></span>
<span id="cb1551-18"><a href="epicurves.html#cb1551-18" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>,      <span class="co"># vertical lines appear every 1 month </span></span>
<span id="cb1551-19"><a href="epicurves.html#cb1551-19" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1551-20"><a href="epicurves.html#cb1551-20" tabindex="-1"></a>  </span>
<span id="cb1551-21"><a href="epicurves.html#cb1551-21" tabindex="-1"></a>  <span class="co"># y-axis</span></span>
<span id="cb1551-22"><a href="epicurves.html#cb1551-22" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>  <span class="co"># removes excess y-axis space between bottom of bars and the labels</span></span>
<span id="cb1551-23"><a href="epicurves.html#cb1551-23" tabindex="-1"></a>  </span>
<span id="cb1551-24"><a href="epicurves.html#cb1551-24" tabindex="-1"></a>  <span class="co"># aesthetic themes</span></span>
<span id="cb1551-25"><a href="epicurves.html#cb1551-25" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span>                                           <span class="co"># a set of themes to simplify plot</span></span>
<span id="cb1551-26"><a href="epicurves.html#cb1551-26" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1551-27"><a href="epicurves.html#cb1551-27" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>), <span class="co"># caption on left side in italics</span></span>
<span id="cb1551-28"><a href="epicurves.html#cb1551-28" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb1551-29"><a href="epicurves.html#cb1551-29" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)<span class="sc">+</span>               </span>
<span id="cb1551-30"><a href="epicurves.html#cb1551-30" tabindex="-1"></a>  </span>
<span id="cb1551-31"><a href="epicurves.html#cb1551-31" tabindex="-1"></a>  <span class="co"># create facets</span></span>
<span id="cb1551-32"><a href="epicurves.html#cb1551-32" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(facet<span class="sc">~</span>. ,                            <span class="co"># each plot is one value of facet</span></span>
<span id="cb1551-33"><a href="epicurves.html#cb1551-33" tabindex="-1"></a>             <span class="at">ncol =</span> <span class="dv">1</span>)<span class="sc">+</span>            </span>
<span id="cb1551-34"><a href="epicurves.html#cb1551-34" tabindex="-1"></a></span>
<span id="cb1551-35"><a href="epicurves.html#cb1551-35" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb1551-36"><a href="epicurves.html#cb1551-36" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title    =</span> <span class="st">&quot;Weekly incidence of cases, by age category&quot;</span>,</span>
<span id="cb1551-37"><a href="epicurves.html#cb1551-37" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Subtitle&quot;</span>,</span>
<span id="cb1551-38"><a href="epicurves.html#cb1551-38" tabindex="-1"></a>       <span class="at">fill     =</span> <span class="st">&quot;Age category&quot;</span>,                                      <span class="co"># provide new title for legend</span></span>
<span id="cb1551-39"><a href="epicurves.html#cb1551-39" tabindex="-1"></a>       <span class="at">x        =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1551-40"><a href="epicurves.html#cb1551-40" tabindex="-1"></a>       <span class="at">y        =</span> <span class="st">&quot;Weekly incident cases reported&quot;</span>,</span>
<span id="cb1551-41"><a href="epicurves.html#cb1551-41" tabindex="-1"></a>       <span class="at">caption  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;n = {nrow(central_data)} from Central Hospital; Case onsets range from {format(min(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)} to {format(max(central_data$date_onset, na.rm=T), format = &#39;%a %d %b %Y&#39;)}</span><span class="sc">\n</span><span class="st">{nrow(central_data %&gt;% filter(is.na(date_onset)))} cases missing date of onset and not shown&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1176-1.png" width="480" /></p>
</div>
</div>
</div>
<div id="dữ-liệu-dự-kiến" class="section level2" number="32.3">
<h2><span class="header-section-number">32.3</span> Dữ liệu dự kiến</h2>
<p>Dữ liệu gần đây nhất được biểu thị trong đường cong dịch tễ nên được đánh dấu là dự kiến hoặc có thể báo cáo chậm trễ. Điều này có thể được thực hiện bằng cách thêm một đường thẳng đứng và/hoặc hình chữ nhật trong một số ngày cụ thể. Đây là hai tùy chọn:</p>
<ol style="list-style-type: decimal">
<li><p>Sử dụng <code>annotate()</code>:</p>
<ul>
<li>Để sử dụng dạng đường <code>annotate(geom = "segment")</code>. Cung cấp <code>x</code>, <code>xend</code>, <code>y</code>, và <code>yend</code>. Hiệu chỉnh kích thước, kiểu dòng (<code>lty</code>), và màu.<br />
</li>
<li>Để sử dụng dạng hình chữ nhật <code>annotate(geom = "rect")</code>. Cung cấp xmin/xmax/ymin/ymax. Hiệu chỉnh màu và hệ số alpha.<br />
</li>
</ul></li>
<li><p>Nhóm dữ liệu theo trạng thái tạm thời và tô màu các cột đó theo cách khác nhau</p></li>
</ol>
<p><span style="color: orange;"><strong><em>THẬN TRỌNG</em></strong>: Bạn có thể thử hàm <code>geom_rect()</code> để vẽ hình chữ nhật, nhưng việc điều chỉnh độ trong suốt không khả thi trong bối cảnh cảnh bộ số liệu <code>linelist</code>. Hàm này sẽ phủ lên một hình chữ nhật cho mỗi hàng/quan sát!. Sử dụng hệ số alpha rất thấp (ví dụ: 0.01) hoặc một cách tiếp cận khác.</span></p>
<div id="sử-dụng-annotate" class="section level3 unnumbered">
<h3>Sử dụng <code>annotate()</code></h3>
<ul>
<li>Trong <code>annotate(geom = "rect")</code>, đối số <code>xmin</code> và <code>xmax</code> cần được định dạng phân lớp ngày<br />
</li>
<li>Lưu ý rằng vì những dữ liệu này được tổng hợp thành các cột hàng tuần và cột cuối cùng kéo dài đến Thứ Hai sau điểm dữ liệu cuối cùng, vùng được tô bóng có thể bao gồm 4 tuần<br />
</li>
<li>Đây là một <a href="https://ggplot2.tidyverse.org/reference/annotate.html">ví dụ trực tuyến</a> về <code>annotate()</code></li>
</ul>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1552-1"><a href="epicurves.html#cb1552-1" tabindex="-1"></a><span class="fu">ggplot</span>(central_data) <span class="sc">+</span> </span>
<span id="cb1552-2"><a href="epicurves.html#cb1552-2" tabindex="-1"></a>  </span>
<span id="cb1552-3"><a href="epicurves.html#cb1552-3" tabindex="-1"></a>  <span class="co"># histogram</span></span>
<span id="cb1552-4"><a href="epicurves.html#cb1552-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1552-5"><a href="epicurves.html#cb1552-5" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1552-6"><a href="epicurves.html#cb1552-6" tabindex="-1"></a>    </span>
<span id="cb1552-7"><a href="epicurves.html#cb1552-7" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central,   <span class="co"># pre-defined date vector - see top of ggplot section</span></span>
<span id="cb1552-8"><a href="epicurves.html#cb1552-8" tabindex="-1"></a>    </span>
<span id="cb1552-9"><a href="epicurves.html#cb1552-9" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>,</span>
<span id="cb1552-10"><a href="epicurves.html#cb1552-10" tabindex="-1"></a>    </span>
<span id="cb1552-11"><a href="epicurves.html#cb1552-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1552-12"><a href="epicurves.html#cb1552-12" tabindex="-1"></a></span>
<span id="cb1552-13"><a href="epicurves.html#cb1552-13" tabindex="-1"></a>  <span class="co"># scales</span></span>
<span id="cb1552-14"><a href="epicurves.html#cb1552-14" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb1552-15"><a href="epicurves.html#cb1552-15" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1552-16"><a href="epicurves.html#cb1552-16" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                   <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1552-17"><a href="epicurves.html#cb1552-17" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>,           <span class="co"># 1st of month</span></span>
<span id="cb1552-18"><a href="epicurves.html#cb1552-18" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>,     <span class="co"># 1st of month</span></span>
<span id="cb1552-19"><a href="epicurves.html#cb1552-19" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># automatic label formatting</span></span>
<span id="cb1552-20"><a href="epicurves.html#cb1552-20" tabindex="-1"></a>  </span>
<span id="cb1552-21"><a href="epicurves.html#cb1552-21" tabindex="-1"></a>  <span class="co"># labels and theme</span></span>
<span id="cb1552-22"><a href="epicurves.html#cb1552-22" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1552-23"><a href="epicurves.html#cb1552-23" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Using annotate()</span><span class="sc">\n</span><span class="st">Rectangle and line showing that data from last 21-days are tentative&quot;</span>,</span>
<span id="cb1552-24"><a href="epicurves.html#cb1552-24" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Week of symptom onset&quot;</span>,</span>
<span id="cb1552-25"><a href="epicurves.html#cb1552-25" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Weekly case indicence&quot;</span>)<span class="sc">+</span> </span>
<span id="cb1552-26"><a href="epicurves.html#cb1552-26" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb1552-27"><a href="epicurves.html#cb1552-27" tabindex="-1"></a>  </span>
<span id="cb1552-28"><a href="epicurves.html#cb1552-28" tabindex="-1"></a>  <span class="co"># add semi-transparent red rectangle to tentative data</span></span>
<span id="cb1552-29"><a href="epicurves.html#cb1552-29" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb1552-30"><a href="epicurves.html#cb1552-30" tabindex="-1"></a>    <span class="st">&quot;rect&quot;</span>,</span>
<span id="cb1552-31"><a href="epicurves.html#cb1552-31" tabindex="-1"></a>    <span class="at">xmin  =</span> <span class="fu">as.Date</span>(<span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">21</span>), <span class="co"># note must be wrapped in as.Date()</span></span>
<span id="cb1552-32"><a href="epicurves.html#cb1552-32" tabindex="-1"></a>    <span class="at">xmax  =</span> <span class="fu">as.Date</span>(<span class="cn">Inf</span>),                                          <span class="co"># note must be wrapped in as.Date()</span></span>
<span id="cb1552-33"><a href="epicurves.html#cb1552-33" tabindex="-1"></a>    <span class="at">ymin  =</span> <span class="dv">0</span>,</span>
<span id="cb1552-34"><a href="epicurves.html#cb1552-34" tabindex="-1"></a>    <span class="at">ymax  =</span> <span class="cn">Inf</span>,</span>
<span id="cb1552-35"><a href="epicurves.html#cb1552-35" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>,          <span class="co"># alpha easy and intuitive to adjust using annotate()</span></span>
<span id="cb1552-36"><a href="epicurves.html#cb1552-36" tabindex="-1"></a>    <span class="at">fill  =</span> <span class="st">&quot;red&quot;</span>)<span class="sc">+</span></span>
<span id="cb1552-37"><a href="epicurves.html#cb1552-37" tabindex="-1"></a>  </span>
<span id="cb1552-38"><a href="epicurves.html#cb1552-38" tabindex="-1"></a>  <span class="co"># add black vertical line on top of other layers</span></span>
<span id="cb1552-39"><a href="epicurves.html#cb1552-39" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb1552-40"><a href="epicurves.html#cb1552-40" tabindex="-1"></a>    <span class="st">&quot;segment&quot;</span>,</span>
<span id="cb1552-41"><a href="epicurves.html#cb1552-41" tabindex="-1"></a>    <span class="at">x     =</span> <span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">21</span>, <span class="co"># 21 days before last data</span></span>
<span id="cb1552-42"><a href="epicurves.html#cb1552-42" tabindex="-1"></a>    <span class="at">xend  =</span> <span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">21</span>, </span>
<span id="cb1552-43"><a href="epicurves.html#cb1552-43" tabindex="-1"></a>    <span class="at">y     =</span> <span class="dv">0</span>,         <span class="co"># line begins at y = 0</span></span>
<span id="cb1552-44"><a href="epicurves.html#cb1552-44" tabindex="-1"></a>    <span class="at">yend  =</span> <span class="cn">Inf</span>,       <span class="co"># line to top of plot</span></span>
<span id="cb1552-45"><a href="epicurves.html#cb1552-45" tabindex="-1"></a>    <span class="at">size  =</span> <span class="dv">2</span>,         <span class="co"># line size</span></span>
<span id="cb1552-46"><a href="epicurves.html#cb1552-46" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1552-47"><a href="epicurves.html#cb1552-47" tabindex="-1"></a>    <span class="at">lty   =</span> <span class="st">&quot;solid&quot;</span>)<span class="sc">+</span>   <span class="co"># linetype e.g. &quot;solid&quot;, &quot;dashed&quot;</span></span>
<span id="cb1552-48"><a href="epicurves.html#cb1552-48" tabindex="-1"></a></span>
<span id="cb1552-49"><a href="epicurves.html#cb1552-49" tabindex="-1"></a>  <span class="co"># add text in rectangle</span></span>
<span id="cb1552-50"><a href="epicurves.html#cb1552-50" tabindex="-1"></a>  <span class="fu">annotate</span>(</span>
<span id="cb1552-51"><a href="epicurves.html#cb1552-51" tabindex="-1"></a>    <span class="st">&quot;text&quot;</span>,</span>
<span id="cb1552-52"><a href="epicurves.html#cb1552-52" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">15</span>,</span>
<span id="cb1552-53"><a href="epicurves.html#cb1552-53" tabindex="-1"></a>    <span class="at">y =</span> <span class="dv">15</span>,</span>
<span id="cb1552-54"><a href="epicurves.html#cb1552-54" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Subject to reporting delays&quot;</span>,</span>
<span id="cb1552-55"><a href="epicurves.html#cb1552-55" tabindex="-1"></a>    <span class="at">angle =</span> <span class="dv">90</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1177-1.png" width="672" /></p>
<p>Đường thẳng đứng màu đen có thể tạo ra với code bên dưới, nhưng sử dụng <code>geom_vline()</code>, bạn sẽ mất khả năng kiểm soát chiều cao:</p>
<div class="sourceCode" id="cb1553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1553-1"><a href="epicurves.html#cb1553-1" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">max</span>(central_data<span class="sc">$</span>date_onset, <span class="at">na.rm =</span> T) <span class="sc">-</span> <span class="dv">21</span>,</span>
<span id="cb1553-2"><a href="epicurves.html#cb1553-2" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1553-3"><a href="epicurves.html#cb1553-3" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
</div>
<div id="màu-cột" class="section level3 unnumbered">
<h3>Màu cột</h3>
<p>Một cách tiếp cận thay thế có thể là điều chỉnh màu sắc hoặc cách hiển thị của chính các cột dữ liệu dự kiến. Bạn có thể tạo một cột mới trong giai đoạn chuẩn bị dữ liệu và sử dụng cột đó để nhóm dữ liệu, sao cho <code>aes(fill = )</code> của dữ liệu tạm thời có thể có màu hoặc hệ số alpha khác với các cột khác.</p>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1554-1"><a href="epicurves.html#cb1554-1" tabindex="-1"></a><span class="co"># add column</span></span>
<span id="cb1554-2"><a href="epicurves.html#cb1554-2" tabindex="-1"></a><span class="do">############</span></span>
<span id="cb1554-3"><a href="epicurves.html#cb1554-3" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> central_data <span class="sc">%&gt;%</span> </span>
<span id="cb1554-4"><a href="epicurves.html#cb1554-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tentative =</span> <span class="fu">case_when</span>(</span>
<span id="cb1554-5"><a href="epicurves.html#cb1554-5" tabindex="-1"></a>    date_onset <span class="sc">&gt;=</span> <span class="fu">max</span>(date_onset, <span class="at">na.rm=</span>T) <span class="sc">-</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">&quot;Tentative&quot;</span>, <span class="co"># tenative if in last 7 days</span></span>
<span id="cb1554-6"><a href="epicurves.html#cb1554-6" tabindex="-1"></a>    <span class="cn">TRUE</span>                                       <span class="sc">~</span> <span class="st">&quot;Reliable&quot;</span>)) <span class="co"># all else reliable</span></span>
<span id="cb1554-7"><a href="epicurves.html#cb1554-7" tabindex="-1"></a></span>
<span id="cb1554-8"><a href="epicurves.html#cb1554-8" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb1554-9"><a href="epicurves.html#cb1554-9" tabindex="-1"></a><span class="do">######</span></span>
<span id="cb1554-10"><a href="epicurves.html#cb1554-10" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> date_onset, <span class="at">fill =</span> tentative)) <span class="sc">+</span> </span>
<span id="cb1554-11"><a href="epicurves.html#cb1554-11" tabindex="-1"></a>  </span>
<span id="cb1554-12"><a href="epicurves.html#cb1554-12" tabindex="-1"></a>  <span class="co"># histogram</span></span>
<span id="cb1554-13"><a href="epicurves.html#cb1554-13" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1554-14"><a href="epicurves.html#cb1554-14" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_central,   <span class="co"># pre-defined data vector, see top of ggplot page</span></span>
<span id="cb1554-15"><a href="epicurves.html#cb1554-15" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1554-16"><a href="epicurves.html#cb1554-16" tabindex="-1"></a></span>
<span id="cb1554-17"><a href="epicurves.html#cb1554-17" tabindex="-1"></a>  <span class="co"># scales</span></span>
<span id="cb1554-18"><a href="epicurves.html#cb1554-18" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb1554-19"><a href="epicurves.html#cb1554-19" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;grey&quot;</span>))<span class="sc">+</span></span>
<span id="cb1554-20"><a href="epicurves.html#cb1554-20" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1554-21"><a href="epicurves.html#cb1554-21" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),                   <span class="co"># remove excess x-axis space below and after case bars</span></span>
<span id="cb1554-22"><a href="epicurves.html#cb1554-22" tabindex="-1"></a>    <span class="at">date_breaks =</span> <span class="st">&quot;3 weeks&quot;</span>,           <span class="co"># Monday every 3 weeks</span></span>
<span id="cb1554-23"><a href="epicurves.html#cb1554-23" tabindex="-1"></a>    <span class="at">date_minor_breaks =</span> <span class="st">&quot;week&quot;</span>,        <span class="co"># Monday weeks </span></span>
<span id="cb1554-24"><a href="epicurves.html#cb1554-24" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">label_date_short</span>())<span class="sc">+</span> <span class="co"># label formatting</span></span>
<span id="cb1554-25"><a href="epicurves.html#cb1554-25" tabindex="-1"></a>  </span>
<span id="cb1554-26"><a href="epicurves.html#cb1554-26" tabindex="-1"></a>  <span class="co"># labels and theme</span></span>
<span id="cb1554-27"><a href="epicurves.html#cb1554-27" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Show days that are tentative reporting&quot;</span>,</span>
<span id="cb1554-28"><a href="epicurves.html#cb1554-28" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span> </span>
<span id="cb1554-29"><a href="epicurves.html#cb1554-29" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb1554-30"><a href="epicurves.html#cb1554-30" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())                 <span class="co"># remove title of legend</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1179-1.png" width="672" /></p>
</div>
</div>
<div id="nhãn-ngày-nhiều-cấp-độ" class="section level2" number="32.4">
<h2><span class="header-section-number">32.4</span> Nhãn ngày nhiều cấp độ</h2>
<p>Nếu bạn muốn phân nhiều cấp nhãn ngày (ví dụ: tháng và năm) mà <em>không sao chép các cấp nhãn cấp độ thấp hơn</em>, hãy xem xét một trong các cách tiếp cận bên dưới:</p>
<p>Hãy nhớ rằng - bạn có thể sử dụng các công cụ như <code>\n</code> <em>trong</em> các đối số <code>date_labels</code> hoặc <code>labels</code> để đặt các phần của mỗi nhãn trên một dòng mới bên dưới. Tuy nhiên, đoạn code dưới đây giúp bạn thực hiện nhiều năm hoặc tháng (ví dụ) ở dòng thấp hơn <em>và chỉ một lần</em>. Một số lưu ý về code bên dưới:</p>
<ul>
<li>Số lượng ca bệnh được tổng hợp thành các tuần vì lý do thẩm mỹ. Xem chương Đường cong dịch bệnh (tab dữ liệu tổng hợp) để biết chi tiết.<br />
</li>
<li>Một miền <code>geom_area()</code> được sử dụng thay vì một histogram, vì phương pháp tiếp cận chia biểu đồ dưới đây không hoạt động tốt với histogram.</li>
</ul>
<p><strong>Tổng hợp dữ đếm hàng tuần</strong></p>
<div class="sourceCode" id="cb1555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1555-1"><a href="epicurves.html#cb1555-1" tabindex="-1"></a><span class="co"># Create dataset of case counts by week</span></span>
<span id="cb1555-2"><a href="epicurves.html#cb1555-2" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb1555-3"><a href="epicurves.html#cb1555-3" tabindex="-1"></a>central_weekly <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb1555-4"><a href="epicurves.html#cb1555-4" tabindex="-1"></a>  <span class="fu">filter</span>(hospital <span class="sc">==</span> <span class="st">&quot;Central Hospital&quot;</span>) <span class="sc">%&gt;%</span>   <span class="co"># filter linelist</span></span>
<span id="cb1555-5"><a href="epicurves.html#cb1555-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_onset, <span class="at">unit =</span> <span class="st">&quot;weeks&quot;</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb1555-6"><a href="epicurves.html#cb1555-6" tabindex="-1"></a>  <span class="fu">count</span>(week) <span class="sc">%&gt;%</span>                              <span class="co"># summarize weekly case counts</span></span>
<span id="cb1555-7"><a href="epicurves.html#cb1555-7" tabindex="-1"></a>  <span class="fu">drop_na</span>(week) <span class="sc">%&gt;%</span>                            <span class="co"># remove cases with missing onset_date</span></span>
<span id="cb1555-8"><a href="epicurves.html#cb1555-8" tabindex="-1"></a>  <span class="fu">complete</span>(                                    <span class="co"># fill-in all weeks with no cases reported</span></span>
<span id="cb1555-9"><a href="epicurves.html#cb1555-9" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb1555-10"><a href="epicurves.html#cb1555-10" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(week),   </span>
<span id="cb1555-11"><a href="epicurves.html#cb1555-11" tabindex="-1"></a>      <span class="at">to   =</span> <span class="fu">max</span>(week),</span>
<span id="cb1555-12"><a href="epicurves.html#cb1555-12" tabindex="-1"></a>      <span class="at">by   =</span> <span class="st">&quot;week&quot;</span>),</span>
<span id="cb1555-13"><a href="epicurves.html#cb1555-13" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))                        <span class="co"># convert new NA values to 0 counts</span></span></code></pre></div>
<p><strong>Vẽ biểu đồ</strong></p>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1556-1"><a href="epicurves.html#cb1556-1" tabindex="-1"></a><span class="co"># plot with box border on year</span></span>
<span id="cb1556-2"><a href="epicurves.html#cb1556-2" tabindex="-1"></a><span class="do">##############################</span></span>
<span id="cb1556-3"><a href="epicurves.html#cb1556-3" tabindex="-1"></a><span class="fu">ggplot</span>(central_weekly) <span class="sc">+</span></span>
<span id="cb1556-4"><a href="epicurves.html#cb1556-4" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> n),    <span class="co"># make line, specify x and y</span></span>
<span id="cb1556-5"><a href="epicurves.html#cb1556-5" tabindex="-1"></a>            <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span>             <span class="co"># because line height is count number</span></span>
<span id="cb1556-6"><a href="epicurves.html#cb1556-6" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels=</span><span class="st">&quot;%b&quot;</span>,             <span class="co"># date label format show month </span></span>
<span id="cb1556-7"><a href="epicurves.html#cb1556-7" tabindex="-1"></a>               <span class="at">date_breaks=</span><span class="st">&quot;month&quot;</span>,          <span class="co"># date labels on 1st of each month</span></span>
<span id="cb1556-8"><a href="epicurves.html#cb1556-8" tabindex="-1"></a>               <span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span>              <span class="co"># remove excess space on each end</span></span>
<span id="cb1556-9"><a href="epicurves.html#cb1556-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1556-10"><a href="epicurves.html#cb1556-10" tabindex="-1"></a>    <span class="at">expand  =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                       <span class="co"># remove excess space below x-axis</span></span>
<span id="cb1556-11"><a href="epicurves.html#cb1556-11" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>lubridate<span class="sc">::</span><span class="fu">year</span>(week), <span class="co"># facet on year (of Date class column)</span></span>
<span id="cb1556-12"><a href="epicurves.html#cb1556-12" tabindex="-1"></a>             <span class="at">space=</span><span class="st">&quot;free_x&quot;</span>,                </span>
<span id="cb1556-13"><a href="epicurves.html#cb1556-13" tabindex="-1"></a>             <span class="at">scales=</span><span class="st">&quot;free_x&quot;</span>,                <span class="co"># x-axes adapt to data range (not &quot;fixed&quot;)</span></span>
<span id="cb1556-14"><a href="epicurves.html#cb1556-14" tabindex="-1"></a>             <span class="at">switch=</span><span class="st">&quot;x&quot;</span>) <span class="sc">+</span>                   <span class="co"># facet labels (year) on bottom</span></span>
<span id="cb1556-15"><a href="epicurves.html#cb1556-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1556-16"><a href="epicurves.html#cb1556-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,         <span class="co"># facet labels placement</span></span>
<span id="cb1556-17"><a href="epicurves.html#cb1556-17" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="co"># facet labels no fill grey border</span></span>
<span id="cb1556-18"><a href="epicurves.html#cb1556-18" tabindex="-1"></a>                                        <span class="at">colour =</span> <span class="st">&quot;grey50&quot;</span>),</span>
<span id="cb1556-19"><a href="epicurves.html#cb1556-19" tabindex="-1"></a>        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>))<span class="sc">+</span>      <span class="co"># no space between facet panels</span></span>
<span id="cb1556-20"><a href="epicurves.html#cb1556-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Nested year labels, grey label border&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1181-1.png" width="672" /></p>
<div class="sourceCode" id="cb1557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1557-1"><a href="epicurves.html#cb1557-1" tabindex="-1"></a><span class="co"># plot with no box border on year</span></span>
<span id="cb1557-2"><a href="epicurves.html#cb1557-2" tabindex="-1"></a><span class="do">#################################</span></span>
<span id="cb1557-3"><a href="epicurves.html#cb1557-3" tabindex="-1"></a><span class="fu">ggplot</span>(central_weekly,</span>
<span id="cb1557-4"><a href="epicurves.html#cb1557-4" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> n)) <span class="sc">+</span>              <span class="co"># establish x and y for entire plot</span></span>
<span id="cb1557-5"><a href="epicurves.html#cb1557-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,              <span class="co"># make line, line height is count number</span></span>
<span id="cb1557-6"><a href="epicurves.html#cb1557-6" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#69b3a2&quot;</span>) <span class="sc">+</span>            <span class="co"># line color</span></span>
<span id="cb1557-7"><a href="epicurves.html#cb1557-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;#69b3a2&quot;</span>) <span class="sc">+</span>     <span class="co"># make points at the weekly data points</span></span>
<span id="cb1557-8"><a href="epicurves.html#cb1557-8" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;#69b3a2&quot;</span>,               <span class="co"># fill area below line</span></span>
<span id="cb1557-9"><a href="epicurves.html#cb1557-9" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.4</span>)<span class="sc">+</span>                   <span class="co"># fill transparency</span></span>
<span id="cb1557-10"><a href="epicurves.html#cb1557-10" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels=</span><span class="st">&quot;%b&quot;</span>,            <span class="co"># date label format show month </span></span>
<span id="cb1557-11"><a href="epicurves.html#cb1557-11" tabindex="-1"></a>               <span class="at">date_breaks=</span><span class="st">&quot;month&quot;</span>,         <span class="co"># date labels on 1st of each month</span></span>
<span id="cb1557-12"><a href="epicurves.html#cb1557-12" tabindex="-1"></a>               <span class="at">expand=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span>             <span class="co"># remove excess space</span></span>
<span id="cb1557-13"><a href="epicurves.html#cb1557-13" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1557-14"><a href="epicurves.html#cb1557-14" tabindex="-1"></a>    <span class="at">expand  =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))<span class="sc">+</span>                      <span class="co"># remove excess space below x-axis</span></span>
<span id="cb1557-15"><a href="epicurves.html#cb1557-15" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>lubridate<span class="sc">::</span><span class="fu">year</span>(week),        <span class="co"># facet on year (of Date class column)</span></span>
<span id="cb1557-16"><a href="epicurves.html#cb1557-16" tabindex="-1"></a>             <span class="at">space=</span><span class="st">&quot;free_x&quot;</span>,                </span>
<span id="cb1557-17"><a href="epicurves.html#cb1557-17" tabindex="-1"></a>             <span class="at">scales=</span><span class="st">&quot;free_x&quot;</span>,               <span class="co"># x-axes adapt to data range (not &quot;fixed&quot;)</span></span>
<span id="cb1557-18"><a href="epicurves.html#cb1557-18" tabindex="-1"></a>             <span class="at">switch=</span><span class="st">&quot;x&quot;</span>) <span class="sc">+</span>                  <span class="co"># facet labels (year) on bottom</span></span>
<span id="cb1557-19"><a href="epicurves.html#cb1557-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1557-20"><a href="epicurves.html#cb1557-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>,                     <span class="co"># facet label placement</span></span>
<span id="cb1557-21"><a href="epicurves.html#cb1557-21" tabindex="-1"></a>          <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),            <span class="co"># no facet lable background</span></span>
<span id="cb1557-22"><a href="epicurves.html#cb1557-22" tabindex="-1"></a>          <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),          </span>
<span id="cb1557-23"><a href="epicurves.html#cb1557-23" tabindex="-1"></a>          <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">colour=</span><span class="st">&quot;grey40&quot;</span>),  <span class="co"># grey border to facet PANEL</span></span>
<span id="cb1557-24"><a href="epicurves.html#cb1557-24" tabindex="-1"></a>          <span class="at">panel.spacing=</span><span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">&quot;cm&quot;</span>))<span class="sc">+</span>                   <span class="co"># No space between facet panels</span></span>
<span id="cb1557-25"><a href="epicurves.html#cb1557-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Nested year labels - points, shaded, no label border&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1181-2.png" width="672" /></p>
<p>Các kỹ thuật trên được điều chỉnh từ <a href="https://stackoverflow.com/questions/44616530/axis-labels-on-two-lines-with-nested-x-variables-year-below-months">đây</a> và bài đăng <a href="https://stackoverflow.com/questions/20571306/multi-row-x-axis-labels-in-ggplot-line-chart">này</a> trên stackoverflow.com.</p>
<!-- ======================================================= -->
</div>
<div id="trục-kép-1" class="section level2" number="32.5">
<h2><span class="header-section-number">32.5</span> Trục kép</h2>
<p>Mặc dù có những cuộc thảo luận gay gắt về tính hợp lệ của trục kép trong cộng đồng về trực quan hóa dữ liệu, nhiều chuyên gia dịch tễ vẫn muốn nhìn nhận biểu đồ đường cong dịch bệnh hoặc biểu đồ tương tự với phần trăm trên trục thứ hai. Điều này được thảo luận nhiều hơn trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>, nhưng một ví dụ sử dụng phương pháp <strong>cowplot</strong> được trình bày bên dưới:</p>
<ul>
<li>Hai biểu đồ riêng biệt được tạo, và sau đó được kết hợp với package <strong>cowplot</strong>.<br />
</li>
<li>Các biểu đồ phải có chính xác cùng trục x (đã đặt giới hạn), nếu không dữ liệu và nhãn sẽ không được căn chỉnh phù hợp<br />
</li>
<li>Mỗi biểu đồ sử dụng <code>theme_cowplot()</code> và một biểu đồ có trục y được di chuyển sang phía bên phải của biểu đồ</li>
</ul>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1558-1"><a href="epicurves.html#cb1558-1" tabindex="-1"></a><span class="co">#load package</span></span>
<span id="cb1558-2"><a href="epicurves.html#cb1558-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(cowplot)</span>
<span id="cb1558-3"><a href="epicurves.html#cb1558-3" tabindex="-1"></a></span>
<span id="cb1558-4"><a href="epicurves.html#cb1558-4" tabindex="-1"></a><span class="co"># Make first plot of epicurve histogram</span></span>
<span id="cb1558-5"><a href="epicurves.html#cb1558-5" tabindex="-1"></a><span class="do">#######################################</span></span>
<span id="cb1558-6"><a href="epicurves.html#cb1558-6" tabindex="-1"></a>plot_cases <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1558-7"><a href="epicurves.html#cb1558-7" tabindex="-1"></a>  </span>
<span id="cb1558-8"><a href="epicurves.html#cb1558-8" tabindex="-1"></a>  <span class="co"># plot cases per week</span></span>
<span id="cb1558-9"><a href="epicurves.html#cb1558-9" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb1558-10"><a href="epicurves.html#cb1558-10" tabindex="-1"></a>  </span>
<span id="cb1558-11"><a href="epicurves.html#cb1558-11" tabindex="-1"></a>  <span class="co"># create histogram  </span></span>
<span id="cb1558-12"><a href="epicurves.html#cb1558-12" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb1558-13"><a href="epicurves.html#cb1558-13" tabindex="-1"></a>    </span>
<span id="cb1558-14"><a href="epicurves.html#cb1558-14" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1558-15"><a href="epicurves.html#cb1558-15" tabindex="-1"></a>    </span>
<span id="cb1558-16"><a href="epicurves.html#cb1558-16" tabindex="-1"></a>    <span class="co"># bin breaks every week beginning monday before first case, going to monday after last case</span></span>
<span id="cb1558-17"><a href="epicurves.html#cb1558-17" tabindex="-1"></a>    <span class="at">breaks =</span> weekly_breaks_all)<span class="sc">+</span>  <span class="co"># pre-defined vector of weekly dates (see top of ggplot section)</span></span>
<span id="cb1558-18"><a href="epicurves.html#cb1558-18" tabindex="-1"></a>        </span>
<span id="cb1558-19"><a href="epicurves.html#cb1558-19" tabindex="-1"></a>  <span class="co"># specify beginning and end of date axis to align with other plot</span></span>
<span id="cb1558-20"><a href="epicurves.html#cb1558-20" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1558-21"><a href="epicurves.html#cb1558-21" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(weekly_breaks_all), <span class="fu">max</span>(weekly_breaks_all)))<span class="sc">+</span>  <span class="co"># min/max of the pre-defined weekly breaks of histogram</span></span>
<span id="cb1558-22"><a href="epicurves.html#cb1558-22" tabindex="-1"></a>  </span>
<span id="cb1558-23"><a href="epicurves.html#cb1558-23" tabindex="-1"></a>  <span class="co"># labels</span></span>
<span id="cb1558-24"><a href="epicurves.html#cb1558-24" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1558-25"><a href="epicurves.html#cb1558-25" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Daily cases&quot;</span>,</span>
<span id="cb1558-26"><a href="epicurves.html#cb1558-26" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Date of symptom onset&quot;</span></span>
<span id="cb1558-27"><a href="epicurves.html#cb1558-27" tabindex="-1"></a>    )<span class="sc">+</span></span>
<span id="cb1558-28"><a href="epicurves.html#cb1558-28" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb1558-29"><a href="epicurves.html#cb1558-29" tabindex="-1"></a></span>
<span id="cb1558-30"><a href="epicurves.html#cb1558-30" tabindex="-1"></a></span>
<span id="cb1558-31"><a href="epicurves.html#cb1558-31" tabindex="-1"></a><span class="co"># make second plot of percent died per week</span></span>
<span id="cb1558-32"><a href="epicurves.html#cb1558-32" tabindex="-1"></a><span class="do">###########################################</span></span>
<span id="cb1558-33"><a href="epicurves.html#cb1558-33" tabindex="-1"></a>plot_deaths <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                        <span class="co"># begin with linelist</span></span>
<span id="cb1558-34"><a href="epicurves.html#cb1558-34" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">week =</span> <span class="fu">floor_date</span>(date_onset, <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># create week column</span></span>
<span id="cb1558-35"><a href="epicurves.html#cb1558-35" tabindex="-1"></a>  </span>
<span id="cb1558-36"><a href="epicurves.html#cb1558-36" tabindex="-1"></a>  <span class="co"># summarise to get weekly percent of cases who died</span></span>
<span id="cb1558-37"><a href="epicurves.html#cb1558-37" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_cases =</span> <span class="fu">n</span>(),</span>
<span id="cb1558-38"><a href="epicurves.html#cb1558-38" tabindex="-1"></a>            <span class="at">died =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, <span class="at">na.rm=</span>T),</span>
<span id="cb1558-39"><a href="epicurves.html#cb1558-39" tabindex="-1"></a>            <span class="at">pct_died =</span> <span class="dv">100</span><span class="sc">*</span>died<span class="sc">/</span>n_cases) <span class="sc">%&gt;%</span> </span>
<span id="cb1558-40"><a href="epicurves.html#cb1558-40" tabindex="-1"></a>  </span>
<span id="cb1558-41"><a href="epicurves.html#cb1558-41" tabindex="-1"></a>  <span class="co"># begin plot</span></span>
<span id="cb1558-42"><a href="epicurves.html#cb1558-42" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb1558-43"><a href="epicurves.html#cb1558-43" tabindex="-1"></a>  </span>
<span id="cb1558-44"><a href="epicurves.html#cb1558-44" tabindex="-1"></a>  <span class="co"># line of weekly percent who died</span></span>
<span id="cb1558-45"><a href="epicurves.html#cb1558-45" tabindex="-1"></a>  <span class="fu">geom_line</span>(                                <span class="co"># create line of percent died</span></span>
<span id="cb1558-46"><a href="epicurves.html#cb1558-46" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> pct_died),  <span class="co"># specify y-height as pct_died column</span></span>
<span id="cb1558-47"><a href="epicurves.html#cb1558-47" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,                      <span class="co"># set line height to the value in pct_death column, not the number of rows (which is default)</span></span>
<span id="cb1558-48"><a href="epicurves.html#cb1558-48" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1558-49"><a href="epicurves.html#cb1558-49" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;black&quot;</span>)<span class="sc">+</span></span>
<span id="cb1558-50"><a href="epicurves.html#cb1558-50" tabindex="-1"></a>  </span>
<span id="cb1558-51"><a href="epicurves.html#cb1558-51" tabindex="-1"></a>  <span class="co"># Same date-axis limits as the other plot - perfect alignment</span></span>
<span id="cb1558-52"><a href="epicurves.html#cb1558-52" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(</span>
<span id="cb1558-53"><a href="epicurves.html#cb1558-53" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(weekly_breaks_all), <span class="fu">max</span>(weekly_breaks_all)))<span class="sc">+</span>  <span class="co"># min/max of the pre-defined weekly breaks of histogram</span></span>
<span id="cb1558-54"><a href="epicurves.html#cb1558-54" tabindex="-1"></a>  </span>
<span id="cb1558-55"><a href="epicurves.html#cb1558-55" tabindex="-1"></a>  </span>
<span id="cb1558-56"><a href="epicurves.html#cb1558-56" tabindex="-1"></a>  <span class="co"># y-axis adjustments</span></span>
<span id="cb1558-57"><a href="epicurves.html#cb1558-57" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(                <span class="co"># adjust y-axis</span></span>
<span id="cb1558-58"><a href="epicurves.html#cb1558-58" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>, <span class="dv">10</span>),         <span class="co"># set break intervals of percent axis</span></span>
<span id="cb1558-59"><a href="epicurves.html#cb1558-59" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>),              <span class="co"># set extent of percent axis</span></span>
<span id="cb1558-60"><a href="epicurves.html#cb1558-60" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">&quot;right&quot;</span>)<span class="sc">+</span>             <span class="co"># move percent axis to the right</span></span>
<span id="cb1558-61"><a href="epicurves.html#cb1558-61" tabindex="-1"></a>  </span>
<span id="cb1558-62"><a href="epicurves.html#cb1558-62" tabindex="-1"></a>  <span class="co"># Y-axis label, no x-axis label</span></span>
<span id="cb1558-63"><a href="epicurves.html#cb1558-63" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1558-64"><a href="epicurves.html#cb1558-64" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Percent deceased&quot;</span>)<span class="sc">+</span>      <span class="co"># percent axis label</span></span>
<span id="cb1558-65"><a href="epicurves.html#cb1558-65" tabindex="-1"></a>  </span>
<span id="cb1558-66"><a href="epicurves.html#cb1558-66" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()                   <span class="co"># add this to make the two plots merge together nicely</span></span></code></pre></div>
<p>Bây giờ sử dụng <strong>cowplot</strong> để chồng lên hai biểu đồ. Sự chú ý đã được tập trung vào việc căn chỉnh trục x, cạnh của trục y và việc sử dụng <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1559-1"><a href="epicurves.html#cb1559-1" tabindex="-1"></a>aligned_plots <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">align_plots</span>(plot_cases, plot_deaths, <span class="at">align=</span><span class="st">&quot;hv&quot;</span>, <span class="at">axis=</span><span class="st">&quot;tblr&quot;</span>)</span>
<span id="cb1559-2"><a href="epicurves.html#cb1559-2" tabindex="-1"></a><span class="fu">ggdraw</span>(aligned_plots[[<span class="dv">1</span>]]) <span class="sc">+</span> <span class="fu">draw_plot</span>(aligned_plots[[<span class="dv">2</span>]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1183-1.png" width="672" /></p>
</div>
<div id="số-mới-mắc-tích-lũy" class="section level2" number="32.6">
<h2><span class="header-section-number">32.6</span> Số mới mắc tích lũy</h2>
<p>Lưu ý: Nếu sử dụng <strong>incidence2</strong>, hãy xem chương về cách bạn có thể tính số mới mắc tích lũy bằng một hàm đơn giản. Chương này sẽ đề cập đến cách tính số mới mắc tích lũy và vẽ biểu đồ bằng <code>ggplot()</code>.</p>
<p>Nếu bắt đầu bằng bộ số liệu <code>linelist</code>, hãy tạo một cột mới chứa số ca bệnh tích lũy mỗi ngày trong đợt bùng phát bằng cách sử dụng <code>cumsum()</code> từ <strong>base</strong> R:</p>
<div class="sourceCode" id="cb1560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1560-1"><a href="epicurves.html#cb1560-1" tabindex="-1"></a>cumulative_case_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb1560-2"><a href="epicurves.html#cb1560-2" tabindex="-1"></a>  <span class="fu">count</span>(date_onset) <span class="sc">%&gt;%</span>                <span class="co"># count of rows per day (returned in column &quot;n&quot;)   </span></span>
<span id="cb1560-3"><a href="epicurves.html#cb1560-3" tabindex="-1"></a>  <span class="fu">mutate</span>(                         </span>
<span id="cb1560-4"><a href="epicurves.html#cb1560-4" tabindex="-1"></a>    <span class="at">cumulative_cases =</span> <span class="fu">cumsum</span>(n)       <span class="co"># new column of the cumulative number of rows at each date</span></span>
<span id="cb1560-5"><a href="epicurves.html#cb1560-5" tabindex="-1"></a>    )</span></code></pre></div>
<p>10 hàng đầu tiên được hiển thị bên dưới:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-fe69d3bf059f9c3806f2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fe69d3bf059f9c3806f2">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05"],[1,1,2,1,1,1,2,1,1,1],[1,2,4,5,6,7,9,10,11,12]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n      <th>cumulative_cases<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"date_onset","targets":0},{"name":"n","targets":1},{"name":"cumulative_cases","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Sau đó, cột tích lũy này có thể được vẽ dựa trên <code>date_onset</code>, sử dụng <code>geom_line()</code>:</p>
<div class="sourceCode" id="cb1561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1561-1"><a href="epicurves.html#cb1561-1" tabindex="-1"></a>plot_cumulative <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb1561-2"><a href="epicurves.html#cb1561-2" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb1561-3"><a href="epicurves.html#cb1561-3" tabindex="-1"></a>    <span class="at">data =</span> cumulative_case_counts,</span>
<span id="cb1561-4"><a href="epicurves.html#cb1561-4" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date_onset, <span class="at">y =</span> cumulative_cases),</span>
<span id="cb1561-5"><a href="epicurves.html#cb1561-5" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1561-6"><a href="epicurves.html#cb1561-6" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb1561-7"><a href="epicurves.html#cb1561-7" tabindex="-1"></a></span>
<span id="cb1561-8"><a href="epicurves.html#cb1561-8" tabindex="-1"></a>plot_cumulative</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1186-1.png" width="672" /></p>
<p>Nó cũng có thể được phủ đè lên đường cong dịch bệnh, với trục kép bằng cách sử dụng phương pháp <strong>cowplot</strong> được mô tả ở trên và trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>:</p>
<div class="sourceCode" id="cb1562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1562-1"><a href="epicurves.html#cb1562-1" tabindex="-1"></a><span class="co">#load package</span></span>
<span id="cb1562-2"><a href="epicurves.html#cb1562-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(cowplot)</span>
<span id="cb1562-3"><a href="epicurves.html#cb1562-3" tabindex="-1"></a></span>
<span id="cb1562-4"><a href="epicurves.html#cb1562-4" tabindex="-1"></a><span class="co"># Make first plot of epicurve histogram</span></span>
<span id="cb1562-5"><a href="epicurves.html#cb1562-5" tabindex="-1"></a>plot_cases <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb1562-6"><a href="epicurves.html#cb1562-6" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(          </span>
<span id="cb1562-7"><a href="epicurves.html#cb1562-7" tabindex="-1"></a>    <span class="at">data =</span> linelist,</span>
<span id="cb1562-8"><a href="epicurves.html#cb1562-8" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date_onset),</span>
<span id="cb1562-9"><a href="epicurves.html#cb1562-9" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb1562-10"><a href="epicurves.html#cb1562-10" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1562-11"><a href="epicurves.html#cb1562-11" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Daily cases&quot;</span>,</span>
<span id="cb1562-12"><a href="epicurves.html#cb1562-12" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Date of symptom onset&quot;</span></span>
<span id="cb1562-13"><a href="epicurves.html#cb1562-13" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb1562-14"><a href="epicurves.html#cb1562-14" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span>
<span id="cb1562-15"><a href="epicurves.html#cb1562-15" tabindex="-1"></a></span>
<span id="cb1562-16"><a href="epicurves.html#cb1562-16" tabindex="-1"></a><span class="co"># make second plot of cumulative cases line</span></span>
<span id="cb1562-17"><a href="epicurves.html#cb1562-17" tabindex="-1"></a>plot_cumulative <span class="ot">&lt;-</span> <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb1562-18"><a href="epicurves.html#cb1562-18" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb1562-19"><a href="epicurves.html#cb1562-19" tabindex="-1"></a>    <span class="at">data =</span> cumulative_case_counts,</span>
<span id="cb1562-20"><a href="epicurves.html#cb1562-20" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> date_onset, <span class="at">y =</span> cumulative_cases),</span>
<span id="cb1562-21"><a href="epicurves.html#cb1562-21" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1562-22"><a href="epicurves.html#cb1562-22" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)<span class="sc">+</span></span>
<span id="cb1562-23"><a href="epicurves.html#cb1562-23" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb1562-24"><a href="epicurves.html#cb1562-24" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">&quot;right&quot;</span>)<span class="sc">+</span></span>
<span id="cb1562-25"><a href="epicurves.html#cb1562-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1562-26"><a href="epicurves.html#cb1562-26" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Cumulative cases&quot;</span>)<span class="sc">+</span></span>
<span id="cb1562-27"><a href="epicurves.html#cb1562-27" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()<span class="sc">+</span></span>
<span id="cb1562-28"><a href="epicurves.html#cb1562-28" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1562-29"><a href="epicurves.html#cb1562-29" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1562-30"><a href="epicurves.html#cb1562-30" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1562-31"><a href="epicurves.html#cb1562-31" tabindex="-1"></a>    <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1562-32"><a href="epicurves.html#cb1562-32" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p>Bây giờ sử dụng <strong>cowplot</strong> để chồng lên hai biểu đồ. Sự chú ý đã được tập trung vào việc căn chỉnh trục x, cạnh của trục y và việc sử dụng <code>theme_cowplot()</code>.</p>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1563-1"><a href="epicurves.html#cb1563-1" tabindex="-1"></a>aligned_plots <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">align_plots</span>(plot_cases, plot_cumulative, <span class="at">align=</span><span class="st">&quot;hv&quot;</span>, <span class="at">axis=</span><span class="st">&quot;tblr&quot;</span>)</span>
<span id="cb1563-2"><a href="epicurves.html#cb1563-2" tabindex="-1"></a><span class="fu">ggdraw</span>(aligned_plots[[<span class="dv">1</span>]]) <span class="sc">+</span> <span class="fu">draw_plot</span>(aligned_plots[[<span class="dv">2</span>]])</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1188-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
<div id="nguồn-tham-khảo-2" class="section level2" number="32.7">
<h2><span class="header-section-number">32.7</span> Nguồn tham khảo</h2>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
