<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>9 Làm việc với ngày tháng | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="9 Làm việc với ngày tháng | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Làm việc với ngày tháng | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="dates" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Làm việc với ngày tháng</h1>
<p><img src="images/Dates_500x500.png" width="50%" style="display: block; margin: auto;" /></p>
<p>Làm việc với trường ngày trên R cần nhiều sự tỉ mỉ hơn là làm việc với các lớp đối tượng khác. Dưới đây, chúng tôi giới thiệu một số công cụ và ví dụ để các thao tác trở nên dễ dàng hơn. Thật may mắn, trường ngày có thể biến đổi một cách dễ dàng với một bộ packages như <strong>lubridate</strong>.</p>
<p>Khi nhập dữ liệu thô, R thường diễn giải trường ngày dưới dạng các ký tự - điều này có nghĩa là chúng không thể được sử dụng cho các thao tác chung như tạo chuỗi thời gian và tính toán khoảng thời gian. Để làm cho vấn đề trở nên khó hơn một chút, có nhiều cách để định dạng ngày và bạn cần thao tác để R nhận biết từng phần của biến ngày mô tả cái gì (tháng, ngày, giờ, v.v.).</p>
<p>Ngày trong R có kiểu đối tượng riêng - kiểu <code>Date</code>. Nên lưu ý rằng cũng có một kiểu khác lưu trữ đối tượng với định dạng ngày <em>và</em> giờ. Đối tượng ngày giờ được chính thức định dạng ở kiểu <code>POSIXt</code>, <code>POSIXct</code>, và/hoặc <code>POSIXlt</code> sự khác biệt không quá quan trọng). Các đối tượng này được định dạng một cách không chính thức là kiểu <em>datetime</em>.</p>
<ul>
<li>Điều quan trọng là giúp R nhận ra khi một cột chứa thông tin ngày tháng.<br />
</li>
<li>Ngày là một kiểu đối tượng và khó để có thể làm việc.<br />
</li>
<li>Ở đây chúng tôi trình bày một số cách để chuyển đổi các cột ngày thành kiểu dữ liệu Ngày tiêu chuẩn.</li>
</ul>
<!-- ======================================================= -->
<div id="chuẩn-bị" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Chuẩn bị</h2>
<div id="gọi-packages" class="section level3 unnumbered">
<h3>Gọi packages</h3>
<p>Đoạn code này hiển thị tải các package cần thiết để sử dụng. Trong tài liệu này, chúng tôi nhấn mạnh đến hàm <code>p_load()</code> từ package <strong>pacman</strong>, mà có thể cài đặt package nếu cần thiết <em>và</em> gọi package để sử dụng. Bạn cũng có thể gọi và cài đặt package với hàm <code>library()</code> từ <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để biết thêm thông tin về các package trong R.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="dates.html#cb312-1" tabindex="-1"></a><span class="co"># Checks if package is installed, installs if necessary, and loads package for current session</span></span>
<span id="cb312-2"><a href="dates.html#cb312-2" tabindex="-1"></a></span>
<span id="cb312-3"><a href="dates.html#cb312-3" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb312-4"><a href="dates.html#cb312-4" tabindex="-1"></a>  lubridate,  <span class="co"># general package for handling and converting dates  </span></span>
<span id="cb312-5"><a href="dates.html#cb312-5" tabindex="-1"></a>  parsedate,   <span class="co"># has function to &quot;guess&quot; messy dates</span></span>
<span id="cb312-6"><a href="dates.html#cb312-6" tabindex="-1"></a>  aweek,      <span class="co"># another option for converting dates to weeks, and weeks to dates</span></span>
<span id="cb312-7"><a href="dates.html#cb312-7" tabindex="-1"></a>  zoo,        <span class="co"># additional date/time functions</span></span>
<span id="cb312-8"><a href="dates.html#cb312-8" tabindex="-1"></a>  tidyverse,  <span class="co"># data management and visualization  </span></span>
<span id="cb312-9"><a href="dates.html#cb312-9" tabindex="-1"></a>  rio)        <span class="co"># data import/export</span></span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-2" class="section level3 unnumbered">
<h3>Nhập dữ liệu</h3>
<p>Chúng ta sẽ nhập bộ dữ liệu với các ca bệnh từ một vụ dịch Ebola mô phỏng. Nếu bạn muốn tải xuống dữ liệu để thực hành theo từng bước, hãy xem hướng dẫn ở chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a>. Chúng ta giả định rằng tệp dữ liệu đã nằm trong thư mục làm việc của bạn nên bạn không cần chỉ định thư mục con trong đường dẫn này.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="dates.html#cb313-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.xlsx&quot;</span>)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="ngày-hiện-tại" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Ngày hiện tại</h2>
<p>Bạn có thể lấy ngày “hệ thống” hiện tại hoặc ngày giờ hệ thống của máy tính bằng cách thực hiện như sau với <strong>base</strong> R.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="dates.html#cb314-1" tabindex="-1"></a><span class="co"># get the system date - this is a DATE class</span></span>
<span id="cb314-2"><a href="dates.html#cb314-2" tabindex="-1"></a><span class="fu">Sys.Date</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2024-02-16&quot;</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="dates.html#cb316-1" tabindex="-1"></a><span class="co"># get the system time - this is a DATETIME class</span></span>
<span id="cb316-2"><a href="dates.html#cb316-2" tabindex="-1"></a><span class="fu">Sys.time</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2024-02-16 15:05:25 CET&quot;</code></pre>
<p>Với package <strong>lubridate</strong>, chúng cũng có thể trả về giá trị tương ứng với hàm <code>today()</code> và <code>now()</code>. Hàm <code>date()</code> sẽ trả về giá trị ngày và giờ hiện tại với ngày trong tuần và tháng.</p>
<!-- ======================================================= -->
</div>
<div id="chuyển-đổi-sang-ngày" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Chuyển đổi sang Ngày</h2>
<p>Sau khi nạp tập dữ liệu vào R, giá trị cột ngày có thể trông giống như “1989/12/30”, “05/06/2014” hoặc “13 Jan 2020”. Trong những trường hợp này, R có thể vẫn coi các giá trị trong cột có định dạng ký tự. R cần được <em>hướng dẫn</em> rằng các giá trị này là ngày… và định dạng của ngày là gì (phần nào là Ngày, phần nào là tháng, phần nào là Năm, v.v.).</p>
<p>Sau khi hướng dẫn, R chuyển đổi các giá trị này thành kiểu Ngày. Trong nền, R sẽ lưu trữ ngày tháng dưới dạng số (số ngày tính từ ngày “gốc” ngày 1 tháng 1 năm 1970). Bạn sẽ không phải làm việc với định dạng ngày-số thường xuyên, tuy nhiên điều này cho phép R coi ngày là các biến liên tục và cho phép các hoạt động đặc biệt như tính toán khoảng cách giữa các ngày.</p>
<p>Mặc định, các giá trị của phân lớp Ngày trong R được hiển thị là YYYY-MM-DD. Sau chương này chúng ta sẽ thảo luận về cách thay đổi cách hiển thị giá trị ngày tháng.</p>
<p>Dưới đây, chúng tôi trình bày hai cách để chuyển đổi một cột từ dạng ký tự sang kiểu Ngày tiêu chuẩn.</p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Bạn có thể kiểm tra kiểu ngày hiện tại của cột bằng hàm <code>class()</code> trong <strong>base</strong> R, ví dụ như <code>class(linelist$date_onset)</code>.</span></p>
<div id="base-r" class="section level3 unnumbered">
<h3><strong>base</strong> R</h3>
<p><code>as.Date()</code> là hàm chuẩn của <strong>base</strong> R để chuyển đổi một đối tượng hoặc cột thành kiểu Ngày (lưu ý viết hoa chữ “D”).</p>
<p>Sử dụng hàm <code>as.Date()</code> yêu cầu:</p>
<ul>
<li>Bạn <em>làm rõ định dạng <strong>hiện tại</strong> của ngày ở dạng văn bản gốc</em> hoặc ngày gốc nếu biến ngày được cung cấp dưới dạng số (xem mục ngày tháng trong Excel)<br />
</li>
<li>Nếu hàm được áp dụng trên cột dạng văn bản, tất cả các giá trị ngày phải có cùng một định dạng chính xác (nếu không như vậy, hãy thử hàm <code>parse_date()</code> từ package <strong>parsedate</strong>)</li>
</ul>
<p><strong>Trước tiên</strong>, hãy kiểm tra kiểu của cột với hàm <code>class()</code> trong <strong>base</strong> R. Nếu bạn không chắc chắn hoặc phân vân về kiểu dữ liệu của cột (vd: bạn thấy “POSIXct”, v.v.) dễ dàng nhất là chuyển đổi cột thành kiểu văn bản với hàm <code>as.character()</code>, và sau đó chuyển đổi nó thành kiểu Ngày.</p>
<p><strong>Thứ hai</strong>, trong hàm <code>as.Date()</code>, sử dụng đối số <code>format =</code> để cho R biết định dạng <em>hiện tại</em> của các cấu phần trong biến ngày - những ký tự nào đề cập đến tháng, ngày và năm và cách chúng được phân tách. Nếu các giá trị của bạn đã ở một trong các định dạng ngày chuẩn của R (“YYYY-MM-DD” hoặc “YYYY/MM/DD”) thì đối số <code>format =</code> là không cần thiết.</p>
<p>Để <code>format =</code>, hãy cung cấp một chuỗi ký tự (trong dấu ngoặc kép) đại diện cho định dạng ngày <em>hiện tại</em> bằng cách sử dụng các chữ viết tắt đặc biệt “strptime” dưới đây. Ví dụ: nếu ngày ký tự của bạn hiện ở định dạng “DD / MM / YYYY”, như “24/04/1968”, bạn hãy sử dụng đối số <code>format = "%d/%m/%Y"</code> để chuyển đổi các giá trị này. <strong>Đặt định dạng trong dấu ngoặc kép là cần thiết. Và đừng quên bất kỳ dấu gạch chéo hoặc dấu gạch ngang nào!</strong></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="dates.html#cb318-1" tabindex="-1"></a><span class="co"># Convert to class date</span></span>
<span id="cb318-2"><a href="dates.html#cb318-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb318-3"><a href="dates.html#cb318-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">as.Date</span>(date_of_onset, <span class="at">format =</span> <span class="st">&quot;%d/%m/%Y&quot;</span>))</span></code></pre></div>
<p>Hầu hết các từ viết tắt của “strptime” được liệt kê dưới đây. Bạn có thể xem danh sách đầy đủ bằng cách chạy lệnh <code>?strptime</code>.</p>
<p>%d = Thứ tự ngày trong tháng (5, 17, 28, v.v.)<br />
%j = Thứ tự ngày trong năm (theo lịch Julian, ngày từ 001-366)<br />
%a = Ngày trong tuần viết tắt (Mon, Tue, Wed, v.v.)<br />
%A = Ngày trong tuần viết đầy đủ (Monday, Tuesday, v.v.)
%w = Thứ tự ngày trong tuần (0-6, Chủ Nhật là 0)<br />
%u = Thứ tự ngày trong tuần (1-7, Thứ hai là 1)<br />
%W = Thứ tự của tuần trong năm (00-53, Thứ Hai là đầu tuần)<br />
%U = Thứ tự của tuần trong năm (01-53, Chủ Nhật là ngày bắt đầu tuần)<br />
%m = Thứ tự của tháng trong năm (vd: 01, 02, 03, 04)<br />
%b = Tháng viết tắt (Jan, Feb, v.v.)<br />
%B = Tháng viết đầy đủ (January, February, v.v.)<br />
%y = năm 2 chữ số (vd: 89)<br />
%Y = năm 4 chữ số (vd: 1989)<br />
%H = giờ (đồng hồ 24h)<br />
%M = phút<br />
%S = giây
%z = offset from GMT<br />
%Z = Múi giờ (dạng ký tự)</p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Đối số <code>format =</code> của hàm <code>as.Date()</code> sẽ <em>không</em> cho R biết định dạng ngày theo cách bạn muốn, nhưng hơn hết nó giúp xác định thành phần ngày trong cột <em>trước khi</em> bạn chạy dòng lệnh.</span></p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Hãy chắc chắn rằng đối số <code>format =</code> bạn có sử dụng <em>các ký tự ngăn cách ngày tháng</em> (vd: /, -, hoặc khoảng trắng) trong cột ngày hiện tại của bạn.</span></p>
<p>Khi các giá trị nằm trong phân lớp Ngày tiêu chuẩn, R sẽ mặc định hiển thị chúng ở định dạng chuẩn, đó là YYYY-MM-DD.</p>
</div>
<div id="lubridate" class="section level3 unnumbered">
<h3><strong>lubridate</strong></h3>
<p>Việc chuyển đổi các đối tượng dạng tự thành Ngày tháng có thể được thực hiện dễ dàng hơn bằng cách sử dụng package <strong>lubridate</strong>. Đây là một package thuộc hệ sinh thái <strong>tidyverse</strong> được thiết kế để giúp làm việc với ngày và giờ đơn giản và nhất quán hơn so với <strong>base</strong> R. Vì những lý do này, package <strong>lubridate</strong> thường được coi là package tiêu chuẩn vàng cho ngày và giờ và được khuyến khích sử dụng bất cứ khi nào làm việc với chúng.</p>
<p>Package <strong>lubridate</strong> cung cấp một số hàm trợ giúp khác nhau được thiết kế để chuyển đổi các đối tượng dạng ký tự thành ngày tháng một cách trực quan và dễ dàng hơn là định dạng bằng hàm <code>as.Date()</code>. Các hàm này dành riêng cho định dạng ngày tháng, nhưng cho phép nhiều kiểu dấu phân tách và từ đồng nghĩa của ngày tháng (vd: 01 so với Jan so với January) - chúng được đặt tên theo chữ viết tắt của các định dạng ngày.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="dates.html#cb319-1" tabindex="-1"></a><span class="co"># install/load lubridate </span></span>
<span id="cb319-2"><a href="dates.html#cb319-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(lubridate)</span></code></pre></div>
<p>Hàm <code>ymd()</code> có thể chuyển đổi linh hoạt các giá trị ngày được cung cấp dưới dạng <strong>năm, sau đó là tháng, và ngày</strong>.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="dates.html#cb320-1" tabindex="-1"></a><span class="co"># read date in year-month-day format</span></span>
<span id="cb320-2"><a href="dates.html#cb320-2" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2020-10-11&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="dates.html#cb322-1" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;20201011&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<p>Hàm <code>mdy()</code> có thể chuyển đổi linh hoạt các giá trị ngày được cung cấp dưới dạng <strong>tháng, ngày, và năm</strong>.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="dates.html#cb324-1" tabindex="-1"></a><span class="co"># read date in month-day-year format</span></span>
<span id="cb324-2"><a href="dates.html#cb324-2" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;10/11/2020&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="dates.html#cb326-1" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">&quot;Oct 11 20&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<p>Hàm <code>dmy()</code> có thể chuyển đổi linh hoạt các giá trị ngày được cung cấp dưới dạng <strong>ngày, tháng, và năm</strong>.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="dates.html#cb328-1" tabindex="-1"></a><span class="co"># read date in day-month-year format</span></span>
<span id="cb328-2"><a href="dates.html#cb328-2" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;11 10 2020&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="dates.html#cb330-1" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;11 October 2020&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-10-11&quot;</code></pre>
<!-- The `as.character()` and `as.Date()` commands can optionally be combined as:   -->
<!-- ```{r eval=F} -->
<!-- linelist_cleaned$date_of_onset <- as.Date(as.character(linelist_cleaned$date_of_onset), format = "%d/%m/%Y") -->
<!-- ``` -->
<p>Nếu sử dụng piping, việc chuyển đổi cột dạng ký tự thành ngày tháng với <strong>lubridate</strong> có thể trông như thế này:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="dates.html#cb332-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb332-2"><a href="dates.html#cb332-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> lubridate<span class="sc">::</span><span class="fu">dmy</span>(date_onset))</span></code></pre></div>
<p>Sau khi hoàn tất, bạn có thể chạy hàm <code>class()</code> để xác minh lại kiểu dữ liệu của cột</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="dates.html#cb333-1" tabindex="-1"></a><span class="co"># Check the class of the column</span></span>
<span id="cb333-2"><a href="dates.html#cb333-2" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>date_onset)  </span></code></pre></div>
<p>Khi các giá trị nằm trong phân lớp Ngày tiêu chuẩn, R sẽ mặc định hiển thị chúng ở định dạng chuẩn, đó là YYYY-MM-DD.</p>
<p>Lưu ý rằng các hàm trên sử dụng tốt nhất với thông tin về năm có 4 chữ số. Thông tin về năm có 2 chữ số có thể tạo ra các kết quả không mong muốn, bởi vì lubridate sẽ cố gắng đoán và lấy thông tin về thế kỷ.</p>
<p>Để chuyển đổi thông tin về năm 2 chữ số thành 4 chữ số (tất cả trong cùng một thế kỷ), bạn có thể chuyển thành dạng ký tự và sau đó kết hợp các chữ số hiện có với một tiền tố sử dụng hàm <code>str_glue()</code> từ package <strong>stringr</strong> (xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>). Sau đó chuyển đổi sang dạng ngày.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="dates.html#cb334-1" tabindex="-1"></a>two_digit_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;15&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;16&quot;</span>, <span class="st">&quot;17&quot;</span>)</span>
<span id="cb334-2"><a href="dates.html#cb334-2" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;20{two_digit_years}&quot;</span>)</span></code></pre></div>
<pre><code>## 2015
## 2015
## 2016
## 2017</code></pre>
</div>
<div id="kết-hợp-các-cột" class="section level3 unnumbered">
<h3>Kết hợp các cột</h3>
<p>Bạn có thể sử dụng các hàm <code>make_date()</code> và <code>make_datetime()</code> trong package <strong>lubridate</strong> để kết hợp nhiều cột dạng số thành một cột ngày. Ví dụ: nếu bạn có các cột kiểu số như <code>onset_day</code>, <code>onset_month</code>, và <code>onset_year</code> trong data frame <code>linelist</code>:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="dates.html#cb336-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb336-2"><a href="dates.html#cb336-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">onset_date =</span> <span class="fu">make_date</span>(<span class="at">year =</span> onset_year, <span class="at">month =</span> onset_month, <span class="at">day =</span> onset_day))</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="ngày-tháng-trong-excel" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Ngày tháng trong Excel</h2>
<p>Về cơ bản, hầu hết phần mềm lưu trữ thông tin ngày tháng dưới dạng số. R lưu trữ ngày bắt đầu từ ngày 1 tháng 1 năm 1970. Do đó, nếu bạn chạy hàm <code>as.numeric(as.Date("1970-01-01))</code>, bạn sẽ nhận được kết quả là <code>0</code>.</p>
<p>Microsoft Excel lưu trữ ngày tháng có nguồn gốc là ngày 30 tháng 12 năm 1899 (hệ điều hành Windows) hoặc ngày 1 tháng 1 năm 1904 (hệ điều hành Mac), tùy thuộc vào hệ điều hành của bạn. Xem <a href="https://docs.microsoft.com/en-us/office/troubleshoot/excel/1900-and-1904-date-system">hướng dẫn của Microsoft</a> để biết thêm thông tin.</p>
<p>Ngày trong Excel thường nạp vào R dưới dạng các giá trị số thay vì dưới dạng ký tự. Nếu tập dữ liệu bạn đã nhập từ Excel hiển thị ngày tháng dưới dạng số hoặc ký tự như “41369”… hãy sử dụng hàm <code>as.Date()</code> (hoặc hàm <code>as_date()</code> của <strong>lubridate</strong>) để chuyển đổi, nhưng <strong>thay vì cung cấp một “định dạng” như trên, hãy cung cấp ngày gốc trên Excel</strong> tới đối số <code>origin =</code>.</p>
<p>Điều này sẽ không hoạt động nếu ngày Excel được lưu trữ trong R dưới dạng một kiểu ký tự, vì vậy hãy đảm bảo rằng các số được lữu trữ ở kiểu Số!</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> Bạn nên cung cấp định dạng ngày ở định dạng mặc định của R (“YYYY-MM-DD”).</span></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="dates.html#cb337-1" tabindex="-1"></a><span class="co"># An example of providing the Excel &#39;origin date&#39; when converting Excel number dates</span></span>
<span id="cb337-2"><a href="dates.html#cb337-2" tabindex="-1"></a>data_cleaned <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb337-3"><a href="dates.html#cb337-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">as.numeric</span>(date_onset)) <span class="sc">%&gt;%</span>   <span class="co"># ensure class is numeric</span></span>
<span id="cb337-4"><a href="dates.html#cb337-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">as.Date</span>(date_onset, <span class="at">origin =</span> <span class="st">&quot;1899-12-30&quot;</span>)) <span class="co"># convert to date using Excel origin</span></span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="ngày-lộn-xộn" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Ngày lộn xộn</h2>
<p>Hàm <code>guess_dates()</code> từ package <strong>linelist</strong> cố gắng nhận diện một cột ngày tháng “lộn xộn” chứa ngày tháng ở nhiều định dạng khác nhau và chuyển đổi ngày tháng sang định dạng chuẩn. Bạn có thể <a href="https://www.repidemicsconsortium.org/linelist/reference/guess_dates.html">đọc thêm tài liệu trực tuyến về <code>guess_dates()</code></a>. Nếu hàm <code>guess_dates()</code> chưa có trên CRAN của R phiên bản 4.0.2, hãy thử cài đặt theo cách sau <code>pacman::p_load_gh("reconhub/linelist")</code>.</p>
<p>Ví dụ: hàm <code>guess_dates</code> sẽ nhận diện một vectơ gồm các ngày chứa ký tự như sau “03 Jan 2018”, “07/03/1982”, và “08/20/85” và chuyển đổi chúng thành định dạng Ngày tiêu chuẩn như: <code>2018-01-03</code>, <code>1982-03-07</code>, và <code>1985-08-20</code>.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="dates.html#cb338-1" tabindex="-1"></a>parsedate<span class="sc">::</span><span class="fu">parse_date</span>(<span class="fu">c</span>(<span class="st">&quot;03 Jan 2018&quot;</span>,</span>
<span id="cb338-2"><a href="dates.html#cb338-2" tabindex="-1"></a>                        <span class="st">&quot;07/03/1982&quot;</span>,</span>
<span id="cb338-3"><a href="dates.html#cb338-3" tabindex="-1"></a>                        <span class="st">&quot;08/20/85&quot;</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2018-01-03 UTC&quot; &quot;1982-07-03 UTC&quot; &quot;1985-08-20 UTC&quot;</code></pre>
<p>Một số tùy chọn đối số cho hàm <code>guess_dates()</code> mà bạn có thể đưa vào là:</p>
<ul>
<li><code>error_tolerance</code> - Tỷ lệ thông tin nhập không thể được xác định là ngày được chấp nhận (mặc định là 0,1 hoặc 10%)</li>
<li><code>last_date</code> - ngày hợp lệ cuối cùng (mặc định là ngày hiện tại)<br />
</li>
<li><code>first_date</code> - ngày hợp lệ đầu tiên. Giá trị mặc định là năm mươi năm trước last_date.</li>
</ul>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="dates.html#cb340-1" tabindex="-1"></a><span class="co"># An example using guess_dates on the column dater_onset</span></span>
<span id="cb340-2"><a href="dates.html#cb340-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                 <span class="co"># the dataset is called linelist</span></span>
<span id="cb340-3"><a href="dates.html#cb340-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">parse_date</span>(date_onset)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="làm-việc-với-kiểu-dữ-liệu-ngày-giờ" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Làm việc với kiểu dữ liệu ngày-giờ</h2>
<p>Như đã đề cập ở trước, R cũng hỗ trợ kiểu dữ liệu <code>datetime</code> - là một cột chứa thông tin ngày <strong>và</strong> giờ. Bởi vì với kiểu dữ liệu <code>Date</code>, chúng cần được chuyển đổi từ các đối tượng kiểu <code>character</code> thành kiểu <code>datetime</code>.</p>
<div id="chuyển-đổi-ngày-giờ" class="section level3 unnumbered">
<h3>Chuyển đổi ngày giờ</h3>
<p>Một đối tượng <code>datetime</code> được định dạng phần ngày trước, sau đó là phần thời gian - ví dụ: <em>01 Jan 2020, 16:30</em>. Cũng như ngày, có nhiều cách có thể được định dạng và có nhiều cấp độ chính xác (giờ, phút, giây) có thể sử dụng.</p>
<p>Thật may mắn, các hàm hỗ trợ trong <strong>lubridate</strong> cũng tồn tại để giúp chuyển đổi thông tin dạng chuỗi này thành các đối tượng dạng <code>datetime</code>. Các hàm này là phần mở rộng của các hàm ngày, với hàm <code>_h</code> (chỉ cung cấp giờ), hàm <code>_hm</code> (cung cấp giờ và phút), hoặc hàm <code>_hms</code> (cung cấp giờ, phút và giây) được thêm vào cuối cùng (vd: <code>dmy_hms()</code>). Chúng có thể được sử dụng như sau:</p>
<p>Chuyển đổi datetime chỉ có giờ thành đối tượng datetime</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="dates.html#cb341-1" tabindex="-1"></a><span class="fu">ymd_h</span>(<span class="st">&quot;2020-01-01 16hrs&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 16:00:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="dates.html#cb343-1" tabindex="-1"></a><span class="fu">ymd_h</span>(<span class="st">&quot;2020-01-01 4PM&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 16:00:00 UTC&quot;</code></pre>
<p>Chuyển đổi datetime với giờ và phút thành đối tượng datetime</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="dates.html#cb345-1" tabindex="-1"></a><span class="fu">dmy_hm</span>(<span class="st">&quot;01 January 2020 16:20&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 16:20:00 UTC&quot;</code></pre>
<p>Chuyển đổi datetime với giờ, phút và giây sang đối tượng datetime</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="dates.html#cb347-1" tabindex="-1"></a><span class="fu">mdy_hms</span>(<span class="st">&quot;01 January 2020, 16:20:40&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-20 16:20:40 UTC&quot;</code></pre>
<p>Bạn có thể cung cấp múi giờ nhưng nó bị bỏ qua. Xem các phần sau trong chương này về múi giờ.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="dates.html#cb349-1" tabindex="-1"></a><span class="fu">mdy_hms</span>(<span class="st">&quot;01 January 2020, 16:20:40 PST&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-20 16:20:40 UTC&quot;</code></pre>
<p>Khi làm việc với một data frame, các cột ngày và giờ có thể được kết hợp để tạo cột ngày-giờ bằng cách sử dụng hàm <code>str_glue()</code> từ package <strong>stringr</strong> và các hàm của package <strong>lubridate</strong>. Xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a> để biết thêm chi tiết về <strong>stringr</strong>.</p>
<p>Trong ví dụ này, bộ dữ liệu <code>linelist</code> có một cột ở định dạng “giờ:phút”. Để chuyển đổi thành ngày giờ, chúng tôi làm theo một số bước:</p>
<ol style="list-style-type: decimal">
<li>Tạo một cột thời gian nhập viện “sạch” với các giá trị bị thiếu được điền bằng trung vị cột. Chúng ta làm điều này bởi vì <strong>lubridate</strong> sẽ không hoạt động trên các giá trị missing. Kết hợp nó với cột <code>date_hospitalisation</code>, sau đó sử dụng hàm <code>ymd_hm()</code> để chuyển đổi.</li>
</ol>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="dates.html#cb351-1" tabindex="-1"></a><span class="co"># packages</span></span>
<span id="cb351-2"><a href="dates.html#cb351-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, lubridate, stringr)</span>
<span id="cb351-3"><a href="dates.html#cb351-3" tabindex="-1"></a></span>
<span id="cb351-4"><a href="dates.html#cb351-4" tabindex="-1"></a><span class="co"># time_admission is a column in hours:minutes</span></span>
<span id="cb351-5"><a href="dates.html#cb351-5" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb351-6"><a href="dates.html#cb351-6" tabindex="-1"></a>  </span>
<span id="cb351-7"><a href="dates.html#cb351-7" tabindex="-1"></a>  <span class="co"># when time of admission is not given, assign the median admission time</span></span>
<span id="cb351-8"><a href="dates.html#cb351-8" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb351-9"><a href="dates.html#cb351-9" tabindex="-1"></a>    <span class="at">time_admission_clean =</span> <span class="fu">ifelse</span>(</span>
<span id="cb351-10"><a href="dates.html#cb351-10" tabindex="-1"></a>      <span class="fu">is.na</span>(time_admission),         <span class="co"># if time is missing</span></span>
<span id="cb351-11"><a href="dates.html#cb351-11" tabindex="-1"></a>      <span class="fu">median</span>(time_admission),        <span class="co"># assign the median</span></span>
<span id="cb351-12"><a href="dates.html#cb351-12" tabindex="-1"></a>      time_admission                 <span class="co"># if not missing keep as is</span></span>
<span id="cb351-13"><a href="dates.html#cb351-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb351-14"><a href="dates.html#cb351-14" tabindex="-1"></a>  </span>
<span id="cb351-15"><a href="dates.html#cb351-15" tabindex="-1"></a>    <span class="co"># use str_glue() to combine date and time columns to create one character column</span></span>
<span id="cb351-16"><a href="dates.html#cb351-16" tabindex="-1"></a>    <span class="co"># and then use ymd_hm() to convert it to datetime</span></span>
<span id="cb351-17"><a href="dates.html#cb351-17" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb351-18"><a href="dates.html#cb351-18" tabindex="-1"></a>    <span class="at">date_time_of_admission =</span> <span class="fu">str_glue</span>(<span class="st">&quot;{date_hospitalisation} {time_admission_clean}&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb351-19"><a href="dates.html#cb351-19" tabindex="-1"></a>      <span class="fu">ymd_hm</span>()</span>
<span id="cb351-20"><a href="dates.html#cb351-20" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="chỉ-chuyển-đổi-thời-gian" class="section level3 unnumbered">
<h3>Chỉ chuyển đổi thời gian</h3>
<p>Nếu dữ liệu của bạn chỉ chứa thời gian dạng ký tự (giờ và phút), bạn có thể chuyển đổi và thao tác chúng bằng cách sử dụng hàm <code>strptime()</code> từ <strong>base</strong> R. Ví dụ: để phân biệt sự khác biệt giữa hai loại thời gian này:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="dates.html#cb352-1" tabindex="-1"></a><span class="co"># raw character times</span></span>
<span id="cb352-2"><a href="dates.html#cb352-2" tabindex="-1"></a>time1 <span class="ot">&lt;-</span> <span class="st">&quot;13:45&quot;</span> </span>
<span id="cb352-3"><a href="dates.html#cb352-3" tabindex="-1"></a>time2 <span class="ot">&lt;-</span> <span class="st">&quot;15:20&quot;</span></span>
<span id="cb352-4"><a href="dates.html#cb352-4" tabindex="-1"></a></span>
<span id="cb352-5"><a href="dates.html#cb352-5" tabindex="-1"></a><span class="co"># Times converted to a datetime class</span></span>
<span id="cb352-6"><a href="dates.html#cb352-6" tabindex="-1"></a>time1_clean <span class="ot">&lt;-</span> <span class="fu">strptime</span>(time1, <span class="at">format =</span> <span class="st">&quot;%H:%M&quot;</span>)</span>
<span id="cb352-7"><a href="dates.html#cb352-7" tabindex="-1"></a>time2_clean <span class="ot">&lt;-</span> <span class="fu">strptime</span>(time2, <span class="at">format =</span> <span class="st">&quot;%H:%M&quot;</span>)</span>
<span id="cb352-8"><a href="dates.html#cb352-8" tabindex="-1"></a></span>
<span id="cb352-9"><a href="dates.html#cb352-9" tabindex="-1"></a><span class="co"># Difference is of class &quot;difftime&quot; by default, here converted to numeric hours </span></span>
<span id="cb352-10"><a href="dates.html#cb352-10" tabindex="-1"></a><span class="fu">as.numeric</span>(time2_clean <span class="sc">-</span> time1_clean)   <span class="co"># difference in hours</span></span></code></pre></div>
<pre><code>## [1] 1.583333</code></pre>
<p>Tuy nhiên, lưu ý rằng nếu không có giá trị ngày được cung cấp, phần mềm sẽ giả định là ngày hôm nay. Để kết hợp chuỗi ngày và giờ với nhau, hãy thử cách sử dụng <strong>stringr</strong> đã được nói ở phần bên trên. Đọc thêm về <code>strptime()</code> <a href="https://rdrr.io/r/base/strptime.html">tại đây</a>.</p>
<p>Để chuyển đổi các số có một chữ số thành hai chữ số (ví dụ: để “độn thêm” giờ hoặc phút với các số 0 ở đầu để đạt được 2 chữ số), hãy xem phần <a href="characters-strings.html#str_pad">“Độ dài chuỗi ký tự” trong chương Ký tự và chuỗi</a>.</p>
</div>
<div id="thời-gian-chính-xác" class="section level3 unnumbered">
<h3>Thời gian chính xác</h3>
<p>Bạn có thể trích xuất các phần tử của thời gian với các hàm <code>hour()</code>, <code>minute()</code>, hoặc <code>second()</code> từ <strong>lubridate</strong>.</p>
<p>Đây là một ví dụ về trích xuất giờ và sau đó phân loại theo từng phần trong ngày. Chúng ta bắt đầu với cột <code>time_admission</code>, có kiểu ký tự ở định dạng “HH:MM”. Đầu tiên, hàm <code>strptime()</code> được sử dụng như mô tả ở trên để chuyển đổi các ký tự thành kiểu ngày giờ. Sau đó, giờ được trích xuất với hàm <code>hour()</code>, trả về một số từ 0-24. Cuối cùng, cột <code>time_period</code> được tạo bằng cách sử dụng logic với hàm <code>case_when()</code> để phân loại các dòng thành các buổi Sáng / Chiều / Tối / Đêm dựa trên giờ được nhập liệu.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="dates.html#cb354-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb354-2"><a href="dates.html#cb354-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hour_admit =</span> <span class="fu">hour</span>(<span class="fu">strptime</span>(time_admission, <span class="at">format =</span> <span class="st">&quot;%H:%M&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb354-3"><a href="dates.html#cb354-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time_period =</span> <span class="fu">case_when</span>(</span>
<span id="cb354-4"><a href="dates.html#cb354-4" tabindex="-1"></a>    hour_admit <span class="sc">&gt;</span> <span class="dv">06</span> <span class="sc">&amp;</span> hour_admit <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">&quot;Morning&quot;</span>,</span>
<span id="cb354-5"><a href="dates.html#cb354-5" tabindex="-1"></a>    hour_admit <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;</span> hour_admit <span class="sc">&lt;</span> <span class="dv">17</span> <span class="sc">~</span> <span class="st">&quot;Afternoon&quot;</span>,</span>
<span id="cb354-6"><a href="dates.html#cb354-6" tabindex="-1"></a>    hour_admit <span class="sc">&gt;=</span> <span class="dv">17</span> <span class="sc">&amp;</span> hour_admit <span class="sc">&lt;</span> <span class="dv">21</span> <span class="sc">~</span> <span class="st">&quot;Evening&quot;</span>,</span>
<span id="cb354-7"><a href="dates.html#cb354-7" tabindex="-1"></a>    hour_admit <span class="sc">&gt;=</span><span class="dv">21</span> <span class="sc">|</span> hour_admit <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">&quot;Night&quot;</span>))</span></code></pre></div>
<p>Để tìm hiểu thêm về hàm <code>case_when()</code>, hãy xem chương <a href="cleaning.html#cleaning">Làm sạch số liệu và các hàm quan trọng</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="làm-việc-với-ngày" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Làm việc với ngày</h2>
<p><code>lubridate</code> cũng có thể được sử dụng cho nhiều chức năng khác, chẳng hạn như <strong>trích xuất các phần tử của ngày/ngày-giờ</strong>, <strong>tính toán ngày dạng số học</strong>, hoặc <strong>tính toán khoảng cách giữa ngày với ngày</strong></p>
<p>Ở đây chúng tôi tạo ra một ngày mẫu để sử dụng cho các ví dụ:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="dates.html#cb355-1" tabindex="-1"></a><span class="co"># create object of class Date</span></span>
<span id="cb355-2"><a href="dates.html#cb355-2" tabindex="-1"></a>example_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020-03-01&quot;</span>)</span></code></pre></div>
<div id="trích-xuất-các-cấu-phần-của-ngày" class="section level3 unnumbered">
<h3>Trích xuất các cấu phần của ngày</h3>
<p>Bạn có thể trích xuất các cấu phần phổ biến như tháng, ngày, ngày trong tuần:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="dates.html#cb356-1" tabindex="-1"></a><span class="fu">month</span>(example_date)  <span class="co"># month number</span></span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="dates.html#cb358-1" tabindex="-1"></a><span class="fu">day</span>(example_date)    <span class="co"># day (number) of the month</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="dates.html#cb360-1" tabindex="-1"></a><span class="fu">wday</span>(example_date)   <span class="co"># day number of the week (1-7)</span></span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Bạn cũng có thể trích xuất các cấu phần thời gian từ một đối tượng hoặc cột có kiểu <code>datetime</code>. Điều này có thể hữu ích nếu bạn muốn xem phân phối của thời gian nhập viện.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="dates.html#cb362-1" tabindex="-1"></a>example_datetime <span class="ot">&lt;-</span> <span class="fu">ymd_hm</span>(<span class="st">&quot;2020-03-01 14:45&quot;</span>)</span>
<span id="cb362-2"><a href="dates.html#cb362-2" tabindex="-1"></a></span>
<span id="cb362-3"><a href="dates.html#cb362-3" tabindex="-1"></a><span class="fu">hour</span>(example_datetime)     <span class="co"># extract hour</span></span>
<span id="cb362-4"><a href="dates.html#cb362-4" tabindex="-1"></a><span class="fu">minute</span>(example_datetime)   <span class="co"># extract minute</span></span>
<span id="cb362-5"><a href="dates.html#cb362-5" tabindex="-1"></a><span class="fu">second</span>(example_datetime)   <span class="co"># extract second</span></span></code></pre></div>
<p>Có một số tùy chọn để trích xuất tuần. Xem thêm ở mục tuần Dịch tễ học bên dưới.</p>
<p>Lưu ý rằng nếu bạn đang tìm cách <em>hiển thị</em> ngày theo một cách nhất định (ví dụ: “Jan 2020” hoặc “Thursday 20 March” hoặc “Week 20, 1977”), bạn có thể thực hiện điều này linh hoạt hơn như được mô tả trong mục Hiển thị ngày.</p>
</div>
<div id="tính-toán-ngày" class="section level3 unnumbered">
<h3>Tính toán ngày</h3>
<p>Bạn có thể thêm số ngày hoặc tuần nhất định bằng cách sử dụng các hàm tương ứng từ package <strong>lubridate</strong>.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="dates.html#cb363-1" tabindex="-1"></a><span class="co"># add 3 days to this date</span></span>
<span id="cb363-2"><a href="dates.html#cb363-2" tabindex="-1"></a>example_date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-03-04&quot;</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="dates.html#cb365-1" tabindex="-1"></a><span class="co"># add 7 weeks and subtract two days from this date</span></span>
<span id="cb365-2"><a href="dates.html#cb365-2" tabindex="-1"></a>example_date <span class="sc">+</span> <span class="fu">weeks</span>(<span class="dv">7</span>) <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2020-04-17&quot;</code></pre>
</div>
<div id="khoảng-ngày" class="section level3 unnumbered">
<h3>Khoảng ngày</h3>
<p>Sự khác biệt giữa các ngày có thể được tính bằng:</p>
<ol style="list-style-type: decimal">
<li>Đảm bảo cả hai trường ngày đều thuộc phân lớp ngày tiêu chuẩn<br />
</li>
<li>Sử dụng phép trừ để trả về khoảng chênh lệch “difftime” giữa hai ngày<br />
</li>
<li>Nếu cần thiết, hãy chuyển đổi kết quả thành phân lớp dạng số để thực hiện các phép tính toán học tiếp theo</li>
</ol>
<p>Dưới đây là khoảng thời gian giữa hai ngày được tính toán và hiển thị. Bạn có thể tìm các khoảng thời gian bằng cách sử dụng ký hiệu trừ “minus” trên các giá trị dạng Ngày tiêu chuẩn. Tuy nhiên, lưu ý rằng phân lớp của giá trị trả về là “difftime” như được hiển thị bên dưới và phải được chuyển đổi thành dạng số.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="dates.html#cb367-1" tabindex="-1"></a><span class="co"># find the interval between this date and Feb 20 2020 </span></span>
<span id="cb367-2"><a href="dates.html#cb367-2" tabindex="-1"></a>output <span class="ot">&lt;-</span> example_date <span class="sc">-</span> <span class="fu">ymd</span>(<span class="st">&quot;2020-02-20&quot;</span>)</span>
<span id="cb367-3"><a href="dates.html#cb367-3" tabindex="-1"></a>output    <span class="co"># print</span></span></code></pre></div>
<pre><code>## Time difference of 10 days</code></pre>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="dates.html#cb369-1" tabindex="-1"></a><span class="fu">class</span>(output)</span></code></pre></div>
<pre><code>## [1] &quot;difftime&quot;</code></pre>
<p>Để thực hiện các thao tác tiếp theo trên “difftime”, hãy chuyển nó thành dạng số với hàm <code>as.numeric()</code>.</p>
<p>Tất cả điều này có thể được kết hợp với nhau để xử lý dữ liệu - ví dụ:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="dates.html#cb371-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(lubridate, tidyverse)   <span class="co"># load packages</span></span>
<span id="cb371-2"><a href="dates.html#cb371-2" tabindex="-1"></a></span>
<span id="cb371-3"><a href="dates.html#cb371-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span></span>
<span id="cb371-4"><a href="dates.html#cb371-4" tabindex="-1"></a>  </span>
<span id="cb371-5"><a href="dates.html#cb371-5" tabindex="-1"></a>  <span class="co"># convert date of onset from character to date objects by specifying dmy format</span></span>
<span id="cb371-6"><a href="dates.html#cb371-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">dmy</span>(date_onset),</span>
<span id="cb371-7"><a href="dates.html#cb371-7" tabindex="-1"></a>         <span class="at">date_hospitalisation =</span> <span class="fu">dmy</span>(date_hospitalisation)) <span class="sc">%&gt;%</span></span>
<span id="cb371-8"><a href="dates.html#cb371-8" tabindex="-1"></a>  </span>
<span id="cb371-9"><a href="dates.html#cb371-9" tabindex="-1"></a>  <span class="co"># filter out all cases without onset in march</span></span>
<span id="cb371-10"><a href="dates.html#cb371-10" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">month</span>(date_onset) <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb371-11"><a href="dates.html#cb371-11" tabindex="-1"></a>    </span>
<span id="cb371-12"><a href="dates.html#cb371-12" tabindex="-1"></a>  <span class="co"># find the difference in days between onset and hospitalisation</span></span>
<span id="cb371-13"><a href="dates.html#cb371-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_onset_to_hosp =</span> date_hospitalisation <span class="sc">-</span> date_of_onset)</span></code></pre></div>
<p>Trong bối cảnh của bộ dữ liệu, nếu thiếu một trong hai giá trị ngày ở trên, thì thao tác này sẽ không thực hiện thành công. Điều này sẽ tạo ra một kết quả là <code>NA</code> thay vì là một giá trị số. Khi sử dụng các cột này để tính toán, hãy chắc chắn rằng bạn thiết lập đối số <code>na.rm =</code> là <code>TRUE</code>. Ví dụ:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="dates.html#cb372-1" tabindex="-1"></a><span class="co"># calculate the median number of days to hospitalisation for all cases where data are available</span></span>
<span id="cb372-2"><a href="dates.html#cb372-2" tabindex="-1"></a><span class="fu">median</span>(linelist_delay<span class="sc">$</span>days_onset_to_hosp, <span class="at">na.rm =</span> T)</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="hiển-thị-ngày" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> Hiển thị ngày</h2>
<p>Một khi ngày tháng đã được định dạng đúng kiểu, bạn thường muốn chúng hiển thị theo nhiều cách khác nhau, ví dụ: hiển thị là “Monday 05 January” thay vì “2018-01-05”. Bạn cũng có thể muốn điều chỉnh hiển thị để nhóm các dòng theo các yếu tố ngày - ví dụ: nhóm theo tháng-năm.</p>
<div id="format" class="section level3 unnumbered">
<h3><code>format()</code></h3>
<p>Điều chỉnh hiển thị ngày với hàm <code>format()</code> từ <strong>base</strong> R. Hàm này chấp nhận một chuỗi ký tự (trong dấu ngoặc kép) xác định rõ định dạng đầu ra <em>mong muốn</em> bằng chữ viết tắt “%” strptime (cú pháp tương tự như được sử dụng trong hàm <code>as.Date()</code>). Dưới đây là các từ viết tắt phổ biến.</p>
<p>Lưu ý: việc sử dụng hàm <code>format()</code> sẽ chuyển đổi các giá trị thành kiểu ký tự, vì vậy điều này thường được sử dụng ở cuối phân tích hoặc chỉ cho mục đích hiển thị! Bạn có thể xem danh sách đầy đủ bằng cách chạy lệnh <code>?strptime</code>.</p>
<p>%d = Thứ tự ngày trong tháng (5, 17, 28, v.v.)<br />
%j = Thứ tự ngày trong năm (theo lịch Julian, ngày từ 001-366)<br />
%a = Ngày trong tuần viết tắt (Mon, Tue, Wed, v.v.)<br />
%A = Ngày trong tuần viết đầy đủ (Monday, Tuesday, v.v.)
%w = Thứ tự ngày trong tuần (0-6, Chủ Nhật là 0)<br />
%u = Thứ tự ngày trong tuần (1-7, Thứ hai là 1)<br />
%W = Thứ tự của tuần trong năm (00-53, Thứ Hai là đầu tuần)<br />
%U = Thứ tự của tuần trong năm (01-53, Chủ Nhật là ngày bắt đầu tuần)<br />
%m = Thứ tự của tháng trong năm (vd: 01, 02, 03, 04)<br />
%b = Tháng viết tắt (Jan, Feb, v.v.)<br />
%B = Tháng viết đầy đủ (January, February, v.v.)<br />
%y = năm 2 chữ số (vd: 89)<br />
%Y = năm 4 chữ số (vd: 1989)<br />
%H = giờ (đồng hồ 24h)<br />
%M = phút<br />
%S = giây
%z = offset from GMT<br />
%Z = Múi giờ (dạng ký tự)</p>
<p>Ví dụ về định dạng ngày hôm nay:</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="dates.html#cb373-1" tabindex="-1"></a><span class="co"># today&#39;s date, with formatting</span></span>
<span id="cb373-2"><a href="dates.html#cb373-2" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="at">format =</span> <span class="st">&quot;%d %B %Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;16 February 2024&quot;</code></pre>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="dates.html#cb375-1" tabindex="-1"></a><span class="co"># easy way to get full date and time (default formatting)</span></span>
<span id="cb375-2"><a href="dates.html#cb375-2" tabindex="-1"></a><span class="fu">date</span>()</span></code></pre></div>
<pre><code>## [1] &quot;Fri Feb 16 15:05:26 2024&quot;</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="dates.html#cb377-1" tabindex="-1"></a><span class="co"># formatted combined date, time, and time zone using str_glue() function</span></span>
<span id="cb377-2"><a href="dates.html#cb377-2" tabindex="-1"></a><span class="fu">str_glue</span>(<span class="st">&quot;{format(Sys.Date(), format = &#39;%A, %B %d %Y, %z  %Z, &#39;)}{format(Sys.time(), format = &#39;%H:%M:%S&#39;)}&quot;</span>)</span></code></pre></div>
<pre><code>## Friday, February 16 2024, +0000  UTC, 15:05:26</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="dates.html#cb379-1" tabindex="-1"></a><span class="co"># Using format to display weeks</span></span>
<span id="cb379-2"><a href="dates.html#cb379-2" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y Week %W&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2024 Week 07&quot;</code></pre>
<p>Lưu ý rằng nếu sử dụng hàm <code>str_glue()</code>, hãy lưu ý rằng các nội dung lẽ ra nên để trong dấu ngoặc kép thì bạn chỉ nên sử dụng dấu ngoặc đơn (như trên).</p>
</div>
<div id="tháng-năm" class="section level3 unnumbered">
<h3>Tháng-Năm</h3>
<p>Để chuyển đổi cột Ngày sang định dạng Tháng-năm, chúng tôi khuyên bạn nên sử dụng hàm <code>as.yearmon()</code> từ package <strong>zoo</strong>. Nó giúp chuyển đổi từ định dạng ngày thành định dạng “yearmon” và giữ lại thứ tự thích hợp. Ngược lại, sử dụng hàm <code>format(column, "%Y %B")</code> sẽ chuyển đổi giá trị thành kiểu Ký tự và sẽ sắp xếp các giá trị theo thứ tự bảng chữ cái (không chính xác).</p>
<p>Dưới đây, một cột <code>yearmonth</code> mới được tạo ra từ cột <code>date_onset</code>, sử dụng hàm <code>as.yearmon()</code>. Thứ tự mặc định (đúng) của các giá trị kết quả được hiển thị trong bảng.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="dates.html#cb381-1" tabindex="-1"></a><span class="co"># create new column </span></span>
<span id="cb381-2"><a href="dates.html#cb381-2" tabindex="-1"></a>test_zoo <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb381-3"><a href="dates.html#cb381-3" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">yearmonth =</span> zoo<span class="sc">::</span><span class="fu">as.yearmon</span>(date_onset))</span>
<span id="cb381-4"><a href="dates.html#cb381-4" tabindex="-1"></a></span>
<span id="cb381-5"><a href="dates.html#cb381-5" tabindex="-1"></a><span class="co"># print table</span></span>
<span id="cb381-6"><a href="dates.html#cb381-6" tabindex="-1"></a><span class="fu">table</span>(test_zoo<span class="sc">$</span>yearmon)</span></code></pre></div>
<pre><code>## 
## Apr 2014 May 2014 Jun 2014 Jul 2014 Aug 2014 Sep 2014 Oct 2014 Nov 2014 Dec 2014 
##        7       64      100      226      528     1070     1112      763      562 
## Jan 2015 Feb 2015 Mar 2015 Apr 2015 
##      431      306      277      186</code></pre>
<p>Ngược lại, bạn có thể thấy sử dụng hàm <code>format()</code> chỉ có thể giúp đạt được định dạng hiển thị mong muốn, nhưng sẽ không có thứ tự chính xác.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="dates.html#cb383-1" tabindex="-1"></a><span class="co"># create new column</span></span>
<span id="cb383-2"><a href="dates.html#cb383-2" tabindex="-1"></a>test_format <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb383-3"><a href="dates.html#cb383-3" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">yearmonth =</span> <span class="fu">format</span>(date_onset, <span class="st">&quot;%b %Y&quot;</span>))</span>
<span id="cb383-4"><a href="dates.html#cb383-4" tabindex="-1"></a></span>
<span id="cb383-5"><a href="dates.html#cb383-5" tabindex="-1"></a><span class="co"># print table</span></span>
<span id="cb383-6"><a href="dates.html#cb383-6" tabindex="-1"></a><span class="fu">table</span>(test_format<span class="sc">$</span>yearmon)</span></code></pre></div>
<pre><code>## 
## Apr 2014 Apr 2015 Aug 2014 Dec 2014 Feb 2015 Jan 2015 Jul 2014 Jun 2014 Mar 2015 
##        7      186      528      562      306      431      226      100      277 
## May 2014 Nov 2014 Oct 2014 Sep 2014 
##       64      763     1112     1070</code></pre>
<p>Lưu ý: nếu bạn đang làm việc với hàm <code>ggplot()</code> và chỉ muốn điều chỉnh chỉ <em>hiển thị</em> ngày, bạn chỉ cần cung cấp định dạng strptime là đủ tới đối số <code>date_labels =</code> của hàm <code>scale_x_date()</code> - bạn có thể sử dụng <code>"%b %Y"</code> hoặc <code>"%Y %b"</code>. Xem thêm chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a>.</p>
<p>Package <strong>zoo</strong> cũng cung cấp hàm <code>as.yearqtr()</code>, và bạn có thể sử dụng hàm <code>scale_x_yearmon()</code> khi sử dụng hàm <code>ggplot()</code>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="dates_epi_wks" class="section level2" number="9.9">
<h2><span class="header-section-number">9.9</span> Tuần dịch tễ học</h2>
<div id="lubridate-1" class="section level3 unnumbered">
<h3><strong>lubridate</strong></h3>
<p>Xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a> để biết thêm các ví dụ mở rộng về nhóm dữ liệu theo ngày. Dưới đây chúng tôi mô tả ngắn gọn cách nhóm dữ liệu theo tuần.</p>
<p>Thông thường, chúng tôi khuyên bạn nên sử dụng hàm <code>floor_date()</code> từ package <strong>lubridate</strong>, với đối số <code>unit = "week"</code>. Điều này làm tròn ngày cần xử lý thành ngày “bắt đầu” của tuần, như được xác định bởi đối số <code>week_start =</code>. Ngày bắt đầu của tuần mặc định là 1 (đối với Thứ Hai) nhưng bạn có thể chỉ định bất kỳ ngày nào trong tuần làm ngày bắt đầu (ví dụ: 7 đối với Chủ Nhật). Hàm <code>floor_date()</code> rất linh hoạt và có thể sử dụng để làm tròn xuống các đơn vị thời gian khác bằng cách thiết lập đối số <code>unit =</code> bằng “giây”, “phút”, “giờ”, “ngày”, “tháng”, hoặc “năm”.</p>
<p>Giá trị trả về là ngày bắt đầu trong tuần, với kiểu dữ liệu Ngày. Kiểu dữ liệu này rất hữu ích khi vẽ biểu đồ, vì nó sẽ dễ dàng sử dụng và sắp xếp chính xác trong hàm <code>ggplot()</code>.</p>
<p>Nếu bạn chỉ quan tâm đến việc điều chỉnh ngày để <em>hiển thị</em> theo tuần trong biểu đồ, hãy xem mục Hiển thị ngày trong chương này. Ví dụ: khi vẽ đồ thị một đường cong dịch tễ, bạn có thể định dạng hiển thị ngày bằng cách sử dụng cú pháp strptime “%”. Ví dụ, sử dụng “%Y-%W” hoặc “%Y-%U” để trả về giá trị năm và số tuần (tương ứng với bắt đầu tuần vào ngày thứ Hai hoặc Chủ nhật).</p>
</div>
<div id="đếm-theo-tuần" class="section level3 unnumbered">
<h3>Đếm theo tuần</h3>
<p>Xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a> để được giải thích kỹ hơn về cách nhóm dữ liệu với hàm <code>count()</code>, <code>group_by()</code>, và <code>summarise()</code>. Dưới đây là một ví dụ ngắn gọn.</p>
<ol style="list-style-type: decimal">
<li>Tạo cột ‘tuần’ mới với hàm <code>mutate()</code>, sử dụng hàm <code>floor_date()</code> với đối số <code>unit = "week"</code><br />
</li>
<li>Đếm số lượng dòng (quan sát) mỗi tuần với hàm <code>count()</code>; lọc ra bất kỳ trường hợp nào bị thiếu ngày<br />
</li>
<li>Kết thúc với hàm <code>complete()</code> từ package <strong>tidyr</strong> để đảm bảo rằng <em>tất cả</em> các tuần đều xuất hiện trong dữ liệu - ngay cả những tuần không có dòng/ quan sát nào. Theo mặc định, giá trị đếm cho bất kỳ hàng “mới” nào sẽ là NA, nhưng bạn có thể đặt chúng bằng 0 với đối số <code>fill =</code>, mà điều này kỳ vọng cho một danh sách tên (bên dưới, <code>n</code> là tên của cột đếm).</li>
</ol>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="dates.html#cb385-1" tabindex="-1"></a><span class="co"># Make aggregated dataset of weekly case counts</span></span>
<span id="cb385-2"><a href="dates.html#cb385-2" tabindex="-1"></a>weekly_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb385-3"><a href="dates.html#cb385-3" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span>             <span class="co"># remove cases missing onset date</span></span>
<span id="cb385-4"><a href="dates.html#cb385-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weekly_cases =</span> <span class="fu">floor_date</span>(   <span class="co"># make new column, week of onset</span></span>
<span id="cb385-5"><a href="dates.html#cb385-5" tabindex="-1"></a>    date_onset,</span>
<span id="cb385-6"><a href="dates.html#cb385-6" tabindex="-1"></a>    <span class="at">unit =</span> <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span>            </span>
<span id="cb385-7"><a href="dates.html#cb385-7" tabindex="-1"></a>  <span class="fu">count</span>(weekly_cases) <span class="sc">%&gt;%</span>           <span class="co"># group data by week and count rows per group (creates column &#39;n&#39;)</span></span>
<span id="cb385-8"><a href="dates.html#cb385-8" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">complete</span>(                  <span class="co"># ensure all weeks are present, even those with no cases reported</span></span>
<span id="cb385-9"><a href="dates.html#cb385-9" tabindex="-1"></a>    <span class="at">weekly_cases =</span> <span class="fu">seq.Date</span>(          <span class="co"># re-define the &quot;weekly_cases&quot; column as a complete sequence,</span></span>
<span id="cb385-10"><a href="dates.html#cb385-10" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(weekly_cases),       <span class="co"># from the minimum date</span></span>
<span id="cb385-11"><a href="dates.html#cb385-11" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">max</span>(weekly_cases),         <span class="co"># to the maxiumum date</span></span>
<span id="cb385-12"><a href="dates.html#cb385-12" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;week&quot;</span>),                   <span class="co"># by weeks</span></span>
<span id="cb385-13"><a href="dates.html#cb385-13" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))             <span class="co"># fill-in NAs in the n counts column with 0</span></span></code></pre></div>
<p>Đây là các hàng đầu tiên của kết quả bộ dữ liệu:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-976f7d6c4e9a19f1eec5" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-976f7d6c4e9a19f1eec5">{"x":{"filter":"none","vertical":false,"data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17"],[1,1,4,4,12,14,14,21,21,18,30,23,31,35,55,58,80,86,114,122]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>weekly_cases<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1},{"name":"weekly_cases","targets":0},{"name":"n","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="các-thay-thế-cho-tuần-dịch-tễ-học" class="section level3 unnumbered">
<h3>Các thay thế cho tuần dịch tễ học</h3>
<p>Lưu ý là package <strong>lubridate</strong> cũng có các hàm <code>week()</code>, <code>epiweek()</code>, và <code>isoweek()</code>, mỗi hàm có ngày bắt đầu khác nhau một chút và các sắc thái khác nhau. Mặc dù nói chung, hàm <code>floor_date()</code> là tất cả những gì bạn cần. Đọc thêm về các hàm này bằng cách gõ <code>?week</code> ở cửa sổ console hoặc đọc tài liệu <a href="https://www.rdocumentation.org/packages/lubridate/versions/1.7.4/topics/week">tại đây</a>.</p>
<p>Bạn có thể cân nhắc sử dụng package <strong>aweek</strong> để thiết lập tuần dịch tễ học. Bạn có thể đọc thêm về nó <a href="https://www.repidemicsconsortium.org/aweek/">ở trang web của RECON</a>. Nó có các hàm <code>date2week()</code> và <code>week2date()</code> trong đó bạn có thể đặt ngày bắt đầu tuần với <code>week_start = "Monday"</code>. Package này là dễ sử dụng nhất nếu bạn muốn hiển thị “tuần” theo kiểu đầu ra (vd: “2020-W12”). Một ưu điểm khác của <strong>aweek</strong> là khi áp dụng hàm <code>date2week()</code> cho cột ngày, cột trả về (định dạng tuần) sẽ tự động thuộc kiểu Factor và bao gồm các cấp độ cho tất cả các tuần trong khoảng thời gian (điều này tránh thêm bước <code>complete()</code> được mô tả ở trên). Tuy nhiên, <strong>aweek</strong> không có chức năng làm tròn ngày thành các đơn vị thời gian khác như tháng, năm, v.v.</p>
<p>Một giải pháp thay thế khác cho chuỗi thời gian cũng hoạt động tốt để hiển thị định dạng “tuần” (“2020 W12”) là hàm <code>yearweek()</code> từ package <strong>tsibble</strong>, như được minh họa trong chương <a href="data-used.html#data_outbreak">Chuỗi thời gian và phát hiện ổ dịch</a>.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="chuyển-đổi-múi-ngày-giờ" class="section level2" number="9.10">
<h2><span class="header-section-number">9.10</span> Chuyển đổi múi ngày giờ</h2>
<p>Khi dữ liệu hiển thị ở các múi giờ khác nhau, điều quan trọng là phải chuẩn hóa dữ liệu này thành một múi giờ thống nhất. Điều này có thể gây ra một thách thức lớn hơn nữa, vì thành phần múi giờ của dữ liệu phải được mã hóa theo cách thủ công trong hầu hết các trường hợp.</p>
<p>Trong R, mỗi đối tượng <em>datetime</em> có một cấu phần múi giờ. Mặc định, tất cả các đối tượng datetime sẽ mang múi giờ địa phương của máy tính đang sử dụng - điều này thường đặc trưng cho một <em>vị trí</em> chứ không phải tự đặt tên cho múi giờ đó, vì múi giờ thường sẽ thay đổi ở các vị trí phụ thuộc vào thời gian chiếu sáng. Không thể bù trừ chính xác cho các múi giờ mà không có cấu phần thời gian trong biến ngày, vì mốc trong cột ngày đại diện không thể được quy cho một thời gian cụ thể và do đó không thể tính toán hợp lý sự chuyển đổi thời gian bằng giờ</p>
<p>Để xử lý múi giờ, có một số hàm trợ giúp trong lubridate có thể được sử dụng để thay đổi múi giờ của đối tượng datetime từ múi giờ địa phương sang các múi giờ khác. Múi giờ được đặt bằng cách gán múi giờ cơ sở dữ liệu tz hợp lệ cho đối tượng datetime. Bạn có thể tìm thấy danh sách những thứ này tại đây - nếu vị trí bạn đang sử dụng dữ liệu không có trong danh sách này, các múi giờ của thành phố lớn lân cận có thể được sử dụng thay thế.</p>
<p><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" class="uri">https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</a></p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="dates.html#cb386-1" tabindex="-1"></a><span class="co"># assign the current time to a column</span></span>
<span id="cb386-2"><a href="dates.html#cb386-2" tabindex="-1"></a>time_now <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb386-3"><a href="dates.html#cb386-3" tabindex="-1"></a>time_now</span></code></pre></div>
<pre><code>## [1] &quot;2024-02-16 15:05:26 CET&quot;</code></pre>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="dates.html#cb388-1" tabindex="-1"></a><span class="co"># use with_tz() to assign a new timezone to the column, while CHANGING the clock time</span></span>
<span id="cb388-2"><a href="dates.html#cb388-2" tabindex="-1"></a>time_london_real <span class="ot">&lt;-</span> <span class="fu">with_tz</span>(time_now, <span class="st">&quot;Europe/London&quot;</span>)</span>
<span id="cb388-3"><a href="dates.html#cb388-3" tabindex="-1"></a></span>
<span id="cb388-4"><a href="dates.html#cb388-4" tabindex="-1"></a><span class="co"># use force_tz() to assign a new timezone to the column, while KEEPING the clock time</span></span>
<span id="cb388-5"><a href="dates.html#cb388-5" tabindex="-1"></a>time_london_local <span class="ot">&lt;-</span> <span class="fu">force_tz</span>(time_now, <span class="st">&quot;Europe/London&quot;</span>)</span>
<span id="cb388-6"><a href="dates.html#cb388-6" tabindex="-1"></a></span>
<span id="cb388-7"><a href="dates.html#cb388-7" tabindex="-1"></a></span>
<span id="cb388-8"><a href="dates.html#cb388-8" tabindex="-1"></a><span class="co"># note that as long as the computer that was used to run this code is NOT set to London time,</span></span>
<span id="cb388-9"><a href="dates.html#cb388-9" tabindex="-1"></a><span class="co"># there will be a difference in the times </span></span>
<span id="cb388-10"><a href="dates.html#cb388-10" tabindex="-1"></a><span class="co"># (the number of hours difference from the computers time zone to london)</span></span>
<span id="cb388-11"><a href="dates.html#cb388-11" tabindex="-1"></a>time_london_real <span class="sc">-</span> time_london_local</span></code></pre></div>
<pre><code>## Time difference of -1 hours</code></pre>
<p>Điều này có vẻ trừu tượng và thường không cần thiết nếu người dùng không làm việc trên các múi giờ.</p>
<!-- ======================================================= -->
</div>
<div id="phép-toán-về-khoảng-thời-gian" class="section level2" number="9.11">
<h2><span class="header-section-number">9.11</span> Phép toán về khoảng thời gian</h2>
<p><code>lead()</code> và <code>lag()</code> là các hàm thuộc package <strong>dplyr</strong> giúp tìm các giá trị trước đó (lagged) hoặc tiếp theo (leading) trong một vectơ - thường là vectơ số hoặc ngày. Điều này rất hữu ích khi thực hiện các phép tính về sự thay đổi / chênh lệch giữa các đơn vị thời gian.</p>
<p>Giả sử bạn muốn tính toán sự khác biệt trong trường hợp giữa tuần hiện tại và tuần trước đó. Dữ liệu ban đầu được cung cấp theo số lượng hàng tuần như dưới đây.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-115253ffc7f31a7a11cd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-115253ffc7f31a7a11cd">{"x":{"filter":"none","vertical":false,"data":[["2019-06-23","2019-06-30","2019-07-07","2019-07-14","2019-07-21","2019-07-28","2019-08-04","2019-08-11","2019-08-18","2019-08-25","2019-09-01","2019-09-08","2019-09-15","2019-09-22","2019-09-29","2019-10-06","2019-10-13","2019-10-20","2019-10-27","2019-11-03","2019-11-10","2019-11-17","2019-11-24","2019-12-01","2019-12-08","2019-12-15","2019-12-22","2019-12-29"],[0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19,0]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week_start<\/th>\n      <th>cases_wk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1},{"name":"week_start","targets":0},{"name":"cases_wk","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><strong>Khi sử dụng hàm <code>lag()</code> hoặc <code>lead()</code>, thứ tự của các dòng trong khung dữ liệu là rất quan trọng! - chú ý xem ngày/số của bạn tăng dần hay giảm dần</strong></p>
<p>Đầu tiên, tạo một cột mới chứa giá trị của tuần trước đó (lagged).</p>
<ul>
<li>Kiểm soát số lượng đơn vị trước/sau với <code>n =</code> (phải là số nguyên không âm)<br />
</li>
<li>Sử dụng <code>default =</code> để xác định giá trị được đặt trong các dòng không tồn tại (vd: hàng đầu tiên không có giá trị lagged). Mặc định, nó là <code>NA</code>.<br />
</li>
<li>Sử dụng <code>order_by = TRUE</code> nếu các dòng không được sắp xếp theo cột tham chiếu</li>
</ul>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="dates.html#cb390-1" tabindex="-1"></a>counts <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb390-2"><a href="dates.html#cb390-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cases_prev_wk =</span> <span class="fu">lag</span>(cases_wk, <span class="at">n =</span> <span class="dv">1</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ceeecbdfe52b09c5b702" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ceeecbdfe52b09c5b702">{"x":{"filter":"none","vertical":false,"data":[["2019-06-23","2019-06-30","2019-07-07","2019-07-14","2019-07-21","2019-07-28","2019-08-04","2019-08-11","2019-08-18","2019-08-25","2019-09-01","2019-09-08","2019-09-15","2019-09-22","2019-09-29","2019-10-06","2019-10-13","2019-10-20","2019-10-27","2019-11-03","2019-11-10","2019-11-17","2019-11-24","2019-12-01","2019-12-08","2019-12-15","2019-12-22","2019-12-29"],[0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19,0],[null,0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week_start<\/th>\n      <th>cases_wk<\/th>\n      <th>cases_prev_wk<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"week_start","targets":0},{"name":"cases_wk","targets":1},{"name":"cases_prev_wk","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Tiếp theo, tạo một cột mới khác biệt với hai cột đang tham chiếu:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="dates.html#cb391-1" tabindex="-1"></a>counts <span class="ot">&lt;-</span> counts <span class="sc">%&gt;%</span> </span>
<span id="cb391-2"><a href="dates.html#cb391-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cases_prev_wk =</span> <span class="fu">lag</span>(cases_wk, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb391-3"><a href="dates.html#cb391-3" tabindex="-1"></a>         <span class="at">case_diff =</span> cases_wk <span class="sc">-</span> cases_prev_wk)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-90ddd24a7a52f578f914" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-90ddd24a7a52f578f914">{"x":{"filter":"none","vertical":false,"data":[["2019-06-23","2019-06-30","2019-07-07","2019-07-14","2019-07-21","2019-07-28","2019-08-04","2019-08-11","2019-08-18","2019-08-25","2019-09-01","2019-09-08","2019-09-15","2019-09-22","2019-09-29","2019-10-06","2019-10-13","2019-10-20","2019-10-27","2019-11-03","2019-11-10","2019-11-17","2019-11-24","2019-12-01","2019-12-08","2019-12-15","2019-12-22","2019-12-29"],[0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19,0],[null,0,25,59,90,65,79,41,47,31,32,28,28,76,41,70,90,124,278,371,329,177,69,77,97,100,39,19],[null,25,34,31,-25,14,-38,6,-16,1,-4,0,48,-35,29,20,34,154,93,-42,-152,-108,8,20,3,-61,-20,-19]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week_start<\/th>\n      <th>cases_wk<\/th>\n      <th>cases_prev_wk<\/th>\n      <th>case_diff<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"name":"week_start","targets":0},{"name":"cases_wk","targets":1},{"name":"cases_prev_wk","targets":2},{"name":"case_diff","targets":3}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Bạn có thể đọc thêm về hàm <code>lead()</code> và <code>lag()</code> trong tài liệu <a href="https://dplyr.tidyverse.org/reference/lead-lag.html">này</a> hoặc gõ <code>?lag</code> vào cửa sổ console.</p>
<!-- ======================================================= -->
</div>
<div id="nguồn-1" class="section level2" number="9.12">
<h2><span class="header-section-number">9.12</span> Nguồn</h2>
<p><strong>lubridate</strong> <a href="https://lubridate.tidyverse.org/">tidyverse page</a><br />
<strong>lubridate</strong> RStudio <a href="https://rawgit.com/rstudio/cheatsheets/master/lubridate.pdf">cheatsheet</a><br />
R for Data Science page on <a href="https://r4ds.had.co.nz/dates-and-times.html">dates and times</a><br />
<a href="https://www.statmethods.net/input/dates.html">Online tutorial</a>
<a href="https://www.r-bloggers.com/2013/08/date-formats-in-r/">Date formats</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
