<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>8 Làm sạch số liệu và các hàm quan trọng | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="8 Làm sạch số liệu và các hàm quan trọng | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Làm sạch số liệu và các hàm quan trọng | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="cleaning" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Làm sạch số liệu và các hàm quan trọng</h1>
<p><img src="images/cleaning.png" width="265" height="10%" style="display: block; margin: auto;" /></p>
<p>Chương này trình bày các bước phổ biến được sử dụng trong quá trình “làm sạch” bộ dữ liệu và cũng giải thích việc sử dụng các hàm quản lý dữ liệu thiết yếu trong R.</p>
<p>Để giải thích rõ hơn quá trình làm sạch dữ liệu, chương này bắt đầu từ cách nhập bộ dữ liệu thô có tên linelist và tiến hành từng bước trong quá trình làm sạch. Trong code R, quy trình này được biểu thị dưới dạng một chuỗi “pipe”, tham chiếu đến toán tử “pipe” <code>%&gt;%</code> để chuyển tiếp từ thao tác này sang thao tác tiếp theo trong cùng một bộ dữ liệu.</p>
<div id="các-hàm-quan-trọng" class="section level3 unnumbered">
<h3>Các hàm quan trọng</h3>
<p>Cuốn sách này nhấn mạnh việc sử dụng các hàm từ hệ sinh thái của package <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>. Các hàm thiết yếu trong R trình bày trong chương này được liệt kê dưới đây.</p>
<p>Nhiều hàm thuộc về package <a href="https://dplyr.tidyverse.org/"><strong>dplyr</strong></a>, mà cung cấp các hàm dạng “verb” để giải quyết các thách thức trong thao tác xử lý dữ liệu (tên package được viết đầy đủ là “data frame-<a href="https://www.thefreedictionary.com/plier#:~:text=also%20ply%C2%B7er%20(pl%C4%AB%E2%80%B2,holding%2C%20bending%2C%20or%20cutting.)%22">plier</a>. <strong>dplyr</strong> là một phần trong hệ sinh thái của package <strong>tidyverse</strong> (mà bao gồm các package khác như <strong>ggplot2</strong>, <strong>tidyr</strong>, <strong>stringr</strong>, <strong>tibble</strong>, <strong>purrr</strong>, <strong>magrittr</strong>, và <strong>forcats</strong>).</p>
<table style="width:99%;">
<colgroup>
<col width="37%" />
<col width="42%" />
<col width="18%" />
</colgroup>
<thead>
<tr class="header">
<th>Hàm</th>
<th>Chức năng</th>
<th>Package</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>%&gt;%</code></td>
<td>“pipe” (chuyển tiếp) dữ liệu từ một hàm sang hàm tiếp theo</td>
<td><strong>magrittr</strong></td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td>tạo, chuyển dạng, và định nghĩa lại cột</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td>giữ lại, xóa, chọn, hoặc đổi tên cột</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>rename()</code></td>
<td>đổi tên cột</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>clean_names()</code></td>
<td>chuẩn hóa cú pháp tên cột</td>
<td><strong>janitor</strong></td>
</tr>
<tr class="even">
<td><code>as.character()</code>, <code>as.numeric()</code>, <code>as.Date()</code>, etc.</td>
<td>chuyển đổi định dạng cột</td>
<td><strong>base</strong> R</td>
</tr>
<tr class="odd">
<td><code>across()</code></td>
<td>biến đổi đồng thời nhiều cột</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td>các hàm <strong>tidyselect</strong></td>
<td>sử dụng logic để chọn cột</td>
<td><strong>tidyselect</strong></td>
</tr>
<tr class="odd">
<td><code>filter()</code></td>
<td>giữ lại các dòng theo điều kiện</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>distinct()</code></td>
<td>lọc quan sát trùng</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>rowwise()</code></td>
<td>xử lý theo/trong mỗi dòng</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>add_row()</code></td>
<td>thêm dòng thủ công</td>
<td><strong>tibble</strong></td>
</tr>
<tr class="odd">
<td><code>arrange()</code></td>
<td>săp xếp dòng</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>recode()</code></td>
<td>recode lại giá trị trong cột</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="odd">
<td><code>case_when()</code></td>
<td>recode lại giá trị trong cột kèm các điều kiện phức tạp</td>
<td><strong>dplyr</strong></td>
</tr>
<tr class="even">
<td><code>replace_na()</code>, <code>na_if()</code>, <code>coalesce()</code></td>
<td>các hàm đặc biệt để recode</td>
<td><strong>tidyr</strong></td>
</tr>
<tr class="odd">
<td><code>age_categories()</code> and <code>cut()</code></td>
<td>tạo biến phân nhóm từ biến định lượng</td>
<td><strong>epikit</strong> và <strong>base</strong> R</td>
</tr>
<tr class="even">
<td><code>match_df()</code></td>
<td>recode/làm sạch giá trị sử dụng từ điển dữ liệu</td>
<td><strong>matchmaker</strong></td>
</tr>
<tr class="odd">
<td><code>which()</code></td>
<td>áp dụng các điều kiện logic; trả về các chỉ số</td>
<td><strong>base</strong> R</td>
</tr>
</tbody>
</table>
<p>Nếu bạn muốn xem các hàm này so sánh với các câu lệnh trong Stata hoặc SAS, hãy xem chương <a href="transition-to-R.html#transition-to-R">Chuyển đổi sang R</a>.</p>
<p>Bạn cũng có thể gặp một framework quản lý dữ liệu khác từ package <strong>data.table</strong> trong R với các toán tử như <code>:=</code> và thường xuyên sử dụng dấu ngoặc <code>[ ]</code>. Cách tiếp cận và cú pháp này được giải thích ngắn gọn trong chương <a href="data-table.html#data-table">Data Table</a>.</p>
</div>
<div id="thuật-ngữ" class="section level3 unnumbered">
<h3>Thuật ngữ</h3>
<p>Trong cuốn sách này, chúng tôi quy ước chung “cột” và “hàng” thay cho “biến” và “quan sát”. Như đã giải thích trong phần dẫn trên <a href="https://tidyr.tidyverse.org/articles/tidy-data.html">“dữ liệu gọn gàng - tidy data”</a>, hầu hết các bộ dữ liệu dịch tễ-thống kê đều có cấu trúc gồm các hàng, cột và giá trị.</p>
<p><em>Variables (biến)</em> chứa các giá trị đo lường cùng một thuộc tính cơ bản (như nhóm tuổi, kết quả hoặc ngày bắt đầu). <em>Observations (quan sát)</em> chứa tất cả các giá trị được đo trên cùng một đơn vị (ví dụ: một người, địa điểm hoặc mẫu phòng thí nghiệm). Vì vậy, những khía cạnh này có thể khó xác định một cách hữu hình hơn.</p>
<p>Trong bộ dữ liệu “tidy”, mỗi cột là một biến, mỗi hàng là một quan sát và mỗi ô là một giá trị duy nhất. Tuy nhiên, một số bộ dữ liệu bạn gặp phải sẽ không giống với mô tả này - bộ dữ liệu định dạng “wide (ngang)” có thể có một biến số được chia thành nhiều cột (xem ví dụ trong chương <a href="pivoting.html#pivoting">Xoay trục dữ liệu</a>). Tương tự như vậy, các quan sát có thể được chia thành nhiều hàng.</p>
<p>Cuốn sách này tập trung về quản lý và biến đổi dữ liệu, do đó, việc đề cập đến cấu trúc dữ liệu cụ thể của các hàng và cột sẽ thích hợp hơn là các quan sát và biến vốn khá trừu tượng. Các trường hợp ngoại lệ chủ yếu xảy ra trong các chương về phân tích dữ liệu, nơi bạn sẽ thấy nhiều tham chiếu hơn đến các biến và quan sát.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="quy-trình-làm-sạch" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Quy trình làm sạch</h2>
<p><strong>Chương này tiến hành các bước làm sạch điển hình, bằng cách thêm chúng tuần tự vào một chuỗi pipe.</strong></p>
<p>Trong phân tích dịch tễ học và xử lý dữ liệu, các bước làm sạch thường được thực hiện tuần tự, liên kết với nhau. Trong R, việc này thường được thực hiện dưới dạng một “pipeline - đường ống” làm sạch, trong đó <em>bộ dữ liệu thô được chuyển tiếp hoặc “dẫn” từ bước làm sạch này sang bước làm sạch khác</em>.</p>
<p>Các chuỗi như vậy sử dụng các hàm dạng “verb” trong package <strong>dplyr</strong> và toán tử pipe <code>%&gt;%</code> trong package <strong>magrittr</strong>. Chuỗi pipe bắt đầu từ dữ liệu “thô” (“linelist_raw.xlsx”) và kết thúc bằng bộ dữ liệu “sạch” trên R (<code>linelist</code>) có thể được sử dụng, lưu, xuất, v.v.</p>
<p>Trong quy trình làm sạch dữ liệu, thứ tự của các bước là quan trọng. Các bước làm sạch có thể bao gồm:</p>
<ul>
<li>Nhập dữ liệu</li>
<li>Làm sạch hoặc đổi tên cột</li>
<li>Loại bỏ trùng lặp</li>
<li>Tạo và chuyển đổi cột (ví dụ: mã hóa lại hoặc chuẩn hóa các giá trị)</li>
<li>Lọc hoặc thêm hàng</li>
</ul>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="gọi-package" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Gọi package</h2>
<p>Đoạn code này trình bày cách gọi các package cần thiết cho phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh đến hàm <code>p_load()</code> từ package <strong>pacman</strong>, cài đặt package nếu cần <em>và</em> gọi package ra để sử dụng. Bạn cũng có thể gọi các package đã cài đặt với hàm <code>library()</code> sẵn có trong <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để biết thêm thông tin về các package trong R.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="cleaning.html#cb179-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb179-2"><a href="cleaning.html#cb179-2" tabindex="-1"></a>  rio,        <span class="co"># importing data  </span></span>
<span id="cb179-3"><a href="cleaning.html#cb179-3" tabindex="-1"></a>  here,       <span class="co"># relative file pathways  </span></span>
<span id="cb179-4"><a href="cleaning.html#cb179-4" tabindex="-1"></a>  janitor,    <span class="co"># data cleaning and tables</span></span>
<span id="cb179-5"><a href="cleaning.html#cb179-5" tabindex="-1"></a>  lubridate,  <span class="co"># working with dates</span></span>
<span id="cb179-6"><a href="cleaning.html#cb179-6" tabindex="-1"></a>  epikit,     <span class="co"># age_categories() function</span></span>
<span id="cb179-7"><a href="cleaning.html#cb179-7" tabindex="-1"></a>  tidyverse   <span class="co"># data management and visualization</span></span>
<span id="cb179-8"><a href="cleaning.html#cb179-8" tabindex="-1"></a>)</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="nhập-dữ-liệu-1" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Nhập dữ liệu</h2>
<div id="nhập" class="section level3 unnumbered">
<h3>Nhập</h3>
<p>Ở đây, chúng ta sẽ nhập tệp tin Excel “thô” bằng cách sử dụng hàm <code>import()</code> từ package <strong>rio</strong>. Package <strong>rio</strong> có thể xử lý linh hoạt nhiều loại tệp tin (ví dụ: .xlsx, .csv, .tsv, .rds. Xem chương về <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết thêm thông tin và mẹo về các tình huống bất thường (ví dụ: loại bỏ hàng, thiết lập giá trị trống, nạp trang tính Google, v.v.).</p>
<p>Nếu bạn muốn hiểu rõ hơn, <a href='https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_raw.xlsx' class='download-button'>hãy tải xuống tệp dữ liệu linelist “thô”</a> (với file dạng .xlsx).</p>
<p>Nếu bộ dữ liệu của bạn quá lớn và mất nhiều thời gian để nhập, sẽ hữu ích khi bạn đặt lệnh nhập dữ liệu riêng biệt với chuỗi pipe và dữ liệu “thô” sẽ được lưu thành một tệp riêng biệt. Điều này cũng cho phép dễ dàng so sánh giữa phiên bản gốc và phiên bản đã làm sạch.</p>
<p>Dưới đây, chúng ta nạp một tệp Excel thô và lưu nó dưới dạng dataframe <code>linelist_raw</code>. Chúng tôi giả định rằng tệp này nằm trong thư mục làm việc của bạn hoặc thư mục gốc của dự án R và vì vậy không có thư mục con nào được chỉ định trong đường dẫn tệp.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="cleaning.html#cb180-1" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>)</span></code></pre></div>
<p>Bạn có thể xem 50 hàng đầu tiên của bộ dữ liệu bên dưới. Lưu ý: hàm <code>head(n)</code> trong <strong>base</strong> R cho phép bạn chỉ xem <code>n</code> hàng đầu tiên trong R console.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6a14f2e61b7b8374b6ef" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6a14f2e61b7b8374b6ef">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08T00:00:00Z",null,null,"2014-05-04T00:00:00Z","2014-05-18T00:00:00Z","2014-05-03T00:00:00Z","2014-05-22T00:00:00Z","2014-05-28T00:00:00Z",null,null,"2014-05-30T00:00:00Z","2014-05-28T00:00:00Z","2014-06-14T00:00:00Z","2014-06-07T00:00:00Z","2014-06-09T00:00:00Z",null,null,null,"2014-06-23T00:00:00Z","2014-06-18T00:00:00Z","2014-06-24T00:00:00Z",null,null,"2014-07-03T00:00:00Z",null,"2014-07-10T00:00:00Z","2014-06-14T00:00:00Z",null,"2014-06-18T00:00:00Z","2014-06-29T00:00:00Z","2014-07-02T00:00:00Z","2014-07-12T00:00:00Z","2014-07-12T00:00:00Z","2014-06-13T00:00:00Z","2014-07-15T00:00:00Z","2014-06-20T00:00:00Z",null,null,"2014-07-20T00:00:00Z",null,"2014-07-12T00:00:00Z","2014-07-19T00:00:00Z","2014-07-18T00:00:00Z","2014-07-18T00:00:00Z","2014-07-27T00:00:00Z",null,"2014-07-19T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],[null,"2014-05-18T00:00:00Z","2014-05-30T00:00:00Z",null,"2014-05-29T00:00:00Z","2014-05-24T00:00:00Z","2014-06-01T00:00:00Z","2014-06-07T00:00:00Z","2014-06-18T00:00:00Z","2014-06-09T00:00:00Z","2014-06-15T00:00:00Z",null,"2014-07-09T00:00:00Z",null,"2014-06-30T00:00:00Z","2014-07-11T00:00:00Z","2014-07-01T00:00:00Z","2014-06-25T00:00:00Z","2014-07-06T00:00:00Z","2014-07-02T00:00:00Z","2014-07-09T00:00:00Z","2014-07-07T00:00:00Z","2014-07-20T00:00:00Z",null,"2014-07-22T00:00:00Z","2014-07-16T00:00:00Z","2014-07-14T00:00:00Z","2014-07-20T00:00:00Z","2014-07-16T00:00:00Z","2014-07-19T00:00:00Z","2014-07-27T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-07-26T00:00:00Z","2014-08-14T00:00:00Z","2014-08-01T00:00:00Z","2014-07-23T00:00:00Z","2014-08-28T00:00:00Z","2014-07-28T00:00:00Z","2014-07-19T00:00:00Z",null,"2014-08-03T00:00:00Z",null,null,null,"2014-08-06T00:00:00Z","2014-08-21T00:00:00Z","2014-09-13T00:00:00Z","2014-08-04T00:00:00Z",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],["2","3","56","18","3","16","16","0","61","27","12","42","19","7","7","13","35","17","11","11","19","54","14","28","6","3","31","6","67","14","10","21","20","45","1","12","3","15","20","36","7","13","14","3","10","1","0","20","26","14"],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],["a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a","a"],["b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b","b"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>infection date<\/th>\n      <th>date onset<\/th>\n      <th>hosp date<\/th>\n      <th>date_of_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>row_num<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>merged_header<\/th>\n      <th>...28<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,15,16,17,18,24]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"infection date","targets":2},{"name":"date onset","targets":3},{"name":"hosp date","targets":4},{"name":"date_of_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"hospital","targets":8},{"name":"lon","targets":9},{"name":"lat","targets":10},{"name":"infector","targets":11},{"name":"source","targets":12},{"name":"age","targets":13},{"name":"age_unit","targets":14},{"name":"row_num","targets":15},{"name":"wt_kg","targets":16},{"name":"ht_cm","targets":17},{"name":"ct_blood","targets":18},{"name":"fever","targets":19},{"name":"chills","targets":20},{"name":"cough","targets":21},{"name":"aches","targets":22},{"name":"vomit","targets":23},{"name":"temp","targets":24},{"name":"time_admission","targets":25},{"name":"merged_header","targets":26},{"name":"...28","targets":27}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="đánh-giá" class="section level3 unnumbered">
<h3>Đánh giá</h3>
<p>Bạn có thể sử dụng hàm <code>skim()</code> từ package <strong>skimr</strong> để có cái nhìn tổng quan về toàn bộ bộ dữ liệu (xem chương <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a> để biết thêm thông tin). Các cột được tóm tắt theo phân lớp/định dạng như ký tự và số. Lưu ý: “POSIXct” là một loại phân lớp ngày thô (xem chương <a href="dates.html#dates">Làm việc với ngày tháng</a>.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="cleaning.html#cb181-1" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(linelist_raw)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-180">Table 8.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">linelist_raw</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">6611</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">28</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">17</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">8</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table style="width:100%;">
<colgroup>
<col width="20%" />
<col width="13%" />
<col width="19%" />
<col width="5%" />
<col width="5%" />
<col width="8%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">case_id</td>
<td align="right">137</td>
<td align="right">0.98</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">5888</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">date onset</td>
<td align="right">293</td>
<td align="right">0.96</td>
<td align="right">10</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">580</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">outcome</td>
<td align="right">1500</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">324</td>
<td align="right">0.95</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">hospital</td>
<td align="right">1512</td>
<td align="right">0.77</td>
<td align="right">5</td>
<td align="right">36</td>
<td align="right">0</td>
<td align="right">13</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">infector</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">6</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2697</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="right">2323</td>
<td align="right">0.65</td>
<td align="right">5</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">107</td>
<td align="right">0.98</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">75</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">age_unit</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">fever</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">chills</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">cough</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">aches</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vomit</td>
<td align="right">258</td>
<td align="right">0.96</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">time_admission</td>
<td align="right">844</td>
<td align="right">0.87</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1091</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">merged_header</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">…28</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<colgroup>
<col width="15%" />
<col width="10%" />
<col width="15%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">generation</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">16.60</td>
<td align="right">5.71</td>
<td align="right">0.00</td>
<td align="right">13.00</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">37.00</td>
</tr>
<tr class="even">
<td align="left">lon</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">-13.23</td>
<td align="right">0.02</td>
<td align="right">-13.27</td>
<td align="right">-13.25</td>
<td align="right">-13.23</td>
<td align="right">-13.22</td>
<td align="right">-13.21</td>
</tr>
<tr class="odd">
<td align="left">lat</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">8.47</td>
<td align="right">0.01</td>
<td align="right">8.45</td>
<td align="right">8.46</td>
<td align="right">8.47</td>
<td align="right">8.48</td>
<td align="right">8.49</td>
</tr>
<tr class="even">
<td align="left">row_num</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3240.91</td>
<td align="right">1857.83</td>
<td align="right">1.00</td>
<td align="right">1647.50</td>
<td align="right">3241.00</td>
<td align="right">4836.50</td>
<td align="right">6481.00</td>
</tr>
<tr class="odd">
<td align="left">wt_kg</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">52.69</td>
<td align="right">18.59</td>
<td align="right">-11.00</td>
<td align="right">41.00</td>
<td align="right">54.00</td>
<td align="right">66.00</td>
<td align="right">111.00</td>
</tr>
<tr class="even">
<td align="left">ht_cm</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">125.25</td>
<td align="right">49.57</td>
<td align="right">4.00</td>
<td align="right">91.00</td>
<td align="right">130.00</td>
<td align="right">159.00</td>
<td align="right">295.00</td>
</tr>
<tr class="odd">
<td align="left">ct_blood</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="right">21.26</td>
<td align="right">1.67</td>
<td align="right">16.00</td>
<td align="right">20.00</td>
<td align="right">22.00</td>
<td align="right">22.00</td>
<td align="right">26.00</td>
</tr>
<tr class="even">
<td align="left">temp</td>
<td align="right">158</td>
<td align="right">0.98</td>
<td align="right">38.60</td>
<td align="right">0.95</td>
<td align="right">35.20</td>
<td align="right">38.30</td>
<td align="right">38.80</td>
<td align="right">39.20</td>
<td align="right">40.80</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table>
<colgroup>
<col width="19%" />
<col width="12%" />
<col width="17%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">infection date</td>
<td align="right">2322</td>
<td align="right">0.65</td>
<td align="left">2012-04-09</td>
<td align="left">2015-04-27</td>
<td align="left">2014-10-04</td>
<td align="right">538</td>
</tr>
<tr class="even">
<td align="left">hosp date</td>
<td align="right">7</td>
<td align="right">1.00</td>
<td align="left">2012-04-20</td>
<td align="left">2015-04-30</td>
<td align="left">2014-10-15</td>
<td align="right">570</td>
</tr>
<tr class="odd">
<td align="left">date_of_outcome</td>
<td align="right">1068</td>
<td align="right">0.84</td>
<td align="left">2012-05-14</td>
<td align="left">2015-06-04</td>
<td align="left">2014-10-26</td>
<td align="right">575</td>
</tr>
</tbody>
</table>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="tên-cột" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Tên cột</h2>
<p>Trong R, <em>tên</em> cột là “tiêu đề” hoặc giá trị “trên đỉnh” của một cột. Chúng được sử dụng để tham chiếu đến các cột trong đoạn code và đóng vai trò như một nhãn mặc định trong các bảng biểu.</p>
<p>Các phần mềm thống kê khác như SAS và STATA sử dụng <em>“nhãn”</em> là tên cột phiên bản dài hơn khi in, cùng tồn tại song song với tên cột. Mặc dù R cung cấp tính năng thêm nhãn của cột vào dữ liệu, nhưng điều này hầu hết không được nhấn mạnh trong thực tế. Để đặt tên cột “dễ nhìn” cho các bảng biểu, người ta thường điều chỉnh hiển thị của chúng trong các lệnh vẽ biểu đồ để tạo ra kết quả (ví dụ: tiêu đề trục hoặc chú giải của một biểu đồ hoặc tiêu đề cột trong bảng - xem thêm <a href="#id_%20ggplot_tips_scales">mục scales trong chương Các tips với ggplot</a> và chương <a href="tables-presentation.html#tables-presentation">Trình bày bảng</a>). Nếu bạn muốn gán nhãn cột trong dữ liệu, hãy đọc thêm tài liệu trực tuyến <a href="https://cran.r-project.org/web/packages/expss/vignettes/labels-support.html">tại đây</a> và <a href="https%20:%20//cran.r-project.org/web/packages/labelt/vignettes/intro_labelling.html">tại đây</a>.</p>
<p>Vì tên cột trong R được sử dụng rất thường xuyên, vì vậy chúng phải có cú pháp “sạch”. Chúng tôi đề xuất những tiêu chí sau:</p>
<ul>
<li>Tên ngắn</li>
<li>Không có khoảng trắng (thay thế bằng dấu gạch dưới_)</li>
<li>Không có ký tự lạ (&amp;, #, &lt;, &gt;, …)</li>
<li>Thống nhất cách định danh (vd: toàn bộ tên cột ngày như <strong>date_</strong>onset, <strong>date_</strong>report, <strong>date_</strong>death…)</li>
</ul>
<p>Tên các cột trong <code>linelist_raw</code> được in bên dưới bằng cách sử dụng hàm <code>names()</code> từ <strong>base</strong> R. Ban đầu chúng ta có thể thấy rằng:</p>
<ul>
<li>Một số tên chứa khoảng trắng (vd: <code>infection date</code>)</li>
<li>Một số mẫu tên khác nhau được sử dụng cho biến ngày (<code>date onset</code> và <code>infection date</code>)</li>
<li>Phải có một <em>tiêu đề được hợp nhất</em> ở hai cột cuối cùng trong tệp .xlsx. Chúng tôi biết điều này vì tên của hai cột được hợp nhất (“merge_header”) được R gán cho cột đầu tiên và cột thứ hai được gán tên giữ chỗ “… 28” (vì lúc đó nó trống và là cột thứ 28).</li>
</ul>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="cleaning.html#cb182-1" tabindex="-1"></a><span class="fu">names</span>(linelist_raw)</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;         &quot;generation&quot;      &quot;infection date&quot;  &quot;date onset&quot;     
##  [5] &quot;hosp date&quot;       &quot;date_of_outcome&quot; &quot;outcome&quot;         &quot;gender&quot;         
##  [9] &quot;hospital&quot;        &quot;lon&quot;             &quot;lat&quot;             &quot;infector&quot;       
## [13] &quot;source&quot;          &quot;age&quot;             &quot;age_unit&quot;        &quot;row_num&quot;        
## [17] &quot;wt_kg&quot;           &quot;ht_cm&quot;           &quot;ct_blood&quot;        &quot;fever&quot;          
## [21] &quot;chills&quot;          &quot;cough&quot;           &quot;aches&quot;           &quot;vomit&quot;          
## [25] &quot;temp&quot;            &quot;time_admission&quot;  &quot;merged_header&quot;   &quot;...28&quot;</code></pre>
<p><span style="color: black;"><strong><em>CHÚ Ý:</em></strong> Để tham chiếu tên một cột có chứa khoảng trắng, hãy bao quanh tên cột bằng dấu huyền, ví dụ: linelist$<code>` '\x60infection date\x60'`</code>. Lưu ý là trên bàn phím, dấu huyền (`) được phân biệt với dấu ngoặc đơn (’).</span></p>
<div id="làm-sạch-tự-động" class="section level3 unnumbered">
<h3>Làm sạch tự động</h3>
<p>Hàm <code>clean_names()</code> từ package <strong>janitor</strong> chuẩn hóa tên cột và biến chúng thành duy nhất bằng cách thực hiện như sau:</p>
<ul>
<li>Chuyển đổi tất cả các tên cột thành chỉ bao gồm dấu gạch dưới, số và chữ cái</li>
<li>Các ký tự có dấu được chuyển ngữ sang dạng ASCII (ví dụ: o tiếng Đức với âm sắc trở thành “o”, “enye” tiếng Tây Ban Nha trở thành “n”)</li>
<li>Tùy chọn viết hoa cho tên cột mới có thể được chỉ định bằng cách sử dụng đối số <code>case =</code> (mặc định là “snake”, các lựa chọn thay thế bao gồm “sentence”, “title”, “small_camel”…)</li>
<li>Bạn có thể chỉ định các tên thay thế cụ thể bằng cách cung cấp một vectơ tới đố số <code>replace =</code> (ví dụ: <code>replace = c(onset = "date_of_onset")</code>)</li>
<li>Đây là một <a href="https://cran.r-project.org/web/packages/janitor/vignettes/janitor.html#cleaning">hướng dẫn</a> trực tuyến</li>
</ul>
<p>Sau đây, quy trình làm sạch bắt đầu bằng cách sử dụng hàm <code>clean_names()</code> trên bộ dữ liệu linelist thô.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="cleaning.html#cb184-1" tabindex="-1"></a><span class="co"># pipe the raw dataset through the function clean_names(), assign result as &quot;linelist&quot;  </span></span>
<span id="cb184-2"><a href="cleaning.html#cb184-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb184-3"><a href="cleaning.html#cb184-3" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb184-4"><a href="cleaning.html#cb184-4" tabindex="-1"></a></span>
<span id="cb184-5"><a href="cleaning.html#cb184-5" tabindex="-1"></a><span class="co"># see the new column names</span></span>
<span id="cb184-6"><a href="cleaning.html#cb184-6" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;         &quot;generation&quot;      &quot;infection_date&quot;  &quot;date_onset&quot;     
##  [5] &quot;hosp_date&quot;       &quot;date_of_outcome&quot; &quot;outcome&quot;         &quot;gender&quot;         
##  [9] &quot;hospital&quot;        &quot;lon&quot;             &quot;lat&quot;             &quot;infector&quot;       
## [13] &quot;source&quot;          &quot;age&quot;             &quot;age_unit&quot;        &quot;row_num&quot;        
## [17] &quot;wt_kg&quot;           &quot;ht_cm&quot;           &quot;ct_blood&quot;        &quot;fever&quot;          
## [21] &quot;chills&quot;          &quot;cough&quot;           &quot;aches&quot;           &quot;vomit&quot;          
## [25] &quot;temp&quot;            &quot;time_admission&quot;  &quot;merged_header&quot;   &quot;x28&quot;</code></pre>
<p><span style="color: black;"><strong><em>LƯU Ý</em></strong>: Tên cột cuối cùng “… 28” đã được đổi thành “x28”.</span></p>
</div>
<div id="làm-sạch-tên-cột-thủ-công" class="section level3 unnumbered">
<h3>Làm sạch tên cột thủ công</h3>
<p>Việc đặt tên lại các cột theo cách thủ công thường là cần thiết, ngay cả sau bước chuẩn hóa ở trên. Dưới đây, việc đổi tên được thực hiện bằng cách sử dụng hàm <code>rename()</code> từ package <strong>dplyr</strong>, như một phần của quy trình. <code>rename()</code> sử dụng cú pháp <code>NEW = OLD</code> - tên cột mới được đặt trước tên cột cũ.</p>
<p>Dưới đây, một lệnh đổi tên được thêm vào quy trình làm sạch. Các khoảng trắng đã được thêm vào một cách chọn lọc để căn chỉnh code dễ đọc hơn.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="cleaning.html#cb186-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb186-2"><a href="cleaning.html#cb186-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb186-3"><a href="cleaning.html#cb186-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb186-4"><a href="cleaning.html#cb186-4" tabindex="-1"></a>    </span>
<span id="cb186-5"><a href="cleaning.html#cb186-5" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb186-6"><a href="cleaning.html#cb186-6" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb186-7"><a href="cleaning.html#cb186-7" tabindex="-1"></a>    </span>
<span id="cb186-8"><a href="cleaning.html#cb186-8" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb186-9"><a href="cleaning.html#cb186-9" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb186-10"><a href="cleaning.html#cb186-10" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb186-11"><a href="cleaning.html#cb186-11" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb186-12"><a href="cleaning.html#cb186-12" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome)</span></code></pre></div>
<p>Bây giờ bạn có thể thấy rằng tên các cột đã được thay đổi:</p>
<pre><code>##  [1] &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;      
##  [4] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;date_outcome&quot;        
##  [7] &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;            
## [10] &quot;lon&quot;                  &quot;lat&quot;                  &quot;infector&quot;            
## [13] &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;            
## [16] &quot;row_num&quot;              &quot;wt_kg&quot;                &quot;ht_cm&quot;               
## [19] &quot;ct_blood&quot;             &quot;fever&quot;                &quot;chills&quot;              
## [22] &quot;cough&quot;                &quot;aches&quot;                &quot;vomit&quot;               
## [25] &quot;temp&quot;                 &quot;time_admission&quot;       &quot;merged_header&quot;       
## [28] &quot;x28&quot;</code></pre>
<div id="thay-đối-tên-cột-theo-vị-trí" class="section level4 unnumbered">
<h4>Thay đối tên cột theo vị trí</h4>
<p>Bạn cũng có thể đổi tên theo vị trí cột, thay vì tên cột, ví dụ:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="cleaning.html#cb188-1" tabindex="-1"></a><span class="fu">rename</span>(<span class="at">newNameForFirstColumn  =</span> <span class="dv">1</span>,</span>
<span id="cb188-2"><a href="cleaning.html#cb188-2" tabindex="-1"></a>       <span class="at">newNameForSecondColumn =</span> <span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="đổi-tên-bằng-hàm-select-và-summarise" class="section level4 unnumbered">
<h4>Đổi tên bằng hàm <code>select()</code> và <code>summarise()</code></h4>
<p>Như một lối tắt, bạn cũng có thể đổi tên các cột bằng hàm <code>select()</code> và <code>summarise()</code> thuộc package <strong>dplyr</strong>. Hàm <code>select()</code> được sử dụng để chỉ giữ một số cột nhất định (sẽ được đề cập sau trong chương này). Hàm <code>summarise()</code> được đề cập trong các chương <a href="grouping.html#grouping">Nhóm dữ liệu</a> và <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a>. Các hàm này cũng sử dụng định dạng <code>new_name = old_name</code>. Đây là một ví dụ:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="cleaning.html#cb189-1" tabindex="-1"></a>linelist_raw <span class="sc">%&gt;%</span> </span>
<span id="cb189-2"><a href="cleaning.html#cb189-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="co"># NEW name             # OLD name</span></span>
<span id="cb189-3"><a href="cleaning.html#cb189-3" tabindex="-1"></a>         <span class="at">date_infection       =</span> <span class="st">`</span><span class="at">infection date</span><span class="st">`</span>,    <span class="co"># rename and KEEP ONLY these columns</span></span>
<span id="cb189-4"><a href="cleaning.html#cb189-4" tabindex="-1"></a>         <span class="at">date_hospitalisation =</span> <span class="st">`</span><span class="at">hosp date</span><span class="st">`</span>)</span></code></pre></div>
</div>
</div>
<div id="các-thách-thức-khác" class="section level3 unnumbered">
<h3>Các thách thức khác</h3>
<div id="cột-trống-tên-trên-file-excel" class="section level4 unnumbered">
<h4>Cột trống tên trên file Excel</h4>
<p>R không thể nhận diện các cột trong bộ dữ liệu mà không có tên cột (tiêu đề). Vì vậy, nếu bạn nhập một bộ dữ liệu Excel có dữ liệu nhưng không có tiêu đề cột, R sẽ điền vào các tiêu đề đó mặc định như “… 1” hoặc “… 2”. Phần số đại diện cho số cột (ví dụ: nếu cột thứ 4 trong bộ dữ liệu không có tiêu đề, thì R sẽ mặc định đặt tên là “… 4”).</p>
<p>Bạn có thể làm sạch các tên cột này theo cách thủ công bằng cách tham chiếu số vị trí của chúng (xem ví dụ ở trên) hoặc tên được chỉ định của chúng (<code>linelist_raw$...1</code>).</p>
</div>
<div id="hợp-nhất-tên-cột-và-ô-excel" class="section level4 unnumbered">
<h4>Hợp nhất tên cột và ô Excel</h4>
<p>Các ô được hợp nhất trong file Excel là một sự cố thường xảy ra khi nhận dữ liệu. Như đã giải thích trong chương <a href="transition-to-R.html#transition-to-R">Chuyển đổi sang R</a>, các ô được hợp nhất có thể dễ nhìn cho con người đọc dữ liệu, nhưng không phải là “cấu trúc dữ liệu cơ bản” và gây ra nhiều vấn đề cho máy khi nhận diện dữ liệu. R không thể chứa các ô đã hợp nhất.</p>
<p>Nhắc nhở người nhập liệu rằng <strong>dữ liệu có thể đọc được bởi con người không giống với dữ liệu mà máy có thể đọc được</strong>. Hãy cố gắng đào tạo người dùng về các nguyên tắc về <a href="https://r4ds.had.co.nz/tidy-data.html"><strong>dữ liệu tidy</strong></a>. Nếu có thể, hãy cố gắng thay đổi quy trình để dữ liệu có định dạng gọn gàng hơn mà không hợp nhất các ô.</p>
<ul>
<li>Mỗi biến phải là một cột riêng biệt</li>
<li>Mỗi quan sát phải là một dòng riêng biệt</li>
<li>Mỗi giá trị phải là một ô riêng biệt</li>
</ul>
<p>Khi sử dụng hàm <code>import()</code> của package <strong>rio</strong>, giá trị trong một ô đã hợp nhất sẽ được gán cho ô đầu tiên và các ô tiếp theo sẽ trống.</p>
<p>Một giải pháp để xử lý các ô đã hợp nhất là nạp dữ liệu bằng hàm <code>readWorkbook()</code> từ package <strong>openxlsx</strong>. Thiết lập đối số <code>fillMergedCells = TRUE</code>. Điều này cho phép giá trị trong ô hợp nhất được tham chiếu cho tất cả các ô nằm trong phạm vi hợp nhất.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="cleaning.html#cb190-1" tabindex="-1"></a>linelist_raw <span class="ot">&lt;-</span> openxlsx<span class="sc">::</span><span class="fu">readWorkbook</span>(<span class="st">&quot;linelist_raw.xlsx&quot;</span>, <span class="at">fillMergedCells =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><span style="color: red;"><strong><em>NGUY HIỂM</em></strong>: Nếu các tên cột được hợp nhất với <code>readWorkbook()</code>, có thể sẽ trả về tên cột trùng lặp, mà bạn sẽ cần phải sửa một cách thủ công - R không làm việc được với các tên cột trùng lặp! Bạn có thể đặt lại tên cho chúng bằng cách tham chiếu vị trí của chúng (ví dụ: cột 5), như được giải thích trong mục làm sạch tên cột thủ công.</span></p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="chọn-hoặc-đổi-vị-trí-cột" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Chọn hoặc đổi vị trí cột</h2>
<p>Sử dụng hàm <code>select()</code> từ package <strong>dplyr</strong> để chọn các cột bạn muốn giữ lại và sắp xếp lại thứ tự của chúng trong bộ dữ liệu.</p>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG</em></strong>: Trong các ví dụ dưới đây, bộ dữ liệu <code>linelist</code> được điều chỉnh với hàm <code>select()</code> và được hiển thị, nhưng không được lưu. Việc này được sử dụng phục vụ mục đích mô tả. Tên cột đã sửa đổi được in ra bằng cách chuyển tiếp bộ dữ liệu tới hàm <code>names()</code>.</span></p>
<p><strong>Dưới đây là TẤT CẢ các tên cột trong bộ dữ liệu linelist tại thời điểm làm sạch</strong>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="cleaning.html#cb191-1" tabindex="-1"></a><span class="fu">names</span>(linelist)</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;      
##  [4] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;date_outcome&quot;        
##  [7] &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;            
## [10] &quot;lon&quot;                  &quot;lat&quot;                  &quot;infector&quot;            
## [13] &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;            
## [16] &quot;row_num&quot;              &quot;wt_kg&quot;                &quot;ht_cm&quot;               
## [19] &quot;ct_blood&quot;             &quot;fever&quot;                &quot;chills&quot;              
## [22] &quot;cough&quot;                &quot;aches&quot;                &quot;vomit&quot;               
## [25] &quot;temp&quot;                 &quot;time_admission&quot;       &quot;merged_header&quot;       
## [28] &quot;x28&quot;</code></pre>
<div id="giữ-cột" class="section level3 unnumbered">
<h3>Giữ cột</h3>
<p><strong>Giữ lại những cột mong muốn</strong></p>
<p>Viết tên cột cần giữ trong hàm <code>select()</code>, không có dấu ngoặc kép. Kết quả trả về sẽ xuất hiện trong bộ dữ liệu theo thứ tự mà bạn cung cấp. Lưu ý rằng nếu bạn chỉ định một cột không tồn tại, R sẽ báo lỗi (xem cách sử dụng hàm <code>any_of()</code> bên dưới nếu bạn không muốn gặp lỗi trong trường hợp này).</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="cleaning.html#cb193-1" tabindex="-1"></a><span class="co"># linelist dataset is piped through select() command, and names() prints just the column names</span></span>
<span id="cb193-2"><a href="cleaning.html#cb193-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb193-3"><a href="cleaning.html#cb193-3" tabindex="-1"></a>  <span class="fu">select</span>(case_id, date_onset, date_hospitalisation, fever) <span class="sc">%&gt;%</span> </span>
<span id="cb193-4"><a href="cleaning.html#cb193-4" tabindex="-1"></a>  <span class="fu">names</span>()  <span class="co"># display the column names</span></span></code></pre></div>
<pre><code>## [1] &quot;case_id&quot;              &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
## [4] &quot;fever&quot;</code></pre>
</div>
<div id="clean_tidyselect" class="section level3 unnumbered">
<h3>Hàm trợ giúp “tidyselect”</h3>
<p>Các hàm trợ giúp này được xây dựng để giúp bạn dễ dàng chỉ định các cột cần giữ, loại bỏ hoặc chuyển đổi. Chúng nằm trong package <strong>tidyselect</strong>, thuộc hệ sinh thái <strong>tidyverse</strong> và làm cơ sở cho cách chọn cột trong các hàm <strong>dplyr</strong>.</p>
<p>Ví dụ: nếu bạn muốn sắp xếp lại các cột, hàm <code>everything()</code> là một hàm hữu ích để biểu thị “tất cả các cột khác chưa được đề cập”. Lệnh dưới đây di chuyển các cột <code>date_onset</code> và <code>date_hospitalisation</code> lên cột đầu tiên (bên trái) của bộ dữ liệu, nhưng vẫn giữ tất cả các cột khác sau đó. Lưu ý rằng hàm <code>everything()</code> được viết bằng dấu ngoặc đơn trống:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="cleaning.html#cb195-1" tabindex="-1"></a><span class="co"># move date_onset and date_hospitalisation to beginning</span></span>
<span id="cb195-2"><a href="cleaning.html#cb195-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb195-3"><a href="cleaning.html#cb195-3" tabindex="-1"></a>  <span class="fu">select</span>(date_onset, date_hospitalisation, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb195-4"><a href="cleaning.html#cb195-4" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;case_id&quot;             
##  [4] &quot;generation&quot;           &quot;date_infection&quot;       &quot;date_outcome&quot;        
##  [7] &quot;outcome&quot;              &quot;gender&quot;               &quot;hospital&quot;            
## [10] &quot;lon&quot;                  &quot;lat&quot;                  &quot;infector&quot;            
## [13] &quot;source&quot;               &quot;age&quot;                  &quot;age_unit&quot;            
## [16] &quot;row_num&quot;              &quot;wt_kg&quot;                &quot;ht_cm&quot;               
## [19] &quot;ct_blood&quot;             &quot;fever&quot;                &quot;chills&quot;              
## [22] &quot;cough&quot;                &quot;aches&quot;                &quot;vomit&quot;               
## [25] &quot;temp&quot;                 &quot;time_admission&quot;       &quot;merged_header&quot;       
## [28] &quot;x28&quot;</code></pre>
<p>Dưới đây là các hàm trợ giúp “tidyselect” khác cũng hoạt động <em>trong</em> các hàm <strong>dplyr</strong> như <code>select()</code>, <code>across()</code>, và <code>summarise()</code>:</p>
<ul>
<li><p><code>everything()</code> - tất cả các cột khác chưa được đề cập</p></li>
<li><p><code>last_col()</code> - cột cuối cùng</p></li>
<li><p><code>where()</code> - áp dụng một hàm cho tất cả các cột và chọn những cột trả về giá trị TRUE</p></li>
<li><p><code>contains()</code> - cột chứa một chuỗi ký tự</p>
<ul>
<li>Ví dụ: <code>select(contains("time"))</code></li>
</ul></li>
<li><p><code>starts_with()</code> - khớp với các tiền tố được chỉ định</p>
<ul>
<li>Ví dụ: <code>select(starts_with("date_"))</code></li>
</ul></li>
<li><p><code>ends_with()</code> - khớp với các hậu tố được chỉ định</p>
<ul>
<li>Ví dụ: <code>select(ends_with("_post"))</code></li>
</ul></li>
<li><p><code>matches()</code> - để áp dụng một mệnh đề chính quy (regex)</p>
<ul>
<li>Ví dụ: <code>select(matches("[pt]al"))</code></li>
</ul></li>
<li><p><code>num_range()</code> - một khoảng số học như x01, x02, x03</p></li>
<li><p><code>any_of()</code> - khớp NẾU cột tồn tại nhưng không báo lỗi nếu không tìm thấy</p>
<ul>
<li>Ví dụ: <code>select(any_of(date_onset, date_death, cardiac_arrest))</code></li>
</ul></li>
</ul>
<p>Ngoài ra, sử dụng các toán tử bình thường như <code>c()</code> để liệt kê danh sách cột, hoặc <code>:</code> cho các cột liên tiếp, <code>!</code> cho đối lập, <code>&amp;</code> cho VÀ, và <code>|</code> cho HOẶC.</p>
<p>Sử dụng <code>where()</code> để cụ thể tiêu chí logic cho các cột. Nếu đưa một hàm vào trong <code>where()</code>, hãy nhớ không bao gồm dấu ngoặc đơn trống của hàm đó. Câu lệnh bên dưới chọn các cột kiểu Số.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="cleaning.html#cb197-1" tabindex="-1"></a><span class="co"># select columns that are class Numeric</span></span>
<span id="cb197-2"><a href="cleaning.html#cb197-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb197-3"><a href="cleaning.html#cb197-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-4"><a href="cleaning.html#cb197-4" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;generation&quot; &quot;lon&quot;        &quot;lat&quot;        &quot;row_num&quot;    &quot;wt_kg&quot;      &quot;ht_cm&quot;     
## [7] &quot;ct_blood&quot;   &quot;temp&quot;</code></pre>
<p>Sử dụng <code>contains()</code> để chọn các cột trong đó tên cột chứa một chuỗi ký tự được chỉ định. <code>ends_with()</code> và <code>starts_with()</code> cung cấp thêm các lựa chọn khác nhau.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="cleaning.html#cb199-1" tabindex="-1"></a><span class="co"># select columns containing certain characters</span></span>
<span id="cb199-2"><a href="cleaning.html#cb199-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb199-3"><a href="cleaning.html#cb199-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb199-4"><a href="cleaning.html#cb199-4" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_infection&quot;       &quot;date_onset&quot;           &quot;date_hospitalisation&quot;
## [4] &quot;date_outcome&quot;</code></pre>
<p>Hàm <code>matches()</code> hoạt động tương tự như hàm <code>contains()</code> nhưng có thể được cung cấp một biểu thức chính quy (xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>), chẳng hạn như nhiều chuỗi được phân tách bằng toán tự OR trong dấu ngoặc đơn:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="cleaning.html#cb201-1" tabindex="-1"></a><span class="co"># searched for multiple character matches</span></span>
<span id="cb201-2"><a href="cleaning.html#cb201-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb201-3"><a href="cleaning.html#cb201-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">&quot;onset|hosp|fev&quot;</span>)) <span class="sc">%&gt;%</span>   <span class="co"># note the OR symbol &quot;|&quot;</span></span>
<span id="cb201-4"><a href="cleaning.html#cb201-4" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_onset&quot;           &quot;date_hospitalisation&quot; &quot;hospital&quot;            
## [4] &quot;fever&quot;</code></pre>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG</em></strong>: Nếu tên cột mà bạn đưa ra không tồn tại trong dữ liệu, máy có thể báo lỗi và dừng code của bạn. Cân nhắc sử dụng hàm <code>any_of()</code> để trích dẫn các cột có thể hoặc không thể tồn tại, đặc biệt hữu ích trong các lựa chọn loại trừ (loại bỏ).</span></p>
<p>Chỉ có một trong các cột này tồn tại, nhưng không có lỗi được báo và code sẽ tiếp tục các bước trong quy trình làm sạch.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="cleaning.html#cb203-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb203-2"><a href="cleaning.html#cb203-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">&quot;date_onset&quot;</span>, <span class="st">&quot;village_origin&quot;</span>, <span class="st">&quot;village_detection&quot;</span>, <span class="st">&quot;village_residence&quot;</span>, <span class="st">&quot;village_travel&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb203-3"><a href="cleaning.html#cb203-3" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;date_onset&quot;</code></pre>
</div>
<div id="xóa-cột" class="section level3 unnumbered">
<h3>Xóa cột</h3>
<p><strong>Chỉ ra cột nào cần loại bỏ</strong> bằng cách đặt biểu tượng dấu trừ “-” ở phía trước tên cột (ví dụ: <code>select(-outcome)</code>) hoặc một vectơ tên các cột (như bên dưới). Tất cả các cột khác sẽ được giữ nguyên.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="cleaning.html#cb205-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb205-2"><a href="cleaning.html#cb205-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(date_onset, fever<span class="sc">:</span>vomit)) <span class="sc">%&gt;%</span> <span class="co"># remove date_onset and all columns from fever to vomit</span></span>
<span id="cb205-3"><a href="cleaning.html#cb205-3" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;case_id&quot;              &quot;generation&quot;           &quot;date_infection&quot;      
##  [4] &quot;date_hospitalisation&quot; &quot;date_outcome&quot;         &quot;outcome&quot;             
##  [7] &quot;gender&quot;               &quot;hospital&quot;             &quot;lon&quot;                 
## [10] &quot;lat&quot;                  &quot;infector&quot;             &quot;source&quot;              
## [13] &quot;age&quot;                  &quot;age_unit&quot;             &quot;row_num&quot;             
## [16] &quot;wt_kg&quot;                &quot;ht_cm&quot;                &quot;ct_blood&quot;            
## [19] &quot;temp&quot;                 &quot;time_admission&quot;       &quot;merged_header&quot;       
## [22] &quot;x28&quot;</code></pre>
<p>Bạn cũng có thể xóa một cột bằng cú pháp trong <strong>base</strong> R, bằng cách định nghĩa nó là <code>NULL</code>. Ví dụ:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="cleaning.html#cb207-1" tabindex="-1"></a>linelist<span class="sc">$</span>date_onset <span class="ot">&lt;-</span> <span class="cn">NULL</span>   <span class="co"># deletes column with base R syntax </span></span></code></pre></div>
</div>
<div id="hoạt-động-độc-lập" class="section level3 unnumbered">
<h3>Hoạt động độc lập</h3>
<p><code>select()</code> cũng có thể được sử dụng như một lệnh độc lập (không bắt buộc trong chuỗi các bước làm sạch). Trong trường hợp này, đối số đầu tiên trong bộ dữ liệu gốc sẽ được tham chiếu.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="cleaning.html#cb208-1" tabindex="-1"></a><span class="co"># Create a new linelist with id and age-related columns</span></span>
<span id="cb208-2"><a href="cleaning.html#cb208-2" tabindex="-1"></a>linelist_age <span class="ot">&lt;-</span> <span class="fu">select</span>(linelist, case_id, <span class="fu">contains</span>(<span class="st">&quot;age&quot;</span>))</span>
<span id="cb208-3"><a href="cleaning.html#cb208-3" tabindex="-1"></a></span>
<span id="cb208-4"><a href="cleaning.html#cb208-4" tabindex="-1"></a><span class="co"># display the column names</span></span>
<span id="cb208-5"><a href="cleaning.html#cb208-5" tabindex="-1"></a><span class="fu">names</span>(linelist_age)</span></code></pre></div>
<pre><code>## [1] &quot;case_id&quot;  &quot;age&quot;      &quot;age_unit&quot;</code></pre>
<div id="thêm-vào-quy-trình-làm-sạch" class="section level4 unnumbered">
<h4>Thêm vào quy trình làm sạch</h4>
<p>Trong bộ dữ liệu <code>linelist_raw</code>, có một vài cột chúng ta không cần: <code>row_num</code>, <code>merged_header</code>, và <code>x28</code>. Chúng ta xóa chúng bằng lệnh <code>select()</code> trong chuỗi các bước làm sạch như sau:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="cleaning.html#cb210-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb210-2"><a href="cleaning.html#cb210-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb210-3"><a href="cleaning.html#cb210-3" tabindex="-1"></a></span>
<span id="cb210-4"><a href="cleaning.html#cb210-4" tabindex="-1"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb210-5"><a href="cleaning.html#cb210-5" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb210-6"><a href="cleaning.html#cb210-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb210-7"><a href="cleaning.html#cb210-7" tabindex="-1"></a>    </span>
<span id="cb210-8"><a href="cleaning.html#cb210-8" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb210-9"><a href="cleaning.html#cb210-9" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb210-10"><a href="cleaning.html#cb210-10" tabindex="-1"></a>    </span>
<span id="cb210-11"><a href="cleaning.html#cb210-11" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb210-12"><a href="cleaning.html#cb210-12" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb210-13"><a href="cleaning.html#cb210-13" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb210-14"><a href="cleaning.html#cb210-14" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb210-15"><a href="cleaning.html#cb210-15" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb210-16"><a href="cleaning.html#cb210-16" tabindex="-1"></a>    </span>
<span id="cb210-17"><a href="cleaning.html#cb210-17" tabindex="-1"></a>    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb210-18"><a href="cleaning.html#cb210-18" tabindex="-1"></a>    <span class="do">#####################################################</span></span>
<span id="cb210-19"><a href="cleaning.html#cb210-19" tabindex="-1"></a></span>
<span id="cb210-20"><a href="cleaning.html#cb210-20" tabindex="-1"></a>    <span class="co"># remove column</span></span>
<span id="cb210-21"><a href="cleaning.html#cb210-21" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="loại-bỏ-trùng-lặp" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Loại bỏ trùng lặp</h2>
<p>Xem chương <a href="cleaning.html#loại-bỏ-trùng-lặp">Loại bỏ trùng lặp</a> để biết các tùy chọn mở rộng về cách loại bỏ dữ liệu trùng lặp. Chỉ một ví dụ rất đơn giản về cách loại bỏ hàng trùng lặp được trình bày ở chương này.</p>
<p>Package <strong>dplyr</strong> cung cấp hàm <code>distinct()</code>. Hàm này kiểm tra tất cả các hàng và rút gọn bộ dữ liệu cho chỉ còn các hàng là duy nhất. Nghĩa là, nó loại bỏ 100% các hàng trùng lặp.</p>
<p>Khi đánh giá các hàng trùng lặp, hàm này sẽ thực hiện trên các cột được chỉ định - mặc định nó sẽ xem xét tất cả các cột. Như trình bày trong chương loại bỏ trùng lặp, bạn có thể điều chỉnh phạm vi cột để việc khảo sát tính duy nhất của các hàng sẽ chỉ được đánh giá trong phạm vi một số cột nhất định.</p>
<p>Trong ví dụ đơn giản này, chúng ta chỉ cần thêm câu lệnh trống <code>distinct()</code> vào chuỗi các bước làm sạch. Điều này đảm bảo không có hàng nào là bản sao 100% của các hàng khác (được đánh giá trên tất cả các cột).</p>
<p>Chúng ta bắt đầu với <code>nrow(linelist)</code> hàng trong bộ <code>linelist</code>.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="cleaning.html#cb211-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb211-2"><a href="cleaning.html#cb211-2" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code></pre></div>
<p>Sau khi loại bỏ trùng lặp, thì bộ dữ liệu mới có <code>nrow(linelist)</code> hàng. Bất kỳ hàng nào bị xóa cũng có thể là 100% bản sao của các hàng khác.</p>
<p>Dưới đây, lệnh <code>distinct()</code> được thêm vào quy trình làm sạch:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="cleaning.html#cb212-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb212-2"><a href="cleaning.html#cb212-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb212-3"><a href="cleaning.html#cb212-3" tabindex="-1"></a></span>
<span id="cb212-4"><a href="cleaning.html#cb212-4" tabindex="-1"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb212-5"><a href="cleaning.html#cb212-5" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb212-6"><a href="cleaning.html#cb212-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb212-7"><a href="cleaning.html#cb212-7" tabindex="-1"></a>    </span>
<span id="cb212-8"><a href="cleaning.html#cb212-8" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb212-9"><a href="cleaning.html#cb212-9" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb212-10"><a href="cleaning.html#cb212-10" tabindex="-1"></a>    </span>
<span id="cb212-11"><a href="cleaning.html#cb212-11" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb212-12"><a href="cleaning.html#cb212-12" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb212-13"><a href="cleaning.html#cb212-13" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb212-14"><a href="cleaning.html#cb212-14" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb212-15"><a href="cleaning.html#cb212-15" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb212-16"><a href="cleaning.html#cb212-16" tabindex="-1"></a>    </span>
<span id="cb212-17"><a href="cleaning.html#cb212-17" tabindex="-1"></a>    <span class="co"># remove column</span></span>
<span id="cb212-18"><a href="cleaning.html#cb212-18" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb212-19"><a href="cleaning.html#cb212-19" tabindex="-1"></a>  </span>
<span id="cb212-20"><a href="cleaning.html#cb212-20" tabindex="-1"></a>    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb212-21"><a href="cleaning.html#cb212-21" tabindex="-1"></a>    <span class="do">#####################################################</span></span>
<span id="cb212-22"><a href="cleaning.html#cb212-22" tabindex="-1"></a>    </span>
<span id="cb212-23"><a href="cleaning.html#cb212-23" tabindex="-1"></a>    <span class="co"># de-duplicate</span></span>
<span id="cb212-24"><a href="cleaning.html#cb212-24" tabindex="-1"></a>    <span class="fu">distinct</span>()</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
<div id="tạo-và-biến-đổi-cột" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Tạo và biến đổi cột</h2>
<p><strong>Chúng tôi khuyến khích sử dụng hàm <code>mutate()</code> trong package dplyr để thêm một cột mới hoặc để sửa đổi một cột sẵn có.</strong></p>
<p>Dưới đây là một ví dụ về tạo cột mới với hàm <code>mutate()</code>. Cú pháp là: <code>mutate(new_column_name = value or transformation)</code></p>
<p>Trong Stata, điều này tương tự như lệnh <code>generate</code>, nhưng hàm <code>mutate()</code> trong R còn có thể được sử dụng để điều chỉnh cột đã tồn tại.</p>
<div id="tạo-cột-mới" class="section level3 unnumbered">
<h3>Tạo cột mới</h3>
<p>Tính năng cơ bản nhất của hàm <code>mutate()</code> là để tạo một cột mới, có thể thấy trong ví dụ dưới đây. Nó tạo một cột mới <code>new_col</code> trong đó giá trị trong mỗi hàng đều là 10.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="cleaning.html#cb213-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb213-2"><a href="cleaning.html#cb213-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_col =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>Bạn cũng có thể tham chiếu các giá trị trong các cột khác, để thực hiện phép tính toán. Dưới đây, cột mới <code>bmi</code> được tạo để tính chỉ số khối cơ thể (BMI) cho mỗi trường hợp - như được tính bằng công thức BMI = kg/m^2, sử dụng cột <code>ht_cm</code> và cột <code>wt_kg</code>.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="cleaning.html#cb214-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="cleaning.html#cb214-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<p>Nếu tạo nhiều cột mới, hãy tách riêng từng cột bằng dấu phẩy và dòng mới. Dưới đây là các ví dụ về tạo các cột mới, bao gồm một cột mà chứa các giá trị từ các cột khác được kết hợp bằng hàm <code>str_glue()</code> từ package <strong>stringr</strong> (xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>).</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="cleaning.html#cb215-1" tabindex="-1"></a>new_col_demo <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                       </span>
<span id="cb215-2"><a href="cleaning.html#cb215-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb215-3"><a href="cleaning.html#cb215-3" tabindex="-1"></a>    <span class="at">new_var_dup    =</span> case_id,             <span class="co"># new column = duplicate/copy another existing column</span></span>
<span id="cb215-4"><a href="cleaning.html#cb215-4" tabindex="-1"></a>    <span class="at">new_var_static =</span> <span class="dv">7</span>,                   <span class="co"># new column = all values the same</span></span>
<span id="cb215-5"><a href="cleaning.html#cb215-5" tabindex="-1"></a>    <span class="at">new_var_static =</span> new_var_static <span class="sc">+</span> <span class="dv">5</span>,  <span class="co"># you can overwrite a column, and it can be a calculation using other variables</span></span>
<span id="cb215-6"><a href="cleaning.html#cb215-6" tabindex="-1"></a>    <span class="at">new_var_paste  =</span> stringr<span class="sc">::</span><span class="fu">str_glue</span>(<span class="st">&quot;{hospital} on ({date_hospitalisation})&quot;</span>) <span class="co"># new column = pasting together values from other columns</span></span>
<span id="cb215-7"><a href="cleaning.html#cb215-7" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb215-8"><a href="cleaning.html#cb215-8" tabindex="-1"></a>  <span class="fu">select</span>(case_id, hospital, date_hospitalisation, <span class="fu">contains</span>(<span class="st">&quot;new&quot;</span>))        <span class="co"># show only new columns, for demonstration purposes</span></span></code></pre></div>
<p>Kiểm tra các cột mới. Đối với mục tiêu minh họa, chỉ các cột mới và các cột được sử dụng để tạo cột mới được hiển thị:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-27cca8d13adf036063f9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-27cca8d13adf036063f9">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Marks Maternity Hopital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],["2014-05-15T00:00:00Z","2014-05-14T00:00:00Z","2014-05-18T00:00:00Z","2014-05-20T00:00:00Z","2014-05-22T00:00:00Z","2014-05-23T00:00:00Z","2014-05-29T00:00:00Z","2014-06-03T00:00:00Z","2014-06-06T00:00:00Z","2014-06-07T00:00:00Z","2014-06-08T00:00:00Z","2014-06-15T00:00:00Z","2014-06-17T00:00:00Z","2014-06-17T00:00:00Z","2014-06-20T00:00:00Z","2014-06-19T00:00:00Z","2014-06-23T00:00:00Z","2014-06-24T00:00:00Z","2014-06-27T00:00:00Z","2014-06-28T00:00:00Z","2014-06-29T00:00:00Z","2014-07-03T00:00:00Z","2014-07-09T00:00:00Z","2014-07-09T00:00:00Z","2014-07-11T00:00:00Z","2014-07-11T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-14T00:00:00Z","2014-07-13T00:00:00Z","2014-07-14T00:00:00Z","2014-07-17T00:00:00Z","2014-07-17T00:00:00Z","2014-07-18T00:00:00Z","2014-07-19T00:00:00Z","2014-07-20T00:00:00Z","2014-07-20T00:00:00Z","2014-07-22T00:00:00Z","2014-07-24T00:00:00Z","2014-07-26T00:00:00Z","2014-07-24T00:00:00Z","2014-07-27T00:00:00Z","2014-07-25T00:00:00Z","2014-07-27T00:00:00Z","2014-07-31T00:00:00Z","2014-08-01T00:00:00Z","2014-08-03T00:00:00Z","2014-08-02T00:00:00Z","2014-08-02T00:00:00Z","2014-08-04T00:00:00Z"],["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12],["Other on (2014-05-15)","NA on (2014-05-14)","St. Mark's Maternity Hospital (SMMH) on (2014-05-18)","Port Hospital on (2014-05-20)","Military Hospital on (2014-05-22)","Port Hospital on (2014-05-23)","NA on (2014-05-29)","NA on (2014-06-03)","NA on (2014-06-06)","NA on (2014-06-07)","Port Hospital on (2014-06-08)","Military Hospital on (2014-06-15)","NA on (2014-06-17)","NA on (2014-06-17)","Other on (2014-06-20)","Port Hospital on (2014-06-19)","Port Hospital on (2014-06-23)","Port Hospital on (2014-06-24)","NA on (2014-06-27)","Other on (2014-06-28)","Port Hospital on (2014-06-29)","Port Hospital on (2014-07-03)","St. Mark's Maternity Hospital (SMMH) on (2014-07-09)","NA on (2014-07-09)","Other on (2014-07-11)","NA on (2014-07-11)","St. Marks Maternity Hopital (SMMH) on (2014-07-13)","Military Hospital on (2014-07-14)","Port Hospital on (2014-07-14)","Central Hospital on (2014-07-13)","Military Hospital on (2014-07-14)","Central Hospital on (2014-07-17)","NA on (2014-07-17)","Military Hospital on (2014-07-18)","Other on (2014-07-19)","NA on (2014-07-20)","NA on (2014-07-20)","Port Hospital on (2014-07-22)","Port Hospital on (2014-07-24)","Port Hospital on (2014-07-26)","NA on (2014-07-24)","Central Hospital on (2014-07-27)","Military Hospital on (2014-07-25)","Other on (2014-07-27)","Other on (2014-07-31)","Other on (2014-08-01)","NA on (2014-08-03)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","St. Mark's Maternity Hospital (SMMH) on (2014-08-02)","NA on (2014-08-04)"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>hospital<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>new_var_dup<\/th>\n      <th>new_var_static<\/th>\n      <th>new_var_paste<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":4},{"name":"case_id","targets":0},{"name":"hospital","targets":1},{"name":"date_hospitalisation","targets":2},{"name":"new_var_dup","targets":3},{"name":"new_var_static","targets":4},{"name":"new_var_paste","targets":5}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Một biến thể của hàm <code>mutate()</code> là hàm <code>transmute()</code>. Hàm này thêm một cột mới giống như <code>mutate()</code>, nhưng cũng bỏ/xóa tất cả các cột khác mà bạn không đề cập trong dấu ngoặc đơn của hàm.</span></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="cleaning.html#cb216-1" tabindex="-1"></a><span class="co"># HIDDEN FROM READER</span></span>
<span id="cb216-2"><a href="cleaning.html#cb216-2" tabindex="-1"></a><span class="co"># removes new demo columns created above</span></span>
<span id="cb216-3"><a href="cleaning.html#cb216-3" tabindex="-1"></a><span class="co"># linelist &lt;- linelist %&gt;% </span></span>
<span id="cb216-4"><a href="cleaning.html#cb216-4" tabindex="-1"></a><span class="co">#   select(-contains(&quot;new_var&quot;))</span></span></code></pre></div>
</div>
<div id="chuyển-đổi-kiểu-dữ-liệu-của-cột" class="section level3 unnumbered">
<h3>Chuyển đổi kiểu dữ liệu của cột</h3>
<p>Các cột chứa giá trị là ngày tháng, số hoặc giá trị logic (TRUE/FALSE) sẽ chỉ hoạt động như mong đợi nếu chúng được phân loại chính xác. Có sự khác biệt giữa “2” của phân lớp ký tự và 2 của phân lớp số!</p>
<p>Có nhiều cách để thiết lập kiểu dữ liệu cho cột trong các lệnh nhập, nhưng chúng thường phức tạp. Xem chương <a href="basics.html#basics">R cơ bản</a> về các lớp đối tượng để tìm hiểu thêm về cách chuyển đổi phân lớp đối tượng và cột.</p>
<p>Đầu tiên, hãy kiểm tra các cột quan trọng để xem chúng đã đúng định dạng chính xác chưa. Chúng ta có thể phát hiện điều này ngay từ khi chúng ta chạy lệnh <code>skim()</code>.</p>
<p>Hiện tại, kiểu của cột <code>age</code> là dạng ký tự. Để thực hiện các phân tích định lượng, chúng ta cần những giá trị số này được nhận biết là dạng số!</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="cleaning.html#cb217-1" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Phân lớp của cột <code>date_onset</code> cũng là ký tự! Để thực hiện phân tích, những cột ngày này phải được nhận biết là dạng ngày tháng!</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="cleaning.html#cb219-1" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>date_onset)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Để giải quyết vấn đề này, hãy sử dụng hàm <code>mutate()</code> để định dạng và chuyển đổi lại một cột. Chúng ta giữ nguyên cột đó và định dạng lại sang một phân lớp khác. Sau đây là một ví dụ cơ bản, chuyển đổi hoặc đảm bảo rằng cột <code>age</code> là phân lớp dạng số:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="cleaning.html#cb221-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb221-2"><a href="cleaning.html#cb221-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">as.numeric</span>(age))</span></code></pre></div>
<p>Theo cách tương tự, bạn có thể sử dụng hàm <code>as.character()</code> và hàm <code>as.logical()</code>. Để chuyển đổi sang kiểu Factor, bạn có thể sử dụng hàm <code>factor()</code> từ <strong>base</strong> R hoặc hàm <code>as_factor()</code> từ package <strong>forcats</strong>. Đọc thêm ở chương <a href="factors.html#factors">Factors</a>.</p>
<p>Bạn phải cẩn thận khi chuyển đổi sang phân lớp Ngày. Một số phương pháp được giải thích rõ hơn ở chương <a href="dates.html#dates">Làm việc với ngày tháng</a>. Thông thường, tất cả các giá trị ngày ban đầu phải ở cùng một định dạng cần chuyển đổi để có thể sử dụng (ví dụ: “MM/DD/YYYY” hoặc “DD MM YYYY”). Sau khi chuyển đổi thành thành phân lớp Ngày, hãy kiểm tra dữ liệu của bạn để xác nhận rằng mỗi giá trị đã được chuyển đổi chính xác.</p>
</div>
<div id="dữ-liệu-được-nhóm" class="section level3 unnumbered">
<h3>Dữ liệu được nhóm</h3>
<p>Nếu bộ dữ liệu của bạn đã được <em>nhóm</em> (xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a>), hàm <code>mutate()</code> có thể hoạt động khác so với khi bộ dữ liệu không được nhóm. Bất kỳ hàm tổng hợp nào, như <code>mean()</code>, <code>median()</code>, <code>max()</code>, v.v. sẽ tính theo nhóm, không phải theo tất cả các hàng.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="cleaning.html#cb222-1" tabindex="-1"></a><span class="co"># age normalized to mean of ALL rows</span></span>
<span id="cb222-2"><a href="cleaning.html#cb222-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb222-3"><a href="cleaning.html#cb222-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_norm =</span> age <span class="sc">/</span> <span class="fu">mean</span>(age, <span class="at">na.rm=</span>T))</span>
<span id="cb222-4"><a href="cleaning.html#cb222-4" tabindex="-1"></a></span>
<span id="cb222-5"><a href="cleaning.html#cb222-5" tabindex="-1"></a><span class="co"># age normalized to mean of hospital group</span></span>
<span id="cb222-6"><a href="cleaning.html#cb222-6" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb222-7"><a href="cleaning.html#cb222-7" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb222-8"><a href="cleaning.html#cb222-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_norm =</span> age <span class="sc">/</span> <span class="fu">mean</span>(age, <span class="at">na.rm=</span>T))</span></code></pre></div>
<p>Đọc thêm về cách sử dụng hàm <code>mutate()</code> trên các bộ dữ liệu được nhóm ở <a href="https://dplyr.tidyverse.org/reference/mutate.html">tài liệu về mutate trong package tidyverse</a>.</p>
</div>
<div id="clean_across" class="section level3 unnumbered">
<h3>Biến đổi nhiều cột</h3>
<p>Thông thường, để viết mã ngắn gọn, bạn muốn áp dụng cùng một biến đổi trên nhiều cột cùng một lúc. Một cách biến đổi có thể được áp dụng trên nhiều cột cùng một lúc bằng cách sử dụng hàm <code>across()</code> từ package <strong>dplyr</strong> (cũng trong package <strong>tidyverse</strong>). Hàm <code>across()</code> có thể được sử dụng với bất kỳ hàm nào trong packe <strong>dplyr</strong>, nhưng thường được sử dụng với hàm <code>select()</code>, <code>mutate()</code>, <code>filter()</code>, hoặc <code>summarise()</code>. Xem cách sử dụng hàm <code>summarise()</code> trong chương <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a>.</p>
<p>Chỉ định các cột bằng đối số <code>.cols =</code> và các hàm được sử dụng bằng <code>.fns =</code>. Bất kỳ đối số bổ sung nào để cung cấp cho hàm <code>.fns</code> đều có thể được bao gồm sau dấu phẩy, vẫn nằm trong hàm <code>across()</code>.</p>
<div id="lựa-chọn-cột-với-hàm-across" class="section level4 unnumbered">
<h4>Lựa chọn cột với hàm <code>across()</code></h4>
<p>Chỉ định các cột tới đối số <code>.cols =</code>. Bạn có thể đặt tên cho chúng một cách riêng lẻ hoặc sử dụng các hàm trợ giúp “tidyselect”. Cụ thể hàm tới đối số <code>.fns =</code>. Lưu ý rằng cách sử dụng hàm được trình bày bên dưới, hàm được viết mà <em>không có</em> dấu ngoặc đơn ().</p>
<p>Ở đây, phép biến đổi <code>as.character()</code> được áp dụng cho tên cột cụ thể trong hàm <code>across()</code>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="cleaning.html#cb223-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb223-2"><a href="cleaning.html#cb223-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(temp, ht_cm, wt_kg), <span class="at">.fns =</span> as.character))</span></code></pre></div>
<p>Các hàm trợ giúp “tidyselect” có sẵn để hỗ trợ bạn trong việc chỉ định các cột. Chúng được trình bày chi tiết ở trên trong mục Chọn và sắp xếp thứ tự cột, bao gồm: <code>everything()</code>, <code>last_col()</code>, <code>where()</code>, <code>starts_with()</code>, <code>ends_with()</code>, <code>contains()</code>, <code>matches()</code>, <code>num_range()</code> và <code>any_of()</code>.</p>
<p>Đây là một ví dụ về cách thay đổi tất cả các cột thành phân lớp dạng ký tự:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="cleaning.html#cb224-1" tabindex="-1"></a><span class="co">#to change all columns to character class</span></span>
<span id="cb224-2"><a href="cleaning.html#cb224-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb224-3"><a href="cleaning.html#cb224-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), <span class="at">.fns =</span> as.character))</span></code></pre></div>
<p>Chuyển đổi tất cả các cột thành dạng ký tự có tên chứa chuỗi ký tự “date” (lưu ý vị trí của dấu phẩy và dấu ngoặc đơn):</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="cleaning.html#cb225-1" tabindex="-1"></a><span class="co">#to change all columns to character class</span></span>
<span id="cb225-2"><a href="cleaning.html#cb225-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb225-3"><a href="cleaning.html#cb225-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), <span class="at">.fns =</span> as.character))</span></code></pre></div>
<p>Dưới đây, một ví dụ về việc thay đổi các cột hiện là phân lớp POSIXct (một kiểu dữ liệu ngày tháng thô hiển thị mốc thời gian) - hay nói cách khác, khi hàm <code>is.POSIXct()</code> đánh giá là <code>TRUE</code>. Sau đó, chúng ta muốn áp dụng hàm <code>as.Date()</code> cho các cột này để chuyển đổi chúng thành kiểu Ngày thông thường.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="cleaning.html#cb226-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="cleaning.html#cb226-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.POSIXct), <span class="at">.fns =</span> as.Date))</span></code></pre></div>
<ul>
<li>Lưu ý rằng trong hàm <code>across()</code>, chúng tôi cũng sử dụng hàm <code>where()</code> tương tự như hàm <code>is.POSIXct</code> được đánh giá là TRUE hoặc FALSE.<br />
</li>
<li>Lưu ý rằng hàm <code>is.POSIXct()</code> là từ package <strong>lubridate</strong>. Các hàm “is” tương tự khác như <code>is.character()</code>, <code>is.numeric()</code>, và <code>is.logical()</code> thì thuộc <strong>base R</strong></li>
</ul>
</div>
<div id="hàm-across" class="section level4 unnumbered">
<h4>Hàm <code>across()</code></h4>
<p>Bạn có thể đọc tài liệu với hàm <code>?across</code> để biết chi tiết về cách sử dụng hàm <code>across()</code>. Một vài điểm tóm tắt: có một số cách để chỉ định (các) hàm để thực hiện trên một cột và bạn thậm chí có thể tự chỉ định các hàm riêng của mình:</p>
<ul>
<li><p>Bạn có thể cung cấp tên hàm đứng một mình (ví dụ: <code>mean</code> hoặc <code>as.character</code>)<br />
</p></li>
<li><p>Bạn có thể cung cấp hàm theo phong cách <strong>purrr</strong> (ví dụ: <code>~ mean(.x, na.rm = TRUE)</code>) (xem chương <a href="iteration.html#iteration">Lặp, vòng lặp, và danh sách</a>)<br />
</p></li>
<li><p>Bạn có thể chỉ định nhiều hàm bằng cách cung cấp danh sách (ví dụ: <code>list(mean = mean, n_miss = ~ sum(is.na(.x))</code>).</p>
<ul>
<li>Nếu bạn cung cấp nhiều hàm, nhiều cột được chuyển đổi sẽ được trả về dựa trên mỗi cột ban đầu, với các tên duy nhất theo định dạng <code>col_fn</code>. Bạn có thể điều chỉnh cách đặt tên các cột mới với đối số <code>.names =</code> bằng cách sử dụng cú pháp <strong>glue</strong> (xem chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>) trong đó <code>{.col}</code> và <code>{.fn}</code> được viết tắt cho cột và hàm đầu vào.</li>
</ul></li>
</ul>
<p>Dưới đây là một số tài nguyên trực tuyến về cách sử dụng hàm <code>across()</code>: <a href="https://www.tidyverse.org/blog/2020/04/dplyr-1-0-0-colwise/">creator Hadley Wickham’s thoughts/rationale</a></p>
</div>
</div>
<div id="hàm-coalesce" class="section level3 unnumbered">
<h3>Hàm <code>coalesce()</code></h3>
<p>Hàm <strong>dplyr</strong> này tìm giá trị không bị thiếu đầu tiên tại mỗi vị trí. Nó “điền vào” các giá trị còn thiếu với giá trị có sẵn đầu tiên theo thứ tự bạn chỉ định.</p>
<p>Đây là một ví dụ <em>ngoài phạm vi của bộ dữ liệu</em>: Giả sử bạn có hai vectơ, một vectơ chứa thông tin về làng nơi bệnh nhân được phát hiện và một vectơ chứa thông tin làng nơi bệnh nhân cư trú . Bạn có thể sử dụng hàm <code>coalesce()</code> để chọn giá trị không bị thiếu đầu tiên cho mỗi biến số:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="cleaning.html#cb227-1" tabindex="-1"></a>village_detection <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="cn">NA</span>,  <span class="cn">NA</span>)</span>
<span id="cb227-2"><a href="cleaning.html#cb227-2" tabindex="-1"></a>village_residence <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb227-3"><a href="cleaning.html#cb227-3" tabindex="-1"></a></span>
<span id="cb227-4"><a href="cleaning.html#cb227-4" tabindex="-1"></a>village <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(village_detection, village_residence)</span>
<span id="cb227-5"><a href="cleaning.html#cb227-5" tabindex="-1"></a>village    <span class="co"># print</span></span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;a&quot; &quot;d&quot;</code></pre>
<p>Điều này hoạt động tương tự nếu bạn cung cấp các cột trong bộ dữ liệu: đối với mỗi hàng, hàm sẽ gán giá trị cột mới với giá trị không bị thiếu đầu tiên trong các cột bạn đã cung cấp (theo thứ tự được cung cấp).</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="cleaning.html#cb229-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb229-2"><a href="cleaning.html#cb229-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">village =</span> <span class="fu">coalesce</span>(village_detection, village_residence))</span></code></pre></div>
<p>Đây là một ví dụ về thao tác “theo hàng (row-wise)”. Để biết các phép tính theo hàng phức tạp hơn, hãy xem chương bên dưới về Tính toán theo hàng.</p>
</div>
<div id="toán-lũy-tích" class="section level3 unnumbered">
<h3>Toán lũy tích</h3>
<p>Nếu bạn muốn một cột thể hiện tổng tích lũy/trung bình/tối thiểu/tối đa, v.v. như đánh giá các hàng của bộ dữ liệu cho đến thời điểm đó, hãy sử dụng các hàm sau:</p>
<p><code>cumsum()</code> trả về tổng tích lũy, như được hiển thị bên dưới:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="cleaning.html#cb230-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))     <span class="co"># returns only one number</span></span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="cleaning.html#cb232-1" tabindex="-1"></a><span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">15</span>,<span class="dv">10</span>))  <span class="co"># returns the cumulative sum at each step</span></span></code></pre></div>
<pre><code>## [1]  2  6 21 31</code></pre>
<p>Điều này có thể được sử dụng trong bộ dữ liệu khi tạo một cột mới. Ví dụ: để tính toán số ca lũy tích mỗi ngày trong một đợt bùng dịch, hãy xem xét đoạn code như sau:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="cleaning.html#cb234-1" tabindex="-1"></a>cumulative_case_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>  <span class="co"># begin with case linelist</span></span>
<span id="cb234-2"><a href="cleaning.html#cb234-2" tabindex="-1"></a>  <span class="fu">count</span>(date_onset) <span class="sc">%&gt;%</span>                 <span class="co"># count of rows per day, as column &#39;n&#39;   </span></span>
<span id="cb234-3"><a href="cleaning.html#cb234-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative_cases =</span> <span class="fu">cumsum</span>(n))  <span class="co"># new column, of the cumulative sum at each row</span></span></code></pre></div>
<p>Dưới đây là 10 hàng đầu tiên:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="cleaning.html#cb235-1" tabindex="-1"></a><span class="fu">head</span>(cumulative_case_counts, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    date_onset n cumulative_cases
## 1  2012-04-15 1                1
## 2  2012-05-05 1                2
## 3  2012-05-08 1                3
## 4  2012-05-31 1                4
## 5  2012-06-02 1                5
## 6  2012-06-07 1                6
## 7  2012-06-14 1                7
## 8  2012-06-21 1                8
## 9  2012-06-24 1                9
## 10 2012-06-25 1               10</code></pre>
<p>Xem chương <a href="epicurves.html#epicurves">Đường cong dịch bệnh</a> để biết cách lập biểu đồ các trường hợp mới mắc tích lũy với epicurve.</p>
<p>Xem thêm:<br />
<code>cumsum()</code>, <code>cummean()</code>, <code>cummin()</code>, <code>cummax()</code>, <code>cumany()</code>, <code>cumall()</code></p>
</div>
<div id="sử-dụng-base-r" class="section level3 unnumbered">
<h3>Sử dụng <strong>base</strong> R</h3>
<p>Để định nghĩa một cột mới (hoặc tái định nghĩa lại một cột) bằng cách sử dụng <strong>base</strong> R, hãy viết tên của bộ dữ liệu, được liên kết với <code>$</code>, vào tên cột <em>mới</em> (hoặc cột được sửa đổi). Sử dụng toán tử gán <code>&lt;-</code> để xác định (các) giá trị mới. Hãy nhớ rằng khi sử dụng <strong>base</strong> R, bạn phải chỉ định tên bộ dữ liệu trước tên cột (ví dụ: <code>dataframe$column</code>). Đây là một ví dụ về cách tạo cột <code>bmi</code> bằng cách sử dụng <strong>base</strong> R:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="cleaning.html#cb237-1" tabindex="-1"></a>linelist<span class="sc">$</span>bmi <span class="ot">=</span> linelist<span class="sc">$</span>wt_kg <span class="sc">/</span> (linelist<span class="sc">$</span>ht_cm <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">^</span> <span class="dv">2</span><span class="er">)</span></span></code></pre></div>
</div>
<div id="thêm-vào-chuỗi-pipe" class="section level3 unnumbered">
<h3>Thêm vào chuỗi pipe</h3>
<p><strong>Dưới đây, một cột mới được thêm vào chuỗi pipe và một số phân lớp được chuyển đổi.</strong></p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="cleaning.html#cb238-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb238-2"><a href="cleaning.html#cb238-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb238-3"><a href="cleaning.html#cb238-3" tabindex="-1"></a></span>
<span id="cb238-4"><a href="cleaning.html#cb238-4" tabindex="-1"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb238-5"><a href="cleaning.html#cb238-5" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb238-6"><a href="cleaning.html#cb238-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb238-7"><a href="cleaning.html#cb238-7" tabindex="-1"></a>    </span>
<span id="cb238-8"><a href="cleaning.html#cb238-8" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb238-9"><a href="cleaning.html#cb238-9" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb238-10"><a href="cleaning.html#cb238-10" tabindex="-1"></a>    </span>
<span id="cb238-11"><a href="cleaning.html#cb238-11" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb238-12"><a href="cleaning.html#cb238-12" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb238-13"><a href="cleaning.html#cb238-13" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb238-14"><a href="cleaning.html#cb238-14" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb238-15"><a href="cleaning.html#cb238-15" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb238-16"><a href="cleaning.html#cb238-16" tabindex="-1"></a>    </span>
<span id="cb238-17"><a href="cleaning.html#cb238-17" tabindex="-1"></a>    <span class="co"># remove column</span></span>
<span id="cb238-18"><a href="cleaning.html#cb238-18" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb238-19"><a href="cleaning.html#cb238-19" tabindex="-1"></a>  </span>
<span id="cb238-20"><a href="cleaning.html#cb238-20" tabindex="-1"></a>    <span class="co"># de-duplicate</span></span>
<span id="cb238-21"><a href="cleaning.html#cb238-21" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb238-22"><a href="cleaning.html#cb238-22" tabindex="-1"></a>  </span>
<span id="cb238-23"><a href="cleaning.html#cb238-23" tabindex="-1"></a>    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb238-24"><a href="cleaning.html#cb238-24" tabindex="-1"></a>    <span class="do">###################################################</span></span>
<span id="cb238-25"><a href="cleaning.html#cb238-25" tabindex="-1"></a>    <span class="co"># add new column</span></span>
<span id="cb238-26"><a href="cleaning.html#cb238-26" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb238-27"><a href="cleaning.html#cb238-27" tabindex="-1"></a>  </span>
<span id="cb238-28"><a href="cleaning.html#cb238-28" tabindex="-1"></a>    <span class="co"># convert class of columns</span></span>
<span id="cb238-29"><a href="cleaning.html#cb238-29" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb238-30"><a href="cleaning.html#cb238-30" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb238-31"><a href="cleaning.html#cb238-31" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) </span></code></pre></div>
</div>
</div>
<div id="mã-hóa-lại-giá-trị" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Mã hóa lại giá trị</h2>
<p>Dưới đây là một số tình huống mà bạn cần mã hóa lại (thay đổi) các giá trị:</p>
<ul>
<li>để chỉnh sửa một giá trị cụ thể (ví dụ: một ngày có năm hoặc định dạng không chính xác)</li>
<li>để hợp nhất các giá trị được viết sai chính tả</li>
<li>để tạo một cột chứa giá trị phân loại mới</li>
<li>để tạo một cột chứa danh mục số mới (ví dụ: danh mục độ tuổi)</li>
</ul>
<div id="giá-trị-cụ-thể" class="section level3 unnumbered">
<h3>Giá trị cụ thể</h3>
<p>Để thay đổi các giá trị theo cách thủ công, bạn có thể sử dụng hàm <code>recode()</code> bên trong hàm <code>mutate()</code>.</p>
<p>Hãy tưởng tượng có một ngày không bình thường trong dữ liệu (ví dụ: “2014-14-15”): bạn có thể sửa ngày theo cách thủ công trong dữ liệu thô hoặc, bạn có thể ghi thay đổi trong chuỗi các bước làm sạch thông qua <code>mutate()</code> và <code>recode()</code>. Cách thứ hai sẽ rõ ràng hơn và có thể được tái lập lại cho bất kỳ ai khác muốn hiểu hoặc lặp lại phân tích của bạn.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="cleaning.html#cb239-1" tabindex="-1"></a><span class="co"># fix incorrect values                   # old value       # new value</span></span>
<span id="cb239-2"><a href="cleaning.html#cb239-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb239-3"><a href="cleaning.html#cb239-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">recode</span>(date_onset, <span class="st">&quot;2014-14-15&quot;</span> <span class="ot">=</span> <span class="st">&quot;2014-04-15&quot;</span>))</span></code></pre></div>
<p>Dòng <code>mutate()</code> ở trên có thể được đọc là: “biến đổi cột <code>date_onset</code> bằng với cột <code>date_onset</code> sau khi được mã hóa lại để GIÁ TRỊ CŨ được đổi thành GIÁ TRỊ MỚI”. Lưu ý rằng cú pháp (CŨ = MỚI) này của hàm <code>recode()</code> ngược lại với hầu hết các cú pháp trong R (mới = cũ). Cộng đồng phát triển R đang làm việc để sửa đổi điều này.</p>
<p><strong>Sau đây là một ví dụ khác về việc mã hóa lại nhiều giá trị trong một cột.</strong></p>
<p>Trong bộ dữ liệu <code>linelist</code>, các giá trị trong cột “hospital” phải được làm sạch. Có một số cách viết khác nhau và nhiều giá trị bị thiếu.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="cleaning.html#cb240-1" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>hospital, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)  <span class="co"># print table of all unique values, including missing  </span></span></code></pre></div>
<pre><code>## 
##                      Central Hopital                     Central Hospital 
##                                   11                                  457 
##                           Hospital A                           Hospital B 
##                                  290                                  289 
##                     Military Hopital                    Military Hospital 
##                                   32                                  798 
##                     Mitylira Hopital                    Mitylira Hospital 
##                                    1                                   79 
##                                Other                         Port Hopital 
##                                  907                                   48 
##                        Port Hospital St. Mark&#39;s Maternity Hospital (SMMH) 
##                                 1756                                  417 
##   St. Marks Maternity Hopital (SMMH)                                 &lt;NA&gt; 
##                                   11                                 1512</code></pre>
<p>Lệnh <code>recode()</code> bên dưới tái định nghĩa lại cột “hospital” theo cột hiện tại “hospital”, nhưng với các thay đổi mã hóa được chỉ định. Đừng quên dấu phẩy sau mỗi dòng mã hóa lại!</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="cleaning.html#cb242-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb242-2"><a href="cleaning.html#cb242-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb242-3"><a href="cleaning.html#cb242-3" tabindex="-1"></a>                     <span class="co"># for reference: OLD = NEW</span></span>
<span id="cb242-4"><a href="cleaning.html#cb242-4" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb242-5"><a href="cleaning.html#cb242-5" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb242-6"><a href="cleaning.html#cb242-6" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb242-7"><a href="cleaning.html#cb242-7" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb242-8"><a href="cleaning.html#cb242-8" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb242-9"><a href="cleaning.html#cb242-9" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb242-10"><a href="cleaning.html#cb242-10" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb242-11"><a href="cleaning.html#cb242-11" tabindex="-1"></a>                      ))</span></code></pre></div>
<p>Bây giờ chúng ta thấy các cách viết trong cột <code>hospital</code> đã được sửa chữa và hợp nhất:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="cleaning.html#cb243-1" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>hospital, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##                     Central Hospital                           Hospital A 
##                                  468                                  290 
##                           Hospital B                    Military Hospital 
##                                  289                                  910 
##                                Other                        Port Hospital 
##                                  907                                 1804 
## St. Mark&#39;s Maternity Hospital (SMMH)                                 &lt;NA&gt; 
##                                  428                                 1512</code></pre>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Số lượng khoảng trắng trước và sau dấu bằng không quan trọng. Hãy làm cho code của bạn dễ đọc hơn bằng cách căn chỉnh dấu = cho tất cả hoặc hầu hết các hàng. Ngoài ra, hãy cân nhắc thêm hàng bình luận để làm rõ cho người đọc biết bên nào CŨ và bên nào MỚI.</span></p>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Đôi khi tồn tại một giá trị ký tự <em>trống</em> trong bộ dữ liệu (không được nhận dạng là giá trị missing của R - <code>NA</code>). Bạn có thể tham chiếu giá trị này bằng hai dấu ngoặc kép không có khoảng trắng ở giữa (““).</span></p>
</div>
<div id="theo-logic" class="section level3 unnumbered">
<h3>Theo logic</h3>
<p>Dưới đây, chúng ta trình bày cách mã hóa lại các giá trị trong một cột bằng cách sử dụng logic và điều kiện:</p>
<ul>
<li>Sử dụng hàm <code>replace()</code>, <code>ifelse()</code> và <code>if_else()</code> cho logic đơn giản</li>
<li>Sử dụng hàm <code>case_when()</code> cho logic phức tạp</li>
</ul>
</div>
<div id="logic-đơn-giản" class="section level3 unnumbered">
<h3>Logic đơn giản</h3>
<div id="replace" class="section level4 unnumbered">
<h4><code>replace()</code></h4>
<p>Để mã hóa lại với các tiêu chí logic đơn giản, bạn có thể sử dụng hàm <code>replace()</code> bên trong hàm <code>mutate()</code>. <code>replace()</code> là một hàm từ <strong>base</strong> R. Sử dụng một điều kiện logic để cụ thể các hàng cần thay đổi. Cú pháp chung là:</p>
<p><code>mutate(col_to_change = replace(col_to_change, criteria for rows, new value))</code>.</p>
<p>Một tình huống phổ biến để sử dụng <code>replace()</code> là <strong>chỉ thay đổi một giá trị trong một hàng, bằng cách sử dụng định danh hàng duy nhất</strong>. Dưới đây, giới tính được thay đổi thành “Female” trong hàng mà cột <code>case_id</code> có giá trị là “2195”.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="cleaning.html#cb245-1" tabindex="-1"></a><span class="co"># Example: change gender of one specific observation to &quot;Female&quot; </span></span>
<span id="cb245-2"><a href="cleaning.html#cb245-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb245-3"><a href="cleaning.html#cb245-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">replace</span>(gender, case_id <span class="sc">==</span> <span class="st">&quot;2195&quot;</span>, <span class="st">&quot;Female&quot;</span>))</span></code></pre></div>
<p>Lệnh tương tự sử dụng cú pháp trong <strong>base</strong> R và dấu ngoặc vuông [] ở bên dưới. Nó có nội dung là “Thay đổi giá trị của cột <code>gender</code> trong bộ dữ liệu <code>linelist</code> (đối với các hàng mà cột <code>case_id</code> của <code>linelist</code> có giá trị ‘2195’) thành ‘Female’”.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="cleaning.html#cb246-1" tabindex="-1"></a>linelist<span class="sc">$</span>gender[linelist<span class="sc">$</span>case_id <span class="sc">==</span> <span class="st">&quot;2195&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Female&quot;</span></span></code></pre></div>
</div>
<div id="ifelse-và-if_else" class="section level4 unnumbered">
<h4><code>ifelse()</code> và <code>if_else()</code></h4>
<p>Một cách khác áp dụng cho logic đơn giản là hàm <code>ifelse()</code> và hàm tương tự là <code>if_else()</code>. Tuy nhiên, trong hầu hết các trường hợp để mã hóa lại, cách rõ ràng hơn là sử dụng hàm <code>case_when()</code> (chi tiết bên dưới). Câu lệnh “if else” này là các phiên bản đơn giản hóa của câu lệnh lập trình <code>if</code> và <code>else</code>. Cú pháp chung là:<br />
<code>ifelse(condition, value to return if condition evaluates to TRUE, value to return if condition evaluates to FALSE)</code></p>
<p>Dưới đây, cột <code>source_known</code> được định nghĩa. Giá trị của nó trong một hàng được đặt thành “known” nếu giá trị của hàng trong cột <code>source</code> không bị thiếu. Nếu thiếu giá trị trong cột <code>source</code>, thì giá trị trong <code>source_known</code> được đặt thành “unknown”.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="cleaning.html#cb247-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb247-2"><a href="cleaning.html#cb247-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">source_known =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(source), <span class="st">&quot;known&quot;</span>, <span class="st">&quot;unknown&quot;</span>))</span></code></pre></div>
<p><code>if_else()</code> là một phiên bản đặc biệt từ package <strong>dplyr</strong> để xử lý ngày tháng. Lưu ý rằng nếu giá trị ‘true’ là một ngày thì giá trị ‘false’ cũng phải đủ điều kiện là một ngày, do đó sử dụng giá trị đặc biệt <code>NA_real_</code> thay vì chỉ <code>NA</code>.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="cleaning.html#cb248-1" tabindex="-1"></a><span class="co"># Create a date of death column, which is NA if patient has not died.</span></span>
<span id="cb248-2"><a href="cleaning.html#cb248-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb248-3"><a href="cleaning.html#cb248-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_death =</span> <span class="fu">if_else</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, date_outcome, <span class="cn">NA_real_</span>))</span></code></pre></div>
<p><strong>Tránh lồng ghép nhiều lệnh ifelse với nhau… thay vào đó hãy sử dụng <code>case_when()</code>!</strong> <code>case_when()</code> dễ đọc hơn và bạn sẽ mắc ít lỗi hơn.</p>
<p><img src="images/ifelse%20bad.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Ngoài phạm vi của bộ dữ liệu, nếu bạn muốn một đối tượng được sử dụng trong code của mình chuyển đổi giá trị của nó, hãy xem xét sử dụng hàm <code>switch()</code> từ <strong>base</strong> R.</p>
</div>
</div>
<div id="clean_case_when" class="section level3 unnumbered">
<h3>Logic phức tạp</h3>
<p>Sử dụng <code>case_when()</code> của package <strong>dplyr</strong> nếu bạn đang mã hóa lại thành nhiều nhóm mới hoặc nếu bạn cần sử dụng các câu lệnh logic phức tạp để mã hóa lại các giá trị. Hàm này đánh giá mọi hàng trong bộ dữ liệu, đánh giá xem các hàng có đáp ứng các tiêu chí đã chỉ định hay không và chỉ định giá trị mới chính xác.</p>
<p>Câu lệnh <code>case_when()</code> bao gồm hai cấu phần là Bên tay Phải (RHS) và Bên tay Trái (LHS) được phân tách bằng “dấu ngã” <code>~</code>. Các tiêu chí logic nằm ở phía bên trái và các giá trị tương ứng nằm ở phía bên phải của mỗi mệnh đề. Các mệnh đề được phân tách bằng dấu phẩy.</p>
<p>Ví dụ: chúng tôi sử dụng cột <code>age</code> và <code>age_unit</code> để tạo cột <code>age_years</code>:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="cleaning.html#cb249-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb249-2"><a href="cleaning.html#cb249-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb249-3"><a href="cleaning.html#cb249-3" tabindex="-1"></a>            age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span>  <span class="sc">~</span> age,       <span class="co"># if unit is years</span></span>
<span id="cb249-4"><a href="cleaning.html#cb249-4" tabindex="-1"></a>            age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,    <span class="co"># if unit is months, divide age by 12</span></span>
<span id="cb249-5"><a href="cleaning.html#cb249-5" tabindex="-1"></a>            <span class="fu">is.na</span>(age_unit)      <span class="sc">~</span> age,       <span class="co"># if age unit is missing, assume years</span></span>
<span id="cb249-6"><a href="cleaning.html#cb249-6" tabindex="-1"></a>            <span class="cn">TRUE</span>                 <span class="sc">~</span> <span class="cn">NA_real_</span>)) <span class="co"># any other circumstance, assign NA (missing)</span></span></code></pre></div>
<p>Khi mỗi hàng trong dữ liệu được đánh giá, các tiêu chí được áp dụng/đánh giá theo thứ tự đã viết trong <code>case_when()</code> - từ trên xuống dưới. Nếu tiêu chí đánh giá đầu tiên trả kết quả là <code>TRUE</code> cho một hàng nhất định, giá trị Bên tay phải sẽ được gán và các tiêu chí còn lại sẽ không được kiểm tra cho hàng đó. Vì vậy, tốt nhất là bạn nên viết các tiêu chí đánh giá cụ thể nhất lên đầu, theo sau bởi các tiêu chí chung hơn. Các dòng không đáp ứng bất kỳ tiêu chí nào sẽ được gán giá trị <code>NA</code>.</p>
<p>Đôi khi, bạn muốn gán một giá trị cụ thể cho biến mới mà không thỏa mãn bất kỳ tiêu chí nào, hãy đặt <code>TRUE</code> ở phía bên trái của tiêu chí đánh giá cuối cùng. Phía bên phải của mệnh đề này có thể được gán một giá trị như “kiểm tra tôi! (check me)” hoặc missing.</p>
<p>Dưới đấy là một ví dụ khác sử dụng <code>case_when()</code> để tạo cột mới phân loại tình trạng bệnh nhân, dựa theo định nghĩa ca bệnh là đã xác định hoặc nghi ngờ:</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="cleaning.html#cb250-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb250-2"><a href="cleaning.html#cb250-2" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">case_status =</span> <span class="fu">case_when</span>(</span>
<span id="cb250-3"><a href="cleaning.html#cb250-3" tabindex="-1"></a>          </span>
<span id="cb250-4"><a href="cleaning.html#cb250-4" tabindex="-1"></a>          <span class="co"># if patient had lab test and it is positive,</span></span>
<span id="cb250-5"><a href="cleaning.html#cb250-5" tabindex="-1"></a>          <span class="co"># then they are marked as a confirmed case </span></span>
<span id="cb250-6"><a href="cleaning.html#cb250-6" tabindex="-1"></a>          ct_blood <span class="sc">&lt;</span> <span class="dv">20</span>                   <span class="sc">~</span> <span class="st">&quot;Confirmed&quot;</span>,</span>
<span id="cb250-7"><a href="cleaning.html#cb250-7" tabindex="-1"></a>          </span>
<span id="cb250-8"><a href="cleaning.html#cb250-8" tabindex="-1"></a>          <span class="co"># given that a patient does not have a positive lab result,</span></span>
<span id="cb250-9"><a href="cleaning.html#cb250-9" tabindex="-1"></a>          <span class="co"># if patient has a &quot;source&quot; (epidemiological link) AND has fever, </span></span>
<span id="cb250-10"><a href="cleaning.html#cb250-10" tabindex="-1"></a>          <span class="co"># then they are marked as a suspect case</span></span>
<span id="cb250-11"><a href="cleaning.html#cb250-11" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">is.na</span>(source) <span class="sc">&amp;</span> fever <span class="sc">==</span> <span class="st">&quot;yes&quot;</span> <span class="sc">~</span> <span class="st">&quot;Suspect&quot;</span>,</span>
<span id="cb250-12"><a href="cleaning.html#cb250-12" tabindex="-1"></a>          </span>
<span id="cb250-13"><a href="cleaning.html#cb250-13" tabindex="-1"></a>          <span class="co"># any other patient not addressed above </span></span>
<span id="cb250-14"><a href="cleaning.html#cb250-14" tabindex="-1"></a>          <span class="co"># is marked for follow up</span></span>
<span id="cb250-15"><a href="cleaning.html#cb250-15" tabindex="-1"></a>          <span class="cn">TRUE</span>                            <span class="sc">~</span> <span class="st">&quot;To investigate&quot;</span>))</span></code></pre></div>
<p><span style="color: red;"><strong><em>NGUY HIỂM</em></strong>: Các giá trị ở phía bên phải đều phải cùng một phần lớp - số, ký tự, ngày tháng, lôgic, v.v. Để gán giá trị thiếu (NA), bạn có thể cần sử dụng các biến thể đặc biệt của <code>NA</code> như <code>NA_character_</code>, <code>NA_real_</code> (cho số hoặc POSIX) và <code>as.Date(NA)</code>. Đọc thêm trong chương <a href="dates.html#dates">Làm việc với ngày tháng</a>.</span></p>
</div>
<div id="giá-trị-missing-1" class="section level3 unnumbered">
<h3>Giá trị missing</h3>
<p>Dưới đây là các hàm đặc biệt để xử lý các giá trị bị thiếu trong khi làm sạch dữ liệu.</p>
<p>Xem chương về <a href="missing-data.html#missing-data">Dữ liệu Missing</a> để biết thêm các mẹo chi tiết về xác định và xử lý các giá trị bị thiếu. Ví dụ, hàm <code>is.na()</code> kiểm tra một cách logic sự thiếu giá trị.</p>
<p><strong><code>replace_na()</code></strong></p>
<p>Để thay đổi các giá trị bị thiếu (<code>NA</code>) thành một giá trị cụ thể, chẳng hạn như “Missing”, hãy sử dụng hàm <code>replace_na()</code> trong hàm <code>mutate()</code> trong package <strong>dplyr</strong>. Lưu ý rằng điều này được sử dụng theo cách tương tự như hàm <code>recode</code> ở trên - tên của biến phải được lặp lại trong <code>replace_na()</code>.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="cleaning.html#cb251-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb251-2"><a href="cleaning.html#cb251-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span></code></pre></div>
<p><strong>fct_explicit_na()</strong></p>
<p>Đây là một hàm từ package <strong>forcats</strong>. Package <strong>forcats</strong> xử lý các cột dạng Factor. Factor là cách của R để xử lý các giá trị có thứ tự như <code>c("First", "Second", "Third")</code> hoặc để thiết lập thứ tự cho các giá trị (ví dụ: bệnh viện) xuất hiện trong bảng và biểu đồ. Xem chương <a href="factors.html#factors">Factors</a>.</p>
<p>Nếu dữ liệu của bạn là kiểu Factor và bạn đang cố gắng chuyển giá trị <code>NA</code> thành “Missing” bằng cách sử dụng hàm <code>replace_na()</code>, bạn sẽ gặp lỗi này: <code>invalid factor level, NA generated</code>. Bạn đã cố gắng thêm “Missing” làm giá trị, trong khi nó đã không được xác định là một thứ bậc trong cột Factor, và câu lệnh bị từ chối.</p>
<p>Cách dễ nhất để giải quyết vấn đề này là sử dụng hàm <strong>forcats</strong> <code>fct_explicit_na()</code> để chuyển đổi một cột thành kiểu Factor và chuyển đổi các giá trị <code>NA</code> thành ký tự “(Missing)”.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="cleaning.html#cb252-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb252-2"><a href="cleaning.html#cb252-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">fct_explicit_na</span>(hospital))</span></code></pre></div>
<p>Một giải pháp thay thế chậm hơn sẽ là thêm thứ bậc cho cột Factor bằng cách sử dụng hàm <code>fct_expand()</code> và sau đó chuyển đổi các giá trị bị thiếu.</p>
<p><strong><code>na_if()</code></strong></p>
<p>Để chuyển đổi một <em>giá trị cụ thể</em> thành <code>NA</code>, hãy sử dụng hàm <code>na_if()</code> trong package <strong>dplyr</strong>. Hàm này thực hiện thao tác ngược lại với hàm <code>replace_na()</code>. Trong ví dụ bên dưới, bất kỳ giá trị nào bị “Missing” trong cột <code>hospital</code> đều được chuyển đổi thành <code>NA</code>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="cleaning.html#cb253-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb253-2"><a href="cleaning.html#cb253-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">na_if</span>(hospital, <span class="st">&quot;Missing&quot;</span>))</span></code></pre></div>
<p>Lưu ý: <code>na_if()</code> <strong>không thể sử dụng cho điều kiện logic</strong> (ví dụ: “all values &gt; 99”) - hãy sử dụng <code>replace()</code> hoặc <code>case_when()</code> cho điều này:</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="cleaning.html#cb254-1" tabindex="-1"></a><span class="co"># Convert temperatures above 40 to NA </span></span>
<span id="cb254-2"><a href="cleaning.html#cb254-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb254-3"><a href="cleaning.html#cb254-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp =</span> <span class="fu">replace</span>(temp, temp <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="cn">NA</span>))</span>
<span id="cb254-4"><a href="cleaning.html#cb254-4" tabindex="-1"></a></span>
<span id="cb254-5"><a href="cleaning.html#cb254-5" tabindex="-1"></a><span class="co"># Convert onset dates earlier than 1 Jan 2000 to missing</span></span>
<span id="cb254-6"><a href="cleaning.html#cb254-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb254-7"><a href="cleaning.html#cb254-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_onset =</span> <span class="fu">replace</span>(date_onset, date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2000-01-01&quot;</span>), <span class="cn">NA</span>))</span></code></pre></div>
</div>
<div id="từ-điển-làm-sạch" class="section level3 unnumbered">
<h3>Từ điển làm sạch</h3>
<p>Sử dụng package <strong>matchmaker</strong> trong R và hàm <code>match_df()</code> để làm sạch bộ dữ liệu bằng <em>từ điển làm sạch</em>.</p>
<ol style="list-style-type: decimal">
<li><p>Tạo từ điển làm sạch với 3 cột:</p>
<ul>
<li>Cột “từ” (giá trị không chính xác)<br />
</li>
<li>Cột “tới” (giá trị chính xác)<br />
</li>
<li>Một cột chỉ định cột cho các thay đổi sẽ được áp dụng (hoặc “.global” để áp dụng cho tất cả các cột)</li>
</ul></li>
</ol>
<p>Lưu ý: các mục từ điển .global sẽ bị ghi đè bởi các mục từ điển theo cột cụ thể.</p>
<p><img src="images/cleaning_dict.png" width="75%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Nạp tệp từ điển vào R. Ví dụ này có thể được tải xuống theo hướng dẫn trong chương <a href="data-used.html#data-used">Tải sách và dữ liệu</a>.</li>
</ol>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="cleaning.html#cb255-1" tabindex="-1"></a>cleaning_dict <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;cleaning_dict.csv&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Chuyển bộ dữ liệu linelist ban đầu đến hàm <code>match_df()</code>, xác định <code>dictionary =</code> là bộ dữ liệu từ điển làm sạch. Đối số <code>from =</code> dùng để chỉ định cột trong từ điển tham chiếu chứa các giá trị “cũ”, đối số <code>by =</code> dùng để chỉ định cột trong từ điển tham chiếu chứa các giá trị “mới” tương ứng và cột thứ ba liệt kê cột thực hiện thay đổi. Sử dụng <code>.global</code> trong đối số <code>by =</code> để áp dụng thay đổi trên tất cả các cột. Cột từ điển thứ tư <code>order</code> có thể được sử dụng để chỉ định thức bậc của các giá trị mới.</li>
</ol>
<p>Bạn có thể đọc thêm về hàm ở <a href="https://cran.r-project.org/web/packages/matchmaker/vignettes/intro.html">package documentation</a> bằng cách chạy <code>?match_df</code>. Lưu ý rằng hàm này có thể mất nhiều thời gian để chạy trên dữ liệu lớn.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="cleaning.html#cb256-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb256-2"><a href="cleaning.html#cb256-2" tabindex="-1"></a>  matchmaker<span class="sc">::</span><span class="fu">match_df</span>(</span>
<span id="cb256-3"><a href="cleaning.html#cb256-3" tabindex="-1"></a>          <span class="at">dictionary =</span> cleaning_dict,  <span class="co"># name of your dictionary</span></span>
<span id="cb256-4"><a href="cleaning.html#cb256-4" tabindex="-1"></a>          <span class="at">from =</span> <span class="st">&quot;from&quot;</span>,               <span class="co"># column with values to be replaced (default is col 1)</span></span>
<span id="cb256-5"><a href="cleaning.html#cb256-5" tabindex="-1"></a>          <span class="at">to =</span> <span class="st">&quot;to&quot;</span>,                   <span class="co"># column with final values (default is col 2)</span></span>
<span id="cb256-6"><a href="cleaning.html#cb256-6" tabindex="-1"></a>          <span class="at">by =</span> <span class="st">&quot;col&quot;</span>                   <span class="co"># column with column names (default is col 3)</span></span>
<span id="cb256-7"><a href="cleaning.html#cb256-7" tabindex="-1"></a>  )</span></code></pre></div>
<p>Bây giờ, hãy cuộn sang bên phải để xem các giá trị đã thay đổi như thế nào - đặc biệt là <code>gender</code> (chữ thường thành chữ hoa) và tất cả các cột triệu chứng đã được chuyển từ có/không thành 1/0.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-a554b6802180c8e18382" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a554b6802180c8e18382">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["M","F","M","F","M","F","F","F","M","F","M","M","M","F","F","M","F","F","F","F","M","M","F","M","F","M","M","F","M","F","F","F","M","M","F","M","F","F","F","M","F","M","F","M","M","F","M","F","M","M"],["Other",null,"St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital",null,null,null,null,"Port Hospital","Military Hospital",null,null,"Other","Port Hospital","Port Hospital","Port Hospital",null,"Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null,"Other",null,"St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital",null,"Military Hospital","Other",null,null,"Port Hospital","Port Hospital","Port Hospital",null,"Central Hospital","Military Hospital","Other","Other","Other",null,"St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)",null],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","0","0","0","0","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","0","1","0",null,"0","0","0","1","0",null,"0","0","1",null,null,"0","0",null,"0","0",null,null,"0","0",null,"0","0",null,"0","1","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","1","1","1","1","1","1","1","1","1",null,"1","1","1","1","1",null,"1","1","1",null,null,"1","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","1","1","1","0",null],["0",null,null,"0","0","0",null,"0","0","0","0","0","0","0","0","1","0","0",null,"0","0","0","0","0",null,"0","0","0",null,null,"0","0",null,"0","0",null,null,"1","1",null,"0","0",null,"0","0","0","0","0","0",null],["1",null,null,"0","1","1",null,"1","1","0","1","0","0","0","1","0","0","0",null,"0","1","0","0","0",null,"0","0","0",null,null,"0","1",null,"1","1",null,null,"1","1",null,"1","1",null,"1","1","0","1","1","1",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>age_years<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,9,10,13,15,16,17,23,25,26]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"hospital","targets":8},{"name":"lon","targets":9},{"name":"lat","targets":10},{"name":"infector","targets":11},{"name":"source","targets":12},{"name":"age","targets":13},{"name":"age_unit","targets":14},{"name":"wt_kg","targets":15},{"name":"ht_cm","targets":16},{"name":"ct_blood","targets":17},{"name":"fever","targets":18},{"name":"chills","targets":19},{"name":"cough","targets":20},{"name":"aches","targets":21},{"name":"vomit","targets":22},{"name":"temp","targets":23},{"name":"time_admission","targets":24},{"name":"bmi","targets":25},{"name":"age_years","targets":26}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Lưu ý rằng tên cột của bạn trong từ điển làm sạch phải tương ứng với tên <em>tại thời điểm</em> trong script làm sạch của bạn. Xem <a href="https://www.repidemicsconsortium.org/linelist/reference/clean_data.html">tài liệu tham khảo trực tuyến về package linelist</a> để biết thêm chi tiết.</p>
<div id="thêm-vào-chuỗi-làm-sạch" class="section level4 unnumbered">
<h4>Thêm vào chuỗi làm sạch</h4>
<p><strong>Dưới đây, một số cột mới và biến đổi cột được thêm vào chuỗi các bước làm sạch.</strong></p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="cleaning.html#cb257-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb257-2"><a href="cleaning.html#cb257-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb257-3"><a href="cleaning.html#cb257-3" tabindex="-1"></a></span>
<span id="cb257-4"><a href="cleaning.html#cb257-4" tabindex="-1"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb257-5"><a href="cleaning.html#cb257-5" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb257-6"><a href="cleaning.html#cb257-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb257-7"><a href="cleaning.html#cb257-7" tabindex="-1"></a>    </span>
<span id="cb257-8"><a href="cleaning.html#cb257-8" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb257-9"><a href="cleaning.html#cb257-9" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb257-10"><a href="cleaning.html#cb257-10" tabindex="-1"></a>    </span>
<span id="cb257-11"><a href="cleaning.html#cb257-11" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb257-12"><a href="cleaning.html#cb257-12" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb257-13"><a href="cleaning.html#cb257-13" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb257-14"><a href="cleaning.html#cb257-14" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb257-15"><a href="cleaning.html#cb257-15" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb257-16"><a href="cleaning.html#cb257-16" tabindex="-1"></a>    </span>
<span id="cb257-17"><a href="cleaning.html#cb257-17" tabindex="-1"></a>    <span class="co"># remove column</span></span>
<span id="cb257-18"><a href="cleaning.html#cb257-18" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-19"><a href="cleaning.html#cb257-19" tabindex="-1"></a>  </span>
<span id="cb257-20"><a href="cleaning.html#cb257-20" tabindex="-1"></a>    <span class="co"># de-duplicate</span></span>
<span id="cb257-21"><a href="cleaning.html#cb257-21" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb257-22"><a href="cleaning.html#cb257-22" tabindex="-1"></a>  </span>
<span id="cb257-23"><a href="cleaning.html#cb257-23" tabindex="-1"></a>    <span class="co"># add column</span></span>
<span id="cb257-24"><a href="cleaning.html#cb257-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb257-25"><a href="cleaning.html#cb257-25" tabindex="-1"></a></span>
<span id="cb257-26"><a href="cleaning.html#cb257-26" tabindex="-1"></a>    <span class="co"># convert class of columns</span></span>
<span id="cb257-27"><a href="cleaning.html#cb257-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb257-28"><a href="cleaning.html#cb257-28" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb257-29"><a href="cleaning.html#cb257-29" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-30"><a href="cleaning.html#cb257-30" tabindex="-1"></a>    </span>
<span id="cb257-31"><a href="cleaning.html#cb257-31" tabindex="-1"></a>    <span class="co"># add column: delay to hospitalisation</span></span>
<span id="cb257-32"><a href="cleaning.html#cb257-32" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-33"><a href="cleaning.html#cb257-33" tabindex="-1"></a>    </span>
<span id="cb257-34"><a href="cleaning.html#cb257-34" tabindex="-1"></a>   <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb257-35"><a href="cleaning.html#cb257-35" tabindex="-1"></a>   <span class="do">###################################################</span></span>
<span id="cb257-36"><a href="cleaning.html#cb257-36" tabindex="-1"></a></span>
<span id="cb257-37"><a href="cleaning.html#cb257-37" tabindex="-1"></a>    <span class="co"># clean values of hospital column</span></span>
<span id="cb257-38"><a href="cleaning.html#cb257-38" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb257-39"><a href="cleaning.html#cb257-39" tabindex="-1"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb257-40"><a href="cleaning.html#cb257-40" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb257-41"><a href="cleaning.html#cb257-41" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb257-42"><a href="cleaning.html#cb257-42" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb257-43"><a href="cleaning.html#cb257-43" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb257-44"><a href="cleaning.html#cb257-44" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb257-45"><a href="cleaning.html#cb257-45" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb257-46"><a href="cleaning.html#cb257-46" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb257-47"><a href="cleaning.html#cb257-47" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb257-48"><a href="cleaning.html#cb257-48" tabindex="-1"></a>    </span>
<span id="cb257-49"><a href="cleaning.html#cb257-49" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb257-50"><a href="cleaning.html#cb257-50" tabindex="-1"></a></span>
<span id="cb257-51"><a href="cleaning.html#cb257-51" tabindex="-1"></a>    <span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb257-52"><a href="cleaning.html#cb257-52" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb257-53"><a href="cleaning.html#cb257-53" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span> <span class="sc">~</span> age,</span>
<span id="cb257-54"><a href="cleaning.html#cb257-54" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb257-55"><a href="cleaning.html#cb257-55" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age,</span>
<span id="cb257-56"><a href="cleaning.html#cb257-56" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="num_cats" class="section level2" number="8.9">
<h2><span class="header-section-number">8.9</span> Biến danh mục số</h2>
<p>Ở đây chúng tôi mô tả một số cách tiếp cận đặc biệt để tạo cột dạng danh mục từ các cột dạng số. Các ví dụ phổ biến bao gồm danh mục độ tuổi, nhóm giá trị trong phòng thí nghiệm, v.v. Ở đây chúng ta sẽ thảo luận:</p>
<ul>
<li><code>age_categories()</code>, từ package <strong>epikit</strong><br />
</li>
<li><code>cut()</code>, từ <strong>base</strong> R<br />
</li>
<li><code>case_when()</code><br />
</li>
<li>Chia khoảng phân vị với <code>quantile()</code> and <code>ntile()</code></li>
</ul>
<div id="đánh-giá-phân-phối" class="section level3 unnumbered">
<h3>Đánh giá phân phối</h3>
<p>Trong ví dụ này, chúng tôi sẽ tạo một cột <code>age_cat</code> bằng cách sử dụng cột <code>age_years</code>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="cleaning.html#cb258-1" tabindex="-1"></a><span class="co">#check the class of the linelist variable age</span></span>
<span id="cb258-2"><a href="cleaning.html#cb258-2" tabindex="-1"></a><span class="fu">class</span>(linelist<span class="sc">$</span>age_years)</span></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Trước tiên, hãy kiểm tra phân phối dữ liệu của bạn để đưa ra các điểm cắt thích hợp. Xem chương <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a>.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="cleaning.html#cb260-1" tabindex="-1"></a><span class="co"># examine the distribution</span></span>
<span id="cb260-2"><a href="cleaning.html#cb260-2" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>age_years)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-242-1.png" width="672" height="50%" /></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="cleaning.html#cb261-1" tabindex="-1"></a><span class="fu">summary</span>(linelist<span class="sc">$</span>age_years, <span class="at">na.rm=</span>T)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    0.00    6.00   13.00   16.04   23.00   84.00     107</code></pre>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG</em></strong>: Đôi khi, các biến số sẽ được nhập vào dưới dạng kiểu “ký tự”. Điều này xảy ra nếu có các ký tự không phải số trong một số giá trị, ví dụ: có bản ghi nhập “2 tháng” cho biến tuổi hoặc (tùy thuộc vào cài đặt ngôn ngữ R của bạn) nếu dấu phẩy được sử dụng cho số thập phân (ví dụ: “4,5”nghĩa là bốn năm rưỡi).</span></p>
<!-- ======================================================= -->
</div>
<div id="age_categories" class="section level3 unnumbered">
<h3><code>age_categories()</code></h3>
<p>Với package <strong>epikit</strong>, bạn có thể sử dụng hàm <code>age_categories()</code> để dễ dàng phân loại và gắn nhãn các cột dạng số (lưu ý: hàm này cũng có thể được áp dụng cho các biến ngoài biến tuổi). Như một “phần thưởng”, cột trả về tự động là một cột dạng factor có thứ tự.</p>
<p>Dưới đây là các yêu cầu đầu vào:</p>
<ul>
<li>Một vectơ (cột) dạng số<br />
</li>
<li>Đối sốc <code>breakers =</code> - cung cấp một vectơ dạng số của các điểm cắt cho các phân nhóm mới.</li>
</ul>
<p>Đầu tiên, ví dụ đơn giản nhất:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="cleaning.html#cb263-1" tabindex="-1"></a><span class="co"># Simple example</span></span>
<span id="cb263-2"><a href="cleaning.html#cb263-2" tabindex="-1"></a><span class="do">################</span></span>
<span id="cb263-3"><a href="cleaning.html#cb263-3" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(epikit)                    <span class="co"># load package</span></span>
<span id="cb263-4"><a href="cleaning.html#cb263-4" tabindex="-1"></a></span>
<span id="cb263-5"><a href="cleaning.html#cb263-5" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb263-6"><a href="cleaning.html#cb263-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb263-7"><a href="cleaning.html#cb263-7" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(             <span class="co"># create new column</span></span>
<span id="cb263-8"><a href="cleaning.html#cb263-8" tabindex="-1"></a>      age_years,                            <span class="co"># numeric column to make groups from</span></span>
<span id="cb263-9"><a href="cleaning.html#cb263-9" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>,        <span class="co"># break points</span></span>
<span id="cb263-10"><a href="cleaning.html#cb263-10" tabindex="-1"></a>                   <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>)))</span>
<span id="cb263-11"><a href="cleaning.html#cb263-11" tabindex="-1"></a></span>
<span id="cb263-12"><a href="cleaning.html#cb263-12" tabindex="-1"></a><span class="co"># show table</span></span>
<span id="cb263-13"><a href="cleaning.html#cb263-13" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-69   70+  &lt;NA&gt; 
##  1227  1223  1048   827  1216   597   251    78    27     7   107</code></pre>
<p>Các giá trị cắt bạn chỉ định mặc định là các giới hạn thấp hơn - nghĩa là chúng được đưa vào nhóm “cao hơn”/các nhóm “mở” ở phía dưới/bên trái. Như trình bày dưới đây, bạn có thể thêm 1 vào mỗi giá trị cắt để đạt được các nhóm mà được “mở” ở trên cùng/bên phải.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="cleaning.html#cb265-1" tabindex="-1"></a><span class="co"># Include upper ends for the same categories</span></span>
<span id="cb265-2"><a href="cleaning.html#cb265-2" tabindex="-1"></a><span class="do">############################################</span></span>
<span id="cb265-3"><a href="cleaning.html#cb265-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb265-4"><a href="cleaning.html#cb265-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb265-5"><a href="cleaning.html#cb265-5" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb265-6"><a href="cleaning.html#cb265-6" tabindex="-1"></a>      age_years, </span>
<span id="cb265-7"><a href="cleaning.html#cb265-7" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="dv">11</span>, <span class="dv">16</span>, <span class="dv">21</span>, <span class="dv">31</span>, <span class="dv">41</span>, <span class="dv">51</span>, <span class="dv">61</span>, <span class="dv">71</span>)))</span>
<span id="cb265-8"><a href="cleaning.html#cb265-8" tabindex="-1"></a></span>
<span id="cb265-9"><a href="cleaning.html#cb265-9" tabindex="-1"></a><span class="co"># show table</span></span>
<span id="cb265-10"><a href="cleaning.html#cb265-10" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-5  6-10 11-15 16-20 21-30 31-40 41-50 51-60 61-70   71+  &lt;NA&gt; 
##  1469  1195  1040   770  1149   547   231    70    24     6   107</code></pre>
<p>Bạn có thể điều chỉnh cách hiển thị nhãn bằng <code>separator =</code>. Giá trị mặc định là “-”</p>
<p>Bạn có thể điều chỉnh cách xử lý các số ở hàng đầu, với đối số <code>ceiling =</code>. Thiết lập mức giới hạn cắt trên với <code>ceiling = TRUE</code>. Trong cách sử dụng này, giá trị cắt cao nhất được cung cấp là “ceiling” và danh mục “XX+” không được tạo. Bất kỳ giá trị nào trên giá trị cắt cao nhất (hoặc <code>upper =</code>, nếu được xác định) đều được phân loại là <code>NA</code>. Dưới đây là một ví dụ với <code>ceiling = TRUE</code>, do đó không có danh mục nào là XX + và các giá trị trên 70 (giá trị cắt cao nhất) được chỉ định là NA.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="cleaning.html#cb267-1" tabindex="-1"></a><span class="co"># With ceiling set to TRUE</span></span>
<span id="cb267-2"><a href="cleaning.html#cb267-2" tabindex="-1"></a><span class="do">##########################</span></span>
<span id="cb267-3"><a href="cleaning.html#cb267-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb267-4"><a href="cleaning.html#cb267-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb267-5"><a href="cleaning.html#cb267-5" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb267-6"><a href="cleaning.html#cb267-6" tabindex="-1"></a>      age_years, </span>
<span id="cb267-7"><a href="cleaning.html#cb267-7" tabindex="-1"></a>      <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">70</span>),</span>
<span id="cb267-8"><a href="cleaning.html#cb267-8" tabindex="-1"></a>      <span class="at">ceiling =</span> <span class="cn">TRUE</span>)) <span class="co"># 70 is ceiling, all above become NA</span></span>
<span id="cb267-9"><a href="cleaning.html#cb267-9" tabindex="-1"></a></span>
<span id="cb267-10"><a href="cleaning.html#cb267-10" tabindex="-1"></a><span class="co"># show table</span></span>
<span id="cb267-11"><a href="cleaning.html#cb267-11" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-4   5-9 10-14 15-19 20-29 30-39 40-49 50-59 60-70  &lt;NA&gt; 
##  1227  1223  1048   827  1216   597   251    78    28   113</code></pre>
<p>Ngoài ra, thay vì dùng <code>breakers =</code>, bạn có thể sử dụng hàm <code>lower =</code>, <code>upper =</code>, và <code>by =</code>:</p>
<ul>
<li><code>lower =</code> Mức giới hạn thấp nhất bạn muốn xem xét - mặc định là 0<br />
</li>
<li><code>upper =</code> Mức giới hạn cao nhất bạn muốn xem xét<br />
</li>
<li><code>by =</code> Khoảng cách “năm” giữa các nhóm</li>
</ul>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="cleaning.html#cb269-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb269-2"><a href="cleaning.html#cb269-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb269-3"><a href="cleaning.html#cb269-3" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">age_categories</span>(</span>
<span id="cb269-4"><a href="cleaning.html#cb269-4" tabindex="-1"></a>      age_years, </span>
<span id="cb269-5"><a href="cleaning.html#cb269-5" tabindex="-1"></a>      <span class="at">lower =</span> <span class="dv">0</span>,</span>
<span id="cb269-6"><a href="cleaning.html#cb269-6" tabindex="-1"></a>      <span class="at">upper =</span> <span class="dv">100</span>,</span>
<span id="cb269-7"><a href="cleaning.html#cb269-7" tabindex="-1"></a>      <span class="at">by =</span> <span class="dv">10</span>))</span>
<span id="cb269-8"><a href="cleaning.html#cb269-8" tabindex="-1"></a></span>
<span id="cb269-9"><a href="cleaning.html#cb269-9" tabindex="-1"></a><span class="co"># show table</span></span>
<span id="cb269-10"><a href="cleaning.html#cb269-10" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##   0-9 10-19 20-29 30-39 40-49 50-59 60-69 70-79 80-89 90-99  100+  &lt;NA&gt; 
##  2450  1875  1216   597   251    78    27     6     1     0     0   107</code></pre>
<p>Xem thêm trang trợ giúp của hàm để biết thêm chi tiết (nhập <code>?age_categories</code> trong R console).</p>
<!-- ======================================================= -->
</div>
<div id="cut" class="section level3 unnumbered">
<h3><code>cut()</code></h3>
<p>Hàm <code>cut()</code> trong <strong>base R</strong> là một thay thế cho hàm <code>age_categories()</code>, nhưng tôi nghĩ bạn sẽ thấy lý do tại sao hàm <code>age_categories()</code> được phát triển để đơn giản hóa quá trình này. Một số khác biệt đáng chú ý với hàm <code>age_categories()</code> là:</p>
<ul>
<li>Bạn không cần cài đặt/gọi package khác<br />
</li>
<li>Bạn có thể chỉ định xem các nhóm được mở/đóng ở bên phải/bên trái<br />
</li>
<li>Bạn cần phải cung cấp nhãn chính xác<br />
</li>
<li>Nếu bạn muốn 0 được thêm vào trong nhóm thấp nhất, bạn cần phải cụ thể điều này</li>
</ul>
<p>Cú pháp cơ bản trong <code>cut()</code> trước tiên là cung cấp cột dạng số cần xử lý (<code>age_years</code>), sau đó là đối số <em>break</em>, một vectơ dạng số <code>c()</code> bao gồm các điểm cắt. Sử dụng <code>cut()</code>, kết quả trả về là cột kiểu factor có thứ tự.</p>
<p>Mặc định, việc phân loại xảy ra sao cho phía bên phải/phía trên là “mở” và có tính dung nạp (và phía bên trái/phía dưới là “đóng” hoặc tách biệt). Cách vận hành của hàm này ngược lại với hàm <code>age_categories()</code>. Các nhãn mặc định sử dụng ký hiệu “(A,B]”, có nghĩa là A không được bao gồm nhưng B thì có. <strong>Đảo ngược hành động này bằng cách cung cấp</strong> <strong>đối số <code>right = TRUE</code></strong>.</p>
<p>Do đó, theo mặc định, các giá trị “0” bị loại trừ khỏi nhóm thấp nhất và được phân loại là <code>NA</code>! Giá trị “0” có thể là trẻ sơ sinh được mã hóa là 0 tuổi, vì vậy hãy thật thận trọng! Để thay đổi điều này, hãy thêm argument <code>include.lowest = TRUE</code> để mọi giá trị “0” sẽ được đưa vào nhóm thấp nhất. Nhãn được tạo tự động cho danh mục thấp nhất sau đó sẽ là “[A],B]”. Lưu ý rằng nếu bạn thêm <code>include.lowest = TRUE</code> <strong>và</strong> <code>right = TRUE</code>, hành động này bây giờ sẽ áp dụng cho điểm cắt giá trị <em>cao nhất</em> và phân loại, không phải điểm thấp nhất.</p>
<p>Bạn có thể cung cấp một vectơ nhãn tùy chỉnh bằng cách sử dụng argument <code>labels =</code>. Vì chúng được viết theo cách thủ công, hãy rất cẩn thận để đảm bảo chúng chính xác! Kiểm tra bằng cách lập bảng chéo, như được mô tả bên dưới.</p>
<p>Dưới đây là một ví dụ về hàm <code>cut()</code> được áp dụng cho biến <code>age_years</code> để tạo biến <code>age_cat</code> mới:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="cleaning.html#cb271-1" tabindex="-1"></a><span class="co"># Create new variable, by cutting the numeric age variable</span></span>
<span id="cb271-2"><a href="cleaning.html#cb271-2" tabindex="-1"></a><span class="co"># lower break is excluded but upper break is included in each category</span></span>
<span id="cb271-3"><a href="cleaning.html#cb271-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb271-4"><a href="cleaning.html#cb271-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb271-5"><a href="cleaning.html#cb271-5" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb271-6"><a href="cleaning.html#cb271-6" tabindex="-1"></a>      age_years,</span>
<span id="cb271-7"><a href="cleaning.html#cb271-7" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>,</span>
<span id="cb271-8"><a href="cleaning.html#cb271-8" tabindex="-1"></a>                 <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),</span>
<span id="cb271-9"><a href="cleaning.html#cb271-9" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>         <span class="co"># include 0 in lowest group</span></span>
<span id="cb271-10"><a href="cleaning.html#cb271-10" tabindex="-1"></a>      ))</span>
<span id="cb271-11"><a href="cleaning.html#cb271-11" tabindex="-1"></a></span>
<span id="cb271-12"><a href="cleaning.html#cb271-12" tabindex="-1"></a><span class="co"># tabulate the number of observations per group</span></span>
<span id="cb271-13"><a href="cleaning.html#cb271-13" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##    [0,5]   (5,10]  (10,15]  (15,20]  (20,30]  (30,50]  (50,70] (70,100]     &lt;NA&gt; 
##     1469     1195     1040      770     1149      778       94        6      107</code></pre>
<p><strong>Kiểm tra đoạn code của bạn!!!</strong> Hãy chắc chắn rằng mỗi giá trị độ tuổi đã được chỉ định đúng danh mục bằng cách lập bảng chéo giữa các cột số và danh mục. Kiểm tra việc gán các giá trị ranh giới (ví dụ: 15, nếu các danh mục lân cận là 10-15 và 16-20).</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="cleaning.html#cb273-1" tabindex="-1"></a><span class="co"># Cross tabulation of the numeric and category columns. </span></span>
<span id="cb273-2"><a href="cleaning.html#cb273-2" tabindex="-1"></a><span class="fu">table</span>(<span class="st">&quot;Numeric Values&quot;</span> <span class="ot">=</span> linelist<span class="sc">$</span>age_years,   <span class="co"># names specified in table for clarity.</span></span>
<span id="cb273-3"><a href="cleaning.html#cb273-3" tabindex="-1"></a>      <span class="st">&quot;Categories&quot;</span>     <span class="ot">=</span> linelist<span class="sc">$</span>age_cat,</span>
<span id="cb273-4"><a href="cleaning.html#cb273-4" tabindex="-1"></a>      <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)                        <span class="co"># don&#39;t forget to examine NA values</span></span></code></pre></div>
<pre><code>##                     Categories
## Numeric Values       [0,5] (5,10] (10,15] (15,20] (20,30] (30,50] (50,70] (70,100] &lt;NA&gt;
##   0                    136      0       0       0       0       0       0        0    0
##   0.0833333333333333     1      0       0       0       0       0       0        0    0
##   0.25                   2      0       0       0       0       0       0        0    0
##   0.333333333333333      6      0       0       0       0       0       0        0    0
##   0.416666666666667      1      0       0       0       0       0       0        0    0
##   0.5                    6      0       0       0       0       0       0        0    0
##   0.583333333333333      3      0       0       0       0       0       0        0    0
##   0.666666666666667      3      0       0       0       0       0       0        0    0
##   0.75                   3      0       0       0       0       0       0        0    0
##   0.833333333333333      1      0       0       0       0       0       0        0    0
##   0.916666666666667      1      0       0       0       0       0       0        0    0
##   1                    275      0       0       0       0       0       0        0    0
##   1.5                    2      0       0       0       0       0       0        0    0
##   2                    308      0       0       0       0       0       0        0    0
##   3                    246      0       0       0       0       0       0        0    0
##   4                    233      0       0       0       0       0       0        0    0
##   5                    242      0       0       0       0       0       0        0    0
##   6                      0    241       0       0       0       0       0        0    0
##   7                      0    256       0       0       0       0       0        0    0
##   8                      0    239       0       0       0       0       0        0    0
##   9                      0    245       0       0       0       0       0        0    0
##   10                     0    214       0       0       0       0       0        0    0
##   11                     0      0     220       0       0       0       0        0    0
##   12                     0      0     224       0       0       0       0        0    0
##   13                     0      0     191       0       0       0       0        0    0
##   14                     0      0     199       0       0       0       0        0    0
##   15                     0      0     206       0       0       0       0        0    0
##   16                     0      0       0     186       0       0       0        0    0
##   17                     0      0       0     164       0       0       0        0    0
##   18                     0      0       0     141       0       0       0        0    0
##   19                     0      0       0     130       0       0       0        0    0
##   20                     0      0       0     149       0       0       0        0    0
##   21                     0      0       0       0     158       0       0        0    0
##   22                     0      0       0       0     149       0       0        0    0
##   23                     0      0       0       0     125       0       0        0    0
##   24                     0      0       0       0     144       0       0        0    0
##   25                     0      0       0       0     107       0       0        0    0
##   26                     0      0       0       0     100       0       0        0    0
##   27                     0      0       0       0     117       0       0        0    0
##   28                     0      0       0       0      85       0       0        0    0
##   29                     0      0       0       0      82       0       0        0    0
##   30                     0      0       0       0      82       0       0        0    0
##   31                     0      0       0       0       0      68       0        0    0
##   32                     0      0       0       0       0      84       0        0    0
##   33                     0      0       0       0       0      78       0        0    0
##   34                     0      0       0       0       0      58       0        0    0
##   35                     0      0       0       0       0      58       0        0    0
##   36                     0      0       0       0       0      33       0        0    0
##   37                     0      0       0       0       0      46       0        0    0
##   38                     0      0       0       0       0      45       0        0    0
##   39                     0      0       0       0       0      45       0        0    0
##   40                     0      0       0       0       0      32       0        0    0
##   41                     0      0       0       0       0      34       0        0    0
##   42                     0      0       0       0       0      26       0        0    0
##   43                     0      0       0       0       0      31       0        0    0
##   44                     0      0       0       0       0      24       0        0    0
##   45                     0      0       0       0       0      27       0        0    0
##   46                     0      0       0       0       0      25       0        0    0
##   47                     0      0       0       0       0      16       0        0    0
##   48                     0      0       0       0       0      21       0        0    0
##   49                     0      0       0       0       0      15       0        0    0
##   50                     0      0       0       0       0      12       0        0    0
##   51                     0      0       0       0       0       0      13        0    0
##   52                     0      0       0       0       0       0       7        0    0
##   53                     0      0       0       0       0       0       4        0    0
##   54                     0      0       0       0       0       0       6        0    0
##   55                     0      0       0       0       0       0       9        0    0
##   56                     0      0       0       0       0       0       7        0    0
##   57                     0      0       0       0       0       0       9        0    0
##   58                     0      0       0       0       0       0       6        0    0
##   59                     0      0       0       0       0       0       5        0    0
##   60                     0      0       0       0       0       0       4        0    0
##   61                     0      0       0       0       0       0       2        0    0
##   62                     0      0       0       0       0       0       1        0    0
##   63                     0      0       0       0       0       0       5        0    0
##   64                     0      0       0       0       0       0       1        0    0
##   65                     0      0       0       0       0       0       5        0    0
##   66                     0      0       0       0       0       0       3        0    0
##   67                     0      0       0       0       0       0       2        0    0
##   68                     0      0       0       0       0       0       1        0    0
##   69                     0      0       0       0       0       0       3        0    0
##   70                     0      0       0       0       0       0       1        0    0
##   72                     0      0       0       0       0       0       0        1    0
##   73                     0      0       0       0       0       0       0        3    0
##   76                     0      0       0       0       0       0       0        1    0
##   84                     0      0       0       0       0       0       0        1    0
##   &lt;NA&gt;                   0      0       0       0       0       0       0        0  107</code></pre>
<p><strong>Gán nhãn giá trị <code>NA</code></strong></p>
<p>Bạn có thể muốn gán nhãn cho các giá trị <code>NA</code> chẳng hạn như “Missing”. Bởi vì cột mới có kiểu Factor (số giá trị bị hạn chế), bạn không thể chỉ đơn giản thay đổi nó bằng <code>replace_na()</code>, vì giá trị này sẽ không được chấp nhận. Thay vào đó, hãy sử dụng hàm <code>fct_explicit_na()</code> từ package <strong>forcats</strong> như được giải thích trong chương <a href="factors.html#factors">Factors</a>.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="cleaning.html#cb275-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb275-2"><a href="cleaning.html#cb275-2" tabindex="-1"></a>  </span>
<span id="cb275-3"><a href="cleaning.html#cb275-3" tabindex="-1"></a>  <span class="co"># cut() creates age_cat, automatically of class Factor      </span></span>
<span id="cb275-4"><a href="cleaning.html#cb275-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_cat =</span> <span class="fu">cut</span>(</span>
<span id="cb275-5"><a href="cleaning.html#cb275-5" tabindex="-1"></a>    age_years,</span>
<span id="cb275-6"><a href="cleaning.html#cb275-6" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">100</span>),          </span>
<span id="cb275-7"><a href="cleaning.html#cb275-7" tabindex="-1"></a>    <span class="at">right =</span> <span class="cn">FALSE</span>,</span>
<span id="cb275-8"><a href="cleaning.html#cb275-8" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,        </span>
<span id="cb275-9"><a href="cleaning.html#cb275-9" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0-4&quot;</span>, <span class="st">&quot;5-9&quot;</span>, <span class="st">&quot;10-14&quot;</span>, <span class="st">&quot;15-19&quot;</span>, <span class="st">&quot;20-29&quot;</span>, <span class="st">&quot;30-49&quot;</span>, <span class="st">&quot;50-69&quot;</span>, <span class="st">&quot;70-100&quot;</span>)),</span>
<span id="cb275-10"><a href="cleaning.html#cb275-10" tabindex="-1"></a>         </span>
<span id="cb275-11"><a href="cleaning.html#cb275-11" tabindex="-1"></a>    <span class="co"># make missing values explicit</span></span>
<span id="cb275-12"><a href="cleaning.html#cb275-12" tabindex="-1"></a>    <span class="at">age_cat =</span> <span class="fu">fct_explicit_na</span>(</span>
<span id="cb275-13"><a href="cleaning.html#cb275-13" tabindex="-1"></a>      age_cat,</span>
<span id="cb275-14"><a href="cleaning.html#cb275-14" tabindex="-1"></a>      <span class="at">na_level =</span> <span class="st">&quot;Missing age&quot;</span>)  <span class="co"># you can specify the label</span></span>
<span id="cb275-15"><a href="cleaning.html#cb275-15" tabindex="-1"></a>  )    </span>
<span id="cb275-16"><a href="cleaning.html#cb275-16" tabindex="-1"></a></span>
<span id="cb275-17"><a href="cleaning.html#cb275-17" tabindex="-1"></a><span class="co"># table to view counts</span></span>
<span id="cb275-18"><a href="cleaning.html#cb275-18" tabindex="-1"></a><span class="fu">table</span>(linelist<span class="sc">$</span>age_cat, <span class="at">useNA =</span> <span class="st">&quot;always&quot;</span>)</span></code></pre></div>
<pre><code>## 
##         0-4         5-9       10-14       15-19       20-29       30-49       50-69 
##        1227        1223        1048         827        1216         848         105 
##      70-100 Missing age        &lt;NA&gt; 
##           7         107           0</code></pre>
<p><strong>Tạo nhanh điểm cắt và dán nhãn</strong></p>
<p>Để nhanh chóng tạo điểm cắt và gắn nhãn vectơ, hãy thực hành như bên dưới. Xem chương <a href="basics.html#basics">R cơ bản</a> về hàm <code>seq()</code> và <code>rep()</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="cleaning.html#cb277-1" tabindex="-1"></a><span class="co"># Make break points from 0 to 90 by 5</span></span>
<span id="cb277-2"><a href="cleaning.html#cb277-2" tabindex="-1"></a>age_seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb277-3"><a href="cleaning.html#cb277-3" tabindex="-1"></a>age_seq</span>
<span id="cb277-4"><a href="cleaning.html#cb277-4" tabindex="-1"></a></span>
<span id="cb277-5"><a href="cleaning.html#cb277-5" tabindex="-1"></a><span class="co"># Make labels for the above categories, assuming default cut() settings</span></span>
<span id="cb277-6"><a href="cleaning.html#cb277-6" tabindex="-1"></a>age_labels <span class="ot">=</span> <span class="fu">paste0</span>(age_seq <span class="sc">+</span> <span class="dv">1</span>, <span class="st">&quot;-&quot;</span>, age_seq <span class="sc">+</span> <span class="dv">5</span>)</span>
<span id="cb277-7"><a href="cleaning.html#cb277-7" tabindex="-1"></a>age_labels</span>
<span id="cb277-8"><a href="cleaning.html#cb277-8" tabindex="-1"></a></span>
<span id="cb277-9"><a href="cleaning.html#cb277-9" tabindex="-1"></a><span class="co"># check that both vectors are the same length</span></span>
<span id="cb277-10"><a href="cleaning.html#cb277-10" tabindex="-1"></a><span class="fu">length</span>(age_seq) <span class="sc">==</span> <span class="fu">length</span>(age_labels)</span></code></pre></div>
<p>Đọc thêm về hàm <code>cut()</code> trong trang Trợ giúp của hàm bằng cách nhập <code>?cut</code> trong R console.</p>
</div>
<div id="chia-khoảng-phân-vị" class="section level3 unnumbered">
<h3>Chia khoảng phân vị</h3>
<p>Theo cách hiểu thông thường, “phân vị” hoặc “phần trăm” thường đề cập đến một giá trị dưới ngưỡng tỷ lệ đang được đề cập. Ví dụ: phân vị thứ thứ 95 của biến độ tuổi trong <code>linelist</code> sẽ là các độ tuổi dưới 95% độ tuổi.</p>
<p>Tuy nhiên, trong cách nói thông thường, “tứ phân vị” và “thập phân vị” cũng có thể đề cập đến <em>phân nhóm dữ liệu</em> được chia đều thành 4 hoặc 10 nhóm (lưu ý sẽ có thêm một điểm cắt so với số nhóm).</p>
<p>Để nhận biết điểm cắt của khoảng phân vị, bạn có thể sử dụng hàm <code>quantile()</code> từ package <strong>stats</strong> trong <strong>base</strong> R. Bạn cung cấp một vectơ số (ví dụ: một cột trong bộ dữ liệu) và vectơ các giá trị xác suất số từ 0 đến 1. Các điểm cắt được trả về dưới dạng một vectơ số. Đọc thêm chi tiết các phương pháp thống kê bằng cách nhập <code>?quantile</code>.</p>
<ul>
<li>Nếu vectơ số đầu vào của bạn có bất kỳ giá trị nào bị thiếu, tốt nhất nên thiết lập <code>na.rm = TRUE</code><br />
</li>
<li>Thiết lập<code>names = FALSE</code> để lấy một vectơ số chưa được đặt tên</li>
</ul>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="cleaning.html#cb278-1" tabindex="-1"></a><span class="fu">quantile</span>(linelist<span class="sc">$</span>age_years,               <span class="co"># specify numeric vector to work on</span></span>
<span id="cb278-2"><a href="cleaning.html#cb278-2" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">25</span>, .<span class="dv">50</span>, .<span class="dv">75</span>, .<span class="dv">90</span>, .<span class="dv">95</span>),   <span class="co"># specify the percentiles you want</span></span>
<span id="cb278-3"><a href="cleaning.html#cb278-3" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)                            <span class="co"># ignore missing values </span></span></code></pre></div>
<pre><code>##  0% 25% 50% 75% 90% 95% 
##   0   6  13  23  33  41</code></pre>
<p>Bạn có thể sử dụng kết quả của <code>quantile()</code> làm điểm cắt trong <code>age_categories()</code> hoặc <code>cut()</code>. Dưới đây, chúng ta tạo một cột <code>deciles</code> mới bằng cách sử dụng hàm <code>cut()</code> trong đó các dấu ngắt được xác định bằng cách sử dụng hàm <code>quantiles()</code> trên cột <code>age_years</code>. Sau đó, chúng ta hiển thị kết quả bằng hàm <code>tabyl()</code> từ package <strong>janitor</strong> để bạn có thể xem tỷ lệ phần trăm (xem chương <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a>). Lưu ý rằng chúng không chính xác là 10% trong mỗi nhóm.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="cleaning.html#cb280-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                <span class="co"># begin with linelist</span></span>
<span id="cb280-2"><a href="cleaning.html#cb280-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deciles =</span> <span class="fu">cut</span>(age_years,           <span class="co"># create new column decile as cut() on column age_years</span></span>
<span id="cb280-3"><a href="cleaning.html#cb280-3" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">quantile</span>(                      <span class="co"># define cut breaks using quantile()</span></span>
<span id="cb280-4"><a href="cleaning.html#cb280-4" tabindex="-1"></a>      age_years,                               <span class="co"># operate on age_years</span></span>
<span id="cb280-5"><a href="cleaning.html#cb280-5" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> <span class="fl">0.1</span>),             <span class="co"># 0.0 to 1.0 by 0.1</span></span>
<span id="cb280-6"><a href="cleaning.html#cb280-6" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>),                           <span class="co"># ignore missing values</span></span>
<span id="cb280-7"><a href="cleaning.html#cb280-7" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span>             <span class="co"># for cut() include age 0</span></span>
<span id="cb280-8"><a href="cleaning.html#cb280-8" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(deciles)                   <span class="co"># pipe to table to display</span></span></code></pre></div>
<pre><code>##  deciles   n    percent valid_percent
##    [0,2] 748 0.11319613    0.11505922
##    (2,5] 721 0.10911017    0.11090601
##    (5,7] 497 0.07521186    0.07644978
##   (7,10] 698 0.10562954    0.10736810
##  (10,13] 635 0.09609564    0.09767728
##  (13,17] 755 0.11425545    0.11613598
##  (17,21] 578 0.08746973    0.08890940
##  (21,26] 625 0.09458232    0.09613906
##  (26,33] 596 0.09019370    0.09167820
##  (33,84] 648 0.09806295    0.09967697
##     &lt;NA&gt; 107 0.01619249            NA</code></pre>
</div>
<div id="nhóm-có-khoảng-đều" class="section level3 unnumbered">
<h3>Nhóm có khoảng đều</h3>
<p>Một công cụ khác để tạo nhóm dạng số là hàm <code>ntile()</code> trong package <strong>dplyr</strong>, cố gắng chia dữ liệu của bạn thành n <em>nhóm có khoảng cách đều - nhưng lưu ý rằng không giống như với <code>quantile()</code>, cùng một giá trị có thể xuất hiện trong nhiều nhóm</em>. Cung cấp vectơ số và sau đó là số lượng nhóm. Các giá trị trong cột mới được tạo chỉ là nhóm “số” (ví dụ: 1 đến 10), không phải phạm vi giá trị như khi sử dụng hàm <code>cut()</code>.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="cleaning.html#cb282-1" tabindex="-1"></a><span class="co"># make groups with ntile()</span></span>
<span id="cb282-2"><a href="cleaning.html#cb282-2" tabindex="-1"></a>ntile_data <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="cleaning.html#cb282-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">even_groups =</span> <span class="fu">ntile</span>(age_years, <span class="dv">10</span>))</span>
<span id="cb282-4"><a href="cleaning.html#cb282-4" tabindex="-1"></a></span>
<span id="cb282-5"><a href="cleaning.html#cb282-5" tabindex="-1"></a><span class="co"># make table of counts and proportions by group</span></span>
<span id="cb282-6"><a href="cleaning.html#cb282-6" tabindex="-1"></a>ntile_table <span class="ot">&lt;-</span> ntile_data <span class="sc">%&gt;%</span> </span>
<span id="cb282-7"><a href="cleaning.html#cb282-7" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">tabyl</span>(even_groups)</span>
<span id="cb282-8"><a href="cleaning.html#cb282-8" tabindex="-1"></a>  </span>
<span id="cb282-9"><a href="cleaning.html#cb282-9" tabindex="-1"></a><span class="co"># attach min/max values to demonstrate ranges</span></span>
<span id="cb282-10"><a href="cleaning.html#cb282-10" tabindex="-1"></a>ntile_ranges <span class="ot">&lt;-</span> ntile_data <span class="sc">%&gt;%</span> </span>
<span id="cb282-11"><a href="cleaning.html#cb282-11" tabindex="-1"></a>  <span class="fu">group_by</span>(even_groups) <span class="sc">%&gt;%</span> </span>
<span id="cb282-12"><a href="cleaning.html#cb282-12" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb282-13"><a href="cleaning.html#cb282-13" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb282-14"><a href="cleaning.html#cb282-14" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(age_years, <span class="at">na.rm=</span>T)</span>
<span id="cb282-15"><a href="cleaning.html#cb282-15" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## Warning: There were 2 warnings in `summarise()`.
## The first warning was:
## ℹ In argument: `min = min(age_years, na.rm = T)`.
## ℹ In group 11: `even_groups = NA`.
## Caused by warning in `min()`:
## ! no non-missing arguments to min; returning Inf
## ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="cleaning.html#cb284-1" tabindex="-1"></a><span class="co"># combine and print - note that values are present in multiple groups</span></span>
<span id="cb284-2"><a href="cleaning.html#cb284-2" tabindex="-1"></a><span class="fu">left_join</span>(ntile_table, ntile_ranges, <span class="at">by =</span> <span class="st">&quot;even_groups&quot;</span>)</span></code></pre></div>
<pre><code>##  even_groups   n    percent valid_percent min  max
##            1 651 0.09851695    0.10013844   0    2
##            2 650 0.09836562    0.09998462   2    5
##            3 650 0.09836562    0.09998462   5    7
##            4 650 0.09836562    0.09998462   7   10
##            5 650 0.09836562    0.09998462  10   13
##            6 650 0.09836562    0.09998462  13   17
##            7 650 0.09836562    0.09998462  17   21
##            8 650 0.09836562    0.09998462  21   26
##            9 650 0.09836562    0.09998462  26   33
##           10 650 0.09836562    0.09998462  33   84
##           NA 107 0.01619249            NA Inf -Inf</code></pre>
<!-- ======================================================= -->
</div>
<div id="case_when" class="section level3 unnumbered">
<h3><code>case_when()</code></h3>
<p>Có thể sử dụng hàm <code>case_when()</code> từ <strong>dplyr</strong> để tạo biến danh mục từ cột số, tuy nhiên điều này được thực hiện dễ dàng hơn với hàm <code>age_categories()</code> từ <strong>epikit</strong> hoặc <code>cut()</code> vì chúng sẽ tự động tạo ra một biến factor có thứ tự.</p>
<p>Nếu sử dụng <code>case_when()</code>, vui lòng xem lại cách sử dụng thích hợp như đã mô tả trước đó trong mục Mã hóa lại giá trị. Cũng lưu ý rằng tất cả các giá trị bên tay phải phải thuộc cùng một kiểu. Do đó, nếu bạn muốn giá trị <code>NA</code> ở phía bên phải, bạn nên viết “Missing” hoặc sử dụng giá trị <code>NA</code> đặc biệt là <code>NA_character_</code>.</p>
</div>
<div id="thêm-vào-chuỗi-làm-sạch-1" class="section level3 unnumbered">
<h3>Thêm vào chuỗi làm sạch</h3>
<p>Dưới đây, code để tạo hai cột phân loại tuổi được thêm vào chuỗi các bước làm sạch:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="cleaning.html#cb286-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb286-2"><a href="cleaning.html#cb286-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb286-3"><a href="cleaning.html#cb286-3" tabindex="-1"></a></span>
<span id="cb286-4"><a href="cleaning.html#cb286-4" tabindex="-1"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb286-5"><a href="cleaning.html#cb286-5" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb286-6"><a href="cleaning.html#cb286-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb286-7"><a href="cleaning.html#cb286-7" tabindex="-1"></a>    </span>
<span id="cb286-8"><a href="cleaning.html#cb286-8" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb286-9"><a href="cleaning.html#cb286-9" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-10"><a href="cleaning.html#cb286-10" tabindex="-1"></a>    </span>
<span id="cb286-11"><a href="cleaning.html#cb286-11" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb286-12"><a href="cleaning.html#cb286-12" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb286-13"><a href="cleaning.html#cb286-13" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb286-14"><a href="cleaning.html#cb286-14" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb286-15"><a href="cleaning.html#cb286-15" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb286-16"><a href="cleaning.html#cb286-16" tabindex="-1"></a>    </span>
<span id="cb286-17"><a href="cleaning.html#cb286-17" tabindex="-1"></a>    <span class="co"># remove column</span></span>
<span id="cb286-18"><a href="cleaning.html#cb286-18" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-19"><a href="cleaning.html#cb286-19" tabindex="-1"></a>  </span>
<span id="cb286-20"><a href="cleaning.html#cb286-20" tabindex="-1"></a>    <span class="co"># de-duplicate</span></span>
<span id="cb286-21"><a href="cleaning.html#cb286-21" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-22"><a href="cleaning.html#cb286-22" tabindex="-1"></a></span>
<span id="cb286-23"><a href="cleaning.html#cb286-23" tabindex="-1"></a>    <span class="co"># add column</span></span>
<span id="cb286-24"><a href="cleaning.html#cb286-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb286-25"><a href="cleaning.html#cb286-25" tabindex="-1"></a></span>
<span id="cb286-26"><a href="cleaning.html#cb286-26" tabindex="-1"></a>    <span class="co"># convert class of columns</span></span>
<span id="cb286-27"><a href="cleaning.html#cb286-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb286-28"><a href="cleaning.html#cb286-28" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb286-29"><a href="cleaning.html#cb286-29" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-30"><a href="cleaning.html#cb286-30" tabindex="-1"></a>    </span>
<span id="cb286-31"><a href="cleaning.html#cb286-31" tabindex="-1"></a>    <span class="co"># add column: delay to hospitalisation</span></span>
<span id="cb286-32"><a href="cleaning.html#cb286-32" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-33"><a href="cleaning.html#cb286-33" tabindex="-1"></a>    </span>
<span id="cb286-34"><a href="cleaning.html#cb286-34" tabindex="-1"></a>    <span class="co"># clean values of hospital column</span></span>
<span id="cb286-35"><a href="cleaning.html#cb286-35" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb286-36"><a href="cleaning.html#cb286-36" tabindex="-1"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb286-37"><a href="cleaning.html#cb286-37" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb286-38"><a href="cleaning.html#cb286-38" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb286-39"><a href="cleaning.html#cb286-39" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb286-40"><a href="cleaning.html#cb286-40" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb286-41"><a href="cleaning.html#cb286-41" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb286-42"><a href="cleaning.html#cb286-42" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb286-43"><a href="cleaning.html#cb286-43" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb286-44"><a href="cleaning.html#cb286-44" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb286-45"><a href="cleaning.html#cb286-45" tabindex="-1"></a>    </span>
<span id="cb286-46"><a href="cleaning.html#cb286-46" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-47"><a href="cleaning.html#cb286-47" tabindex="-1"></a></span>
<span id="cb286-48"><a href="cleaning.html#cb286-48" tabindex="-1"></a>    <span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb286-49"><a href="cleaning.html#cb286-49" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb286-50"><a href="cleaning.html#cb286-50" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span> <span class="sc">~</span> age,</span>
<span id="cb286-51"><a href="cleaning.html#cb286-51" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb286-52"><a href="cleaning.html#cb286-52" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age)) <span class="sc">%&gt;%</span></span>
<span id="cb286-53"><a href="cleaning.html#cb286-53" tabindex="-1"></a>  </span>
<span id="cb286-54"><a href="cleaning.html#cb286-54" tabindex="-1"></a>    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb286-55"><a href="cleaning.html#cb286-55" tabindex="-1"></a>    <span class="do">###################################################   </span></span>
<span id="cb286-56"><a href="cleaning.html#cb286-56" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb286-57"><a href="cleaning.html#cb286-57" tabindex="-1"></a>          <span class="co"># age categories: custom</span></span>
<span id="cb286-58"><a href="cleaning.html#cb286-58" tabindex="-1"></a>          <span class="at">age_cat =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb286-59"><a href="cleaning.html#cb286-59" tabindex="-1"></a>        </span>
<span id="cb286-60"><a href="cleaning.html#cb286-60" tabindex="-1"></a>          <span class="co"># age categories: 0 to 85 by 5s</span></span>
<span id="cb286-61"><a href="cleaning.html#cb286-61" tabindex="-1"></a>          <span class="at">age_cat5 =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>)))</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="thêm-hàng" class="section level2" number="8.10">
<h2><span class="header-section-number">8.10</span> Thêm hàng</h2>
<div id="thêm-từng-hàng-một" class="section level3 unnumbered">
<h3>Thêm từng hàng một</h3>
<p>Việc thêm từng hàng một theo cách thủ công là rất nhàm chán nhưng có thể được thực hiện với hàm <code>add_row()</code> từ package <strong>dplyr</strong>. Hãy nhớ rằng mỗi cột chỉ được chứa các giá trị của một phân lớp (ký tự, số, lôgic, v.v.). Vì vậy, khi thêm một hàng cần chú ý tới điều này.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="cleaning.html#cb287-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb287-2"><a href="cleaning.html#cb287-2" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">row_num =</span> <span class="dv">666</span>,</span>
<span id="cb287-3"><a href="cleaning.html#cb287-3" tabindex="-1"></a>          <span class="at">case_id =</span> <span class="st">&quot;abc&quot;</span>,</span>
<span id="cb287-4"><a href="cleaning.html#cb287-4" tabindex="-1"></a>          <span class="at">generation =</span> <span class="dv">4</span>,</span>
<span id="cb287-5"><a href="cleaning.html#cb287-5" tabindex="-1"></a>          <span class="st">`</span><span class="at">infection date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-10-10&quot;</span>),</span>
<span id="cb287-6"><a href="cleaning.html#cb287-6" tabindex="-1"></a>          <span class="at">.before =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>Sử dụng <code>.before</code> và <code>.after.</code> để cụ thể vị trí của hàng bạn muốn thêm. <code>.before = 3</code> sẽ cho phép hàng mới được thêm trước hàng thứ 3 hiện tại. Mặc định thì hàng sẽ được thêm vào dòng cuối cùng. Các cột không được chỉ định sẽ được để trống (<code>NA</code>).</p>
<p><em>Số thứ tự hàng</em> mới có thể trông lạ (“… 23”) nhưng số thứ tự hàng trong các hàng tồn tại trước đó <em>đã</em> thay đổi. Vì vậy, nếu sử dụng lệnh hai lần, hãy kiểm tra/thử việc chèn một cách cẩn thận.</p>
<p>Nếu một phân lớp bạn cung cấp không hoạt động, bạn sẽ thấy báo lỗi như sau:</p>
<pre><code>Error: Can&#39;t combine ..1$infection date &lt;date&gt; and ..2$infection date &lt;character&gt;.</code></pre>
<p>(khi chèn một hàng có giá trị ngày tháng, hãy nhớ đặt thông tin <code>as.Date()</code> ví dụ như <code>as.Date("2020-10-10")</code>).</p>
</div>
<div id="nối-các-hàng" class="section level3 unnumbered">
<h3>Nối các hàng</h3>
<p>Để kết hợp các bộ dữ liệu với nhau bằng cách liên kết các hàng của một bộ dữ liệu này với phần cuối bộ dữ liệu khác, bạn có thể sử dụng hàm <code>bind_rows()</code> từ <strong>dplyr</strong>. Điều này được giải thích chi tiết hơn trong chương <a href="joining-matching.html#joining-matching">Nối dữ liệu</a>.</p>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
<div id="lọc-hàng" class="section level2" number="8.11">
<h2><span class="header-section-number">8.11</span> Lọc hàng</h2>
<p>Bước làm sạch điển hình sau khi bạn đã làm sạch các cột và các giá trị được mã hóa lại đó là <em>lọc</em> bộ dữ liệu cho các hàng cụ thể bằng cách sử dụng hàm <code>filter()</code> trong package <strong>dplyr</strong>.</p>
<p>Trong hàm <code>filter()</code>, hãy cụ thể điều kiện logic phải là giá trị <code>TRUE</code> cho một hàng được giữ trong bộ dữ liệu. Dưới đây chúng tôi trình bày cách lọc hàng dựa trên điều kiện logic đơn giản và phức tạp.</p>
<!-- ======================================================= -->
<div id="lọc-đơn-giản" class="section level3 unnumbered">
<h3>Lọc đơn giản</h3>
<p>Ví dụ đơn giản này định nghĩa lại bộ dữ liệu <code>linelist</code>, đã lọc các hàng để đáp ứng điều kiện logic. <strong>Chỉ những hàng mà câu lệnh logic trong dấu ngoặc đơn đánh giá là <code>TRUE</code> mới được giữ lại</strong>.</p>
<p>Trong ví dụ này, câu lệnh logic là <code>gender == "f"</code>, được hỏi liệu giá trị trong cột <code>gender</code> có bằng “f” (phân biệt chữ hoa chữ thường) hay không.</p>
<p>Trước khi bộ lọc được áp dụng, số hàng trong <code>linelist</code> là <code>nrow(linelist)</code>.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="cleaning.html#cb289-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb289-2"><a href="cleaning.html#cb289-2" tabindex="-1"></a>  <span class="fu">filter</span>(gender <span class="sc">==</span> <span class="st">&quot;f&quot;</span>)   <span class="co"># keep only rows where gender is equal to &quot;f&quot;</span></span></code></pre></div>
<p>Sau khi bộ lọc được áp dụng, số hàng trong <code>linelist</code> là <code>linelist %&gt;% filter(gender == "f") %&gt;% nrow()</code>.</p>
</div>
<div id="lọc-bỏ-các-giá-trị-missing" class="section level3 unnumbered">
<h3>Lọc bỏ các giá trị missing</h3>
<p>Một điều khá phổ biến là bạn muốn lọc bỏ các hàng có giá trị missing. Hãy bỏ qua cách lọc cổ điển <code>filter(!is.na(column) &amp; !is.na(column))</code> và thay vào đó, hãy sử dụng hàm <code>drop_na()</code> trong package <strong>tidyr</strong> được xây dựng để tùy chỉnh cho mục đích này. Nếu chạy với dấu ngoặc trống, nó sẽ loại bỏ các hàng có bất kỳ giá trị nào bị missing. Ngoài ra, bạn có thể cung cấp tên của các cột cụ thể sẽ được đánh giá về mức độ missing hoặc sử dụng các hàm trợ giúp “tidyselect” như được mô tả <a href="cleaning.html#clean_tidyselect">ở trên</a>.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="cleaning.html#cb290-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb290-2"><a href="cleaning.html#cb290-2" tabindex="-1"></a>  <span class="fu">drop_na</span>(case_id, age_years)  <span class="co"># drop rows with missing values for case_id or age_years</span></span></code></pre></div>
<p>Xem chương về <a href="missing-data.html#missing-data">Dữ liệu Missing</a> để biết nhiều kỹ thuật phân tích và quản lý dữ liệu missing.</p>
</div>
<div id="lọc-bằng-số-thứ-tự-của-hàng" class="section level3 unnumbered">
<h3>Lọc bằng số thứ tự của hàng</h3>
<p>Trong một data frame hoặc tibble, mỗi hàng thường sẽ có một “số thứ tự” (khi xem trong R Viewer) xuất hiện ở bên trái của cột đầu tiên. Bản thân nó không phải là một cột trong dữ liệu, nhưng nó có thể được sử dụng trong câu lệnh <code>filter()</code>.</p>
<p>Để lọc dựa trên “số thứ tự của hàng”, bạn có thể sử dụng hàm <strong>dplyr</strong> <code>row_number()</code> với “dấu ngoặc đơn mở” như một phần của câu lệnh lọc logic. Thường thì bạn sẽ sử dụng toán tử <code>%in%</code> và một dãy số như một phần của câu lệnh logic đó, như được trình bày bên dưới. Để xem N hàng <em>đầu tiên</em>, bạn cũng có thể sử dụng hàm đặc biệt <code>head()</code> trong package <strong>dplyr</strong>.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="cleaning.html#cb291-1" tabindex="-1"></a><span class="co"># View first 100 rows</span></span>
<span id="cb291-2"><a href="cleaning.html#cb291-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">100</span>)     <span class="co"># or use tail() to see the n last rows</span></span>
<span id="cb291-3"><a href="cleaning.html#cb291-3" tabindex="-1"></a></span>
<span id="cb291-4"><a href="cleaning.html#cb291-4" tabindex="-1"></a><span class="co"># Show row 5 only</span></span>
<span id="cb291-5"><a href="cleaning.html#cb291-5" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">5</span>)</span>
<span id="cb291-6"><a href="cleaning.html#cb291-6" tabindex="-1"></a></span>
<span id="cb291-7"><a href="cleaning.html#cb291-7" tabindex="-1"></a><span class="co"># View rows 2 through 20, and three specific columns</span></span>
<span id="cb291-8"><a href="cleaning.html#cb291-8" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(date_onset, outcome, age)</span></code></pre></div>
<p>Bạn cũng có thể chuyển đổi số thứ tự hàng thành cột bằng cách sử dụng hàm <strong>tibble</strong> <code>rownames_to_column()</code> (không viết bất kỳ ký tự nào trong dấu ngoặc đơn).</p>
<!-- ======================================================= -->
</div>
<div id="lọc-phức-tạp" class="section level3 unnumbered">
<h3>Lọc phức tạp</h3>
<p>Các câu lệnh logic phức tạp hơn có thể được xây dựng bằng cách sử dụng các toán tử ngoặc đơn <code>( )</code>, HOẶC <code>|</code>, PHỦ ĐỊNH <code>!</code>, <code>%in%</code>, và VÀ <code>&amp;</code>. Dưới đây là một ví dụ:</p>
<p>Lưu ý: Bạn có thể sử dụng <code>!</code> trước một mệnh đề logic để phủ định nó. Ví dụ, <code>!is.na(column)</code> trả về giá trị TRUE nếu cột đó không bị thiếu giá trị. Tương tự như vậy <code>!column %in% c("a", "b", "c")</code> trả về kết quả là TRUE nếu giá trị cột <em>không</em> có trong vectơ.</p>
<div id="kiểm-tra-dữ-liệu" class="section level4 unnumbered">
<h4>Kiểm tra dữ liệu</h4>
<p>Dưới đây là một dòng lệnh đơn giản để tạo biểu đồ các ngày bắt đầu. Chúng ta thấy rằng có một đợt bùng phát nhỏ thứ hai từ năm 2012-2013 cũng được bao gồm trong tập bộ liệu thô này. <strong>Trong các phân tích, chúng ta muốn xóa các bản ghi từ đợt bùng phát sớm.</strong></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="cleaning.html#cb292-1" tabindex="-1"></a><span class="fu">hist</span>(linelist<span class="sc">$</span>date_onset, <span class="at">breaks =</span> <span class="dv">50</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-260-1.png" width="50%" /></p>
</div>
<div id="cách-lọc-và-xử-lý-các-giá-trị-số-và-ngày-bị-missing" class="section level4 unnumbered">
<h4>Cách lọc và xử lý các giá trị số và ngày bị missing</h4>
<p>Chúng ta có thể chỉ lọc theo <code>date_onset</code> đến những hàng sau tháng 6 năm 2013 không? <strong>Lưu ý! Việc áp dụng code <code>filter(date_onset &gt; as.Date("2013-06-01")))</code> sẽ xóa bất kỳ hàng nào trong đợt dịch sau đó có ngày bắt đầu bị thiếu!</strong></p>
<p><span style="color: red;"><strong><em>NGUY HIỂM</em></strong>: Việc lọc với điều kiện lớn hơn (&gt;) hoặc nhỏ hơn (&lt;) một ngày hoặc số có thể loại bỏ bất kỳ hàng nào có giá trị bị thiếu (<code>NA</code>)! Điều này là do <code>NA</code> được coi là giá trị lớn hoặc nhỏ vô hạn.</span></p>
<p><em>(Xem chương <a href="dates.html#dates">Làm việc với ngày tháng</a> để biết thêm thông tin về cách xử lý với ngày tháng và package <strong>lubridate</strong>)</em></p>
</div>
<div id="thiết-kế-bộ-lọc" class="section level4 unnumbered">
<h4>Thiết kế bộ lọc</h4>
<p>Lập một bảng chéo để đảm bảo rằng chúng ta chỉ loại bỏ các hàng cần loại bỏ:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="cleaning.html#cb293-1" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Hospital  =</span> linelist<span class="sc">$</span>hospital,                     <span class="co"># hospital name</span></span>
<span id="cb293-2"><a href="cleaning.html#cb293-2" tabindex="-1"></a>      <span class="at">YearOnset =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(linelist<span class="sc">$</span>date_onset),  <span class="co"># year of date_onset</span></span>
<span id="cb293-3"><a href="cleaning.html#cb293-3" tabindex="-1"></a>      <span class="at">useNA     =</span> <span class="st">&quot;always&quot;</span>)                              <span class="co"># show missing values</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2012 2013 2014 2015 &lt;NA&gt;
##   Central Hospital                        0    0  351   99   18
##   Hospital A                            229   46    0    0   15
##   Hospital B                            227   47    0    0   15
##   Military Hospital                       0    0  676  200   34
##   Missing                                 0    0 1117  318   77
##   Other                                   0    0  684  177   46
##   Port Hospital                           9    1 1372  347   75
##   St. Mark&#39;s Maternity Hospital (SMMH)    0    0  322   93   13
##   &lt;NA&gt;                                    0    0    0    0    0</code></pre>
<p>Liệu chúng ta có thể lọc theo tiêu chí nào khác để loại bỏ đợt bùng phát đầu tiên (trong năm 2012 &amp; 2013) khỏi bộ dữ liệu? Chúng ta thấy rằng:</p>
<ul>
<li>Vụ dịch đầu tiên năm 2012 &amp; 2013 xảy ra tại Hospital A, Hospital B, tại Port Hospital cũng có 10 trường hợp mắc.<br />
</li>
<li>Hospital A &amp; B <em>không</em> có ca bệnh nào trong đợt dịch thứ hai, nhưng Port Hospital thì có.</li>
</ul>
<p>Chúng ta muốn loại bỏ:</p>
<ul>
<li><p>Các dòng <code>nrow(linelist %&gt;% filter(hospital %in% c("Hospital A", "Hospital B") | date_onset &lt; as.Date("2013-06-01")))</code> bắt đầu vào năm 2012 và 2013 tại Hospital A, B hoặc Port Hospital:</p>
<ul>
<li>Loại trừ các hàng <code>nrow(linelist %&gt;% filter(date_onset &lt; as.Date("2013-06-01")))</code> bắt đầu vào năm 2012 và 2013</li>
<li>Loại trừ các hàng <code>nrow(linelist %&gt;% filter(hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> từ Hospital A và B với các giá trị ngày bị thiếu<br />
</li>
<li>Không loại bỏ các dòng khác <code>nrow(linelist %&gt;% filter(!hospital %in% c('Hospital A', 'Hospital B') &amp; is.na(date_onset)))</code> bị thiếu ngày bắt đầu.</li>
</ul></li>
</ul>
<p>Chúng ta bắt đầu với <code>linelist</code> bằng câu lệnh <code>nrow(linelist)</code>. Đây là toàn bộ câu lệnh lọc của chúng ta:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="cleaning.html#cb295-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb295-2"><a href="cleaning.html#cb295-2" tabindex="-1"></a>  <span class="co"># keep rows where onset is after 1 June 2013 OR where onset is missing and it was a hospital OTHER than Hospital A or B</span></span>
<span id="cb295-3"><a href="cleaning.html#cb295-3" tabindex="-1"></a>  <span class="fu">filter</span>(date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="sc">|</span> (<span class="fu">is.na</span>(date_onset) <span class="sc">&amp;</span> <span class="sc">!</span>hospital <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>)))</span>
<span id="cb295-4"><a href="cleaning.html#cb295-4" tabindex="-1"></a></span>
<span id="cb295-5"><a href="cleaning.html#cb295-5" tabindex="-1"></a><span class="fu">nrow</span>(linelist)</span></code></pre></div>
<pre><code>## [1] 6019</code></pre>
<p>Khi chúng ta lập lại bảng chéo, chúng ta thấy rằng Hospital A &amp; B bị loại bỏ hoàn toàn, và 10 trường hợp của Port Hospital từ năm 2012 &amp; 2013 bị loại bỏ và tất cả các giá trị khác đều tương tự - đúng như ý chúng ta muốn.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="cleaning.html#cb297-1" tabindex="-1"></a><span class="fu">table</span>(<span class="at">Hospital  =</span> linelist<span class="sc">$</span>hospital,                     <span class="co"># hospital name</span></span>
<span id="cb297-2"><a href="cleaning.html#cb297-2" tabindex="-1"></a>      <span class="at">YearOnset =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(linelist<span class="sc">$</span>date_onset),  <span class="co"># year of date_onset</span></span>
<span id="cb297-3"><a href="cleaning.html#cb297-3" tabindex="-1"></a>      <span class="at">useNA     =</span> <span class="st">&quot;always&quot;</span>)                              <span class="co"># show missing values</span></span></code></pre></div>
<pre><code>##                                       YearOnset
## Hospital                               2014 2015 &lt;NA&gt;
##   Central Hospital                      351   99   18
##   Military Hospital                     676  200   34
##   Missing                              1117  318   77
##   Other                                 684  177   46
##   Port Hospital                        1372  347   75
##   St. Mark&#39;s Maternity Hospital (SMMH)  322   93   13
##   &lt;NA&gt;                                    0    0    0</code></pre>
<p>Nhiều biểu thức có thể được bao hàm trong một lệnh lọc (được phân tách bằng dấu phẩy) hoặc bạn luôn có thể viết chúng riêng biệt và nối tiếp nhau trong chuỗi các bước làm sạch để rõ ràng hơn.</p>
<p><em>Ghi chú: một số độc giả có thể nhận thấy rằng sẽ dễ dàng hơn nếu chỉ lọc theo <code>date_hospitalisation</code> vì nó hoàn chỉnh 100% mà không có giá trị nào bị thiếu. Đây là sự thật. Nhưng <code>date_onset</code> được sử dụng cho mục đích thể hiện sự phức tạp của việc lọc.</em></p>
</div>
</div>
<div id="độc-lập" class="section level3 unnumbered">
<h3>Độc lập</h3>
<p>Việc lọc cũng có thể được thực hiện như một lệnh độc lập (không phải là một phần của chuỗi các bước làm sạch). Giống như các hàm <strong>dplyr</strong> khác, trong trường hợp này, đối số đầu tiên phải chính là bộ dữ liệu.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="cleaning.html#cb299-1" tabindex="-1"></a><span class="co"># dataframe &lt;- filter(dataframe, condition(s) for rows to keep)</span></span>
<span id="cb299-2"><a href="cleaning.html#cb299-2" tabindex="-1"></a></span>
<span id="cb299-3"><a href="cleaning.html#cb299-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">filter</span>(linelist, <span class="sc">!</span><span class="fu">is.na</span>(case_id))</span></code></pre></div>
<p>Bạn cũng có thể sử dụng <strong>base</strong> R để chia nhỏ dữ liệu bằng cách sử dụng dấu ngoặc đểm tham chiếu tới [hàng, cột] mà bạn muốn giữ lại.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="cleaning.html#cb300-1" tabindex="-1"></a><span class="co"># dataframe &lt;- dataframe[row conditions, column conditions] (blank means keep all)</span></span>
<span id="cb300-2"><a href="cleaning.html#cb300-2" tabindex="-1"></a></span>
<span id="cb300-3"><a href="cleaning.html#cb300-3" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist[<span class="sc">!</span><span class="fu">is.na</span>(case_id), ]</span></code></pre></div>
</div>
<div id="xem-nhanh-các-bản-ghi" class="section level3 unnumbered">
<h3>Xem nhanh các bản ghi</h3>
<p>Thường thì bạn muốn xem nhanh một vài bản ghi, chỉ cho một vài cột. Hàm <code>View()</code> trong <strong>base</strong> R sẽ hiển thị một khung dữ liệu để xem trong RStudio.</p>
<p>Xem <code>linelist</code> trong RStudio:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="cleaning.html#cb301-1" tabindex="-1"></a><span class="fu">View</span>(linelist)</span></code></pre></div>
<p>Dưới đây là hai ví dụ về việc xem các ô cụ thể (hàng cụ thể và cột cụ thể):</p>
<p><strong>Với hàm <code>filter()</code> và <code>select()</code> trong dplyr:</strong></p>
<p>Với hàm <code>View()</code>, chuyển tiếp bộ dữ liệu đến hàm <code>filter()</code> để giữ các hàng nhất định và sau đó <code>select()</code> để giữ các cột nhất định. Ví dụ, để xem xét ngày khởi phát và nhập viện của 3 trường hợp cụ thể:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="cleaning.html#cb302-1" tabindex="-1"></a><span class="fu">View</span>(linelist <span class="sc">%&gt;%</span></span>
<span id="cb302-2"><a href="cleaning.html#cb302-2" tabindex="-1"></a>       <span class="fu">filter</span>(case_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;11f8ea&quot;</span>, <span class="st">&quot;76b97a&quot;</span>, <span class="st">&quot;47a5f5&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb302-3"><a href="cleaning.html#cb302-3" tabindex="-1"></a>       <span class="fu">select</span>(date_onset, date_hospitalisation))</span></code></pre></div>
<p>Bạn có thể đạt được điều tương tự với cú pháp trong <strong>base</strong> R, sử dụng dấu ngoặc <code>[ ]</code> cho tập hợp con bạn muốn xem.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="cleaning.html#cb303-1" tabindex="-1"></a><span class="fu">View</span>(linelist[linelist<span class="sc">$</span>case_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;11f8ea&quot;</span>, <span class="st">&quot;76b97a&quot;</span>, <span class="st">&quot;47a5f5&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;date_onset&quot;</span>, <span class="st">&quot;date_hospitalisation&quot;</span>)])</span></code></pre></div>
<div id="thêm-vào-chuỗi-làm-sạch-2" class="section level4 unnumbered">
<h4>Thêm vào chuỗi làm sạch</h4>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="cleaning.html#cb304-1" tabindex="-1"></a><span class="co"># CLEANING &#39;PIPE&#39; CHAIN (starts with raw data and pipes it through cleaning steps)</span></span>
<span id="cb304-2"><a href="cleaning.html#cb304-2" tabindex="-1"></a><span class="do">##################################################################################</span></span>
<span id="cb304-3"><a href="cleaning.html#cb304-3" tabindex="-1"></a></span>
<span id="cb304-4"><a href="cleaning.html#cb304-4" tabindex="-1"></a><span class="co"># begin cleaning pipe chain</span></span>
<span id="cb304-5"><a href="cleaning.html#cb304-5" tabindex="-1"></a><span class="do">###########################</span></span>
<span id="cb304-6"><a href="cleaning.html#cb304-6" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> linelist_raw <span class="sc">%&gt;%</span></span>
<span id="cb304-7"><a href="cleaning.html#cb304-7" tabindex="-1"></a>    </span>
<span id="cb304-8"><a href="cleaning.html#cb304-8" tabindex="-1"></a>    <span class="co"># standardize column name syntax</span></span>
<span id="cb304-9"><a href="cleaning.html#cb304-9" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb304-10"><a href="cleaning.html#cb304-10" tabindex="-1"></a>    </span>
<span id="cb304-11"><a href="cleaning.html#cb304-11" tabindex="-1"></a>    <span class="co"># manually re-name columns</span></span>
<span id="cb304-12"><a href="cleaning.html#cb304-12" tabindex="-1"></a>           <span class="co"># NEW name             # OLD name</span></span>
<span id="cb304-13"><a href="cleaning.html#cb304-13" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">date_infection       =</span> infection_date,</span>
<span id="cb304-14"><a href="cleaning.html#cb304-14" tabindex="-1"></a>           <span class="at">date_hospitalisation =</span> hosp_date,</span>
<span id="cb304-15"><a href="cleaning.html#cb304-15" tabindex="-1"></a>           <span class="at">date_outcome         =</span> date_of_outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb304-16"><a href="cleaning.html#cb304-16" tabindex="-1"></a>    </span>
<span id="cb304-17"><a href="cleaning.html#cb304-17" tabindex="-1"></a>    <span class="co"># remove column</span></span>
<span id="cb304-18"><a href="cleaning.html#cb304-18" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(row_num, merged_header, x28)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-19"><a href="cleaning.html#cb304-19" tabindex="-1"></a>  </span>
<span id="cb304-20"><a href="cleaning.html#cb304-20" tabindex="-1"></a>    <span class="co"># de-duplicate</span></span>
<span id="cb304-21"><a href="cleaning.html#cb304-21" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb304-22"><a href="cleaning.html#cb304-22" tabindex="-1"></a></span>
<span id="cb304-23"><a href="cleaning.html#cb304-23" tabindex="-1"></a>    <span class="co"># add column</span></span>
<span id="cb304-24"><a href="cleaning.html#cb304-24" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">bmi =</span> wt_kg <span class="sc">/</span> (ht_cm<span class="sc">/</span><span class="dv">100</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>     </span>
<span id="cb304-25"><a href="cleaning.html#cb304-25" tabindex="-1"></a></span>
<span id="cb304-26"><a href="cleaning.html#cb304-26" tabindex="-1"></a>    <span class="co"># convert class of columns</span></span>
<span id="cb304-27"><a href="cleaning.html#cb304-27" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>), as.Date), </span>
<span id="cb304-28"><a href="cleaning.html#cb304-28" tabindex="-1"></a>           <span class="at">generation =</span> <span class="fu">as.numeric</span>(generation),</span>
<span id="cb304-29"><a href="cleaning.html#cb304-29" tabindex="-1"></a>           <span class="at">age        =</span> <span class="fu">as.numeric</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-30"><a href="cleaning.html#cb304-30" tabindex="-1"></a>    </span>
<span id="cb304-31"><a href="cleaning.html#cb304-31" tabindex="-1"></a>    <span class="co"># add column: delay to hospitalisation</span></span>
<span id="cb304-32"><a href="cleaning.html#cb304-32" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">days_onset_hosp =</span> <span class="fu">as.numeric</span>(date_hospitalisation <span class="sc">-</span> date_onset)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-33"><a href="cleaning.html#cb304-33" tabindex="-1"></a>    </span>
<span id="cb304-34"><a href="cleaning.html#cb304-34" tabindex="-1"></a>    <span class="co"># clean values of hospital column</span></span>
<span id="cb304-35"><a href="cleaning.html#cb304-35" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">recode</span>(hospital,</span>
<span id="cb304-36"><a href="cleaning.html#cb304-36" tabindex="-1"></a>                      <span class="co"># OLD = NEW</span></span>
<span id="cb304-37"><a href="cleaning.html#cb304-37" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb304-38"><a href="cleaning.html#cb304-38" tabindex="-1"></a>                      <span class="st">&quot;Mitylira Hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb304-39"><a href="cleaning.html#cb304-39" tabindex="-1"></a>                      <span class="st">&quot;Military Hopital&quot;</span>  <span class="ot">=</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb304-40"><a href="cleaning.html#cb304-40" tabindex="-1"></a>                      <span class="st">&quot;Port Hopital&quot;</span>      <span class="ot">=</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb304-41"><a href="cleaning.html#cb304-41" tabindex="-1"></a>                      <span class="st">&quot;Central Hopital&quot;</span>   <span class="ot">=</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb304-42"><a href="cleaning.html#cb304-42" tabindex="-1"></a>                      <span class="st">&quot;other&quot;</span>             <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>,</span>
<span id="cb304-43"><a href="cleaning.html#cb304-43" tabindex="-1"></a>                      <span class="st">&quot;St. Marks Maternity Hopital (SMMH)&quot;</span> <span class="ot">=</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span></span>
<span id="cb304-44"><a href="cleaning.html#cb304-44" tabindex="-1"></a>                      )) <span class="sc">%&gt;%</span> </span>
<span id="cb304-45"><a href="cleaning.html#cb304-45" tabindex="-1"></a>    </span>
<span id="cb304-46"><a href="cleaning.html#cb304-46" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hospital =</span> <span class="fu">replace_na</span>(hospital, <span class="st">&quot;Missing&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-47"><a href="cleaning.html#cb304-47" tabindex="-1"></a></span>
<span id="cb304-48"><a href="cleaning.html#cb304-48" tabindex="-1"></a>    <span class="co"># create age_years column (from age and age_unit)</span></span>
<span id="cb304-49"><a href="cleaning.html#cb304-49" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">case_when</span>(</span>
<span id="cb304-50"><a href="cleaning.html#cb304-50" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;years&quot;</span> <span class="sc">~</span> age,</span>
<span id="cb304-51"><a href="cleaning.html#cb304-51" tabindex="-1"></a>          age_unit <span class="sc">==</span> <span class="st">&quot;months&quot;</span> <span class="sc">~</span> age<span class="sc">/</span><span class="dv">12</span>,</span>
<span id="cb304-52"><a href="cleaning.html#cb304-52" tabindex="-1"></a>          <span class="fu">is.na</span>(age_unit) <span class="sc">~</span> age)) <span class="sc">%&gt;%</span></span>
<span id="cb304-53"><a href="cleaning.html#cb304-53" tabindex="-1"></a>  </span>
<span id="cb304-54"><a href="cleaning.html#cb304-54" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb304-55"><a href="cleaning.html#cb304-55" tabindex="-1"></a>          <span class="co"># age categories: custom</span></span>
<span id="cb304-56"><a href="cleaning.html#cb304-56" tabindex="-1"></a>          <span class="at">age_cat =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">70</span>)),</span>
<span id="cb304-57"><a href="cleaning.html#cb304-57" tabindex="-1"></a>        </span>
<span id="cb304-58"><a href="cleaning.html#cb304-58" tabindex="-1"></a>          <span class="co"># age categories: 0 to 85 by 5s</span></span>
<span id="cb304-59"><a href="cleaning.html#cb304-59" tabindex="-1"></a>          <span class="at">age_cat5 =</span> epikit<span class="sc">::</span><span class="fu">age_categories</span>(age_years, <span class="at">breakers =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">85</span>, <span class="dv">5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb304-60"><a href="cleaning.html#cb304-60" tabindex="-1"></a>    </span>
<span id="cb304-61"><a href="cleaning.html#cb304-61" tabindex="-1"></a>    <span class="co"># ABOVE ARE UPSTREAM CLEANING STEPS ALREADY DISCUSSED</span></span>
<span id="cb304-62"><a href="cleaning.html#cb304-62" tabindex="-1"></a>    <span class="do">###################################################</span></span>
<span id="cb304-63"><a href="cleaning.html#cb304-63" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb304-64"><a href="cleaning.html#cb304-64" tabindex="-1"></a>          <span class="co"># keep only rows where case_id is not missing</span></span>
<span id="cb304-65"><a href="cleaning.html#cb304-65" tabindex="-1"></a>          <span class="sc">!</span><span class="fu">is.na</span>(case_id),  </span>
<span id="cb304-66"><a href="cleaning.html#cb304-66" tabindex="-1"></a>          </span>
<span id="cb304-67"><a href="cleaning.html#cb304-67" tabindex="-1"></a>          <span class="co"># also filter to keep only the second outbreak</span></span>
<span id="cb304-68"><a href="cleaning.html#cb304-68" tabindex="-1"></a>          date_onset <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2013-06-01&quot;</span>) <span class="sc">|</span> (<span class="fu">is.na</span>(date_onset) <span class="sc">&amp;</span> <span class="sc">!</span>hospital <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Hospital A&quot;</span>, <span class="st">&quot;Hospital B&quot;</span>)))</span></code></pre></div>
<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="tính-toán-theo-hàng" class="section level2" number="8.12">
<h2><span class="header-section-number">8.12</span> Tính toán theo hàng</h2>
<p>Nếu bạn muốn thực hiện một phép tính trong một hàng, bạn có thể sử dụng hàm <code>rowwise()</code> từ <strong>dplyr</strong>. Xem chi tiết tại <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/rowwise.html">row-wise calculations</a>.<br />
Ví dụ: code này sử dụng hàm <code>rowwise()</code> và sau đó tạo một cột mới là tổng số cột triệu chứng được chứa giá trị “có”, cho mỗi hàng trong <code>linelist</code>. Các cột được cụ thể trong hàm <code>sum()</code> theo tên trong vectơ <code>c()</code>. Hàm <code>rowwise()</code> về cơ bản là một hình thức <code>group_by()</code> đặc biệt, vì vậy tốt nhất bạn nên sử dụng <code>ungroup()</code> khi bạn hoàn tất (trong chương <a href="grouping.html#grouping">Nhóm dữ liệu</a>).</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="cleaning.html#cb305-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb305-2"><a href="cleaning.html#cb305-2" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb305-3"><a href="cleaning.html#cb305-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_symptoms =</span> <span class="fu">sum</span>(<span class="fu">c</span>(fever, chills, cough, aches, vomit) <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb305-4"><a href="cleaning.html#cb305-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb305-5"><a href="cleaning.html#cb305-5" tabindex="-1"></a>  <span class="fu">select</span>(fever, chills, cough, aches, vomit, num_symptoms) <span class="co"># for display</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 6
##    fever chills cough aches vomit num_symptoms
##    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;int&gt;
##  1 no    no     yes   no    yes              2
##  2 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  3 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  4 no    no     no    no    no               0
##  5 no    no     yes   no    yes              2
##  6 no    no     yes   no    yes              2
##  7 &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;            NA
##  8 no    no     yes   no    yes              2
##  9 no    no     yes   no    yes              2
## 10 no    no     yes   no    no               1
## # ℹ 5,878 more rows</code></pre>
<p>Khi bạn chỉ định cột để đánh giá, bạn có thể muốn sử dụng các hàm trợ giúp “tidyselect” như được mô tả trong mục <code>select()</code> của chương này. Bạn chỉ cần thực hiện một điều chỉnh (vì bạn đang không sử dụng chúng bên trong một hàm của <strong>dplyr</strong> như <code>select()</code> hoặc <code>summarise()</code>).</p>
<p>Đặt tiêu chí đặc tả cột trong hàm <strong>dplyr</strong> là <code>c_across()</code>. Điều này là do hàm <code>c_across</code> (<a href="https://dplyr.tidyverse.org/reference/c_across.html">tài liệu</a>) được thiết kế để hoạt động cụ thể với hàm <code>rowwise()</code>. Ví dụ, như đoạn code sau:</p>
<ul>
<li>Áp dụng <code>rowwise()</code> nên bước tiếp theo (<code>sum()</code>) được áp dụng trong mỗi hàng (không tính tổng toàn bộ các cột)<br />
</li>
<li>Tạo cột mới <code>num_NA_dates</code>, được xác định cho mỗi hàng là số cột (có tên chứa “ngày tháng”) mà <code>is.na()</code> trả về giá trị TRUE (nghĩa là chúng bị thiếu dữ liệu)<br />
</li>
<li><code>ungroup()</code> để loại bỏ ảnh hưởng của <code>rowwise()</code> cho các bước tiếp theo</li>
</ul>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="cleaning.html#cb307-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb307-2"><a href="cleaning.html#cb307-2" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb307-3"><a href="cleaning.html#cb307-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_NA_dates =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>))))) <span class="sc">%&gt;%</span> </span>
<span id="cb307-4"><a href="cleaning.html#cb307-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb307-5"><a href="cleaning.html#cb307-5" tabindex="-1"></a>  <span class="fu">select</span>(num_NA_dates, <span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>)) <span class="co"># for display</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
##    num_NA_dates date_infection date_onset date_hospitalisation date_outcome
##           &lt;int&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1            1 2014-05-08     2014-05-13 2014-05-15           NA          
##  2            1 NA             2014-05-13 2014-05-14           2014-05-18  
##  3            1 NA             2014-05-16 2014-05-18           2014-05-30  
##  4            1 2014-05-04     2014-05-18 2014-05-20           NA          
##  5            0 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6            0 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7            0 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8            0 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9            1 NA             2014-06-05 2014-06-06           2014-06-18  
## 10            1 NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows</code></pre>
<p>Bạn cũng có thể cung cấp các hàm khác, chẳng hạn như <code>max()</code> để lấy ngày mới nhất hoặc gần đây nhất cho mỗi hàng:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="cleaning.html#cb309-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb309-2"><a href="cleaning.html#cb309-2" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb309-3"><a href="cleaning.html#cb309-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">latest_date =</span> <span class="fu">max</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>)), <span class="at">na.rm=</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb309-4"><a href="cleaning.html#cb309-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb309-5"><a href="cleaning.html#cb309-5" tabindex="-1"></a>  <span class="fu">select</span>(latest_date, <span class="fu">contains</span>(<span class="st">&quot;date&quot;</span>))  <span class="co"># for display</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
##    latest_date date_infection date_onset date_hospitalisation date_outcome
##    &lt;date&gt;      &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1 2014-05-15  2014-05-08     2014-05-13 2014-05-15           NA          
##  2 2014-05-18  NA             2014-05-13 2014-05-14           2014-05-18  
##  3 2014-05-30  NA             2014-05-16 2014-05-18           2014-05-30  
##  4 2014-05-20  2014-05-04     2014-05-18 2014-05-20           NA          
##  5 2014-05-29  2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6 2014-05-24  2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7 2014-06-01  2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8 2014-06-07  2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9 2014-06-18  NA             2014-06-05 2014-06-06           2014-06-18  
## 10 2014-06-09  NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows</code></pre>
</div>
<div id="sắp-xếp" class="section level2" number="8.13">
<h2><span class="header-section-number">8.13</span> Sắp xếp</h2>
<p>Sử dụng hàm <strong>dplyr</strong> <code>arrange()</code> để sắp xếp thứ tự các hàng theo giá trị cột.</p>
<p>Đơn giản hãy liệt kê các cột theo thứ tự mà chúng cần được sắp xếp. Thêm <code>.by_group = TRUE</code> nếu bạn muốn việc sắp xếp xảy ra trước bất kỳ <em>hành động nhóm dữ liệu</em> nào được áp dụng trong dữ liệu (xem chương <a href="grouping.html#grouping">Nhóm dữ liệu</a>).</p>
<p>Mặc định, cột sẽ được sắp xếp theo thứ tự “tăng dần” (áp dụng cho cột số và cả cột ký tự). Bạn có thể sắp xếp một biến theo thứ tự “giảm dần” bằng cách đặt tên biến trong hàm <code>desc()</code>.</p>
<p>Việc sắp xếp dữ liệu với hàm <code>arrange()</code> đặc biệt hữu ích khi <a href="tables-presentation.html#tables-presentation">Trình bày bảng</a>, sử dụng hàm <code>slice()</code> để lấy các hàng “trên cùng” trên mỗi nhóm hoặc thiết lập thứ tự danh mục theo thứ tự xuất hiện.</p>
<p>Ví dụ: để sắp xếp các hàng trong <code>linelist</code> theo <code>hospital</code>, sau đó theo <code>date_onset</code> thứ tự giảm dần, chúng ta sẽ thực hiện như sau:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="cleaning.html#cb311-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb311-2"><a href="cleaning.html#cb311-2" tabindex="-1"></a>   <span class="fu">arrange</span>(hospital, <span class="fu">desc</span>(date_onset))</span></code></pre></div>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
