<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>26 Phân tích khảo sát | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="26 Phân tích khảo sát | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="26 Phân tích khảo sát | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="survey-analysis" class="section level1" number="26">
<h1><span class="header-section-number">26</span> Phân tích khảo sát</h1>
<!-- ======================================================= -->
<div id="tổng-quan-4" class="section level2" number="26.1">
<h2><span class="header-section-number">26.1</span> Tổng quan</h2>
<p>Chương này trình bày việc sử dụng một số packages để phân tích khảo sát.</p>
<p>Hầu hết các packages R dùng để phân tích khảo sát đều dựa trên <a href="https://cran.r-project.org/web/packages/survey/index.html"><strong>survey</strong> package</a> cho phân tích có trọng số. Chúng tôi sẽ sử dụng <strong>survey</strong> cũng như <a href="https://cran.r-project.org/web/packages/srvyr/index.html"><strong>srvyr</strong></a> (cho phép <strong>survey</strong> mã hóa theo kiểu tidyverse) và <a href="https://cran.r-project.org/web/packages/gtsummary/index.html"><strong>gtsummary</strong></a> (cho phép <strong>survey</strong> tạo các bảng sẵn sàng cho xuất bản). Trong khi package <strong>survey</strong> ban đầu không cho phép mã hóa theo kiểu tidyverse, nhưng nó có điểm cộng là cho phép khảo sát được trọng số hóa mô hình tuyến tính tổng quát (sẽ được thêm vào chương này sau). Chúng tôi cũng sẽ minh họa bằng cách sử dụng một hàm từ package <a href="https://github.com/R4EPI/sitrep"><strong>sitrep</strong></a> để tạo mẫu trọng số (<em>lưu ý</em> package này hiện chưa có trên CRAN, nhưng có thể được cài đặt từ github).</p>
<p>Hầu hết chương này dựa trên công việc đã hoàn thành của <a href="https://r4epis.netlify.app/">dự án “R4Epis”</a>; để biết code chi tiết và mẫu R-markdown xem <a href="https://github.com/R4EPI/sitrep">trang github của “R4Epis”</a>. Một số package <strong>survey</strong> dựa trên các phiên bản đầu tiên của <a href="https://github.com/EPIET/RapidAssessmentSurveys">các nghiên cứuu trường hợp EPIET</a>.</p>
<p>Hiện tại, chương này không đề cập đến các phép tính cỡ mẫu hoặc lấy mẫu. Để tính cỡ mẫu đơn giản, hãy xem <a href="https://www.openepi.com/Menu/OE_Menu.htm">OpenEpi</a>. Chương <a href="data-used.html#gis">GIS cơ bản</a> trong sổ tay này sẽ có một phần về lấy mẫu ngẫu nhiên theo không gian và chương này cũng sẽ đề cập một phần về khung lấy mẫu cũng như tính toán cỡ mẫu.</p>
<ol style="list-style-type: decimal">
<li>Dữ liệu khảo sát</li>
<li>Thời gian quan sát</li>
<li>Áp dụng trọng số</li>
<li>Đối tượng thiết kế nghiên cứu</li>
<li>Phân tích mô tả</li>
<li>Tỷ lệ được áp dụng trọng số</li>
<li>Tỷ suất được áp dụng trọng số</li>
</ol>
<!-- ======================================================= -->
</div>
<div id="chuẩn-bị-16" class="section level2" number="26.2">
<h2><span class="header-section-number">26.2</span> Chuẩn bị</h2>
<div id="packages-2" class="section level3 unnumbered">
<h3>Packages</h3>
<p>Đoạn code này hiển thị việc gọi các package cần thiết cho các phân tích. Trong cuốn sách này, chúng tôi nhấn mạnh việc sử dụng hàm <code>p_load()</code> từ package <strong>pacman</strong>, giúp cài đặt các package cần thiết <em>và</em> gọi chúng ra để sử dụng. Bạn cũng có thể gọi các packages đã cài đặt với hàm <code>library()</code> của <strong>base</strong> R. Xem thêm chương <a href="basics.html#basics">R cơ bản</a> để có thêm thông tin về các packages trong R. Ở đây chúng tôi cũng minh họa việc sử dụng hàm <code>p_load_gh()</code> từ <strong>pacman</strong> để cài đặt một package tải từ github mà chưa được công bố trên CRAN.</p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1238-1"><a href="survey-analysis.html#cb1238-1" tabindex="-1"></a><span class="do">## load packages from CRAN</span></span>
<span id="cb1238-2"><a href="survey-analysis.html#cb1238-2" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(rio,          <span class="co"># File import</span></span>
<span id="cb1238-3"><a href="survey-analysis.html#cb1238-3" tabindex="-1"></a>               here,         <span class="co"># File locator</span></span>
<span id="cb1238-4"><a href="survey-analysis.html#cb1238-4" tabindex="-1"></a>               tidyverse,    <span class="co"># data management + ggplot2 graphics</span></span>
<span id="cb1238-5"><a href="survey-analysis.html#cb1238-5" tabindex="-1"></a>               tsibble,      <span class="co"># handle time series datasets</span></span>
<span id="cb1238-6"><a href="survey-analysis.html#cb1238-6" tabindex="-1"></a>               survey,       <span class="co"># for survey functions</span></span>
<span id="cb1238-7"><a href="survey-analysis.html#cb1238-7" tabindex="-1"></a>               srvyr,        <span class="co"># dplyr wrapper for survey package</span></span>
<span id="cb1238-8"><a href="survey-analysis.html#cb1238-8" tabindex="-1"></a>               gtsummary,    <span class="co"># wrapper for survey package to produce tables</span></span>
<span id="cb1238-9"><a href="survey-analysis.html#cb1238-9" tabindex="-1"></a>               apyramid,     <span class="co"># a package dedicated to creating age pyramids</span></span>
<span id="cb1238-10"><a href="survey-analysis.html#cb1238-10" tabindex="-1"></a>               patchwork,    <span class="co"># for combining ggplots</span></span>
<span id="cb1238-11"><a href="survey-analysis.html#cb1238-11" tabindex="-1"></a>               ggforce       <span class="co"># for alluvial/sankey plots</span></span>
<span id="cb1238-12"><a href="survey-analysis.html#cb1238-12" tabindex="-1"></a>               ) </span>
<span id="cb1238-13"><a href="survey-analysis.html#cb1238-13" tabindex="-1"></a></span>
<span id="cb1238-14"><a href="survey-analysis.html#cb1238-14" tabindex="-1"></a><span class="do">## load packages from github</span></span>
<span id="cb1238-15"><a href="survey-analysis.html#cb1238-15" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load_gh</span>(</span>
<span id="cb1238-16"><a href="survey-analysis.html#cb1238-16" tabindex="-1"></a>     <span class="st">&quot;R4EPI/sitrep&quot;</span>          <span class="co"># for observation time / weighting functions</span></span>
<span id="cb1238-17"><a href="survey-analysis.html#cb1238-17" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="nạp-dữ-liệu" class="section level3 unnumbered">
<h3>Nạp dữ liệu</h3>
<p>Bộ dữ liệu ví dụ được sử dụng trong phần này:</p>
<ul>
<li>dữ liệu điều tra tỷ lệ tử vong mô phỏng.</li>
<li>số lượng dân cư mô phỏng cho khu vực khảo sát.</li>
<li>từ điển dữ liệu cho dữ liệu khảo sát tử vong mô phỏng.</li>
</ul>
<p>Bộ này dựa trên khảo sát đã được phê duyệt trước của hội đồng đạo đức MSF OCA. Các tập dữ liệu mô phỏng được tạo như một phần của <a href="https://r4epis.netlify.app/">Dự án “R4Epis”</a>. Tất cả đều dựa trên dữ liệu được thu thập bằng <a href="https://www.kobotoolbox.org/">KoboToolbox</a>, đây là một phần mềm thu thập dữ liệu dựa trên <a href="https://opendatakit.org/">Open Data Kit</a>.</p>
<p>Kobo cho phép bạn xuất cả dữ liệu đã thu thập, cũng như từ điển dữ liệu cho tập dữ liệu đó. Chúng tôi thực sự khuyên bạn nên làm điều này vì nó đơn giản hóa việc làm sạch dữ liệu và hữu ích cho việc tra cứu các biến/câu hỏi.</p>
<p><span style="color: darkgreen;"><strong><em>MẸO:</em></strong> Từ điển dữ liệu Kobo có tên biến trong cột “name” của sheet “survey” (khảo sát). Các giá trị có thể có cho mỗi biến được chỉ định trong sheet “choices” (lựa chọn). Trong tab lựa chọn, “name” có giá trị rút gọn và các cột “label::english” và “label::french” chứa các nhãn mô tả đầy đủ. Sử dụng hàm <code>msf_dict_survey()</code> của package <strong>epidict</strong> để nhập tệp excel từ điển Kobo sẽ định dạng lại tệp này cho bạn để bạn có thể dễ dàng sử dụng để code lại.</span></p>
<p><span style="color: orange;"><strong><em>THẬN TRỌNG:</em></strong> Bộ dữ liệu ví dụ không giống nhau dưới dạng xuất (như trong Kobo, bạn xuất từng cấp bảng câu hỏi khác nhau) - xem phần dữ liệu khảo sát bên dưới để hợp nhất các cấp độ khác nhau.</span></p>
<p>Bộ dữ liệu được nhập bằng hàm <code>import()</code> từ package <strong>rio</strong>. Xem chương về <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết các cách nhập dữ liệu khác nhau.</p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="survey-analysis.html#cb1239-1" tabindex="-1"></a><span class="co"># import the survey data</span></span>
<span id="cb1239-2"><a href="survey-analysis.html#cb1239-2" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;survey_data.xlsx&quot;</span>)</span>
<span id="cb1239-3"><a href="survey-analysis.html#cb1239-3" tabindex="-1"></a></span>
<span id="cb1239-4"><a href="survey-analysis.html#cb1239-4" tabindex="-1"></a><span class="co"># import the dictionary into R</span></span>
<span id="cb1239-5"><a href="survey-analysis.html#cb1239-5" tabindex="-1"></a>survey_dict <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;survey_dict.xlsx&quot;</span>) </span></code></pre></div>
<p>10 hàng đầu tiên của khảo sát được hiển thị bên dưới.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6c6dcc8af8fcec6b2e85" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6c6dcc8af8fcec6b2e85">{"x":{"filter":"none","vertical":false,"data":[[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["2018-04-15T00:00:00Z","2018-03-04T00:00:00Z","2018-04-16T00:00:00Z","2018-01-23T00:00:00Z","2018-01-09T00:00:00Z","2018-03-07T00:00:00Z","2018-02-18T00:00:00Z","2018-04-12T00:00:00Z","2018-04-17T00:00:00Z","2018-01-05T00:00:00Z"],[null,null,null,null,null,null,null,null,null,null],["village_1","village_1","village_10","village_5","village_3","village_8","other","village_7","village_4","village_2"],[null,null,null,null,null,null,null,null,null,null],[1,1,10,5,3,8,11,7,4,2],[9,1,15,6,18,14,17,16,13,14],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["yes","no","no","yes","no","yes","no","yes","yes","yes"],[null,"no_benefit","neg_experience",null,"other",null,"no_benefit",null,null,null],[null,null,null,null,null,null,null,null,null,null],[6,null,null,8,null,5,null,6,5,5],["female",null,null,"female",null,"male",null,"male","male","female"],[26,null,null,3,null,22,null,33,96,18],[null,null,null,36,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no",null,null,"no",null,"yes",null,"yes","yes","yes"],["yes",null,null,null,null,"yes",null,"no","no","no"],["secondary",null,null,null,null,"secondary",null,null,null,null],["no",null,null,"no",null,"yes",null,"no","yes","yes"],[null,null,null,null,null,"yes",null,null,"no","no"],["yes",null,null,null,null,null,null,null,null,"yes"],["no",null,null,"no",null,"yes",null,"yes","no","yes"],["yes",null,null,"no",null,"no",null,"no","yes","yes"],["no",null,null,null,null,null,null,null,"no","no"],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"no",null,"no",null,"yes","no","no"],["no",null,null,null,null,null,null,"no",null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["no","no","no","no","no","no","no","no","yes","no"],[null,null,null,null,null,null,null,null,"no",null],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,"dont_know",null],[null,null,null,null,null,null,null,null,null,null],["yes",null,null,"yes",null,"no",null,"yes","no","no"],[null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null],["sexual",null,null,"sexual",null,null,null,"shot",null,null],["0",null,null,"0",null,null,null,"0",null,null],["1",null,null,"1",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"1",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],["0",null,null,"0",null,null,null,"0",null,null],[9,1,183,83,58,146,205,130,72,33],[1,1,1,1,1,1,1,1,1,1],["9_1","1_1","183_1","83_1","58_1","146_1","205_1","130_1","72_1","33_1"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>start<\/th>\n      <th>end<\/th>\n      <th>today<\/th>\n      <th>deviceid<\/th>\n      <th>date<\/th>\n      <th>team_number<\/th>\n      <th>village_name<\/th>\n      <th>village_other<\/th>\n      <th>cluster_number<\/th>\n      <th>household_number<\/th>\n      <th>households_building<\/th>\n      <th>random_hh<\/th>\n      <th>random_hh_note<\/th>\n      <th>consent<\/th>\n      <th>no_consent_reason<\/th>\n      <th>no_consent_other<\/th>\n      <th>member_number<\/th>\n      <th>sex<\/th>\n      <th>age_years<\/th>\n      <th>age_months_calc<\/th>\n      <th>age_months<\/th>\n      <th>bednet<\/th>\n      <th>read_write<\/th>\n      <th>education_level<\/th>\n      <th>measles_vaccination<\/th>\n      <th>vaccination_card<\/th>\n      <th>pregnant<\/th>\n      <th>malaria_treatment<\/th>\n      <th>arrived<\/th>\n      <th>remember_arrival<\/th>\n      <th>arrived_date<\/th>\n      <th>left<\/th>\n      <th>remember_departure<\/th>\n      <th>left_date<\/th>\n      <th>born<\/th>\n      <th>remember_dob<\/th>\n      <th>birthday_date<\/th>\n      <th>died<\/th>\n      <th>remember_death<\/th>\n      <th>death_date<\/th>\n      <th>cause<\/th>\n      <th>cause_other<\/th>\n      <th>violent_episode<\/th>\n      <th>violent_episodes_number<\/th>\n      <th>violence_nature_other<\/th>\n      <th>violence_nature<\/th>\n      <th>violence_nature/beaten<\/th>\n      <th>violence_nature/sexual<\/th>\n      <th>violence_nature/shot<\/th>\n      <th>violence_nature/detained_kidnapped<\/th>\n      <th>violence_nature/other<\/th>\n      <th>violence_nature/no_response<\/th>\n      <th>index<\/th>\n      <th>index_y<\/th>\n      <th>uid<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[8,9,16,18,19,20,52,53]},{"name":"start","targets":0},{"name":"end","targets":1},{"name":"today","targets":2},{"name":"deviceid","targets":3},{"name":"date","targets":4},{"name":"team_number","targets":5},{"name":"village_name","targets":6},{"name":"village_other","targets":7},{"name":"cluster_number","targets":8},{"name":"household_number","targets":9},{"name":"households_building","targets":10},{"name":"random_hh","targets":11},{"name":"random_hh_note","targets":12},{"name":"consent","targets":13},{"name":"no_consent_reason","targets":14},{"name":"no_consent_other","targets":15},{"name":"member_number","targets":16},{"name":"sex","targets":17},{"name":"age_years","targets":18},{"name":"age_months_calc","targets":19},{"name":"age_months","targets":20},{"name":"bednet","targets":21},{"name":"read_write","targets":22},{"name":"education_level","targets":23},{"name":"measles_vaccination","targets":24},{"name":"vaccination_card","targets":25},{"name":"pregnant","targets":26},{"name":"malaria_treatment","targets":27},{"name":"arrived","targets":28},{"name":"remember_arrival","targets":29},{"name":"arrived_date","targets":30},{"name":"left","targets":31},{"name":"remember_departure","targets":32},{"name":"left_date","targets":33},{"name":"born","targets":34},{"name":"remember_dob","targets":35},{"name":"birthday_date","targets":36},{"name":"died","targets":37},{"name":"remember_death","targets":38},{"name":"death_date","targets":39},{"name":"cause","targets":40},{"name":"cause_other","targets":41},{"name":"violent_episode","targets":42},{"name":"violent_episodes_number","targets":43},{"name":"violence_nature_other","targets":44},{"name":"violence_nature","targets":45},{"name":"violence_nature/beaten","targets":46},{"name":"violence_nature/sexual","targets":47},{"name":"violence_nature/shot","targets":48},{"name":"violence_nature/detained_kidnapped","targets":49},{"name":"violence_nature/other","targets":50},{"name":"violence_nature/no_response","targets":51},{"name":"index","targets":52},{"name":"index_y","targets":53},{"name":"uid","targets":54}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Chúng ta cũng muốn nhập dữ liệu về quần thể lấy mẫu để có thể tạo ra các trọng số thích hợp. Dữ liệu này có thể ở các định dạng khác nhau, tuy nhiên chúng tôi khuyên bạn nên định dạng như hình bên dưới (dữ liệu này có thể chỉ cần nhập vào excel).</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="survey-analysis.html#cb1240-1" tabindex="-1"></a><span class="co"># import the population data</span></span>
<span id="cb1240-2"><a href="survey-analysis.html#cb1240-2" tabindex="-1"></a>population <span class="ot">&lt;-</span> rio<span class="sc">::</span><span class="fu">import</span>(<span class="st">&quot;population.xlsx&quot;</span>)</span></code></pre></div>
<p>10 hàng đầu tiên của khảo sát được hiển thị bên dưới.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-600de4796b42d5919169" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-600de4796b42d5919169">{"x":{"filter":"none","vertical":false,"data":[["0-2","3-14","15-29","30-44","45+","0-2","3-14","15-29","30-44","45+"],["male","male","male","male","male","female","female","female","female","female"],[0.034,0.1811,0.138,0.0808,0.06610000000000001,0.034,0.1811,0.138,0.0808,0.06610000000000001],[340,1811,1380,808,661,340,1811,1380,808,661],["district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a","district_a"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>age_group<\/th>\n      <th>sex<\/th>\n      <th>proportions<\/th>\n      <th>population<\/th>\n      <th>health_district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"name":"age_group","targets":0},{"name":"sex","targets":1},{"name":"proportions","targets":2},{"name":"population","targets":3},{"name":"health_district","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Đối với khảo sát theo cụm, bạn có thể muốn thêm trọng số khảo sát ở cấp cụm. Bạn có thể đọc dữ liệu này như trên. Ngoài ra, nếu số lượng ít, chúng có thể được nhập như dưới đây dưới dạng một tibble. Trong mọi trường hợp, bạn sẽ cần có một cột với mã định danh cụm khớp với dữ liệu khảo sát của bạn và một cột khác với số lượng hộ gia đình ở từng cụm.</p>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="survey-analysis.html#cb1241-1" tabindex="-1"></a><span class="do">## define the number of households in each cluster</span></span>
<span id="cb1241-2"><a href="survey-analysis.html#cb1241-2" tabindex="-1"></a>cluster_counts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cluster =</span> <span class="fu">c</span>(<span class="st">&quot;village_1&quot;</span>, <span class="st">&quot;village_2&quot;</span>, <span class="st">&quot;village_3&quot;</span>, <span class="st">&quot;village_4&quot;</span>, </span>
<span id="cb1241-3"><a href="survey-analysis.html#cb1241-3" tabindex="-1"></a>                                     <span class="st">&quot;village_5&quot;</span>, <span class="st">&quot;village_6&quot;</span>, <span class="st">&quot;village_7&quot;</span>, <span class="st">&quot;village_8&quot;</span>,</span>
<span id="cb1241-4"><a href="survey-analysis.html#cb1241-4" tabindex="-1"></a>                                     <span class="st">&quot;village_9&quot;</span>, <span class="st">&quot;village_10&quot;</span>), </span>
<span id="cb1241-5"><a href="survey-analysis.html#cb1241-5" tabindex="-1"></a>                         <span class="at">households =</span> <span class="fu">c</span>(<span class="dv">700</span>, <span class="dv">400</span>, <span class="dv">600</span>, <span class="dv">500</span>, <span class="dv">300</span>, </span>
<span id="cb1241-6"><a href="survey-analysis.html#cb1241-6" tabindex="-1"></a>                                        <span class="dv">800</span>, <span class="dv">700</span>, <span class="dv">400</span>, <span class="dv">500</span>, <span class="dv">500</span>))</span></code></pre></div>
</div>
<div id="làm-sạch-dữ-liệu-2" class="section level3 unnumbered">
<h3>Làm sạch dữ liệu</h3>
<p>Dưới đây đảm bảo rằng cột ngày ở định dạng thích hợp. Có một số cách khác để thực hiện việc này (xem chương <a href="dates.html#dates">Làm việc với ngày tháng</a> để biết chi tiết), tuy nhiên sử dụng từ điển để xác định ngày sẽ nhanh chóng và dễ dàng.</p>
<p>Chúng tôi cũng tạo một biến nhóm tuổi bằng cách sử dụng hàm <code>age_categories()</code> từ <strong>epikit</strong> - xem phần <a href="cleaning.html#cleaning">Làm sạch dữ liệu</a> của sổ tay để biết chi tiết. Ngoài ra, chúng tôi tạo một biến ký tự xác định các cụm khác nhau nằm trong khu vực nào.</p>
<p>Cuối cùng, chúng tôi mã hóa lại tất cả các biến yes/no thành các biến TRUE/FALSE - nếu không, các biến này không thể được sử dụng bởi các hàm tính tỷ lệ trong package <strong>survey</strong>.</p>
<div class="sourceCode" id="cb1242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1242-1"><a href="survey-analysis.html#cb1242-1" tabindex="-1"></a><span class="do">## select the date variable names from the dictionary </span></span>
<span id="cb1242-2"><a href="survey-analysis.html#cb1242-2" tabindex="-1"></a>DATEVARS <span class="ot">&lt;-</span> survey_dict <span class="sc">%&gt;%</span> </span>
<span id="cb1242-3"><a href="survey-analysis.html#cb1242-3" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;date&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1242-4"><a href="survey-analysis.html#cb1242-4" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(survey_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb1242-5"><a href="survey-analysis.html#cb1242-5" tabindex="-1"></a>  <span class="do">## filter to match the column names of your data</span></span>
<span id="cb1242-6"><a href="survey-analysis.html#cb1242-6" tabindex="-1"></a>  <span class="fu">pull</span>(name) <span class="co"># select date vars</span></span>
<span id="cb1242-7"><a href="survey-analysis.html#cb1242-7" tabindex="-1"></a>  </span>
<span id="cb1242-8"><a href="survey-analysis.html#cb1242-8" tabindex="-1"></a><span class="do">## change to dates </span></span>
<span id="cb1242-9"><a href="survey-analysis.html#cb1242-9" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1242-10"><a href="survey-analysis.html#cb1242-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(DATEVARS), as.Date))</span>
<span id="cb1242-11"><a href="survey-analysis.html#cb1242-11" tabindex="-1"></a></span>
<span id="cb1242-12"><a href="survey-analysis.html#cb1242-12" tabindex="-1"></a></span>
<span id="cb1242-13"><a href="survey-analysis.html#cb1242-13" tabindex="-1"></a><span class="do">## add those with only age in months to the year variable (divide by twelve)</span></span>
<span id="cb1242-14"><a href="survey-analysis.html#cb1242-14" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1242-15"><a href="survey-analysis.html#cb1242-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_years =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(age_years), </span>
<span id="cb1242-16"><a href="survey-analysis.html#cb1242-16" tabindex="-1"></a>                             age_months <span class="sc">/</span> <span class="dv">12</span>, </span>
<span id="cb1242-17"><a href="survey-analysis.html#cb1242-17" tabindex="-1"></a>                             age_years))</span>
<span id="cb1242-18"><a href="survey-analysis.html#cb1242-18" tabindex="-1"></a></span>
<span id="cb1242-19"><a href="survey-analysis.html#cb1242-19" tabindex="-1"></a><span class="do">## define age group variable</span></span>
<span id="cb1242-20"><a href="survey-analysis.html#cb1242-20" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1242-21"><a href="survey-analysis.html#cb1242-21" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">age_categories</span>(age_years, </span>
<span id="cb1242-22"><a href="survey-analysis.html#cb1242-22" tabindex="-1"></a>                                    <span class="at">breakers =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">45</span>)</span>
<span id="cb1242-23"><a href="survey-analysis.html#cb1242-23" tabindex="-1"></a>                                    ))</span>
<span id="cb1242-24"><a href="survey-analysis.html#cb1242-24" tabindex="-1"></a></span>
<span id="cb1242-25"><a href="survey-analysis.html#cb1242-25" tabindex="-1"></a></span>
<span id="cb1242-26"><a href="survey-analysis.html#cb1242-26" tabindex="-1"></a><span class="do">## create a character variable based off groups of a different variable </span></span>
<span id="cb1242-27"><a href="survey-analysis.html#cb1242-27" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1242-28"><a href="survey-analysis.html#cb1242-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">health_district =</span> <span class="fu">case_when</span>(</span>
<span id="cb1242-29"><a href="survey-analysis.html#cb1242-29" tabindex="-1"></a>    cluster_number <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">~</span> <span class="st">&quot;district_a&quot;</span>, </span>
<span id="cb1242-30"><a href="survey-analysis.html#cb1242-30" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;district_b&quot;</span></span>
<span id="cb1242-31"><a href="survey-analysis.html#cb1242-31" tabindex="-1"></a>  ))</span>
<span id="cb1242-32"><a href="survey-analysis.html#cb1242-32" tabindex="-1"></a></span>
<span id="cb1242-33"><a href="survey-analysis.html#cb1242-33" tabindex="-1"></a></span>
<span id="cb1242-34"><a href="survey-analysis.html#cb1242-34" tabindex="-1"></a><span class="do">## select the yes/no variable names from the dictionary </span></span>
<span id="cb1242-35"><a href="survey-analysis.html#cb1242-35" tabindex="-1"></a>YNVARS <span class="ot">&lt;-</span> survey_dict <span class="sc">%&gt;%</span> </span>
<span id="cb1242-36"><a href="survey-analysis.html#cb1242-36" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">&quot;yn&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1242-37"><a href="survey-analysis.html#cb1242-37" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">%in%</span> <span class="fu">names</span>(survey_data)) <span class="sc">%&gt;%</span> </span>
<span id="cb1242-38"><a href="survey-analysis.html#cb1242-38" tabindex="-1"></a>  <span class="do">## filter to match the column names of your data</span></span>
<span id="cb1242-39"><a href="survey-analysis.html#cb1242-39" tabindex="-1"></a>  <span class="fu">pull</span>(name) <span class="co"># select yn vars</span></span>
<span id="cb1242-40"><a href="survey-analysis.html#cb1242-40" tabindex="-1"></a>  </span>
<span id="cb1242-41"><a href="survey-analysis.html#cb1242-41" tabindex="-1"></a><span class="do">## change to dates </span></span>
<span id="cb1242-42"><a href="survey-analysis.html#cb1242-42" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1242-43"><a href="survey-analysis.html#cb1242-43" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(YNVARS), </span>
<span id="cb1242-44"><a href="survey-analysis.html#cb1242-44" tabindex="-1"></a>                str_detect, </span>
<span id="cb1242-45"><a href="survey-analysis.html#cb1242-45" tabindex="-1"></a>                <span class="at">pattern =</span> <span class="st">&quot;yes&quot;</span>))</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="dữ-liệu-khảo-sát" class="section level2" number="26.3">
<h2><span class="header-section-number">26.3</span> Dữ liệu khảo sát</h2>
<p>Có rất nhiều thiết kế lấy mẫu khác nhau có thể được sử dụng cho các khảo sát. Ở đây chúng tôi sẽ trình bày code cho: - Phân tầng - Cụm - Cụm phân tầng</p>
<p>Như đã mô tả ở trên (tùy thuộc vào cách bạn thiết kế bảng câu hỏi của mình), dữ liệu cho mỗi cấp độ sẽ được xuất dưới dạng bộ dữ liệu riêng biệt từ Kobo. Trong ví dụ của chúng tôi, có một cấp cho các hộ gia đình và một cấp cho các cá nhân trong các hộ gia đình đó.</p>
<p>Hai cấp độ này được liên kết bởi một mã định danh duy nhất. Đối với bộ dữ liệu Kobo, biến này là “_index” ở cấp hộ gia đình, khớp với “_parent_index” ở cấp cá nhân. Thao tác này sẽ tạo các hàng mới cho hộ gia đình với mỗi cá nhân phù hợp, hãy xem chương <a href="joining-matching.html#joining-matching">Nối dữ liệu</a> để biết chi tiết.</p>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="survey-analysis.html#cb1243-1" tabindex="-1"></a><span class="do">## join the individual and household data to form a complete data set</span></span>
<span id="cb1243-2"><a href="survey-analysis.html#cb1243-2" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(survey_data_hh, </span>
<span id="cb1243-3"><a href="survey-analysis.html#cb1243-3" tabindex="-1"></a>                         survey_data_indiv,</span>
<span id="cb1243-4"><a href="survey-analysis.html#cb1243-4" tabindex="-1"></a>                         <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;_index&quot;</span> <span class="ot">=</span> <span class="st">&quot;_parent_index&quot;</span>))</span>
<span id="cb1243-5"><a href="survey-analysis.html#cb1243-5" tabindex="-1"></a></span>
<span id="cb1243-6"><a href="survey-analysis.html#cb1243-6" tabindex="-1"></a></span>
<span id="cb1243-7"><a href="survey-analysis.html#cb1243-7" tabindex="-1"></a><span class="do">## create a unique identifier by combining indeces of the two levels </span></span>
<span id="cb1243-8"><a href="survey-analysis.html#cb1243-8" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1243-9"><a href="survey-analysis.html#cb1243-9" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">uid =</span> <span class="fu">str_glue</span>(<span class="st">&quot;{index}_{index_y}&quot;</span>))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="thời-gian-quan-sát" class="section level2" number="26.4">
<h2><span class="header-section-number">26.4</span> Thời gian quan sát</h2>
<p>Đối với các cuộc khảo sát về tỷ lệ tử vong, chúng ta muốn biết mỗi cá nhân đã có mặt tại địa điểm trong bao lâu để có thể tính toán tỷ lệ tử vong thích hợp trong khoảng thời gian nghiên cứu. Điều này không áp dụng đối với tất cả các cuộc điều tra, nhưng đặc biệt rất quan trọng đối với các cuộc điều tra tử vong vì chúng thường được khảo sát ở các quần thể di động hoặc di cư.</p>
<p>Để làm điều này, trước tiên chúng ta xác định khoảng thời gian quan tâm, còn được gọi là khoảng thời gian hồi cứu (tức là thời gian mà những người tham gia được yêu cầu báo cáo khi trả lời câu hỏi). Sau đó, chúng ta có thể sử dụng khoảng thời gian này để đặt các ngày không thích hợp thành giá trị missing, vd: các trường hợp tử vong được báo cáo ngoài khoảng thời gian quan tâm.</p>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1244-1"><a href="survey-analysis.html#cb1244-1" tabindex="-1"></a><span class="do">## set the start/end of recall period</span></span>
<span id="cb1244-2"><a href="survey-analysis.html#cb1244-2" tabindex="-1"></a><span class="do">## can be changed to date variables from dataset </span></span>
<span id="cb1244-3"><a href="survey-analysis.html#cb1244-3" tabindex="-1"></a><span class="do">## (e.g. arrival date &amp; date questionnaire)</span></span>
<span id="cb1244-4"><a href="survey-analysis.html#cb1244-4" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1244-5"><a href="survey-analysis.html#cb1244-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recall_start =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2018-01-01&quot;</span>), </span>
<span id="cb1244-6"><a href="survey-analysis.html#cb1244-6" tabindex="-1"></a>         <span class="at">recall_end   =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2018-05-01&quot;</span>)</span>
<span id="cb1244-7"><a href="survey-analysis.html#cb1244-7" tabindex="-1"></a>  )</span>
<span id="cb1244-8"><a href="survey-analysis.html#cb1244-8" tabindex="-1"></a></span>
<span id="cb1244-9"><a href="survey-analysis.html#cb1244-9" tabindex="-1"></a></span>
<span id="cb1244-10"><a href="survey-analysis.html#cb1244-10" tabindex="-1"></a><span class="co"># set inappropriate dates to NA based on rules </span></span>
<span id="cb1244-11"><a href="survey-analysis.html#cb1244-11" tabindex="-1"></a><span class="do">## e.g. arrivals before start, departures departures after end</span></span>
<span id="cb1244-12"><a href="survey-analysis.html#cb1244-12" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1244-13"><a href="survey-analysis.html#cb1244-13" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb1244-14"><a href="survey-analysis.html#cb1244-14" tabindex="-1"></a>           <span class="at">arrived_date =</span> <span class="fu">if_else</span>(arrived_date <span class="sc">&lt;</span> recall_start, </span>
<span id="cb1244-15"><a href="survey-analysis.html#cb1244-15" tabindex="-1"></a>                                 <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1244-16"><a href="survey-analysis.html#cb1244-16" tabindex="-1"></a>                                  arrived_date),</span>
<span id="cb1244-17"><a href="survey-analysis.html#cb1244-17" tabindex="-1"></a>           <span class="at">birthday_date =</span> <span class="fu">if_else</span>(birthday_date <span class="sc">&lt;</span> recall_start,</span>
<span id="cb1244-18"><a href="survey-analysis.html#cb1244-18" tabindex="-1"></a>                                  <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1244-19"><a href="survey-analysis.html#cb1244-19" tabindex="-1"></a>                                  birthday_date),</span>
<span id="cb1244-20"><a href="survey-analysis.html#cb1244-20" tabindex="-1"></a>           <span class="at">left_date =</span> <span class="fu">if_else</span>(left_date <span class="sc">&gt;</span> recall_end,</span>
<span id="cb1244-21"><a href="survey-analysis.html#cb1244-21" tabindex="-1"></a>                              <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1244-22"><a href="survey-analysis.html#cb1244-22" tabindex="-1"></a>                               left_date),</span>
<span id="cb1244-23"><a href="survey-analysis.html#cb1244-23" tabindex="-1"></a>           <span class="at">death_date =</span> <span class="fu">if_else</span>(death_date <span class="sc">&gt;</span> recall_end,</span>
<span id="cb1244-24"><a href="survey-analysis.html#cb1244-24" tabindex="-1"></a>                               <span class="fu">as.Date</span>(<span class="cn">NA</span>),</span>
<span id="cb1244-25"><a href="survey-analysis.html#cb1244-25" tabindex="-1"></a>                               death_date)</span>
<span id="cb1244-26"><a href="survey-analysis.html#cb1244-26" tabindex="-1"></a>           )</span></code></pre></div>
<p>Sau đó, chúng ta có thể sử dụng các biến ngày của mình để xác định ngày bắt đầu và ngày kết thúc cho từng cá nhân. Chúng ta có thể sử dụng hàm <code>find_start_date()</code> từ <strong>sitrep</strong> để xác định ngày bắt đầu và sau đó sử dụng hàm đó để tính toán sự khác biệt giữa các ngày (người-thời gian).</p>
<p>Ngày bắt đầu: Sự kiện phù hợp tới sớm nhất trong khoảng thời gian hồi cứu của bạn. Hoặc là ngày bắt đầu thời gian hồi cứu của bạn (mà bạn xác định trước) hoặc ngày sau khi bắt đầu hồi cứu nếu có (ví dụ: đi đến hoặc sinh ra)</p>
<p>Ngày kết thúc: Sự kiện dừng lại thích hợp sớm nhất trong thời gian hồi cứu của bạn. Hoặc là ngày kết thúc thời gian hồi cứu hoặc ngày trước khi kết thúc hồi cứu nếu có (ví dụ: rời đi, tử vong)</p>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="survey-analysis.html#cb1245-1" tabindex="-1"></a><span class="do">## create new variables for start and end dates/causes</span></span>
<span id="cb1245-2"><a href="survey-analysis.html#cb1245-2" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1245-3"><a href="survey-analysis.html#cb1245-3" tabindex="-1"></a>     <span class="do">## choose earliest date entered in survey</span></span>
<span id="cb1245-4"><a href="survey-analysis.html#cb1245-4" tabindex="-1"></a>     <span class="do">## from births, household arrivals, and camp arrivals </span></span>
<span id="cb1245-5"><a href="survey-analysis.html#cb1245-5" tabindex="-1"></a>     <span class="fu">find_start_date</span>(<span class="st">&quot;birthday_date&quot;</span>,</span>
<span id="cb1245-6"><a href="survey-analysis.html#cb1245-6" tabindex="-1"></a>                  <span class="st">&quot;arrived_date&quot;</span>,</span>
<span id="cb1245-7"><a href="survey-analysis.html#cb1245-7" tabindex="-1"></a>                  <span class="at">period_start =</span> <span class="st">&quot;recall_start&quot;</span>,</span>
<span id="cb1245-8"><a href="survey-analysis.html#cb1245-8" tabindex="-1"></a>                  <span class="at">period_end   =</span> <span class="st">&quot;recall_end&quot;</span>,</span>
<span id="cb1245-9"><a href="survey-analysis.html#cb1245-9" tabindex="-1"></a>                  <span class="at">datecol      =</span> <span class="st">&quot;startdate&quot;</span>,</span>
<span id="cb1245-10"><a href="survey-analysis.html#cb1245-10" tabindex="-1"></a>                  <span class="at">datereason   =</span> <span class="st">&quot;startcause&quot;</span> </span>
<span id="cb1245-11"><a href="survey-analysis.html#cb1245-11" tabindex="-1"></a>                 ) <span class="sc">%&gt;%</span></span>
<span id="cb1245-12"><a href="survey-analysis.html#cb1245-12" tabindex="-1"></a>     <span class="do">## choose earliest date entered in survey</span></span>
<span id="cb1245-13"><a href="survey-analysis.html#cb1245-13" tabindex="-1"></a>     <span class="do">## from camp departures, death and end of the study</span></span>
<span id="cb1245-14"><a href="survey-analysis.html#cb1245-14" tabindex="-1"></a>     <span class="fu">find_end_date</span>(<span class="st">&quot;left_date&quot;</span>,</span>
<span id="cb1245-15"><a href="survey-analysis.html#cb1245-15" tabindex="-1"></a>                <span class="st">&quot;death_date&quot;</span>,</span>
<span id="cb1245-16"><a href="survey-analysis.html#cb1245-16" tabindex="-1"></a>                <span class="at">period_start =</span> <span class="st">&quot;recall_start&quot;</span>,</span>
<span id="cb1245-17"><a href="survey-analysis.html#cb1245-17" tabindex="-1"></a>                <span class="at">period_end   =</span> <span class="st">&quot;recall_end&quot;</span>,</span>
<span id="cb1245-18"><a href="survey-analysis.html#cb1245-18" tabindex="-1"></a>                <span class="at">datecol      =</span> <span class="st">&quot;enddate&quot;</span>,</span>
<span id="cb1245-19"><a href="survey-analysis.html#cb1245-19" tabindex="-1"></a>                <span class="at">datereason   =</span> <span class="st">&quot;endcause&quot;</span> </span>
<span id="cb1245-20"><a href="survey-analysis.html#cb1245-20" tabindex="-1"></a>               )</span>
<span id="cb1245-21"><a href="survey-analysis.html#cb1245-21" tabindex="-1"></a></span>
<span id="cb1245-22"><a href="survey-analysis.html#cb1245-22" tabindex="-1"></a></span>
<span id="cb1245-23"><a href="survey-analysis.html#cb1245-23" tabindex="-1"></a><span class="do">## label those that were present at the start/end (except births/deaths)</span></span>
<span id="cb1245-24"><a href="survey-analysis.html#cb1245-24" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1245-25"><a href="survey-analysis.html#cb1245-25" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb1245-26"><a href="survey-analysis.html#cb1245-26" tabindex="-1"></a>       <span class="do">## fill in start date to be the beginning of recall period (for those empty) </span></span>
<span id="cb1245-27"><a href="survey-analysis.html#cb1245-27" tabindex="-1"></a>       <span class="at">startdate =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(startdate), recall_start, startdate), </span>
<span id="cb1245-28"><a href="survey-analysis.html#cb1245-28" tabindex="-1"></a>       <span class="do">## set the start cause to present at start if equal to recall period </span></span>
<span id="cb1245-29"><a href="survey-analysis.html#cb1245-29" tabindex="-1"></a>       <span class="do">## unless it is equal to the birth date </span></span>
<span id="cb1245-30"><a href="survey-analysis.html#cb1245-30" tabindex="-1"></a>       <span class="at">startcause =</span> <span class="fu">if_else</span>(startdate <span class="sc">==</span> recall_start <span class="sc">&amp;</span> startcause <span class="sc">!=</span> <span class="st">&quot;birthday_date&quot;</span>,</span>
<span id="cb1245-31"><a href="survey-analysis.html#cb1245-31" tabindex="-1"></a>                              <span class="st">&quot;Present at start&quot;</span>, startcause), </span>
<span id="cb1245-32"><a href="survey-analysis.html#cb1245-32" tabindex="-1"></a>       <span class="do">## fill in end date to be end of recall period (for those empty) </span></span>
<span id="cb1245-33"><a href="survey-analysis.html#cb1245-33" tabindex="-1"></a>       <span class="at">enddate =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(enddate), recall_end, enddate), </span>
<span id="cb1245-34"><a href="survey-analysis.html#cb1245-34" tabindex="-1"></a>       <span class="do">## set the end cause to present at end if equall to recall end </span></span>
<span id="cb1245-35"><a href="survey-analysis.html#cb1245-35" tabindex="-1"></a>       <span class="do">## unless it is equal to the death date</span></span>
<span id="cb1245-36"><a href="survey-analysis.html#cb1245-36" tabindex="-1"></a>       <span class="at">endcause =</span> <span class="fu">if_else</span>(enddate <span class="sc">==</span> recall_end <span class="sc">&amp;</span> endcause <span class="sc">!=</span> <span class="st">&quot;death_date&quot;</span>, </span>
<span id="cb1245-37"><a href="survey-analysis.html#cb1245-37" tabindex="-1"></a>                            <span class="st">&quot;Present at end&quot;</span>, endcause))</span>
<span id="cb1245-38"><a href="survey-analysis.html#cb1245-38" tabindex="-1"></a></span>
<span id="cb1245-39"><a href="survey-analysis.html#cb1245-39" tabindex="-1"></a></span>
<span id="cb1245-40"><a href="survey-analysis.html#cb1245-40" tabindex="-1"></a><span class="do">## Define observation time in days</span></span>
<span id="cb1245-41"><a href="survey-analysis.html#cb1245-41" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1245-42"><a href="survey-analysis.html#cb1245-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">obstime =</span> <span class="fu">as.numeric</span>(enddate <span class="sc">-</span> startdate))</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="áp-dụng-trọng-số" class="section level2" number="26.5">
<h2><span class="header-section-number">26.5</span> Áp dụng trọng số</h2>
<p>Điều quan trọng là bạn phải loại bỏ các đối tượng có lỗi trước khi thêm trọng số khảo sát. Ví dụ: nếu bạn có các quan sát với thời gian theo dõi âm, bạn sẽ cần kiểm tra các đối tượng đó (bạn có thể thực hiện việc này với hàm <code>assert_positive_timespan()</code> từ <strong>sitrep</strong>. Một điều khác là nếu bạn muốn bỏ các hàng trống (ví dụ: với <code>drop_na(uid)</code>) hoặc xóa các bản ghi trùng lặp (xem chương <a href="cleaning.html#loại-bỏ-trùng-lặp">Loại bỏ trùng lặp</a> trong sổ tay này để biết thêm chi tiết). Những đối tượng không có sự đồng ý tham gia nghiên cứu cũng cần phải bị xóa.</p>
<p>Trong ví dụ này, chúng ta lọc các trường hợp muốn loại bỏ và lưu trữ chúng trong một dataframe riêng - theo cách này, chúng ta có thể mô tả những trường hợp đã bị loại khỏi khảo sát. Sau đó, chúng ta sử dụng hàm <code>anti_join()</code> từ <strong>dplyr</strong> để xóa những trường hợp bị loại bỏ này khỏi dữ liệu khảo sát của chúng ta.</p>
<p><span style="color: red;"><strong><em>NGUY HIỂM:</em></strong> Bạn không thể có giá trị missing trong biến trọng số của mình hoặc bất kỳ biến nào có liên quan đến thiết kế khảo sát của bạn (ví dụ: tuổi, giới tính, biến phân tầng hoặc cụm).</span></p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1246-1"><a href="survey-analysis.html#cb1246-1" tabindex="-1"></a><span class="do">## store the cases that you drop so you can describe them (e.g. non-consenting </span></span>
<span id="cb1246-2"><a href="survey-analysis.html#cb1246-2" tabindex="-1"></a><span class="do">## or wrong village/cluster)</span></span>
<span id="cb1246-3"><a href="survey-analysis.html#cb1246-3" tabindex="-1"></a>dropped <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1246-4"><a href="survey-analysis.html#cb1246-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>consent <span class="sc">|</span> <span class="fu">is.na</span>(startdate) <span class="sc">|</span> <span class="fu">is.na</span>(enddate) <span class="sc">|</span> village_name <span class="sc">==</span> <span class="st">&quot;other&quot;</span>)</span>
<span id="cb1246-5"><a href="survey-analysis.html#cb1246-5" tabindex="-1"></a></span>
<span id="cb1246-6"><a href="survey-analysis.html#cb1246-6" tabindex="-1"></a><span class="do">## use the dropped cases to remove the unused rows from the survey data set  </span></span>
<span id="cb1246-7"><a href="survey-analysis.html#cb1246-7" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(survey_data, dropped, <span class="at">by =</span> <span class="fu">names</span>(dropped))</span></code></pre></div>
<p>Như đã đề cập ở trên, chúng tôi trình bày cách thêm trọng số cho ba thiết kế nghiên cứu khác nhau (phân tầng, phân cụm và cụm phân tầng). Chúng yêu cầu thông tin về dân số gốc và/hoặc các cụm được khảo sát. Chúng tôi sẽ sử dụng code cụm phân tầng cho ví dụ này, nhưng hãy sử dụng code nào thích hợp nhất cho thiết kế nghiên cứu của bạn.</p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="survey-analysis.html#cb1247-1" tabindex="-1"></a><span class="co"># stratified ------------------------------------------------------------------</span></span>
<span id="cb1247-2"><a href="survey-analysis.html#cb1247-2" tabindex="-1"></a><span class="co"># create a variable called &quot;surv_weight_strata&quot;</span></span>
<span id="cb1247-3"><a href="survey-analysis.html#cb1247-3" tabindex="-1"></a><span class="co"># contains weights for each individual - by age group, sex and health district</span></span>
<span id="cb1247-4"><a href="survey-analysis.html#cb1247-4" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">add_weights_strata</span>(<span class="at">x =</span> survey_data,</span>
<span id="cb1247-5"><a href="survey-analysis.html#cb1247-5" tabindex="-1"></a>                                         <span class="at">p =</span> population,</span>
<span id="cb1247-6"><a href="survey-analysis.html#cb1247-6" tabindex="-1"></a>                                         <span class="at">surv_weight =</span> <span class="st">&quot;surv_weight_strata&quot;</span>,</span>
<span id="cb1247-7"><a href="survey-analysis.html#cb1247-7" tabindex="-1"></a>                                         <span class="at">surv_weight_ID =</span> <span class="st">&quot;surv_weight_ID_strata&quot;</span>,</span>
<span id="cb1247-8"><a href="survey-analysis.html#cb1247-8" tabindex="-1"></a>                                         age_group, sex, health_district)</span>
<span id="cb1247-9"><a href="survey-analysis.html#cb1247-9" tabindex="-1"></a></span>
<span id="cb1247-10"><a href="survey-analysis.html#cb1247-10" tabindex="-1"></a><span class="do">## cluster ---------------------------------------------------------------------</span></span>
<span id="cb1247-11"><a href="survey-analysis.html#cb1247-11" tabindex="-1"></a></span>
<span id="cb1247-12"><a href="survey-analysis.html#cb1247-12" tabindex="-1"></a><span class="co"># get the number of people of individuals interviewed per household</span></span>
<span id="cb1247-13"><a href="survey-analysis.html#cb1247-13" tabindex="-1"></a><span class="co"># adds a variable with counts of the household (parent) index variable</span></span>
<span id="cb1247-14"><a href="survey-analysis.html#cb1247-14" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1247-15"><a href="survey-analysis.html#cb1247-15" tabindex="-1"></a>  <span class="fu">add_count</span>(index, <span class="at">name =</span> <span class="st">&quot;interviewed&quot;</span>)</span>
<span id="cb1247-16"><a href="survey-analysis.html#cb1247-16" tabindex="-1"></a></span>
<span id="cb1247-17"><a href="survey-analysis.html#cb1247-17" tabindex="-1"></a></span>
<span id="cb1247-18"><a href="survey-analysis.html#cb1247-18" tabindex="-1"></a><span class="do">## create cluster weights</span></span>
<span id="cb1247-19"><a href="survey-analysis.html#cb1247-19" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> <span class="fu">add_weights_cluster</span>(<span class="at">x =</span> survey_data,</span>
<span id="cb1247-20"><a href="survey-analysis.html#cb1247-20" tabindex="-1"></a>                                          <span class="at">cl =</span> cluster_counts,</span>
<span id="cb1247-21"><a href="survey-analysis.html#cb1247-21" tabindex="-1"></a>                                          <span class="at">eligible =</span> member_number,</span>
<span id="cb1247-22"><a href="survey-analysis.html#cb1247-22" tabindex="-1"></a>                                          <span class="at">interviewed =</span> interviewed,</span>
<span id="cb1247-23"><a href="survey-analysis.html#cb1247-23" tabindex="-1"></a>                                          <span class="at">cluster_x =</span> village_name,</span>
<span id="cb1247-24"><a href="survey-analysis.html#cb1247-24" tabindex="-1"></a>                                          <span class="at">cluster_cl =</span> cluster,</span>
<span id="cb1247-25"><a href="survey-analysis.html#cb1247-25" tabindex="-1"></a>                                          <span class="at">household_x =</span> index,</span>
<span id="cb1247-26"><a href="survey-analysis.html#cb1247-26" tabindex="-1"></a>                                          <span class="at">household_cl =</span> households,</span>
<span id="cb1247-27"><a href="survey-analysis.html#cb1247-27" tabindex="-1"></a>                                          <span class="at">surv_weight =</span> <span class="st">&quot;surv_weight_cluster&quot;</span>,</span>
<span id="cb1247-28"><a href="survey-analysis.html#cb1247-28" tabindex="-1"></a>                                          <span class="at">surv_weight_ID =</span> <span class="st">&quot;surv_weight_ID_cluster&quot;</span>,</span>
<span id="cb1247-29"><a href="survey-analysis.html#cb1247-29" tabindex="-1"></a>                                          <span class="at">ignore_cluster =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1247-30"><a href="survey-analysis.html#cb1247-30" tabindex="-1"></a>                                          <span class="at">ignore_household =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1247-31"><a href="survey-analysis.html#cb1247-31" tabindex="-1"></a></span>
<span id="cb1247-32"><a href="survey-analysis.html#cb1247-32" tabindex="-1"></a></span>
<span id="cb1247-33"><a href="survey-analysis.html#cb1247-33" tabindex="-1"></a><span class="co"># stratified and cluster ------------------------------------------------------</span></span>
<span id="cb1247-34"><a href="survey-analysis.html#cb1247-34" tabindex="-1"></a><span class="co"># create a survey weight for cluster and strata</span></span>
<span id="cb1247-35"><a href="survey-analysis.html#cb1247-35" tabindex="-1"></a>survey_data <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1247-36"><a href="survey-analysis.html#cb1247-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">surv_weight_cluster_strata =</span> surv_weight_strata <span class="sc">*</span> surv_weight_cluster)</span></code></pre></div>
<!-- ======================================================= -->
</div>
<div id="đối-tượng-theo-thiết-kế-nghiên-cứu" class="section level2" number="26.6">
<h2><span class="header-section-number">26.6</span> Đối tượng theo thiết kế nghiên cứu</h2>
<p>Tạo đối tượng khảo sát theo thiết kế nghiên cứu của bạn. Sử dụng theo cách tương tự như dataframe để tính toán trọng số cho tỷ lệ, v.v. Đảm bảo rằng tất cả các biến cần thiết đã được tạo trước bước này.</p>
<p>Có bốn tùy chọn, hãy đánh dấu thành bình luận những tùy chọn bạn không sử dụng: - Ngẫu nhiên đơn - Phân tầng - Cụm - Cụm phân tầng</p>
<p>Đối với mẫu này - chúng ta sẽ giả vờ rằng chúng ta nhóm cụm các cuộc khảo sát theo hai tầng riêng biệt (khu vực A và B). Vì vậy, để có được ước tính tổng thể, chúng ta cần có trọng số kết hợp của cụm và tầng.</p>
<p>Như đã đề cập trước đây, có hai packages có sẵn để thực hiện việc này. Package cổ điển là <strong>survey</strong> và một package gọn hơn được gọi là <strong>srvyr</strong> giúp tạo các đối tượng và hàm theo phong cách tidyverse. Chúng tôi sẽ trình bày cả hai, nhưng lưu ý rằng hầu hết code trong chương này sẽ sử dụng các đối tượng dựa trên <strong>srvyr</strong>. Một ngoại lệ là package <strong>gtsummary</strong> chỉ chấp nhận các đối tượng từ package <strong>survey</strong>.</p>
<div id="package-survey" class="section level3" number="26.6.1">
<h3><span class="header-section-number">26.6.1</span> Package <strong>Survey</strong></h3>
<p>Package <strong>survey</strong> sử dụng hiệu quả code <strong>base</strong> <em>R</em> nên không thể sử dụng các pipes (<code>%&gt;%</code>) hoặc các cú pháp <strong>dplyr</strong> khác. Với package <strong>survey</strong>, chúng tôi sử dụng hàm <code>svydesign()</code> để xác định đối tượng khảo sát với các cụm, trọng số và tầng thích hợp.</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> chúng ta cần sử dụng dấu ngã (<code>~</code>) trước các biến, điều này là do package sử dụng cú pháp <strong>base</strong> <em>R</em> để gán các biến dựa trên công thức.</span></p>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="survey-analysis.html#cb1248-1" tabindex="-1"></a><span class="co"># simple random ---------------------------------------------------------------</span></span>
<span id="cb1248-2"><a href="survey-analysis.html#cb1248-2" tabindex="-1"></a>base_survey_design_simple <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="co"># 1 for no cluster ids</span></span>
<span id="cb1248-3"><a href="survey-analysis.html#cb1248-3" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="cn">NULL</span>,               <span class="co"># No weight added</span></span>
<span id="cb1248-4"><a href="survey-analysis.html#cb1248-4" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span>,                <span class="co"># sampling was simple (no strata)</span></span>
<span id="cb1248-5"><a href="survey-analysis.html#cb1248-5" tabindex="-1"></a>                   <span class="at">data =</span> survey_data            <span class="co"># have to specify the dataset</span></span>
<span id="cb1248-6"><a href="survey-analysis.html#cb1248-6" tabindex="-1"></a>                  )</span>
<span id="cb1248-7"><a href="survey-analysis.html#cb1248-7" tabindex="-1"></a></span>
<span id="cb1248-8"><a href="survey-analysis.html#cb1248-8" tabindex="-1"></a><span class="do">## stratified ------------------------------------------------------------------</span></span>
<span id="cb1248-9"><a href="survey-analysis.html#cb1248-9" tabindex="-1"></a>base_survey_design_strata <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,  <span class="co"># 1 for no cluster ids</span></span>
<span id="cb1248-10"><a href="survey-analysis.html#cb1248-10" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>surv_weight_strata, <span class="co"># weight variable created above</span></span>
<span id="cb1248-11"><a href="survey-analysis.html#cb1248-11" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="sc">~</span>health_district,     <span class="co"># sampling was stratified by district</span></span>
<span id="cb1248-12"><a href="survey-analysis.html#cb1248-12" tabindex="-1"></a>                   <span class="at">data =</span> survey_data             <span class="co"># have to specify the dataset</span></span>
<span id="cb1248-13"><a href="survey-analysis.html#cb1248-13" tabindex="-1"></a>                  )</span>
<span id="cb1248-14"><a href="survey-analysis.html#cb1248-14" tabindex="-1"></a></span>
<span id="cb1248-15"><a href="survey-analysis.html#cb1248-15" tabindex="-1"></a><span class="co"># cluster ---------------------------------------------------------------------</span></span>
<span id="cb1248-16"><a href="survey-analysis.html#cb1248-16" tabindex="-1"></a>base_survey_design_cluster <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>village_name, <span class="co"># cluster ids</span></span>
<span id="cb1248-17"><a href="survey-analysis.html#cb1248-17" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>surv_weight_cluster, <span class="co"># weight variable created above</span></span>
<span id="cb1248-18"><a href="survey-analysis.html#cb1248-18" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span>,                 <span class="co"># sampling was simple (no strata)</span></span>
<span id="cb1248-19"><a href="survey-analysis.html#cb1248-19" tabindex="-1"></a>                   <span class="at">data =</span> survey_data              <span class="co"># have to specify the dataset</span></span>
<span id="cb1248-20"><a href="survey-analysis.html#cb1248-20" tabindex="-1"></a>                  )</span>
<span id="cb1248-21"><a href="survey-analysis.html#cb1248-21" tabindex="-1"></a></span>
<span id="cb1248-22"><a href="survey-analysis.html#cb1248-22" tabindex="-1"></a><span class="co"># stratified cluster ----------------------------------------------------------</span></span>
<span id="cb1248-23"><a href="survey-analysis.html#cb1248-23" tabindex="-1"></a>base_survey_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>village_name,      <span class="co"># cluster ids</span></span>
<span id="cb1248-24"><a href="survey-analysis.html#cb1248-24" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>surv_weight_cluster_strata, <span class="co"># weight variable created above</span></span>
<span id="cb1248-25"><a href="survey-analysis.html#cb1248-25" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="sc">~</span>health_district,             <span class="co"># sampling was stratified by district</span></span>
<span id="cb1248-26"><a href="survey-analysis.html#cb1248-26" tabindex="-1"></a>                   <span class="at">data =</span> survey_data                     <span class="co"># have to specify the dataset</span></span>
<span id="cb1248-27"><a href="survey-analysis.html#cb1248-27" tabindex="-1"></a>                  )</span></code></pre></div>
</div>
<div id="package-srvyr" class="section level3" number="26.6.2">
<h3><span class="header-section-number">26.6.2</span> Package <strong>Srvyr</strong></h3>
<p>Với package <strong>srvyr</strong>, chúng ta có thể sử dụng hàm <code>as_survey_design()</code>, nó có tất cả các đối số tương tự như trên nhưng cho phép dùng các pipes (<code>%&gt;%</code>), và vì vậy chúng ta không cần sử dụng dấu ngã (<code>~</code>).</p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1249-1"><a href="survey-analysis.html#cb1249-1" tabindex="-1"></a><span class="do">## simple random ---------------------------------------------------------------</span></span>
<span id="cb1249-2"><a href="survey-analysis.html#cb1249-2" tabindex="-1"></a>survey_design_simple <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1249-3"><a href="survey-analysis.html#cb1249-3" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> <span class="dv">1</span>, <span class="co"># 1 for no cluster ids </span></span>
<span id="cb1249-4"><a href="survey-analysis.html#cb1249-4" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="cn">NULL</span>, <span class="co"># No weight added</span></span>
<span id="cb1249-5"><a href="survey-analysis.html#cb1249-5" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata)</span></span>
<span id="cb1249-6"><a href="survey-analysis.html#cb1249-6" tabindex="-1"></a>                  )</span>
<span id="cb1249-7"><a href="survey-analysis.html#cb1249-7" tabindex="-1"></a><span class="do">## stratified ------------------------------------------------------------------</span></span>
<span id="cb1249-8"><a href="survey-analysis.html#cb1249-8" tabindex="-1"></a>survey_design_strata <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1249-9"><a href="survey-analysis.html#cb1249-9" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> <span class="dv">1</span>, <span class="co"># 1 for no cluster ids</span></span>
<span id="cb1249-10"><a href="survey-analysis.html#cb1249-10" tabindex="-1"></a>                   <span class="at">weights =</span> surv_weight_strata, <span class="co"># weight variable created above</span></span>
<span id="cb1249-11"><a href="survey-analysis.html#cb1249-11" tabindex="-1"></a>                   <span class="at">strata =</span> health_district <span class="co"># sampling was stratified by district</span></span>
<span id="cb1249-12"><a href="survey-analysis.html#cb1249-12" tabindex="-1"></a>                  )</span>
<span id="cb1249-13"><a href="survey-analysis.html#cb1249-13" tabindex="-1"></a><span class="do">## cluster ---------------------------------------------------------------------</span></span>
<span id="cb1249-14"><a href="survey-analysis.html#cb1249-14" tabindex="-1"></a>survey_design_cluster <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1249-15"><a href="survey-analysis.html#cb1249-15" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> village_name, <span class="co"># cluster ids</span></span>
<span id="cb1249-16"><a href="survey-analysis.html#cb1249-16" tabindex="-1"></a>                   <span class="at">weights =</span> surv_weight_cluster, <span class="co"># weight variable created above</span></span>
<span id="cb1249-17"><a href="survey-analysis.html#cb1249-17" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="cn">NULL</span> <span class="co"># sampling was simple (no strata)</span></span>
<span id="cb1249-18"><a href="survey-analysis.html#cb1249-18" tabindex="-1"></a>                  )</span>
<span id="cb1249-19"><a href="survey-analysis.html#cb1249-19" tabindex="-1"></a></span>
<span id="cb1249-20"><a href="survey-analysis.html#cb1249-20" tabindex="-1"></a><span class="do">## stratified cluster ----------------------------------------------------------</span></span>
<span id="cb1249-21"><a href="survey-analysis.html#cb1249-21" tabindex="-1"></a>survey_design <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1249-22"><a href="survey-analysis.html#cb1249-22" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> village_name, <span class="co"># cluster ids</span></span>
<span id="cb1249-23"><a href="survey-analysis.html#cb1249-23" tabindex="-1"></a>                   <span class="at">weights =</span> surv_weight_cluster_strata, <span class="co"># weight variable created above</span></span>
<span id="cb1249-24"><a href="survey-analysis.html#cb1249-24" tabindex="-1"></a>                   <span class="at">strata =</span> health_district <span class="co"># sampling was stratified by district</span></span>
<span id="cb1249-25"><a href="survey-analysis.html#cb1249-25" tabindex="-1"></a>                  )</span></code></pre></div>
<!-- ======================================================= -->
</div>
</div>
<div id="phân-tích-mô-tả-3" class="section level2" number="26.7">
<h2><span class="header-section-number">26.7</span> Phân tích mô tả</h2>
<p>Phân tích mô tả và trực quan hóa cơ bản được đề cập nhiều trong các chương khác của cuốn sổ tay, vì vậy chúng tôi sẽ không đi sâu vào nó ở đây. Để biết chi tiết, hãy xem các chương về <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a>, <a href="stat-tests.html#stat-tests">Các kiểm định thống kê cơ bản</a>, <a href="tables-presentation.html#tables-presentation">Trình bày bảng</a>, <a href="ggplot-basics.html#ggplot-basics">ggplot cơ bản</a> và <a href="rmarkdown.html#rmarkdown">Báo cáo với R Markdown</a>.</p>
<p>Trong phần này, chúng ta sẽ tập trung vào cách điều tra sai số trong mẫu của bạn và trực quan hóa chúng. Chúng ta cũng sẽ xem xét việc trực quan hóa dòng dân cư trong bối cảnh khảo sát bằng cách sử dụng sơ đồ luồng alluvial/sankey.</p>
<p>Nhìn chung, bạn nên xem xét đưa vào các phân tích mô tả sau:</p>
<ul>
<li>Số cụm, hộ gia đình và cá nhân cuối cùng được đưa vào</li>
<li>Số lượng cá nhân bị loại trừ và lý do loại trừ</li>
<li>Trung vị (biên độ) số hộ gia đình trên một cụm và số cá thể trên một hộ gia đình</li>
</ul>
<div id="sai-số-chọn-mẫu" class="section level3" number="26.7.1">
<h3><span class="header-section-number">26.7.1</span> Sai số chọn mẫu</h3>
<p>So sánh tỷ lệ trong từng nhóm tuổi giữa mẫu của bạn và quần thể gốc. Điều này rất quan trọng để có thể làm nổi bật sai số chọn mẫu tiềm ẩn. Tương tự, bạn có thể lặp lại điều này khi xem xét sự phân bố theo giới tính.</p>
<p>Lưu ý rằng các giá trị p từ phép kiểm định hai nhóm chỉ mang tính chất chỉ dẫn và phần thảo luận mang tính mô tả (hoặc trực quan với tháp tuổi bên dưới) về các phân bố trong mẫu nghiên cứu của bạn so với quần thể gốc là quan trọng. Đó là bởi vì việc tăng cỡ mẫu sẽ hay dẫn đến những khác biệt có thể không liên quan sau khi áp dụng trọng số vào dữ liệu của bạn.</p>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="survey-analysis.html#cb1250-1" tabindex="-1"></a><span class="do">## counts and props of the study population</span></span>
<span id="cb1250-2"><a href="survey-analysis.html#cb1250-2" tabindex="-1"></a>ag <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span> </span>
<span id="cb1250-3"><a href="survey-analysis.html#cb1250-3" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-4"><a href="survey-analysis.html#cb1250-4" tabindex="-1"></a>  <span class="fu">drop_na</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-5"><a href="survey-analysis.html#cb1250-5" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1250-6"><a href="survey-analysis.html#cb1250-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n), </span>
<span id="cb1250-7"><a href="survey-analysis.html#cb1250-7" tabindex="-1"></a>         <span class="at">n_total =</span> <span class="fu">sum</span>(n))</span>
<span id="cb1250-8"><a href="survey-analysis.html#cb1250-8" tabindex="-1"></a></span>
<span id="cb1250-9"><a href="survey-analysis.html#cb1250-9" tabindex="-1"></a><span class="do">## counts and props of the source population</span></span>
<span id="cb1250-10"><a href="survey-analysis.html#cb1250-10" tabindex="-1"></a>propcount <span class="ot">&lt;-</span> population <span class="sc">%&gt;%</span> </span>
<span id="cb1250-11"><a href="survey-analysis.html#cb1250-11" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb1250-12"><a href="survey-analysis.html#cb1250-12" tabindex="-1"></a>    <span class="fu">tally</span>(population) <span class="sc">%&gt;%</span></span>
<span id="cb1250-13"><a href="survey-analysis.html#cb1250-13" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span>
<span id="cb1250-14"><a href="survey-analysis.html#cb1250-14" tabindex="-1"></a></span>
<span id="cb1250-15"><a href="survey-analysis.html#cb1250-15" tabindex="-1"></a><span class="do">## bind together the columns of two tables, group by age, and perform a </span></span>
<span id="cb1250-16"><a href="survey-analysis.html#cb1250-16" tabindex="-1"></a><span class="do">## binomial test to see if n/total is significantly different from population</span></span>
<span id="cb1250-17"><a href="survey-analysis.html#cb1250-17" tabindex="-1"></a><span class="do">## proportion.</span></span>
<span id="cb1250-18"><a href="survey-analysis.html#cb1250-18" tabindex="-1"></a>  <span class="do">## suffix here adds to text to the end of columns in each of the two datasets</span></span>
<span id="cb1250-19"><a href="survey-analysis.html#cb1250-19" tabindex="-1"></a><span class="fu">left_join</span>(ag, propcount, <span class="at">by =</span> <span class="st">&quot;age_group&quot;</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_pop&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1250-20"><a href="survey-analysis.html#cb1250-20" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span></span>
<span id="cb1250-21"><a href="survey-analysis.html#cb1250-21" tabindex="-1"></a>  <span class="do">## broom::tidy(binom.test()) makes a data frame out of the binomial test and</span></span>
<span id="cb1250-22"><a href="survey-analysis.html#cb1250-22" tabindex="-1"></a>  <span class="do">## will add the variables p.value, parameter, conf.low, conf.high, method, and</span></span>
<span id="cb1250-23"><a href="survey-analysis.html#cb1250-23" tabindex="-1"></a>  <span class="do">## alternative. We will only use p.value here. You can include other</span></span>
<span id="cb1250-24"><a href="survey-analysis.html#cb1250-24" tabindex="-1"></a>  <span class="do">## columns if you want to report confidence intervals</span></span>
<span id="cb1250-25"><a href="survey-analysis.html#cb1250-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">binom =</span> <span class="fu">list</span>(broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="fu">binom.test</span>(n, n_total, proportion_pop)))) <span class="sc">%&gt;%</span></span>
<span id="cb1250-26"><a href="survey-analysis.html#cb1250-26" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(binom)) <span class="sc">%&gt;%</span> <span class="co"># important for expanding the binom.test data frame</span></span>
<span id="cb1250-27"><a href="survey-analysis.html#cb1250-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion_pop =</span> proportion_pop <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1250-28"><a href="survey-analysis.html#cb1250-28" tabindex="-1"></a>  <span class="do">## Adjusting the p-values to correct for false positives </span></span>
<span id="cb1250-29"><a href="survey-analysis.html#cb1250-29" tabindex="-1"></a>  <span class="do">## (because testing multiple age groups). This will only make </span></span>
<span id="cb1250-30"><a href="survey-analysis.html#cb1250-30" tabindex="-1"></a>  <span class="do">## a difference if you have many age categories</span></span>
<span id="cb1250-31"><a href="survey-analysis.html#cb1250-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> <span class="fu">p.adjust</span>(p.value, <span class="at">method =</span> <span class="st">&quot;holm&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1250-32"><a href="survey-analysis.html#cb1250-32" tabindex="-1"></a>                      </span>
<span id="cb1250-33"><a href="survey-analysis.html#cb1250-33" tabindex="-1"></a>  <span class="do">## Only show p-values over 0.001 (those under report as &lt;0.001)</span></span>
<span id="cb1250-34"><a href="survey-analysis.html#cb1250-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p.value =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, </span>
<span id="cb1250-35"><a href="survey-analysis.html#cb1250-35" tabindex="-1"></a>                          <span class="st">&quot;&lt;0.001&quot;</span>, </span>
<span id="cb1250-36"><a href="survey-analysis.html#cb1250-36" tabindex="-1"></a>                          <span class="fu">as.character</span>(<span class="fu">round</span>(p.value, <span class="dv">3</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-37"><a href="survey-analysis.html#cb1250-37" tabindex="-1"></a>  </span>
<span id="cb1250-38"><a href="survey-analysis.html#cb1250-38" tabindex="-1"></a>  <span class="do">## rename the columns appropriately</span></span>
<span id="cb1250-39"><a href="survey-analysis.html#cb1250-39" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb1250-40"><a href="survey-analysis.html#cb1250-40" tabindex="-1"></a>    <span class="st">&quot;Age group&quot;</span> <span class="ot">=</span> age_group,</span>
<span id="cb1250-41"><a href="survey-analysis.html#cb1250-41" tabindex="-1"></a>    <span class="st">&quot;Study population (n)&quot;</span> <span class="ot">=</span> n,</span>
<span id="cb1250-42"><a href="survey-analysis.html#cb1250-42" tabindex="-1"></a>    <span class="st">&quot;Study population (%)&quot;</span> <span class="ot">=</span> proportion,</span>
<span id="cb1250-43"><a href="survey-analysis.html#cb1250-43" tabindex="-1"></a>    <span class="st">&quot;Source population (n)&quot;</span> <span class="ot">=</span> n_pop,</span>
<span id="cb1250-44"><a href="survey-analysis.html#cb1250-44" tabindex="-1"></a>    <span class="st">&quot;Source population (%)&quot;</span> <span class="ot">=</span> proportion_pop,</span>
<span id="cb1250-45"><a href="survey-analysis.html#cb1250-45" tabindex="-1"></a>    <span class="st">&quot;P-value&quot;</span> <span class="ot">=</span> p.value</span>
<span id="cb1250-46"><a href="survey-analysis.html#cb1250-46" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Groups:   Age group [5]
##   `Age group` `Study population (n)` `Study population (%)` `Source population (n)`
##   &lt;chr&gt;                        &lt;int&gt;                  &lt;dbl&gt;                   &lt;dbl&gt;
## 1 0-2                             12                 0.0256                    1360
## 2 3-14                            42                 0.0896                    7244
## 3 15-29                           64                 0.136                     5520
## 4 30-44                           52                 0.111                     3232
## 5 45+                            299                 0.638                     2644
## # ℹ 2 more variables: `Source population (%)` &lt;dbl&gt;, `P-value` &lt;chr&gt;</code></pre>
</div>
<div id="tháp-dân-số" class="section level3" number="26.7.2">
<h3><span class="header-section-number">26.7.2</span> Tháp dân số</h3>
<p>Tháp dân số (hoặc tháp tuổi-giới) là một cách dễ dàng để trực quan hóa sự phân bố trong quần thể khảo sát của bạn. Cũng nên xem xét việc tạo <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a> về độ tuổi và giới tính theo tầng khảo sát. Chúng ta sẽ minh họa bằng package <strong>apyramid</strong> vì nó cho phép các tỷ lệ được áp dụng trọng số sử dụng đối tượng theo thiết kế nghiên cứu mà chúng ta đã tạo ở trên. Các tùy chọn khác để tạo <a href="age-pyramid.html#age-pyramid">Tháp dân số</a> được đề cập nhiều hơn trong chương đó của sổ tay. Chúng ta cũng sẽ sử dụng một hàm trong package <strong>apyramid</strong> là <code>age_pyramid()</code> để code ngắn gọn hơn một biểu đồ theo tỷ lệ.</p>
<p>Giống như với phép kiểm định sự khác biệt giữa hai nhóm chuẩn được thảo luận ở trên trong phần sai số chọn mẫu, ở đây chúng ta quan tâm đến việc trực quan hóa liệu quần thể mẫu của chúng ta có khác biệt đáng kể so với quần thể gốc hay không, và liệu trọng số có sửa chữa được sự khác biệt này hay không. Để làm điều này, chúng ta sẽ sử dụng package <strong>patchwork</strong> để hiển thị các biểu đồ tạo bởi <strong>ggplot</strong> song song với nhau; chi tiết xem phần kết hợp các đồ thị trong chương <a href="ggplot-tips.html#ggplot-tips">Các tips với ggplot</a> của sổ tay này. Chúng ta sẽ trực quan hóa quần thể gốc, quần thể khảo sát không trọng số và quần thể khảo sát có trọng số. Bạn cũng có thể xem xét trực quan theo từng tầng của khảo sát - bằng cách sử dụng đối số <code>stack_by  = "health_district"</code> trong ví dụ của chúng tôi ở đây (xem <code>?plot_age_pyramid</code> để biết chi tiết).</p>
<p><span style="color: black;"><strong><em>Lưu ý:</em></strong> Trục x và y được lật ngược trong tháp</span></p>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1252-1"><a href="survey-analysis.html#cb1252-1" tabindex="-1"></a><span class="do">## define x-axis limits and labels ---------------------------------------------</span></span>
<span id="cb1252-2"><a href="survey-analysis.html#cb1252-2" tabindex="-1"></a><span class="do">## (update these numbers to be the values for your graph)</span></span>
<span id="cb1252-3"><a href="survey-analysis.html#cb1252-3" tabindex="-1"></a>max_prop <span class="ot">&lt;-</span> <span class="dv">35</span>      <span class="co"># choose the highest proportion you want to show </span></span>
<span id="cb1252-4"><a href="survey-analysis.html#cb1252-4" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="dv">5</span>           <span class="co"># choose the space you want beween labels </span></span>
<span id="cb1252-5"><a href="survey-analysis.html#cb1252-5" tabindex="-1"></a></span>
<span id="cb1252-6"><a href="survey-analysis.html#cb1252-6" tabindex="-1"></a><span class="do">## this part defines vector using the above numbers with axis breaks</span></span>
<span id="cb1252-7"><a href="survey-analysis.html#cb1252-7" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1252-8"><a href="survey-analysis.html#cb1252-8" tabindex="-1"></a>    <span class="fu">seq</span>(max_prop<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span> <span class="sc">-</span> step<span class="sc">/</span><span class="dv">100</span>, step<span class="sc">/</span><span class="dv">100</span>), </span>
<span id="cb1252-9"><a href="survey-analysis.html#cb1252-9" tabindex="-1"></a>    <span class="dv">0</span>, </span>
<span id="cb1252-10"><a href="survey-analysis.html#cb1252-10" tabindex="-1"></a>    <span class="fu">seq</span>(<span class="dv">0</span> <span class="sc">+</span> step <span class="sc">/</span> <span class="dv">100</span>, max_prop<span class="sc">/</span><span class="dv">100</span>, step<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb1252-11"><a href="survey-analysis.html#cb1252-11" tabindex="-1"></a>    )</span>
<span id="cb1252-12"><a href="survey-analysis.html#cb1252-12" tabindex="-1"></a></span>
<span id="cb1252-13"><a href="survey-analysis.html#cb1252-13" tabindex="-1"></a><span class="do">## this part defines vector using the above numbers with axis limits</span></span>
<span id="cb1252-14"><a href="survey-analysis.html#cb1252-14" tabindex="-1"></a>limits <span class="ot">&lt;-</span> <span class="fu">c</span>(max_prop<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>, max_prop<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb1252-15"><a href="survey-analysis.html#cb1252-15" tabindex="-1"></a></span>
<span id="cb1252-16"><a href="survey-analysis.html#cb1252-16" tabindex="-1"></a><span class="do">## this part defines vector using the above numbers with axis labels</span></span>
<span id="cb1252-17"><a href="survey-analysis.html#cb1252-17" tabindex="-1"></a>labels <span class="ot">&lt;-</span>  <span class="fu">c</span>(</span>
<span id="cb1252-18"><a href="survey-analysis.html#cb1252-18" tabindex="-1"></a>      <span class="fu">seq</span>(max_prop, step, <span class="sc">-</span>step), </span>
<span id="cb1252-19"><a href="survey-analysis.html#cb1252-19" tabindex="-1"></a>      <span class="dv">0</span>, </span>
<span id="cb1252-20"><a href="survey-analysis.html#cb1252-20" tabindex="-1"></a>      <span class="fu">seq</span>(step, max_prop, step)</span>
<span id="cb1252-21"><a href="survey-analysis.html#cb1252-21" tabindex="-1"></a>    )</span>
<span id="cb1252-22"><a href="survey-analysis.html#cb1252-22" tabindex="-1"></a></span>
<span id="cb1252-23"><a href="survey-analysis.html#cb1252-23" tabindex="-1"></a></span>
<span id="cb1252-24"><a href="survey-analysis.html#cb1252-24" tabindex="-1"></a><span class="do">## create plots individually  --------------------------------------------------</span></span>
<span id="cb1252-25"><a href="survey-analysis.html#cb1252-25" tabindex="-1"></a></span>
<span id="cb1252-26"><a href="survey-analysis.html#cb1252-26" tabindex="-1"></a><span class="do">## plot the source population </span></span>
<span id="cb1252-27"><a href="survey-analysis.html#cb1252-27" tabindex="-1"></a><span class="do">## nb: this needs to be collapsed for the overall population (i.e. removing health districts)</span></span>
<span id="cb1252-28"><a href="survey-analysis.html#cb1252-28" tabindex="-1"></a>source_population <span class="ot">&lt;-</span> population <span class="sc">%&gt;%</span></span>
<span id="cb1252-29"><a href="survey-analysis.html#cb1252-29" tabindex="-1"></a>  <span class="do">## ensure that age and sex are factors</span></span>
<span id="cb1252-30"><a href="survey-analysis.html#cb1252-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">factor</span>(age_group, </span>
<span id="cb1252-31"><a href="survey-analysis.html#cb1252-31" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;0-2&quot;</span>, </span>
<span id="cb1252-32"><a href="survey-analysis.html#cb1252-32" tabindex="-1"></a>                                       <span class="st">&quot;3-14&quot;</span>, </span>
<span id="cb1252-33"><a href="survey-analysis.html#cb1252-33" tabindex="-1"></a>                                       <span class="st">&quot;15-29&quot;</span>,</span>
<span id="cb1252-34"><a href="survey-analysis.html#cb1252-34" tabindex="-1"></a>                                       <span class="st">&quot;30-44&quot;</span>, </span>
<span id="cb1252-35"><a href="survey-analysis.html#cb1252-35" tabindex="-1"></a>                                       <span class="st">&quot;45+&quot;</span>)), </span>
<span id="cb1252-36"><a href="survey-analysis.html#cb1252-36" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span> </span>
<span id="cb1252-37"><a href="survey-analysis.html#cb1252-37" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb1252-38"><a href="survey-analysis.html#cb1252-38" tabindex="-1"></a>  <span class="do">## add the counts for each health district together </span></span>
<span id="cb1252-39"><a href="survey-analysis.html#cb1252-39" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">population =</span> <span class="fu">sum</span>(population)) <span class="sc">%&gt;%</span> </span>
<span id="cb1252-40"><a href="survey-analysis.html#cb1252-40" tabindex="-1"></a>  <span class="do">## remove the grouping so can calculate overall proportion</span></span>
<span id="cb1252-41"><a href="survey-analysis.html#cb1252-41" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1252-42"><a href="survey-analysis.html#cb1252-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> population <span class="sc">/</span> <span class="fu">sum</span>(population)) <span class="sc">%&gt;%</span> </span>
<span id="cb1252-43"><a href="survey-analysis.html#cb1252-43" tabindex="-1"></a>  <span class="do">## plot pyramid </span></span>
<span id="cb1252-44"><a href="survey-analysis.html#cb1252-44" tabindex="-1"></a>  <span class="fu">age_pyramid</span>(</span>
<span id="cb1252-45"><a href="survey-analysis.html#cb1252-45" tabindex="-1"></a>            <span class="at">age_group =</span> age_group, </span>
<span id="cb1252-46"><a href="survey-analysis.html#cb1252-46" tabindex="-1"></a>            <span class="at">split_by =</span> sex, </span>
<span id="cb1252-47"><a href="survey-analysis.html#cb1252-47" tabindex="-1"></a>            <span class="at">count =</span> proportion, </span>
<span id="cb1252-48"><a href="survey-analysis.html#cb1252-48" tabindex="-1"></a>            <span class="at">proportional =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1252-49"><a href="survey-analysis.html#cb1252-49" tabindex="-1"></a>  <span class="do">## only show the y axis label (otherwise repeated in all three plots)</span></span>
<span id="cb1252-50"><a href="survey-analysis.html#cb1252-50" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Source population&quot;</span>, </span>
<span id="cb1252-51"><a href="survey-analysis.html#cb1252-51" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1252-52"><a href="survey-analysis.html#cb1252-52" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Age group (years)&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1252-53"><a href="survey-analysis.html#cb1252-53" tabindex="-1"></a>  <span class="do">## make the x axis the same for all plots </span></span>
<span id="cb1252-54"><a href="survey-analysis.html#cb1252-54" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> breaks, </span>
<span id="cb1252-55"><a href="survey-analysis.html#cb1252-55" tabindex="-1"></a>    <span class="at">limits =</span> limits, </span>
<span id="cb1252-56"><a href="survey-analysis.html#cb1252-56" tabindex="-1"></a>    <span class="at">labels =</span> labels)</span>
<span id="cb1252-57"><a href="survey-analysis.html#cb1252-57" tabindex="-1"></a>  </span>
<span id="cb1252-58"><a href="survey-analysis.html#cb1252-58" tabindex="-1"></a>  </span>
<span id="cb1252-59"><a href="survey-analysis.html#cb1252-59" tabindex="-1"></a><span class="do">## plot the unweighted sample population </span></span>
<span id="cb1252-60"><a href="survey-analysis.html#cb1252-60" tabindex="-1"></a>sample_population <span class="ot">&lt;-</span> <span class="fu">age_pyramid</span>(survey_data, </span>
<span id="cb1252-61"><a href="survey-analysis.html#cb1252-61" tabindex="-1"></a>                 <span class="at">age_group =</span> <span class="st">&quot;age_group&quot;</span>, </span>
<span id="cb1252-62"><a href="survey-analysis.html#cb1252-62" tabindex="-1"></a>                 <span class="at">split_by =</span> <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb1252-63"><a href="survey-analysis.html#cb1252-63" tabindex="-1"></a>                 <span class="at">proportion =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb1252-64"><a href="survey-analysis.html#cb1252-64" tabindex="-1"></a>  <span class="do">## only show the x axis label (otherwise repeated in all three plots)</span></span>
<span id="cb1252-65"><a href="survey-analysis.html#cb1252-65" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Unweighted sample population&quot;</span>, </span>
<span id="cb1252-66"><a href="survey-analysis.html#cb1252-66" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Proportion (%)&quot;</span>, </span>
<span id="cb1252-67"><a href="survey-analysis.html#cb1252-67" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1252-68"><a href="survey-analysis.html#cb1252-68" tabindex="-1"></a>  <span class="do">## make the x axis the same for all plots </span></span>
<span id="cb1252-69"><a href="survey-analysis.html#cb1252-69" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> breaks, </span>
<span id="cb1252-70"><a href="survey-analysis.html#cb1252-70" tabindex="-1"></a>    <span class="at">limits =</span> limits, </span>
<span id="cb1252-71"><a href="survey-analysis.html#cb1252-71" tabindex="-1"></a>    <span class="at">labels =</span> labels)</span>
<span id="cb1252-72"><a href="survey-analysis.html#cb1252-72" tabindex="-1"></a></span>
<span id="cb1252-73"><a href="survey-analysis.html#cb1252-73" tabindex="-1"></a></span>
<span id="cb1252-74"><a href="survey-analysis.html#cb1252-74" tabindex="-1"></a><span class="do">## plot the weighted sample population </span></span>
<span id="cb1252-75"><a href="survey-analysis.html#cb1252-75" tabindex="-1"></a>weighted_population <span class="ot">&lt;-</span> survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1252-76"><a href="survey-analysis.html#cb1252-76" tabindex="-1"></a>  <span class="do">## make sure the variables are factors</span></span>
<span id="cb1252-77"><a href="survey-analysis.html#cb1252-77" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_group =</span> <span class="fu">factor</span>(age_group), </span>
<span id="cb1252-78"><a href="survey-analysis.html#cb1252-78" tabindex="-1"></a>         <span class="at">sex =</span> <span class="fu">factor</span>(sex)) <span class="sc">%&gt;%</span></span>
<span id="cb1252-79"><a href="survey-analysis.html#cb1252-79" tabindex="-1"></a>  <span class="fu">age_pyramid</span>(</span>
<span id="cb1252-80"><a href="survey-analysis.html#cb1252-80" tabindex="-1"></a>    <span class="at">age_group =</span> <span class="st">&quot;age_group&quot;</span>,</span>
<span id="cb1252-81"><a href="survey-analysis.html#cb1252-81" tabindex="-1"></a>    <span class="at">split_by =</span> <span class="st">&quot;sex&quot;</span>, </span>
<span id="cb1252-82"><a href="survey-analysis.html#cb1252-82" tabindex="-1"></a>    <span class="at">proportion =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1252-83"><a href="survey-analysis.html#cb1252-83" tabindex="-1"></a>  <span class="do">## only show the x axis label (otherwise repeated in all three plots)</span></span>
<span id="cb1252-84"><a href="survey-analysis.html#cb1252-84" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Weighted sample population&quot;</span>, </span>
<span id="cb1252-85"><a href="survey-analysis.html#cb1252-85" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1252-86"><a href="survey-analysis.html#cb1252-86" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>)  <span class="sc">+</span> </span>
<span id="cb1252-87"><a href="survey-analysis.html#cb1252-87" tabindex="-1"></a>  <span class="do">## make the x axis the same for all plots </span></span>
<span id="cb1252-88"><a href="survey-analysis.html#cb1252-88" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> breaks, </span>
<span id="cb1252-89"><a href="survey-analysis.html#cb1252-89" tabindex="-1"></a>    <span class="at">limits =</span> limits, </span>
<span id="cb1252-90"><a href="survey-analysis.html#cb1252-90" tabindex="-1"></a>    <span class="at">labels =</span> labels)</span>
<span id="cb1252-91"><a href="survey-analysis.html#cb1252-91" tabindex="-1"></a></span>
<span id="cb1252-92"><a href="survey-analysis.html#cb1252-92" tabindex="-1"></a><span class="do">## combine all three plots  ----------------------------------------------------</span></span>
<span id="cb1252-93"><a href="survey-analysis.html#cb1252-93" tabindex="-1"></a><span class="do">## combine three plots next to eachother using + </span></span>
<span id="cb1252-94"><a href="survey-analysis.html#cb1252-94" tabindex="-1"></a>source_population <span class="sc">+</span> sample_population <span class="sc">+</span> weighted_population <span class="sc">+</span> </span>
<span id="cb1252-95"><a href="survey-analysis.html#cb1252-95" tabindex="-1"></a>  <span class="do">## only show one legend and define theme </span></span>
<span id="cb1252-96"><a href="survey-analysis.html#cb1252-96" tabindex="-1"></a>  <span class="do">## note the use of &amp; for combining theme with plot_layout()</span></span>
<span id="cb1252-97"><a href="survey-analysis.html#cb1252-97" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb1252-98"><a href="survey-analysis.html#cb1252-98" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,                    <span class="co"># move legend to bottom</span></span>
<span id="cb1252-99"><a href="survey-analysis.html#cb1252-99" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),                <span class="co"># remove title</span></span>
<span id="cb1252-100"><a href="survey-analysis.html#cb1252-100" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),                <span class="co"># change text size</span></span>
<span id="cb1252-101"><a href="survey-analysis.html#cb1252-101" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>) <span class="co"># turn x-axis text</span></span>
<span id="cb1252-102"><a href="survey-analysis.html#cb1252-102" tabindex="-1"></a>       )</span></code></pre></div>
<p><img src="_main_files/figure-html/weighted_age_pyramid-1.png" width="1440" /></p>
</div>
<div id="sơ-đồ-alluvialsankey" class="section level3" number="26.7.3">
<h3><span class="header-section-number">26.7.3</span> Sơ đồ alluvial/sankey</h3>
<p>Trực quan điểm bắt đầu và kết quả của từng cá nhân có thể rất hữu ích để có được cái nhìn tổng quan. Có một ứng dụng khá rõ ràng cho quần thể di động, tuy nhiên có rất nhiều ứng dụng khác như nhóm thuần tập hoặc bất kỳ tình huống nào khác trong đó có sự chuyển đổi ở các trạng thái của các cá nhân. Các sơ đồ này có một số tên khác nhau bao gồm các tập hợp alluvial, sankey và parallel - chi tiết có trong chương sổ tay về <a href="diagrams.html#diagrams">Sơ đồ và biểu đồ</a>.</p>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="survey-analysis.html#cb1253-1" tabindex="-1"></a><span class="do">## summarize data</span></span>
<span id="cb1253-2"><a href="survey-analysis.html#cb1253-2" tabindex="-1"></a>flow_table <span class="ot">&lt;-</span> survey_data <span class="sc">%&gt;%</span></span>
<span id="cb1253-3"><a href="survey-analysis.html#cb1253-3" tabindex="-1"></a>  <span class="fu">count</span>(startcause, endcause, sex) <span class="sc">%&gt;%</span>  <span class="co"># get counts </span></span>
<span id="cb1253-4"><a href="survey-analysis.html#cb1253-4" tabindex="-1"></a>  <span class="fu">gather_set_data</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="st">&quot;startcause&quot;</span>, <span class="st">&quot;endcause&quot;</span>))     <span class="co"># change format for plotting</span></span>
<span id="cb1253-5"><a href="survey-analysis.html#cb1253-5" tabindex="-1"></a></span>
<span id="cb1253-6"><a href="survey-analysis.html#cb1253-6" tabindex="-1"></a></span>
<span id="cb1253-7"><a href="survey-analysis.html#cb1253-7" tabindex="-1"></a><span class="do">## plot your dataset </span></span>
<span id="cb1253-8"><a href="survey-analysis.html#cb1253-8" tabindex="-1"></a>  <span class="do">## on the x axis is the start and end causes</span></span>
<span id="cb1253-9"><a href="survey-analysis.html#cb1253-9" tabindex="-1"></a>  <span class="do">## gather_set_data generates an ID for each possible combination</span></span>
<span id="cb1253-10"><a href="survey-analysis.html#cb1253-10" tabindex="-1"></a>  <span class="do">## splitting by y gives the possible start/end combos</span></span>
<span id="cb1253-11"><a href="survey-analysis.html#cb1253-11" tabindex="-1"></a>  <span class="do">## value as n gives it as counts (could also be changed to proportion)</span></span>
<span id="cb1253-12"><a href="survey-analysis.html#cb1253-12" tabindex="-1"></a><span class="fu">ggplot</span>(flow_table, <span class="fu">aes</span>(x, <span class="at">id =</span> id, <span class="at">split =</span> y, <span class="at">value =</span> n)) <span class="sc">+</span></span>
<span id="cb1253-13"><a href="survey-analysis.html#cb1253-13" tabindex="-1"></a>  <span class="do">## colour lines by sex </span></span>
<span id="cb1253-14"><a href="survey-analysis.html#cb1253-14" tabindex="-1"></a>  <span class="fu">geom_parallel_sets</span>(<span class="fu">aes</span>(<span class="at">fill =</span> sex), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">axis.width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb1253-15"><a href="survey-analysis.html#cb1253-15" tabindex="-1"></a>  <span class="do">## fill in the label boxes grey</span></span>
<span id="cb1253-16"><a href="survey-analysis.html#cb1253-16" tabindex="-1"></a>  <span class="fu">geom_parallel_sets_axes</span>(<span class="at">axis.width =</span> <span class="fl">0.15</span>, <span class="at">fill =</span> <span class="st">&quot;grey80&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span></span>
<span id="cb1253-17"><a href="survey-analysis.html#cb1253-17" tabindex="-1"></a>  <span class="do">## change text colour and angle (needs to be adjusted)</span></span>
<span id="cb1253-18"><a href="survey-analysis.html#cb1253-18" tabindex="-1"></a>  <span class="fu">geom_parallel_sets_labels</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">angle =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1253-19"><a href="survey-analysis.html#cb1253-19" tabindex="-1"></a>  <span class="do">## remove axis labels</span></span>
<span id="cb1253-20"><a href="survey-analysis.html#cb1253-20" tabindex="-1"></a>  <span class="fu">theme_void</span>()<span class="sc">+</span></span>
<span id="cb1253-21"><a href="survey-analysis.html#cb1253-21" tabindex="-1"></a>  <span class="do">## move legend to bottom</span></span>
<span id="cb1253-22"><a href="survey-analysis.html#cb1253-22" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/visualise_population_flow-1.png" width="672" /></p>
<!-- ======================================================= -->
</div>
</div>
<div id="tỷ-lệ-được-áp-dụng-trọng-số" class="section level2" number="26.8">
<h2><span class="header-section-number">26.8</span> Tỷ lệ được áp dụng trọng số</h2>
<p>Phần này sẽ trình bày chi tiết cách tạo bảng cho số lượng và tỷ lệ được áp dụng trọng số, với khoảng tin cậy và hệ số thiết kế liên quan. Có bốn tùy chọn khác nhau sử dụng các hàm từ các packages sau: <strong>survey</strong>, <strong>srvyr</strong>, <strong>sitrep</strong> và <strong>gtsummary</strong>. Để tạo ra một bảng dịch tễ học tiêu chuẩn với code tối giản, chúng tôi khuyên bạn nên dùng hàm <strong>sitrep</strong> - là một hàm có code gọn hơn của <strong>srvyr</strong>; Tuy nhiên, lưu ý rằng hàm này chưa có trên CRAN và có thể thay đổi trong tương lai. Mặt khác, code của <strong>survey</strong> có thể là code ổn định nhất trong thời gian dài, trong khi <strong>srvyr</strong> sẽ phù hợp nhất đối với các luồng công việc sử dụng tidyverse. Mặc dù các hàm <strong>gtsummary</strong> có rất nhiều tiềm năng, nhưng chúng vẫn đang được thử nghiệm và chưa hoàn thiện tại thời điểm viết chương này.</p>
<div id="package-survey-1" class="section level3" number="26.8.1">
<h3><span class="header-section-number">26.8.1</span> Package <strong>survey</strong></h3>
<p>Chúng ta có thể sử dụng hàm <code>svyciprop()</code> từ <strong>survey</strong> để lấy tỷ lệ có trọng số và khoảng tin cậy 95% đi kèm. Một hệ số thiết kế thích hợp có thể được trích xuất bằng cách sử dụng hàm <code>svymean()</code> chứ không phải hàm <code>svyprop()</code>. Cần lưu ý rằng <code>svyprop()</code> dường như chỉ chấp nhận các biến có giá trị từ 0 đến 1 (hoặc TRUE/FALSE), vì vậy các biến phân loại sẽ không hoạt động.</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> Các hàm từ <strong>survey</strong> cũng chấp nhận các đối tượng thiết kế từ <strong>srvyr</strong>, nhưng ở đây chúng tôi đã sử dụng đối tượng thiết kế từ package <strong>survey</strong> với mục đích tạo sự nhất quán</span></p>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1254-1"><a href="survey-analysis.html#cb1254-1" tabindex="-1"></a><span class="do">## produce weighted counts </span></span>
<span id="cb1254-2"><a href="survey-analysis.html#cb1254-2" tabindex="-1"></a><span class="fu">svytable</span>(<span class="sc">~</span>died, base_survey_design)</span></code></pre></div>
<pre><code>## died
##      FALSE       TRUE 
## 1406244.43   76213.01</code></pre>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1256-1"><a href="survey-analysis.html#cb1256-1" tabindex="-1"></a><span class="do">## produce weighted proportions</span></span>
<span id="cb1256-2"><a href="survey-analysis.html#cb1256-2" tabindex="-1"></a><span class="fu">svyciprop</span>(<span class="sc">~</span>died, base_survey_design, <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>##               2.5% 97.5%
## died 0.0514 0.0208  0.12</code></pre>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1258-1"><a href="survey-analysis.html#cb1258-1" tabindex="-1"></a><span class="do">## get the design effect </span></span>
<span id="cb1258-2"><a href="survey-analysis.html#cb1258-2" tabindex="-1"></a><span class="fu">svymean</span>(<span class="sc">~</span>died, base_survey_design, <span class="at">na.rm =</span> T, <span class="at">deff =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb1258-3"><a href="survey-analysis.html#cb1258-3" tabindex="-1"></a>  <span class="fu">deff</span>()</span></code></pre></div>
<pre><code>## diedFALSE  diedTRUE 
##  3.755508  3.755508</code></pre>
<p>Chúng ta có thể kết hợp các hàm từ <strong>survey</strong> được hiển thị ở trên với một hàm mà chúng ta tự định nghĩa như bên dưới, được gọi là <code>svy_prop</code>; và sau đó chúng ta có thể sử dụng hàm đó cùng với hàm <code>map()</code> từ package <strong>purrr</strong> để lặp qua một số biến và tạo một bảng. Xem chương <a href="iteration.html#iteration">Lặp, vòng lặp, và danh sách</a> để biết chi tiết về <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="survey-analysis.html#cb1260-1" tabindex="-1"></a><span class="co"># Define function to calculate weighted counts, proportions, CI and design effect</span></span>
<span id="cb1260-2"><a href="survey-analysis.html#cb1260-2" tabindex="-1"></a><span class="co"># x is the variable in quotation marks </span></span>
<span id="cb1260-3"><a href="survey-analysis.html#cb1260-3" tabindex="-1"></a><span class="co"># design is your survey design object</span></span>
<span id="cb1260-4"><a href="survey-analysis.html#cb1260-4" tabindex="-1"></a></span>
<span id="cb1260-5"><a href="survey-analysis.html#cb1260-5" tabindex="-1"></a>svy_prop <span class="ot">&lt;-</span> <span class="cf">function</span>(design, x) {</span>
<span id="cb1260-6"><a href="survey-analysis.html#cb1260-6" tabindex="-1"></a>  </span>
<span id="cb1260-7"><a href="survey-analysis.html#cb1260-7" tabindex="-1"></a>  <span class="do">## put the variable of interest in a formula </span></span>
<span id="cb1260-8"><a href="survey-analysis.html#cb1260-8" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste0</span>( <span class="st">&quot;~&quot;</span> , x))</span>
<span id="cb1260-9"><a href="survey-analysis.html#cb1260-9" tabindex="-1"></a>  <span class="do">## only keep the TRUE column of counts from svytable</span></span>
<span id="cb1260-10"><a href="survey-analysis.html#cb1260-10" tabindex="-1"></a>  weighted_counts <span class="ot">&lt;-</span> <span class="fu">svytable</span>(form, design)[[<span class="dv">2</span>]]</span>
<span id="cb1260-11"><a href="survey-analysis.html#cb1260-11" tabindex="-1"></a>  <span class="do">## calculate proportions (multiply by 100 to get percentages)</span></span>
<span id="cb1260-12"><a href="survey-analysis.html#cb1260-12" tabindex="-1"></a>  weighted_props <span class="ot">&lt;-</span> <span class="fu">svyciprop</span>(form, design, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb1260-13"><a href="survey-analysis.html#cb1260-13" tabindex="-1"></a>  <span class="do">## extract the confidence intervals and multiply to get percentages</span></span>
<span id="cb1260-14"><a href="survey-analysis.html#cb1260-14" tabindex="-1"></a>  weighted_confint <span class="ot">&lt;-</span> <span class="fu">confint</span>(weighted_props) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb1260-15"><a href="survey-analysis.html#cb1260-15" tabindex="-1"></a>  <span class="do">## use svymean to calculate design effect and only keep the TRUE column</span></span>
<span id="cb1260-16"><a href="survey-analysis.html#cb1260-16" tabindex="-1"></a>  design_eff <span class="ot">&lt;-</span> <span class="fu">deff</span>(<span class="fu">svymean</span>(form, design, <span class="at">na.rm =</span> <span class="cn">TRUE</span>, <span class="at">deff =</span> <span class="cn">TRUE</span>))[[<span class="cn">TRUE</span>]]</span>
<span id="cb1260-17"><a href="survey-analysis.html#cb1260-17" tabindex="-1"></a>  </span>
<span id="cb1260-18"><a href="survey-analysis.html#cb1260-18" tabindex="-1"></a>  <span class="do">## combine in to one data frame</span></span>
<span id="cb1260-19"><a href="survey-analysis.html#cb1260-19" tabindex="-1"></a>  full_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb1260-20"><a href="survey-analysis.html#cb1260-20" tabindex="-1"></a>    <span class="st">&quot;Variable&quot;</span>        <span class="ot">=</span> x,</span>
<span id="cb1260-21"><a href="survey-analysis.html#cb1260-21" tabindex="-1"></a>    <span class="st">&quot;Count&quot;</span>           <span class="ot">=</span> weighted_counts,</span>
<span id="cb1260-22"><a href="survey-analysis.html#cb1260-22" tabindex="-1"></a>    <span class="st">&quot;Proportion&quot;</span>      <span class="ot">=</span> weighted_props,</span>
<span id="cb1260-23"><a href="survey-analysis.html#cb1260-23" tabindex="-1"></a>    weighted_confint, </span>
<span id="cb1260-24"><a href="survey-analysis.html#cb1260-24" tabindex="-1"></a>    <span class="st">&quot;Design effect&quot;</span>   <span class="ot">=</span> design_eff</span>
<span id="cb1260-25"><a href="survey-analysis.html#cb1260-25" tabindex="-1"></a>    )</span>
<span id="cb1260-26"><a href="survey-analysis.html#cb1260-26" tabindex="-1"></a>  </span>
<span id="cb1260-27"><a href="survey-analysis.html#cb1260-27" tabindex="-1"></a>  <span class="do">## return table as a dataframe</span></span>
<span id="cb1260-28"><a href="survey-analysis.html#cb1260-28" tabindex="-1"></a>  full_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(full_table, </span>
<span id="cb1260-29"><a href="survey-analysis.html#cb1260-29" tabindex="-1"></a>             <span class="do">## remove the variable names from rows (is a separate column now)</span></span>
<span id="cb1260-30"><a href="survey-analysis.html#cb1260-30" tabindex="-1"></a>             <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb1260-31"><a href="survey-analysis.html#cb1260-31" tabindex="-1"></a>  </span>
<span id="cb1260-32"><a href="survey-analysis.html#cb1260-32" tabindex="-1"></a>  <span class="do">## change numerics back to numeric</span></span>
<span id="cb1260-33"><a href="survey-analysis.html#cb1260-33" tabindex="-1"></a>  full_table[ , <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(full_table[, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb1260-34"><a href="survey-analysis.html#cb1260-34" tabindex="-1"></a>  </span>
<span id="cb1260-35"><a href="survey-analysis.html#cb1260-35" tabindex="-1"></a>  <span class="do">## return dataframe</span></span>
<span id="cb1260-36"><a href="survey-analysis.html#cb1260-36" tabindex="-1"></a>  full_table</span>
<span id="cb1260-37"><a href="survey-analysis.html#cb1260-37" tabindex="-1"></a>}</span>
<span id="cb1260-38"><a href="survey-analysis.html#cb1260-38" tabindex="-1"></a></span>
<span id="cb1260-39"><a href="survey-analysis.html#cb1260-39" tabindex="-1"></a><span class="do">## iterate over several variables to create a table </span></span>
<span id="cb1260-40"><a href="survey-analysis.html#cb1260-40" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb1260-41"><a href="survey-analysis.html#cb1260-41" tabindex="-1"></a>  <span class="do">## define variables of interest</span></span>
<span id="cb1260-42"><a href="survey-analysis.html#cb1260-42" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;died&quot;</span>, <span class="st">&quot;arrived&quot;</span>), </span>
<span id="cb1260-43"><a href="survey-analysis.html#cb1260-43" tabindex="-1"></a>  <span class="do">## state function using and arguments for that function (design)</span></span>
<span id="cb1260-44"><a href="survey-analysis.html#cb1260-44" tabindex="-1"></a>  svy_prop, <span class="at">design =</span> base_survey_design) <span class="sc">%&gt;%</span> </span>
<span id="cb1260-45"><a href="survey-analysis.html#cb1260-45" tabindex="-1"></a>  <span class="do">## collapse list in to a single data frame</span></span>
<span id="cb1260-46"><a href="survey-analysis.html#cb1260-46" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1260-47"><a href="survey-analysis.html#cb1260-47" tabindex="-1"></a>  <span class="do">## round </span></span>
<span id="cb1260-48"><a href="survey-analysis.html#cb1260-48" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##   Variable    Count Proportion X2.5. X97.5. Design.effect
## 1     left 701199.1       47.3  39.2   55.5           2.4
## 2     died  76213.0        5.1   2.1   12.1           3.8
## 3  arrived 761799.0       51.4  40.9   61.7           3.9</code></pre>
</div>
<div id="package-srvyr-1" class="section level3" number="26.8.2">
<h3><span class="header-section-number">26.8.2</span> Package <strong>srvyr</strong></h3>
<p>Với <strong>srvyr</strong> chúng ta có thể sử dụng cú pháp của package <strong>dplyr</strong> để tạo một bảng. Lưu ý rằng hàm <code>survey_mean()</code> được sử dụng, đối số tỷ lệ được chỉ định và hàm tương tự cũng được sử dụng để tính toán hệ số thiết kế. Điều này là do <strong>srvyr</strong> bao gồm cả hai hàm <code>svyciprop()</code> và <code>svymean()</code> của package <strong>survey</strong> được sử dụng trong phần trên.</p>
<p><span style="color: black;"><strong><em>LƯU Ý:</em></strong> Có vẻ như không thể lấy tỷ lệ từ các biến phân loại bằng <strong>srvyr</strong>, nếu bạn cần điều này, hãy xem phần bên dưới sử dụng <strong>sitrep</strong></span></p>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1262-1"><a href="survey-analysis.html#cb1262-1" tabindex="-1"></a><span class="do">## use the srvyr design object</span></span>
<span id="cb1262-2"><a href="survey-analysis.html#cb1262-2" tabindex="-1"></a>survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1262-3"><a href="survey-analysis.html#cb1262-3" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1262-4"><a href="survey-analysis.html#cb1262-4" tabindex="-1"></a>    <span class="do">## produce the weighted counts </span></span>
<span id="cb1262-5"><a href="survey-analysis.html#cb1262-5" tabindex="-1"></a>    <span class="at">counts =</span> <span class="fu">survey_total</span>(died), </span>
<span id="cb1262-6"><a href="survey-analysis.html#cb1262-6" tabindex="-1"></a>    <span class="do">## produce weighted proportions and confidence intervals </span></span>
<span id="cb1262-7"><a href="survey-analysis.html#cb1262-7" tabindex="-1"></a>    <span class="do">## multiply by 100 to get a percentage </span></span>
<span id="cb1262-8"><a href="survey-analysis.html#cb1262-8" tabindex="-1"></a>    <span class="at">props =</span> <span class="fu">survey_mean</span>(died, </span>
<span id="cb1262-9"><a href="survey-analysis.html#cb1262-9" tabindex="-1"></a>                        <span class="at">proportion =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1262-10"><a href="survey-analysis.html#cb1262-10" tabindex="-1"></a>                        <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>) <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb1262-11"><a href="survey-analysis.html#cb1262-11" tabindex="-1"></a>    <span class="do">## produce the design effect </span></span>
<span id="cb1262-12"><a href="survey-analysis.html#cb1262-12" tabindex="-1"></a>    <span class="at">deff =</span> <span class="fu">survey_mean</span>(died, <span class="at">deff =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1262-13"><a href="survey-analysis.html#cb1262-13" tabindex="-1"></a>  <span class="do">## only keep the rows of interest</span></span>
<span id="cb1262-14"><a href="survey-analysis.html#cb1262-14" tabindex="-1"></a>  <span class="do">## (drop standard errors and repeat proportion calculation)</span></span>
<span id="cb1262-15"><a href="survey-analysis.html#cb1262-15" tabindex="-1"></a>  <span class="fu">select</span>(counts, props, props_low, props_upp, deff_deff)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   counts props props_low props_upp deff_deff
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 76213.  5.14      2.08      12.1      3.76</code></pre>
<p>Ở đây, chúng ta cũng có thể viết một hàm để sau đó lặp qua nhiều biến bằng cách sử dụng package <strong>purrr</strong>. Xem chương <a href="iteration.html#iteration">Lặp, vòng lặp, và danh sách</a> trong sổ tay này để biết chi tiết về <strong>purrr</strong>.</p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1264-1"><a href="survey-analysis.html#cb1264-1" tabindex="-1"></a><span class="co"># Define function to calculate weighted counts, proportions, CI and design effect</span></span>
<span id="cb1264-2"><a href="survey-analysis.html#cb1264-2" tabindex="-1"></a><span class="co"># design is your survey design object</span></span>
<span id="cb1264-3"><a href="survey-analysis.html#cb1264-3" tabindex="-1"></a><span class="co"># x is the variable in quotation marks </span></span>
<span id="cb1264-4"><a href="survey-analysis.html#cb1264-4" tabindex="-1"></a></span>
<span id="cb1264-5"><a href="survey-analysis.html#cb1264-5" tabindex="-1"></a></span>
<span id="cb1264-6"><a href="survey-analysis.html#cb1264-6" tabindex="-1"></a>srvyr_prop <span class="ot">&lt;-</span> <span class="cf">function</span>(design, x) {</span>
<span id="cb1264-7"><a href="survey-analysis.html#cb1264-7" tabindex="-1"></a>  </span>
<span id="cb1264-8"><a href="survey-analysis.html#cb1264-8" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1264-9"><a href="survey-analysis.html#cb1264-9" tabindex="-1"></a>    <span class="do">## using the survey design object</span></span>
<span id="cb1264-10"><a href="survey-analysis.html#cb1264-10" tabindex="-1"></a>    design, </span>
<span id="cb1264-11"><a href="survey-analysis.html#cb1264-11" tabindex="-1"></a>    <span class="do">## produce the weighted counts </span></span>
<span id="cb1264-12"><a href="survey-analysis.html#cb1264-12" tabindex="-1"></a>    <span class="at">counts =</span> <span class="fu">survey_total</span>(.data[[x]]), </span>
<span id="cb1264-13"><a href="survey-analysis.html#cb1264-13" tabindex="-1"></a>    <span class="do">## produce weighted proportions and confidence intervals </span></span>
<span id="cb1264-14"><a href="survey-analysis.html#cb1264-14" tabindex="-1"></a>    <span class="do">## multiply by 100 to get a percentage </span></span>
<span id="cb1264-15"><a href="survey-analysis.html#cb1264-15" tabindex="-1"></a>    <span class="at">props =</span> <span class="fu">survey_mean</span>(.data[[x]], </span>
<span id="cb1264-16"><a href="survey-analysis.html#cb1264-16" tabindex="-1"></a>                        <span class="at">proportion =</span> <span class="cn">TRUE</span>, </span>
<span id="cb1264-17"><a href="survey-analysis.html#cb1264-17" tabindex="-1"></a>                        <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>) <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb1264-18"><a href="survey-analysis.html#cb1264-18" tabindex="-1"></a>    <span class="do">## produce the design effect </span></span>
<span id="cb1264-19"><a href="survey-analysis.html#cb1264-19" tabindex="-1"></a>    <span class="at">deff =</span> <span class="fu">survey_mean</span>(.data[[x]], <span class="at">deff =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1264-20"><a href="survey-analysis.html#cb1264-20" tabindex="-1"></a>  <span class="do">## add in the variable name</span></span>
<span id="cb1264-21"><a href="survey-analysis.html#cb1264-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">variable =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb1264-22"><a href="survey-analysis.html#cb1264-22" tabindex="-1"></a>  <span class="do">## only keep the rows of interest</span></span>
<span id="cb1264-23"><a href="survey-analysis.html#cb1264-23" tabindex="-1"></a>  <span class="do">## (drop standard errors and repeat proportion calculation)</span></span>
<span id="cb1264-24"><a href="survey-analysis.html#cb1264-24" tabindex="-1"></a>  <span class="fu">select</span>(variable, counts, props, props_low, props_upp, deff_deff)</span>
<span id="cb1264-25"><a href="survey-analysis.html#cb1264-25" tabindex="-1"></a>  </span>
<span id="cb1264-26"><a href="survey-analysis.html#cb1264-26" tabindex="-1"></a>}</span>
<span id="cb1264-27"><a href="survey-analysis.html#cb1264-27" tabindex="-1"></a>  </span>
<span id="cb1264-28"><a href="survey-analysis.html#cb1264-28" tabindex="-1"></a></span>
<span id="cb1264-29"><a href="survey-analysis.html#cb1264-29" tabindex="-1"></a><span class="do">## iterate over several variables to create a table </span></span>
<span id="cb1264-30"><a href="survey-analysis.html#cb1264-30" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb1264-31"><a href="survey-analysis.html#cb1264-31" tabindex="-1"></a>  <span class="do">## define variables of interest</span></span>
<span id="cb1264-32"><a href="survey-analysis.html#cb1264-32" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;died&quot;</span>, <span class="st">&quot;arrived&quot;</span>), </span>
<span id="cb1264-33"><a href="survey-analysis.html#cb1264-33" tabindex="-1"></a>  <span class="do">## state function using and arguments for that function (design)</span></span>
<span id="cb1264-34"><a href="survey-analysis.html#cb1264-34" tabindex="-1"></a>  <span class="sc">~</span><span class="fu">srvyr_prop</span>(.x, <span class="at">design =</span> survey_design)) <span class="sc">%&gt;%</span> </span>
<span id="cb1264-35"><a href="survey-analysis.html#cb1264-35" tabindex="-1"></a>  <span class="do">## collapse list in to a single data frame</span></span>
<span id="cb1264-36"><a href="survey-analysis.html#cb1264-36" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   variable  counts props props_low props_upp deff_deff
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 left     701199. 47.3      39.2       55.5      2.38
## 2 died      76213.  5.14      2.08      12.1      3.76
## 3 arrived  761799. 51.4      40.9       61.7      3.93</code></pre>
</div>
<div id="package-sitrep" class="section level3" number="26.8.3">
<h3><span class="header-section-number">26.8.3</span> Package <strong>sitrep</strong></h3>
<p>Hàm <code>tab_survey()</code> từ <strong>sitrep</strong> là một hàm gọn hơn cho <strong>srvyr</strong>, cho phép bạn tạo các bảng có trọng số với code tối giản. Nó cũng cho phép bạn tính toán tỷ lệ có trọng số cho các biến phân loại.</p>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1266-1"><a href="survey-analysis.html#cb1266-1" tabindex="-1"></a><span class="do">## using the survey design object</span></span>
<span id="cb1266-2"><a href="survey-analysis.html#cb1266-2" tabindex="-1"></a>survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1266-3"><a href="survey-analysis.html#cb1266-3" tabindex="-1"></a>  <span class="do">## pass the names of variables of interest unquoted</span></span>
<span id="cb1266-4"><a href="survey-analysis.html#cb1266-4" tabindex="-1"></a>  <span class="fu">tab_survey</span>(arrived, left, died, education_level,</span>
<span id="cb1266-5"><a href="survey-analysis.html#cb1266-5" tabindex="-1"></a>             <span class="at">deff =</span> <span class="cn">TRUE</span>,   <span class="co"># calculate the design effect</span></span>
<span id="cb1266-6"><a href="survey-analysis.html#cb1266-6" tabindex="-1"></a>             <span class="at">pretty =</span> <span class="cn">TRUE</span>  <span class="co"># merge the proportion and 95%CI</span></span>
<span id="cb1266-7"><a href="survey-analysis.html#cb1266-7" tabindex="-1"></a>             )</span></code></pre></div>
<pre><code>## Warning: removing 257 missing value(s) from `education_level`</code></pre>
<pre><code>## # A tibble: 9 × 5
##   variable        value            n  deff ci               
##   &lt;chr&gt;           &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;            
## 1 arrived         TRUE       761799.  3.93 51.4% (40.9-61.7)
## 2 arrived         FALSE      720658.  3.93 48.6% (38.3-59.1)
## 3 left            TRUE       701199.  2.38 47.3% (39.2-55.5)
## 4 left            FALSE      781258.  2.38 52.7% (44.5-60.8)
## 5 died            TRUE        76213.  3.76 5.1% (2.1-12.1)  
## 6 died            FALSE     1406244.  3.76 94.9% (87.9-97.9)
## 7 education_level higher     171644.  4.70 42.4% (26.9-59.7)
## 8 education_level primary    102609.  2.37 25.4% (16.2-37.3)
## 9 education_level secondary  130201.  6.68 32.2% (16.5-53.3)</code></pre>
</div>
<div id="package-gtsummary" class="section level3" number="26.8.4">
<h3><span class="header-section-number">26.8.4</span> Package <strong>gtsummary</strong></h3>
<p>Với <strong>gtsummary</strong>, dường như vẫn chưa có hàm sẵn có để thêm khoảng tin cậy hoặc hệ số thiết kế. Ở đây chúng tôi trình bày cách định nghĩa một hàm để thêm khoảng tin cậy và sau đó thêm khoảng tin cậy vào bảng được tạo bằng <strong>gtsummary</strong> với hàm <code>tbl_svysummary()</code>.</p>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="survey-analysis.html#cb1269-1" tabindex="-1"></a>confidence_intervals <span class="ot">&lt;-</span> <span class="cf">function</span>(data, variable, by, ...) {</span>
<span id="cb1269-2"><a href="survey-analysis.html#cb1269-2" tabindex="-1"></a>  </span>
<span id="cb1269-3"><a href="survey-analysis.html#cb1269-3" tabindex="-1"></a>  <span class="do">## extract the confidence intervals and multiply to get percentages</span></span>
<span id="cb1269-4"><a href="survey-analysis.html#cb1269-4" tabindex="-1"></a>  props <span class="ot">&lt;-</span> <span class="fu">svyciprop</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>( <span class="st">&quot;~&quot;</span> , variable)),</span>
<span id="cb1269-5"><a href="survey-analysis.html#cb1269-5" tabindex="-1"></a>              data, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1269-6"><a href="survey-analysis.html#cb1269-6" tabindex="-1"></a>  </span>
<span id="cb1269-7"><a href="survey-analysis.html#cb1269-7" tabindex="-1"></a>  <span class="do">## extract the confidence intervals </span></span>
<span id="cb1269-8"><a href="survey-analysis.html#cb1269-8" tabindex="-1"></a>  <span class="fu">as.numeric</span>(<span class="fu">confint</span>(props) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="do">## make numeric and multiply for percentage</span></span>
<span id="cb1269-9"><a href="survey-analysis.html#cb1269-9" tabindex="-1"></a>    <span class="fu">round</span>(., <span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>           <span class="do">## round to one digit</span></span>
<span id="cb1269-10"><a href="survey-analysis.html#cb1269-10" tabindex="-1"></a>    <span class="fu">c</span>(.) <span class="sc">%&gt;%</span>                           <span class="do">## extract the numbers from matrix</span></span>
<span id="cb1269-11"><a href="survey-analysis.html#cb1269-11" tabindex="-1"></a>    <span class="fu">paste0</span>(., <span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)          <span class="do">## combine to single character</span></span>
<span id="cb1269-12"><a href="survey-analysis.html#cb1269-12" tabindex="-1"></a>}</span>
<span id="cb1269-13"><a href="survey-analysis.html#cb1269-13" tabindex="-1"></a></span>
<span id="cb1269-14"><a href="survey-analysis.html#cb1269-14" tabindex="-1"></a><span class="do">## using the survey package design object</span></span>
<span id="cb1269-15"><a href="survey-analysis.html#cb1269-15" tabindex="-1"></a><span class="fu">tbl_svysummary</span>(base_survey_design, </span>
<span id="cb1269-16"><a href="survey-analysis.html#cb1269-16" tabindex="-1"></a>               <span class="at">include =</span> <span class="fu">c</span>(arrived, left, died),   <span class="do">## define variables want to include</span></span>
<span id="cb1269-17"><a href="survey-analysis.html#cb1269-17" tabindex="-1"></a>               <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">everything</span>() <span class="sc">~</span> <span class="fu">c</span>(<span class="st">&quot;{n} ({p}%)&quot;</span>))) <span class="sc">%&gt;%</span> <span class="do">## define stats of interest</span></span>
<span id="cb1269-18"><a href="survey-analysis.html#cb1269-18" tabindex="-1"></a>  <span class="fu">add_n</span>() <span class="sc">%&gt;%</span>  <span class="do">## add the weighted total </span></span>
<span id="cb1269-19"><a href="survey-analysis.html#cb1269-19" tabindex="-1"></a>  <span class="fu">add_stat</span>(<span class="at">fns =</span> <span class="fu">everything</span>() <span class="sc">~</span> confidence_intervals) <span class="sc">%&gt;%</span> <span class="do">## add CIs</span></span>
<span id="cb1269-20"><a href="survey-analysis.html#cb1269-20" tabindex="-1"></a>  <span class="do">## modify the column headers</span></span>
<span id="cb1269-21"><a href="survey-analysis.html#cb1269-21" tabindex="-1"></a>  <span class="fu">modify_header</span>(</span>
<span id="cb1269-22"><a href="survey-analysis.html#cb1269-22" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb1269-23"><a href="survey-analysis.html#cb1269-23" tabindex="-1"></a>      n <span class="sc">~</span> <span class="st">&quot;**Weighted total (N)**&quot;</span>,</span>
<span id="cb1269-24"><a href="survey-analysis.html#cb1269-24" tabindex="-1"></a>      stat_0 <span class="sc">~</span> <span class="st">&quot;**Weighted Count**&quot;</span>,</span>
<span id="cb1269-25"><a href="survey-analysis.html#cb1269-25" tabindex="-1"></a>      add_stat_1 <span class="sc">~</span> <span class="st">&quot;**95%CI**&quot;</span></span>
<span id="cb1269-26"><a href="survey-analysis.html#cb1269-26" tabindex="-1"></a>    )</span>
<span id="cb1269-27"><a href="survey-analysis.html#cb1269-27" tabindex="-1"></a>    )</span></code></pre></div>
<div id="dnqntzxgpb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dnqntzxgpb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dnqntzxgpb thead, #dnqntzxgpb tbody, #dnqntzxgpb tfoot, #dnqntzxgpb tr, #dnqntzxgpb td, #dnqntzxgpb th {
  border-style: none;
}

#dnqntzxgpb p {
  margin: 0;
  padding: 0;
}

#dnqntzxgpb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dnqntzxgpb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dnqntzxgpb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dnqntzxgpb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dnqntzxgpb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dnqntzxgpb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dnqntzxgpb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dnqntzxgpb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dnqntzxgpb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dnqntzxgpb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dnqntzxgpb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dnqntzxgpb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dnqntzxgpb .gt_spanner_row {
  border-bottom-style: hidden;
}

#dnqntzxgpb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dnqntzxgpb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dnqntzxgpb .gt_from_md > :first-child {
  margin-top: 0;
}

#dnqntzxgpb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dnqntzxgpb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dnqntzxgpb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dnqntzxgpb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dnqntzxgpb .gt_row_group_first td {
  border-top-width: 2px;
}

#dnqntzxgpb .gt_row_group_first th {
  border-top-width: 2px;
}

#dnqntzxgpb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dnqntzxgpb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dnqntzxgpb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dnqntzxgpb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dnqntzxgpb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dnqntzxgpb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dnqntzxgpb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dnqntzxgpb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dnqntzxgpb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dnqntzxgpb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dnqntzxgpb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dnqntzxgpb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dnqntzxgpb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dnqntzxgpb .gt_left {
  text-align: left;
}

#dnqntzxgpb .gt_center {
  text-align: center;
}

#dnqntzxgpb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dnqntzxgpb .gt_font_normal {
  font-weight: normal;
}

#dnqntzxgpb .gt_font_bold {
  font-weight: bold;
}

#dnqntzxgpb .gt_font_italic {
  font-style: italic;
}

#dnqntzxgpb .gt_super {
  font-size: 65%;
}

#dnqntzxgpb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dnqntzxgpb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dnqntzxgpb .gt_indent_1 {
  text-indent: 5px;
}

#dnqntzxgpb .gt_indent_2 {
  text-indent: 10px;
}

#dnqntzxgpb .gt_indent_3 {
  text-indent: 15px;
}

#dnqntzxgpb .gt_indent_4 {
  text-indent: 20px;
}

#dnqntzxgpb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Characteristic&lt;/strong&gt;"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Weighted total (N)&lt;/strong&gt;"><strong>Weighted total (N)</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;Weighted Count&lt;/strong&gt;&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;"><strong>Weighted Count</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="&lt;strong&gt;95%CI&lt;/strong&gt;"><strong>95%CI</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">arrived</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">761,799 (51%)</td>
<td headers="add_stat_1" class="gt_row gt_center">40.9-61.7</td></tr>
    <tr><td headers="label" class="gt_row gt_left">left</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">701,199 (47%)</td>
<td headers="add_stat_1" class="gt_row gt_center">39.2-55.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">died</td>
<td headers="n" class="gt_row gt_center">1,482,457</td>
<td headers="stat_0" class="gt_row gt_center">76,213 (5.1%)</td>
<td headers="add_stat_1" class="gt_row gt_center">2.1-12.1</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
<!-- ======================================================= -->
</div>
</div>
<div id="tỷ-suất-được-áp-dụng-trọng-số" class="section level2" number="26.9">
<h2><span class="header-section-number">26.9</span> Tỷ suất được áp dụng trọng số</h2>
<p>Tương tự đối với các tỷ lệ được áp dụng trọng số (chẳng hạn như tỷ lệ tử vong), bạn có thể sử dụng package <strong>survey</strong> hoặc <strong>srvyr</strong>. Tương tự, bạn có thể viết các hàm (tương tự như ở trên) để lặp qua một số biến. Bạn cũng có thể tạo một hàm cho <strong>gtsummary</strong> như trên nhưng hiện tại nó không có chức năng sẵn có.</p>
<div id="package-survey-2" class="section level3" number="26.9.1">
<h3><span class="header-section-number">26.9.1</span> Package <strong>survey</strong></h3>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1270-1"><a href="survey-analysis.html#cb1270-1" tabindex="-1"></a>ratio <span class="ot">&lt;-</span> <span class="fu">svyratio</span>(<span class="sc">~</span>died, </span>
<span id="cb1270-2"><a href="survey-analysis.html#cb1270-2" tabindex="-1"></a>         <span class="at">denominator =</span> <span class="sc">~</span>obstime, </span>
<span id="cb1270-3"><a href="survey-analysis.html#cb1270-3" tabindex="-1"></a>         <span class="at">design =</span> base_survey_design)</span>
<span id="cb1270-4"><a href="survey-analysis.html#cb1270-4" tabindex="-1"></a></span>
<span id="cb1270-5"><a href="survey-analysis.html#cb1270-5" tabindex="-1"></a>ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(ratio)</span>
<span id="cb1270-6"><a href="survey-analysis.html#cb1270-6" tabindex="-1"></a></span>
<span id="cb1270-7"><a href="survey-analysis.html#cb1270-7" tabindex="-1"></a><span class="fu">cbind</span>(</span>
<span id="cb1270-8"><a href="survey-analysis.html#cb1270-8" tabindex="-1"></a>  ratio<span class="sc">$</span>ratio <span class="sc">*</span> <span class="dv">10000</span>, </span>
<span id="cb1270-9"><a href="survey-analysis.html#cb1270-9" tabindex="-1"></a>  ci <span class="sc">*</span> <span class="dv">10000</span></span>
<span id="cb1270-10"><a href="survey-analysis.html#cb1270-10" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##       obstime    2.5 %   97.5 %
## died 5.981922 1.194294 10.76955</code></pre>
</div>
<div id="package-srvyr-2" class="section level3" number="26.9.2">
<h3><span class="header-section-number">26.9.2</span> Package <strong>srvyr</strong></h3>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1272-1"><a href="survey-analysis.html#cb1272-1" tabindex="-1"></a>survey_design <span class="sc">%&gt;%</span> </span>
<span id="cb1272-2"><a href="survey-analysis.html#cb1272-2" tabindex="-1"></a>  <span class="do">## survey ratio used to account for observation time </span></span>
<span id="cb1272-3"><a href="survey-analysis.html#cb1272-3" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1272-4"><a href="survey-analysis.html#cb1272-4" tabindex="-1"></a>    <span class="at">mortality =</span> <span class="fu">survey_ratio</span>(</span>
<span id="cb1272-5"><a href="survey-analysis.html#cb1272-5" tabindex="-1"></a>      <span class="fu">as.numeric</span>(died) <span class="sc">*</span> <span class="dv">10000</span>, </span>
<span id="cb1272-6"><a href="survey-analysis.html#cb1272-6" tabindex="-1"></a>      obstime, </span>
<span id="cb1272-7"><a href="survey-analysis.html#cb1272-7" tabindex="-1"></a>      <span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)</span>
<span id="cb1272-8"><a href="survey-analysis.html#cb1272-8" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   mortality mortality_low mortality_upp
##       &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1      5.98         0.349          11.6</code></pre>
<!-- ======================================================= -->
</div>
</div>
<div id="tài-nguyên-học-liệu-9" class="section level2" number="26.10">
<h2><span class="header-section-number">26.10</span> Tài nguyên học liệu</h2>
<p><a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">UCLA stats page</a></p>
<p><a href="http://asdfree.com/">Analyze survey data free</a></p>
<p><a href="http://gdfe.co/srvyr/">srvyr packge</a></p>
<p><a href="http://www.danieldsjoberg.com/gtsummary/reference/index.html">gtsummary package</a></p>
<p><a href="https://github.com/EPIET/RapidAssessmentSurveys">EPIET survey case studies</a></p>

<!-- ======================================================= -->
<!-- ======================================================= -->
<!-- ======================================================= -->
</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
