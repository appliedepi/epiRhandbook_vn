<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>14 Nối dữ liệu | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="14 Nối dữ liệu | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Nối dữ liệu | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="joining-matching" class="section level1" number="14">
<h1><span class="header-section-number">14</span> Nối dữ liệu</h1>
<p><img src="images/left-join.gif" width="50%" /></p>
<p><em>Ở trên: một ví dụ động về phép nối bên trái (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">nguồn ảnh</a>)</em></p>
<p>Chương này mô tả các cách “nối (join)”, “khớp (match)”, “liên kết (link),”gắn (bind)” và các cách khác để kết hợp các data frame.</p>
<p>Việc phân tích hay quy trình làm việc dịch tễ học của bạn liên quan đến nhiều nguồn dữ liệu và sự liên kết của nhiều bộ dữ liệu với nhau là phổ biến. Có thể bạn cần kết nối dữ liệu phòng thí nghiệm với kết quả lâm sàng của bệnh nhân, hoặc dữ liệu di động của Google với các xu hướng bệnh truyền nhiễm hay thậm chí là bộ dữ liệu ở một giai đoạn phân tích với phiên bản đã biến đổi của chính nó.</p>
<p>Trong chương này chúng ta trình bày code nhằm:</p>
<ul>
<li>Hướng dẫn <em>nối</em> hai data frame sao cho các hàng khớp với nhau dựa trên các giá trị chung trong cột định danh<br />
</li>
<li>Nối hai data frame dựa trên sự phù hợp (có khả năng) <em>theo xác suất</em> giữa các giá trị<br />
</li>
<li>Mở rộng một data frame bằng cách <em>gắn</em> hoặc (“thêm vào”) trực tiếp các hàng hoặc cột từ một data frame khác</li>
</ul>
<!-- ======================================================= -->
<div id="chuẩn-bị-5" class="section level2" number="14.1">
<h2><span class="header-section-number">14.1</span> Chuẩn bị</h2>
<div id="gọi-package-3" class="section level3 unnumbered">
<h3>Gọi package</h3>
<p>Đoạn code này hiển thị những package cần gọi cho các phân tích. Trong sổ tay này, chúng ta nhấn mạnh đến hàm <code>p_load()</code> từ <strong>pacman</strong>, hàm sẽ cài đặt package nếu cần <em>và</em> gọi nó ra để sử dụng. Bạn cũng có thể gọi các package đã cài đặt với hàm <code>library()</code> từ <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để có thêm thông tin về các R package.</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="joining-matching.html#cb666-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb666-2"><a href="joining-matching.html#cb666-2" tabindex="-1"></a>  rio,            <span class="co"># import and export</span></span>
<span id="cb666-3"><a href="joining-matching.html#cb666-3" tabindex="-1"></a>  here,           <span class="co"># locate files </span></span>
<span id="cb666-4"><a href="joining-matching.html#cb666-4" tabindex="-1"></a>  tidyverse,      <span class="co"># data management and visualisation</span></span>
<span id="cb666-5"><a href="joining-matching.html#cb666-5" tabindex="-1"></a>  RecordLinkage,  <span class="co"># probabilistic matches</span></span>
<span id="cb666-6"><a href="joining-matching.html#cb666-6" tabindex="-1"></a>  fastLink        <span class="co"># probabilistic matches</span></span>
<span id="cb666-7"><a href="joining-matching.html#cb666-7" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-7" class="section level3 unnumbered">
<h3>Nhập dữ liệu</h3>
<p>Để bắt đầu, chúng ta nhập các trường hợp trong linelist đã được làm sạch từ một vụ dịch Ebola mô phỏng. Nếu bạn muốn theo dõi, <a href="https://github.com/epirhandbook/Epi_R_handbook/raw/master/data/case_linelists/linelist_cleaned.rds">bấm để tải xuống linelist “đã được làm sạch”</a> (tệp .rds). Nhập dữ liệu với hàm <code>import()</code> từ package <strong>rio</strong> (hàm này xử lý nhiều loại tệp như .xlsx, .csv, .rds - xem chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết thêm chi tiết).</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb667-1"><a href="joining-matching.html#cb667-1" tabindex="-1"></a><span class="co"># import case linelist </span></span>
<span id="cb667-2"><a href="joining-matching.html#cb667-2" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>50 hàng đầu tiên của linelist được hiển thị dưới đây.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-0f836873d309813454c4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0f836873d309813454c4">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"age","targets":8},{"name":"age_unit","targets":9},{"name":"age_years","targets":10},{"name":"age_cat","targets":11},{"name":"age_cat5","targets":12},{"name":"hospital","targets":13},{"name":"lon","targets":14},{"name":"lat","targets":15},{"name":"infector","targets":16},{"name":"source","targets":17},{"name":"wt_kg","targets":18},{"name":"ht_cm","targets":19},{"name":"ct_blood","targets":20},{"name":"fever","targets":21},{"name":"chills","targets":22},{"name":"cough","targets":23},{"name":"aches","targets":24},{"name":"vomit","targets":25},{"name":"temp","targets":26},{"name":"time_admission","targets":27},{"name":"bmi","targets":28},{"name":"days_onset_hosp","targets":29}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="bộ-dữ-liệu-mẫu" class="section level3 unnumbered">
<h3>Bộ dữ liệu mẫu</h3>
<p>Trong phần nối dữ liệu dưới đây, chúng ta sẽ sử dụng các bộ dữ liệu sau:</p>
<ol style="list-style-type: decimal">
<li>Một phiên bản “thu nhỏ” của bộ dữ liệu <code>linelist</code>, chỉ chứa các cột <code>case_id</code>, <code>date_onset</code>, <code>hospital</code> và chỉ 10 hàng đầu tiên<br />
</li>
<li>Một data frame riêng biệt có tên <code>hosp_info</code>, chứa thêm thông tin chi tiết của từng bệnh viện</li>
</ol>
<p>Trong phần ghép theo xác suất, chúng ta sẽ sử dụng hai bộ dữ liệu nhỏ khác nhau. Code để tạo các bộ dữ liệu này được đưa ra trong phần đó.</p>
<div id="joins_llmini" class="section level4 unnumbered">
<h4>Dữ liệu linelist “thu nhỏ”</h4>
<p>Dưới đây là bộ dữ liệu linelist thu nhỏ, bao gồm 10 hàng và chỉ chứa các cột <code>case_id</code>, <code>date_onset</code> và <code>hospital</code>.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="joining-matching.html#cb668-1" tabindex="-1"></a>linelist_mini <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span>                 <span class="co"># start with original linelist</span></span>
<span id="cb668-2"><a href="joining-matching.html#cb668-2" tabindex="-1"></a>  <span class="fu">select</span>(case_id, date_onset, hospital) <span class="sc">%&gt;%</span>   <span class="co"># select columns</span></span>
<span id="cb668-3"><a href="joining-matching.html#cb668-3" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)                                    <span class="co"># only take the first 10 rows</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4059a9634858188312e4" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4059a9634858188312e4">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="joins_hosp_info" class="section level4 unnumbered">
<h4>Data frame thông tin bệnh viện</h4>
<p>Dưới đây là code để tạo một data frame riêng biệt với thông tin bổ sung của bảy bệnh viện (số lượng người dân có thể tiếp cận và mức độ chăm sóc hiện có). Lưu ý rằng tên “Bệnh viện Quân đội (Military Hospital)” thuộc về hai bệnh viện khác nhau - một bệnh viện cấp 1 phục vụ 10000 cư dân và một bệnh viện cấp hai phục vụ 40500 cư dân.</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb669-1"><a href="joining-matching.html#cb669-1" tabindex="-1"></a><span class="co"># Make the hospital information data frame</span></span>
<span id="cb669-2"><a href="joining-matching.html#cb669-2" tabindex="-1"></a>hosp_info <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb669-3"><a href="joining-matching.html#cb669-3" tabindex="-1"></a>  <span class="at">hosp_name     =</span> <span class="fu">c</span>(<span class="st">&quot;central hospital&quot;</span>, <span class="st">&quot;military&quot;</span>, <span class="st">&quot;military&quot;</span>, <span class="st">&quot;port&quot;</span>, <span class="st">&quot;St. Mark&#39;s&quot;</span>, <span class="st">&quot;ignace&quot;</span>, <span class="st">&quot;sisters&quot;</span>),</span>
<span id="cb669-4"><a href="joining-matching.html#cb669-4" tabindex="-1"></a>  <span class="at">catchment_pop =</span> <span class="fu">c</span>(<span class="dv">1950280</span>, <span class="dv">40500</span>, <span class="dv">10000</span>, <span class="dv">50280</span>, <span class="dv">12000</span>, <span class="dv">5000</span>, <span class="dv">4200</span>),</span>
<span id="cb669-5"><a href="joining-matching.html#cb669-5" tabindex="-1"></a>  <span class="at">level         =</span> <span class="fu">c</span>(<span class="st">&quot;Tertiary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Secondary&quot;</span>, <span class="st">&quot;Primary&quot;</span>, <span class="st">&quot;Primary&quot;</span>)</span>
<span id="cb669-6"><a href="joining-matching.html#cb669-6" tabindex="-1"></a>)</span></code></pre></div>
<p>Đây là data frame này:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-a5824cfed2d8e9308f26" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a5824cfed2d8e9308f26">{"x":{"filter":"none","vertical":false,"data":[["central hospital","military","military","port","St. Mark's","ignace","sisters"],[1950280,40500,10000,50280,12000,5000,4200],["Tertiary","Secondary","Primary","Secondary","Secondary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":7,"columnDefs":[{"className":"dt-right","targets":1},{"name":"hosp_name","targets":0},{"name":"catchment_pop","targets":1},{"name":"level","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
</div>
<div id="làm-sạch-trước" class="section level3 unnumbered">
<h3>Làm sạch trước</h3>
<p>Các phương pháp nối truyền thống (không theo xác suất) phân biệt chữ hoa, chữ thường và yêu cầu khớp các ký tự chính xác giữa các giá trị trong hai data frame. Để minh họa một số bước làm sạch mà bạn có thể cần làm trước khi bắt đầu nối, chúng ta sẽ làm sạch và căn chỉnh bộ dữ liệu <code>linelist_mini</code> và <code>hosp_info</code> ngay bây giờ.</p>
<p><strong>Xác định điểm khác biệt</strong></p>
<p>Chúng ta cần các giá trị của cột <code>hosp_name</code> trong data frame <code>hosp_info</code> để khớp với các giá trị của cột <code>hospital</code> trong data frame <code>linelist_mini</code>.</p>
<p>Dưới đây là các giá trị trong data frame <code>linelist_mini</code>, được in bằng hàm <code>unique()</code>trong <strong>base</strong> R:</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="joining-matching.html#cb670-1" tabindex="-1"></a><span class="fu">unique</span>(linelist_mini<span class="sc">$</span>hospital)</span></code></pre></div>
<pre><code>## [1] &quot;Other&quot;                                &quot;Missing&quot;                             
## [3] &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot; &quot;Port Hospital&quot;                       
## [5] &quot;Military Hospital&quot;</code></pre>
<p>và đây là các giá trị trong data frame <code>hosp_info</code>:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="joining-matching.html#cb672-1" tabindex="-1"></a><span class="fu">unique</span>(hosp_info<span class="sc">$</span>hosp_name)</span></code></pre></div>
<pre><code>## [1] &quot;central hospital&quot; &quot;military&quot;         &quot;port&quot;             &quot;St. Mark&#39;s&quot;      
## [5] &quot;ignace&quot;           &quot;sisters&quot;</code></pre>
<p>Bạn có thể thấy rằng mặc dù một số bệnh viện tồn tại trong cả hai data frame, nhưng có nhiều điểm khác biệt về chính tả.</p>
<p><strong>Căn chỉnh giá trị</strong></p>
<p>Chúng ta bắt đầu bằng cách làm sạch các giá trị trong data frame <code>hosp_info</code>. Như đã được giải thích trong chương <a href="cleaning.html#cleaning">Làm sạch số liệu và các hàm quan trọng</a>, chúng ta có thể code lại các giá trị với tiêu chí logic bằng cách sử dụng hàm <code>case_when()</code> của <strong>dplyr</strong>. Đối với bốn bệnh viện tồn tại trong cả hai data frame, chúng ta thay đổi các giá trị để phù hợp với các giá trị trong <code>linelist_mini</code>. Các bệnh viện khác chúng ta để nguyên giá trị (<code>TRUE ~ hosp_name</code>).</p>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG:</em></strong> Thông thường khi làm sạch, chúng ta nên tạo một cột mới (ví dụ: <code>hosp_name_clean</code>), nhưng để dễ dàng giải thích, chúng ta hiển thị các thay đổi trên cột cũ</span></p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="joining-matching.html#cb674-1" tabindex="-1"></a>hosp_info <span class="ot">&lt;-</span> hosp_info <span class="sc">%&gt;%</span> </span>
<span id="cb674-2"><a href="joining-matching.html#cb674-2" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb674-3"><a href="joining-matching.html#cb674-3" tabindex="-1"></a>    <span class="at">hosp_name =</span> <span class="fu">case_when</span>(</span>
<span id="cb674-4"><a href="joining-matching.html#cb674-4" tabindex="-1"></a>      <span class="co"># criteria                         # new value</span></span>
<span id="cb674-5"><a href="joining-matching.html#cb674-5" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;military&quot;</span>          <span class="sc">~</span> <span class="st">&quot;Military Hospital&quot;</span>,</span>
<span id="cb674-6"><a href="joining-matching.html#cb674-6" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;port&quot;</span>              <span class="sc">~</span> <span class="st">&quot;Port Hospital&quot;</span>,</span>
<span id="cb674-7"><a href="joining-matching.html#cb674-7" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;St. Mark&#39;s&quot;</span>        <span class="sc">~</span> <span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span>,</span>
<span id="cb674-8"><a href="joining-matching.html#cb674-8" tabindex="-1"></a>      hosp_name <span class="sc">==</span> <span class="st">&quot;central hospital&quot;</span>  <span class="sc">~</span> <span class="st">&quot;Central Hospital&quot;</span>,</span>
<span id="cb674-9"><a href="joining-matching.html#cb674-9" tabindex="-1"></a>      <span class="cn">TRUE</span>                             <span class="sc">~</span> hosp_name</span>
<span id="cb674-10"><a href="joining-matching.html#cb674-10" tabindex="-1"></a>      )</span>
<span id="cb674-11"><a href="joining-matching.html#cb674-11" tabindex="-1"></a>    )</span></code></pre></div>
<p>Tên bệnh viện xuất hiện trong cả hai data frame đều được căn chỉnh. Có hai bệnh viện trong dữ liệu <code>hosp_info</code> không có trong <code>linelist_mini</code> - chúng ta sẽ giải quyết những trường hợp này sau, trong phần nối dữ liệu.</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb675-1"><a href="joining-matching.html#cb675-1" tabindex="-1"></a><span class="fu">unique</span>(hosp_info<span class="sc">$</span>hosp_name)</span></code></pre></div>
<pre><code>## [1] &quot;Central Hospital&quot;                     &quot;Military Hospital&quot;                   
## [3] &quot;Port Hospital&quot;                        &quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;
## [5] &quot;ignace&quot;                               &quot;sisters&quot;</code></pre>
<p>Trước một phép nối, việc chuyển đổi một cột thành tất cả chữ thường hoặc tất cả chữ hoa thường dễ dàng nhất. Nếu bạn cần chuyển đổi tất cả các giá trị trong một cột thành CHỮ HOA hoặc chữ thường, hãy sử dụng <code>mutate()</code> và đặt cột bên trong một trong những hàm từ package <strong>stringr</strong>, như ã được trình bày trong chương <a href="characters-strings.html#characters-strings">Ký tự và chuỗi</a>.</p>
<p><code>str_to_upper()</code><br />
<code>str_to_upper()</code><br />
<code>str_to_title()</code></p>
<!-- ======================================================= -->
</div>
</div>
<div id="nối-bằng-dplyr" class="section level2" number="14.2">
<h2><span class="header-section-number">14.2</span> <strong>Nối bằng dplyr</strong></h2>
<p>Package <strong>dplyr</strong> cung cấp một số hàm nối khác nhau. <strong>dplyr</strong> là một package thuộc hệ sinh thái <strong>tidyverse</strong>. Các hàm nối này được mô tả ở bên dưới, trong các trường hợp sử dụng đơn giản.</p>
<p>Rất cảm ơn <a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">https://github.com/gadenbuie</a> vì những tấm ảnh động bổ ích!</p>
<!-- ======================================================= -->
<div id="cú-pháp-chung" class="section level3 unnumbered">
<h3>Cú pháp chung</h3>
<p>Các lệnh nối có thể được chạy dưới dạng các lệnh độc lập để nối hai data frame thành một đối tượng mới, hoặc chúng có thể được sử dụng trong một chuỗi pipe (<code>%&gt;%</code>) để hợp nhất một data frame vào một data frame khác khi nó đang được làm sạch hoặc chỉnh sửa.</p>
<p>Trong ví dụ dưới đây, hàm <code>left_join()</code> được sử dụng như một lệnh độc lập để tạo một data frame <code>joined_data</code> mới. Các dữ liệu đầu vào là data frame 1 và 2 (<code>df1</code> và <code>df2</code>). Data frame đầu tiên được liệt kê là data frame cơ sở và data frame thứ hai được liệt kê là data frame sẽ nối <em>với</em> data frame thứ nhất.</p>
<p>Đối số thứ ba <code>by =</code> là nơi bạn xác định các cột trong mỗi data frame mà sẽ được sử dụng để căn chỉnh các hàng trong hai data frame. Nếu tên của các cột này khác nhau, hãy đặt chúng trong một vectơ <code>c()</code> như được trình bày dưới đây, nơi mà các hàng được khớp trên cơ sở các giá trị chung giữa cột <code>ID</code> trong <code>df1</code> và cột <code>identifier</code> trong <code>df2</code>.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="joining-matching.html#cb677-1" tabindex="-1"></a><span class="co"># Join based on common values between column &quot;ID&quot; (first data frame) and column &quot;identifier&quot; (second data frame)</span></span>
<span id="cb677-2"><a href="joining-matching.html#cb677-2" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span> <span class="ot">=</span> <span class="st">&quot;identifier&quot;</span>))</span></code></pre></div>
<p>Nếu các cột <code>by</code> trong cả hai data frame có cùng tên, bạn chỉ cần cung cấp tên này, đặt trong dấu ngoặc kép.</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="joining-matching.html#cb678-1" tabindex="-1"></a><span class="co"># Joint based on common values in column &quot;ID&quot; in both data frames</span></span>
<span id="cb678-2"><a href="joining-matching.html#cb678-2" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>)</span></code></pre></div>
<p>Nếu bạn đang nối các data frame dựa trên các giá trị chung của nhiều trường, hãy liệt kê các trường này trong vectơ <code>c()</code>. Ví dụ dưới đây nối các hàng nếu các giá trị trong ba cột trong mỗi bộ dữ liệu căn chỉnh chính xác.</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="joining-matching.html#cb679-1" tabindex="-1"></a><span class="co"># join based on same first name, last name, and age</span></span>
<span id="cb679-2"><a href="joining-matching.html#cb679-2" tabindex="-1"></a>joined_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(df1, df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;firstname&quot;</span>, <span class="st">&quot;surname&quot;</span> <span class="ot">=</span> <span class="st">&quot;lastname&quot;</span>, <span class="st">&quot;Age&quot;</span> <span class="ot">=</span> <span class="st">&quot;age&quot;</span>))</span></code></pre></div>
<p>Các lệnh nối cũng có thể được chạy trong một chuỗi pipe. Điều này sẽ thực hiện sửa đổi data frame trong chuỗi pipe.</p>
<p>Trong ví dụ dưới đây, <code>df1</code> được đưa qua các pipe, <code>df2</code> được nối vào đó và vì thế <code>df1</code> được chỉnh sửa và xác định lại.</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="joining-matching.html#cb680-1" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span></span>
<span id="cb680-2"><a href="joining-matching.html#cb680-2" tabindex="-1"></a>  <span class="fu">filter</span>(date_onset <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-03-05&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># miscellaneous cleaning </span></span>
<span id="cb680-3"><a href="joining-matching.html#cb680-3" tabindex="-1"></a>  <span class="fu">left_join</span>(df2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span> <span class="ot">=</span> <span class="st">&quot;identifier&quot;</span>))    <span class="co"># join df2 to df1</span></span></code></pre></div>
<p><span style="color: orange;"><strong><em>CẨN TRỌNG:</em></strong> Nối dựa trên những trường hợp cụ thể! Do đó, rất hữu ích khi chuyển đổi tất cả các giá trị thành chữ thường hoặc chữ hoa trước khi nối. Xem thêm chương về ký tự/chuỗi.</span></p>
<!-- ======================================================= -->
</div>
<div id="nối-trái-và-phải" class="section level3 unnumbered">
<h3>Nối trái và phải</h3>
<p><strong>Nối trái hoặc phải thường được sử dụng để thêm thông tin vào data frame</strong> - thông tin mới chỉ được thêm vào các hàng đã tồn tại trong data frame cơ sở. Đây là những phép nối phổ biến trong hoạt động dịch tễ học vì chúng được sử dụng để thêm thông tin từ một bộ dữ liệu vào một bộ dữ liệu khác.</p>
<p>Khi sử dụng các phép nối này, thứ tự viết của các data frame trong lệnh rất quan trọng*.</p>
<ul>
<li>Trong <em>phép nối trái</em>, data frame <em>đầu tiên</em> được viết là data frame cơ sở<br />
</li>
<li>Trong <em>phép nối phải</em>, data frame <em>thứ hai</em> được viết là data frame cơ sở</li>
</ul>
<p><strong>Tất cả các hàng của data frame cơ sở được giữ lại.</strong> Thông tin trong data frame (thứ cấp) khác được kết hợp với data frame cơ sở <em>chỉ khi có sự trùng khớp của (các) cột định danh</em>. Ngoài ra:</p>
<ul>
<li>Các hàng trong data frame thứ cấp không khớp sẽ bị loại bỏ.<br />
</li>
<li>Nếu có nhiều hàng cơ sở khớp với một hàng trong data frame thứ cấp (nhiều-khớp-một), thông tin phụ sẽ được thêm vào <em>mỗi hàng cơ sở được khớp</em>.<br />
</li>
<li>Nếu một hàng cơ sở khớp với nhiều hàng trong data frame thứ cấp (một-khớp-nhiều), tất cả các kết hợp sẽ được đưa ra, nghĩa là <em>các hàng mới</em> <em>có thể được thêm vào data frame trả về của bạn!</em></li>
</ul>
<p>Sau đây là các ví dụ động về phép nối trái và phải (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">nguồn ảnh</a>)</p>
<p><img src="images/left-join.gif" width="50%" /><img src="images/right-join.gif" width="50%" /></p>
<p><strong>Ví dụ</strong></p>
<p>Dưới đây là kết quả đầu ra của phép nối trái <code>left_join()</code> của bộ dữ liệu <code>hosp_info</code> (data frame thứ cấp, <a href="joining-matching.html#joins_hosp_info">xem tại đây</a>) <em>vào</em> <code>linelist_mini</code> (data frame cơ sở, <a href="joining-matching.html#joins_llmini">xem tại đây</a>). <code>linelist_mini</code> gốc có <code>nrow(linelist_mini)</code> hàng. <code>linelist_mini</code> đã chỉnh sửa được hiển thị. Lưu ý những điều dưới đây:</p>
<ul>
<li>Hai cột mới <code>catchment_pop</code> và <code>level</code> đã được thêm vào bên trái của <code>linelist_mini</code><br />
</li>
<li>Tất cả các hàng gốc của data frame cơ sở <code>linelist_mini</code> đều được giữ lại<br />
</li>
<li>Bất kỳ hàng gốc nào của <code>linelist_mini</code> cho “Military Hospital” đều bị trùng lặp vì nó khớp với <em>hai hàng</em> trong data frame thứ cấp, do đó cả hai sự kết hợp đều được trả về<br />
</li>
<li>Cột định danh kết hợp của bộ dữ liệu thứ cấp (<code>hosp_name</code>) đã biến mất vì nó thừa so với cột định danh trong bộ dữ liệu chính (<code>hospital</code>)<br />
</li>
<li>Khi một hàng cơ sở không khớp với bất kỳ hàng thứ cấp nào (ví dụ: khi <code>hospital</code> là “Other” hoặc “Missing”), <code>NA</code> (trống) sẽ điền vào các cột từ data frame thứ cấp<br />
</li>
<li>Các hàng trong data frame thứ cấp không khớp với data frame cơ sở (bệnh viện “sisters” và “ignace”) đã bị loại bỏ</li>
</ul>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="joining-matching.html#cb681-1" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb681-2"><a href="joining-matching.html#cb681-2" tabindex="-1"></a>  <span class="fu">left_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in left_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-3167b3872078a45e390b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3167b3872078a45e390b">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="tôi-nên-sử-dụng-phép-nối-phải-hay-phép-nối-trái" class="section level4 unnumbered">
<h4>“Tôi nên sử dụng phép nối phải hay phép nối trái?”</h4>
<p>Để trả lời câu hỏi trên, hãy tự hỏi “data frame nào nên giữ lại tất cả các hàng của nó?” - hãy sử dụng cái này làm data frame cơ sở. <em>Phép nối trái</em> giữ tất cả các hàng trong data frame đầu tiên được viết trong lệnh, trong khi <em>phép nối phải</em> giữ tất cả các hàng trong data frame thứ hai.</p>
<p>Hai lệnh bên dưới đạt cùng một kết quả đầu ra - 10 hàng <code>hosp_info</code> được nối <em>vào</em> bộ dữ liệu cơ sở <code>linelist_mini</code>, tuy nhiên chúng sử dụng các phép nối khác nhau. Kết quả là thứ tự cột sẽ khác nhau dựa trên việc <code>hosp_info</code> đến từ bên phải (trong phép nối bên trái) hay đến từ bên trái (trong phép nối bên phải). Thứ tự của các hàng cũng có thể thay đổi tương ứng. Nhưng cả hai hệ quả này đều có thể được giải quyết bằng cách sử dụng <code>select()</code> để sắp xếp lại các cột hoặc <code>arrange()</code> để sắp xếp các hàng.</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="joining-matching.html#cb683-1" tabindex="-1"></a><span class="co"># The two commands below achieve the same data, but with differently ordered rows and columns</span></span>
<span id="cb683-2"><a href="joining-matching.html#cb683-2" tabindex="-1"></a><span class="fu">left_join</span>(linelist_mini, hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span>
<span id="cb683-3"><a href="joining-matching.html#cb683-3" tabindex="-1"></a><span class="fu">right_join</span>(hosp_info, linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<p>Đây là kết quả nối <code>hosp_info</code> vào <code>linelist_mini</code> qua phép nối trái (các cột mới đến từ bên phải)</p>
<pre><code>## Warning in left_join(linelist_mini, hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e0e6218985fa3c0bb9e8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e0e6218985fa3c0bb9e8">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing"],[null,null,12000,50280,40500,10000,50280,null,null,null,null],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Đây là kết quả nối <code>hosp_info</code> vào <code>linelist_mini</code> qua phép nối phải (các cột mới đến từ bên trái)</p>
<pre><code>## Warning in right_join(hosp_info, linelist_mini, by = c(hosp_name = &quot;hospital&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 4 of `x` matches multiple rows in `y`.
## ℹ Row 5 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f45c02a24f1a382c3cb3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f45c02a24f1a382c3cb3">{"x":{"filter":"none","vertical":false,"data":[["Military Hospital","Military Hospital","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Other","Missing","Missing","Missing","Missing","Missing"],[40500,10000,50280,50280,12000,null,null,null,null,null,null],["Secondary","Primary","Secondary","Secondary","Secondary",null,null,null,null,null,null],["893f25","893f25","b8812a","be99c8","11f8ea","5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-21","2014-05-21","2014-05-18","2014-05-22","2014-05-16","2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":1},{"name":"hosp_name","targets":0},{"name":"catchment_pop","targets":1},{"name":"level","targets":2},{"name":"case_id","targets":3},{"name":"date_onset","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Ngoài ra, hãy xem xét liệu trường hợp-đang sử dụng của bạn có nằm trong một chuỗi pipe (<code>%&gt;%</code>) hay không. Nếu bộ dữ liệu nằm trong pipe là đường cơ sở, bạn có thể sẽ sử dụng một phép nối trái để thêm dữ liệu vào đó.</p>
<!-- ======================================================= -->
</div>
</div>
<div id="nối-hoàn-toàn" class="section level3 unnumbered">
<h3>Nối hoàn toàn</h3>
<p><strong>Nối hoàn toàn là phép nối <em>bao hàm</em> nhất trong tất cả các phép nối</strong> - nó trả về tất cả các hàng từ cả hai data frame.</p>
<p>Nếu có bất kỳ hàng nào chỉ hiện diện duy nhất trong một data frame (khi không tìm thấy hàng nào phù hợp), data frame sẽ bao gồm các hàng đó và trở nên dài hơn. Các giá trị missing <code>NA</code> được sử dụng để điền-vào bất kỳ khoảng trống nào đã tạo. Khi bạn nối, hãy kiểm tra số cột và số hàng cẩn thận để khắc phục lỗi về phân biệt chữ hoa với chữ thường và đảm bảo các kết quả khớp ký tự chính xác.</p>
<p>Data frame “cơ sở” là data frame được viết đầu tiên trong lệnh. Việc điều chỉnh data frame này sẽ không ảnh hưởng đến những bản ghi nào được trả về bởi phép nối, nhưng nó có thể ảnh hưởng đến thứ tự cột kết quả, thứ tự hàng và cột định danh nào được giữ lại.</p>
<p><img src="images/full-join.gif" width="50%" /></p>
<p>Ví dụ động về một phép nối hoàn toàn (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">nguồn ảnh</a>)</p>
<p><strong>Ví dụ</strong></p>
<p>Dưới đây kết quả đầu ra của phép nối hoàn toàn <code>full_join()</code> của <code>hosp_info</code> (ban đầu là <code>nrow(hosp_info)</code>, <a href="joining-matching.html#joins_hosp_info">xem tại đây</a>) <em>vào</em> <code>linelist_mini</code> (ban đầu là <code>nrow(linelist_mini)</code>, <a href="joining-matching.html#joins_llmini">xem tại đây</a>). Lưu ý những điều dưới đây:</p>
<ul>
<li>Tất cả các hàng cơ sở đều được giữ nguyên (<code>linelist_mini</code>)<br />
</li>
<li>Các hàng trong data frame thứ cấp không khớp với data frame cơ sở được giữ lại (“ignace” và “sisters”), với các giá trị trong các cột cơ sở tương ứng <code>case_id</code> và <code>onset</code> điền-vào các giá trị missing<br />
</li>
<li>Tương tự, các hàng trong data frame cơ sở không khớp với hàng trong data frame thứ cấp (“Other” và “Missing”) được giữ lại, với các cột phụ <code>catchment_pop</code> và <code>level</code> điền-vào các giá trị missing<br />
</li>
<li>Trong trường hợp khớp một-với-một hoặc nhiều-với-một (ví dụ: các hàng của “Military Hospital”), tất cả các kết hợp có thể có được trả về (kéo dài thêm data frame cuối cùng)<br />
</li>
<li>Chỉ cột định danh từ data frame cơ sở được giữ lại (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="joining-matching.html#cb686-1" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb686-2"><a href="joining-matching.html#cb686-2" tabindex="-1"></a>  <span class="fu">full_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in full_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f2d23b7aa5534e808e63" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f2d23b7aa5534e808e63">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","11f8ea","b8812a","893f25","893f25","be99c8","07e3e8","369449","f393b4","1389ca",null,null,null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05",null,null,null],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Central Hospital","ignace","sisters"],[null,null,12000,50280,40500,10000,50280,null,null,null,null,1950280,5000,4200],[null,null,"Secondary","Secondary","Secondary","Primary","Secondary",null,null,null,null,"Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":15,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,15,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="nối-bên-trong" class="section level3 unnumbered">
<h3>Nối bên trong</h3>
<p><strong>Nối bên trong là phép nối <em>hạn chế</em> nhất trong tất cả các phép nối</strong> - nó chỉ trả về các hàng có kết quả khớp trên cả hai data frame.<br />
Điều này có nghĩa là số hàng trong data frame cơ sở có thể thực sự <em>giảm xuống</em>. Việc điều chỉnh data frame nào là “cơ sở” (được viết đầu tiên trong hàm) sẽ không ảnh hưởng đến hàng nào được trả về, nhưng nó sẽ ảnh hưởng đến thứ tự cột, thứ tự hàng và cột định danh nào được giữ lại.</p>
<p><img src="images/inner-join.gif" width="50%" /></p>
<p>Ví dụ động về một phép nối bên trong (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">nguồn ảnh</a>)</p>
<p><strong>Ví dụ</strong></p>
<p>Dưới đây kết quả đầu ra việc nối <code>inner_join()</code> của <code>linelist_mini</code> (cơ sở) với <code>hosp_info</code> (thứ cấp). Lưu ý những điều dưới đây:</p>
<ul>
<li>Các hàng cơ sở không khớp với dữ liệu thứ cấp sẽ bị xóa (các hàng mà <code>hospital</code> nhận giá trị “Missing” hoặc “Other”)<br />
</li>
<li>Tương tự, các hàng từ data frame thứ cấp không khớp trong data frame cơ sở sẽ bị xóa (các hàng mà <code>hosp_name</code> nhận giá trị “sisters” hoặc “ignace”)<br />
</li>
<li>Chỉ cột định danh từ data frame cơ sở được giữ lại (<code>hospital</code>)</li>
</ul>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="joining-matching.html#cb688-1" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb688-2"><a href="joining-matching.html#cb688-2" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in inner_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-d79b6e18ca412e336823" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d79b6e18ca412e336823">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
<div id="nối-một-phần" class="section level3 unnumbered">
<h3>Nối một phần</h3>
<p>Nối một phần là một “phép nối chọn lọc” mà sử dụng bộ dữ liệu khác <em>không nhằm để thêm hàng hay cột, mà để lọc dữ liệu</em>.</p>
<p><strong>Phép nối-một phần giữ lại tất cả các quan sát trong data frame cơ sở mà có sự trùng khớp với data frame thứ cấp</strong> (nhưng không thêm cột mới cũng như không sao chép bất kỳ hàng nào cho các dữ liệu khớp). Đọc thêm về những phép nối “chọn lọc” này <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">tại đây</a>.</p>
<p><img src="images/semi-join.gif" width="50%" /></p>
<p>Ví dụ động về phép nối một phần (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">nguồn ảnh</a>)</p>
<p>Như một ví dụ, code dưới đây trả về các hàng từ data frame <code>hosp_info</code> mà khớp với <code>linelist_mini</code> theo tên bệnh viện.</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="joining-matching.html#cb690-1" tabindex="-1"></a>hosp_info <span class="sc">%&gt;%</span> </span>
<span id="cb690-2"><a href="joining-matching.html#cb690-2" tabindex="-1"></a>  <span class="fu">semi_join</span>(linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<pre><code>##                              hosp_name catchment_pop     level
## 1                    Military Hospital         40500 Secondary
## 2                    Military Hospital         10000   Primary
## 3                        Port Hospital         50280 Secondary
## 4 St. Mark&#39;s Maternity Hospital (SMMH)         12000 Secondary</code></pre>
<!-- ======================================================= -->
</div>
<div id="anti-join" class="section level3 unnumbered">
<h3>Anti join</h3>
<p><strong>Anti join là một “phép nối chọn lọc” khác trả về các hàng trong data frame cơ sở <em>không</em> khớp với data frame thứ cấp.</strong></p>
<p>Đọc thêm về những phép nối “chọn lọc” này <a href="https://towardsdatascience.com/level-up-with-semi-joins-in-r-a068426096e0">tại đây</a>.</p>
<p>Các tình huống phổ biến của anti join bao gồm xác định các bản ghi không tồn tại trong một data frame khác, khắc phục lỗi chính tả trong một phép nối (xem xét các bản ghi <em>đáng lẽ sẽ</em> khớp) và kiểm tra các bản ghi đã bị loại trừ sau một phép nối khác.</p>
<p><strong>Như với <code>right_join()</code> và <code>left_join()</code>, quan trọng là data frame <em>cơ sở</em> (được liệt kê đầu tiên)</strong>. Các hàng được trả về chỉ từ data frame cơ sở. Lưu ý trong ảnh động bên dưới, hàng trong data frame thứ cấp (hàng 4 màu tím) không được trả về mặc dù nó không khớp với hàng cơ sở.</p>
<p><img src="images/anti-join.gif" width="50%" /></p>
<p>Ví dụ động về anti join (<a href="https://github.com/gadenbuie/tidyexplain/tree/master/images">nguồn ảnh</a>)</p>
<div id="ví-dụ-anti_join-đơn-giản" class="section level4 unnumbered">
<h4>Ví dụ <code>anti_join()</code> đơn giản</h4>
<p>Một ví dụ đơn giản, hãy tìm bệnh viện trong <code>hosp_info</code> mà không tồn tại trong <code>linelist_mini</code>. chúng ta liệt kê <code>hosp_info</code> trước, như một data frame cơ sở. Các bệnh viện không có trong <code>linelist_mini</code> sẽ được trả về.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="joining-matching.html#cb692-1" tabindex="-1"></a>hosp_info <span class="sc">%&gt;%</span> </span>
<span id="cb692-2"><a href="joining-matching.html#cb692-2" tabindex="-1"></a>  <span class="fu">anti_join</span>(linelist_mini, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hosp_name&quot;</span> <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-aeded774e5ab77b311b7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-aeded774e5ab77b311b7">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","ignace","sisters"],[1950280,5000,4200],["Tertiary","Primary","Primary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hosp_name<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":12,"columnDefs":[{"className":"dt-right","targets":1},{"name":"hosp_name","targets":0},{"name":"catchment_pop","targets":1},{"name":"level","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,12,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="ví-dụ-anti_join-phức-tạp" class="section level4 unnumbered">
<h4>Ví dụ <code>anti_join()</code> phức tạp</h4>
<p>Một ví dụ khác, giả sử chúng ta đã chạy một <code>inner_join()</code> giữa <code>linelist_mini</code> và <code>hosp_info</code>. Lệnh này chỉ trả về một tập con các bản ghi của <code>linelist_mini</code> gốc, vì một số bản ghi không có trong <code>hosp_info</code>.</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="joining-matching.html#cb693-1" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb693-2"><a href="joining-matching.html#cb693-2" tabindex="-1"></a>  <span class="fu">inner_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<pre><code>## Warning in inner_join(., hosp_info, by = c(hospital = &quot;hosp_name&quot;)): Detected an unexpected many-to-many relationship between `x` and `y`.
## ℹ Row 5 of `x` matches multiple rows in `y`.
## ℹ Row 4 of `y` matches multiple rows in `x`.
## ℹ If a many-to-many relationship is expected, set `relationship = &quot;many-to-many&quot;` to
##   silence this warning.</code></pre>
<div class="datatables html-widget html-fill-item" id="htmlwidget-052bc70bfde727044fb7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-052bc70bfde727044fb7">{"x":{"filter":"none","vertical":false,"data":[["11f8ea","b8812a","893f25","893f25","be99c8"],["2014-05-16","2014-05-18","2014-05-21","2014-05-21","2014-05-22"],["St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Military Hospital","Port Hospital"],[12000,50280,40500,10000,50280],["Secondary","Secondary","Secondary","Primary","Secondary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n      <th>catchment_pop<\/th>\n      <th>level<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":3},{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2},{"name":"catchment_pop","targets":3},{"name":"level","targets":4}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Để xem lại các bản ghi <code>linelist_mini</code> đã bị loại trừ trong phép nối bên trong, chúng ta có thể chạy một phép nối anti-join với cùng thiết lập (<code>linelist_mini</code> là data frame cơ sở).</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="joining-matching.html#cb695-1" tabindex="-1"></a>linelist_mini <span class="sc">%&gt;%</span> </span>
<span id="cb695-2"><a href="joining-matching.html#cb695-2" tabindex="-1"></a>  <span class="fu">anti_join</span>(hosp_info, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;hospital&quot;</span> <span class="ot">=</span> <span class="st">&quot;hosp_name&quot;</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-1537614536de0653dd04" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-1537614536de0653dd04">{"x":{"filter":"none","vertical":false,"data":[["5fe599","8689b7","07e3e8","369449","f393b4","1389ca"],["2014-05-13","2014-05-13","2014-05-27","2014-06-02","2014-06-05","2014-06-05"],["Other","Missing","Missing","Missing","Missing","Missing"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>date_onset<\/th>\n      <th>hospital<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"name":"case_id","targets":0},{"name":"date_onset","targets":1},{"name":"hospital","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Để xem các bản ghi <code>hosp_info</code> đã bị loại trừ trong phép nối bên trong, chúng ta cũng có thể chạy một phép nối anti-join với <code>hosp_info</code> là data frame cơ sở.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="khớp-theo-xác-suất" class="section level2" number="14.3">
<h2><span class="header-section-number">14.3</span> Khớp theo xác suất</h2>
<p>Nếu bạn không có thông tin định danh duy nhất chung trên các bộ dữ liệu để nối, hãy xem xét sử dụng thuật toán khớp theo xác suất. Phương pháp này sẽ tìm thấy các bản ghi khớp với nhau dựa trên sự tương đồng (ví dụ: khoảng cách chuỗi Jaro-Winkler hoặc khoảng cách số). Dưới đây là một ví dụ đơn giản sử dụng package <strong>fastLink</strong>.</p>
<p><strong>Gọi package</strong></p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="joining-matching.html#cb696-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb696-2"><a href="joining-matching.html#cb696-2" tabindex="-1"></a>  tidyverse,      <span class="co"># data manipulation and visualization</span></span>
<span id="cb696-3"><a href="joining-matching.html#cb696-3" tabindex="-1"></a>  fastLink        <span class="co"># record matching</span></span>
<span id="cb696-4"><a href="joining-matching.html#cb696-4" tabindex="-1"></a>  )</span></code></pre></div>
<p>Dưới đây là hai bộ dữ liệu mẫu nhỏ mà chúng ta sẽ sử dụng để giải thích phương pháp khớp theo xác suất (<code>cases</code> và <code>test_results</code>):</p>
<p>Đây là code được sử dụng để tạo bộ dữ liệu:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="joining-matching.html#cb697-1" tabindex="-1"></a><span class="co"># make datasets</span></span>
<span id="cb697-2"><a href="joining-matching.html#cb697-2" tabindex="-1"></a></span>
<span id="cb697-3"><a href="joining-matching.html#cb697-3" tabindex="-1"></a>cases <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb697-4"><a href="joining-matching.html#cb697-4" tabindex="-1"></a>  <span class="sc">~</span>gender, <span class="sc">~</span>first,      <span class="sc">~</span>middle,     <span class="sc">~</span>last,        <span class="sc">~</span>yr,   <span class="sc">~</span>mon, <span class="sc">~</span>day, <span class="sc">~</span>district,</span>
<span id="cb697-5"><a href="joining-matching.html#cb697-5" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Amir&quot;</span>,      <span class="cn">NA</span>,          <span class="st">&quot;Khan&quot;</span>,       <span class="dv">1989</span>,  <span class="dv">11</span>,   <span class="dv">22</span>,   <span class="st">&quot;River&quot;</span>,</span>
<span id="cb697-6"><a href="joining-matching.html#cb697-6" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Anthony&quot;</span>,   <span class="st">&quot;B.&quot;</span>,        <span class="st">&quot;Smith&quot;</span>,      <span class="dv">1970</span>, <span class="dv">09</span>, <span class="dv">19</span>,      <span class="st">&quot;River&quot;</span>, </span>
<span id="cb697-7"><a href="joining-matching.html#cb697-7" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,     <span class="st">&quot;Marialisa&quot;</span>, <span class="st">&quot;Contreras&quot;</span>, <span class="st">&quot;Rodrigues&quot;</span>,  <span class="dv">1972</span>, <span class="dv">04</span>, <span class="dv">15</span>,      <span class="st">&quot;River&quot;</span>,</span>
<span id="cb697-8"><a href="joining-matching.html#cb697-8" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,     <span class="st">&quot;Elizabeth&quot;</span>, <span class="st">&quot;Casteel&quot;</span>,   <span class="st">&quot;Chase&quot;</span>,      <span class="dv">1954</span>, <span class="dv">03</span>, <span class="dv">03</span>,      <span class="st">&quot;City&quot;</span>,</span>
<span id="cb697-9"><a href="joining-matching.html#cb697-9" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Jose&quot;</span>,      <span class="st">&quot;Sanchez&quot;</span>,   <span class="st">&quot;Lopez&quot;</span>,      <span class="dv">1996</span>, <span class="dv">01</span>, <span class="dv">06</span>,      <span class="st">&quot;City&quot;</span>,</span>
<span id="cb697-10"><a href="joining-matching.html#cb697-10" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,     <span class="st">&quot;Cassidy&quot;</span>,   <span class="st">&quot;Jones&quot;</span>,      <span class="st">&quot;Davis&quot;</span>,     <span class="dv">1980</span>, <span class="dv">07</span>, <span class="dv">20</span>,      <span class="st">&quot;City&quot;</span>,</span>
<span id="cb697-11"><a href="joining-matching.html#cb697-11" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Michael&quot;</span>,   <span class="st">&quot;Murphy&quot;</span>,     <span class="st">&quot;O&#39;Calaghan&quot;</span>,<span class="dv">1969</span>, <span class="dv">04</span>, <span class="dv">12</span>,      <span class="st">&quot;Rural&quot;</span>, </span>
<span id="cb697-12"><a href="joining-matching.html#cb697-12" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,     <span class="st">&quot;Oliver&quot;</span>,    <span class="st">&quot;Laurent&quot;</span>,    <span class="st">&quot;De Bordow&quot;</span> , <span class="dv">1971</span>, <span class="dv">02</span>, <span class="dv">04</span>,     <span class="st">&quot;River&quot;</span>,</span>
<span id="cb697-13"><a href="joining-matching.html#cb697-13" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Blessing&quot;</span>,  <span class="cn">NA</span>,          <span class="st">&quot;Adebayo&quot;</span>,   <span class="dv">1955</span>,  <span class="dv">02</span>, <span class="dv">14</span>,     <span class="st">&quot;Rural&quot;</span></span>
<span id="cb697-14"><a href="joining-matching.html#cb697-14" tabindex="-1"></a>)</span>
<span id="cb697-15"><a href="joining-matching.html#cb697-15" tabindex="-1"></a></span>
<span id="cb697-16"><a href="joining-matching.html#cb697-16" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb697-17"><a href="joining-matching.html#cb697-17" tabindex="-1"></a>  <span class="sc">~</span>gender,  <span class="sc">~</span>first,     <span class="sc">~</span>middle,     <span class="sc">~</span>last,          <span class="sc">~</span>yr, <span class="sc">~</span>mon, <span class="sc">~</span>day, <span class="sc">~</span>district, <span class="sc">~</span>result,</span>
<span id="cb697-18"><a href="joining-matching.html#cb697-18" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Amir&quot;</span>,     <span class="cn">NA</span>,          <span class="st">&quot;Khan&quot;</span>,         <span class="dv">1989</span>, <span class="dv">11</span>,   <span class="dv">22</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-19"><a href="joining-matching.html#cb697-19" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Tony&quot;</span>,   <span class="st">&quot;B&quot;</span>,         <span class="st">&quot;Smith&quot;</span>,          <span class="dv">1970</span>, <span class="dv">09</span>,   <span class="dv">19</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-20"><a href="joining-matching.html#cb697-20" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Maria&quot;</span>,    <span class="st">&quot;Contreras&quot;</span>, <span class="st">&quot;Rodriguez&quot;</span>,    <span class="dv">1972</span>, <span class="dv">04</span>,   <span class="dv">15</span>,  <span class="st">&quot;Cty&quot;</span>,   <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb697-21"><a href="joining-matching.html#cb697-21" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Betty&quot;</span>,    <span class="st">&quot;Castel&quot;</span>,   <span class="st">&quot;Chase&quot;</span>,        <span class="dv">1954</span>,  <span class="dv">03</span>,   <span class="dv">30</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-22"><a href="joining-matching.html#cb697-22" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Andrea&quot;</span>,   <span class="cn">NA</span>,          <span class="st">&quot;Kumaraswamy&quot;</span>,  <span class="dv">2001</span>, <span class="dv">01</span>,   <span class="dv">05</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;positive&quot;</span>,      </span>
<span id="cb697-23"><a href="joining-matching.html#cb697-23" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Caroline&quot;</span>, <span class="cn">NA</span>,          <span class="st">&quot;Wang&quot;</span>,         <span class="dv">1988</span>, <span class="dv">12</span>,   <span class="dv">11</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb697-24"><a href="joining-matching.html#cb697-24" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Trang&quot;</span>,    <span class="cn">NA</span>,          <span class="st">&quot;Nguyen&quot;</span>,       <span class="dv">1981</span>, <span class="dv">06</span>,   <span class="dv">10</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-25"><a href="joining-matching.html#cb697-25" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Olivier&quot;</span> , <span class="st">&quot;Laurent&quot;</span>,   <span class="st">&quot;De Bordeaux&quot;</span>,  <span class="cn">NA</span>,   <span class="cn">NA</span>,   <span class="cn">NA</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-26"><a href="joining-matching.html#cb697-26" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Mike&quot;</span>,     <span class="st">&quot;Murphy&quot;</span>,    <span class="st">&quot;O&#39;Callaghan&quot;</span>,  <span class="dv">1969</span>, <span class="dv">04</span>,   <span class="dv">12</span>,  <span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb697-27"><a href="joining-matching.html#cb697-27" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Cassidy&quot;</span>,  <span class="st">&quot;Jones&quot;</span>,     <span class="st">&quot;Davis&quot;</span>,        <span class="dv">1980</span>, <span class="dv">07</span>,   <span class="dv">02</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-28"><a href="joining-matching.html#cb697-28" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Mohammad&quot;</span>, <span class="cn">NA</span>,          <span class="st">&quot;Ali&quot;</span>,          <span class="dv">1942</span>, <span class="dv">01</span>,   <span class="dv">17</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb697-29"><a href="joining-matching.html#cb697-29" tabindex="-1"></a>  <span class="cn">NA</span>,       <span class="st">&quot;Jose&quot;</span>,     <span class="st">&quot;Sanchez&quot;</span>,   <span class="st">&quot;Lopez&quot;</span>,        <span class="dv">1995</span>, <span class="dv">01</span>,   <span class="dv">06</span>,  <span class="st">&quot;City&quot;</span>,  <span class="st">&quot;negative&quot;</span>,</span>
<span id="cb697-30"><a href="joining-matching.html#cb697-30" tabindex="-1"></a>  <span class="st">&quot;M&quot;</span>,      <span class="st">&quot;Abubakar&quot;</span>, <span class="cn">NA</span>,          <span class="st">&quot;Abullahi&quot;</span>,     <span class="dv">1960</span>, <span class="dv">01</span>,   <span class="dv">01</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span>,</span>
<span id="cb697-31"><a href="joining-matching.html#cb697-31" tabindex="-1"></a>  <span class="st">&quot;F&quot;</span>,      <span class="st">&quot;Maria&quot;</span>,    <span class="st">&quot;Salinas&quot;</span>,   <span class="st">&quot;Contreras&quot;</span>,    <span class="dv">1955</span>, <span class="dv">03</span>,   <span class="dv">03</span>,  <span class="st">&quot;River&quot;</span>, <span class="st">&quot;positive&quot;</span></span>
<span id="cb697-32"><a href="joining-matching.html#cb697-32" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>Bộ dữ liệu <code>cases</code> có 9 bản ghi</strong> của những bệnh nhân đang chờ kết quả xét nghiệm.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-029dd2f34dfb8dc2bc1d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-029dd2f34dfb8dc2bc1d">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p><strong>Bộ dữ liệu <code>test_results</code></strong> có 14 bản ghi và chứa cột <code>result</code>, cột mà chúng ta muốn thêm vào các bản ghi trong <code>cases</code> dựa trên các bản ghi khớp theo xác xuất.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6dc47cf793565f8bdf34" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6dc47cf793565f8bdf34">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","F","F","F","M","M","F","M",null,"M","F"],["Amir","Tony","Maria","Betty","Andrea","Caroline","Trang","Olivier","Mike","Cassidy","Mohammad","Jose","Abubakar","Maria"],[null,"B","Contreras","Castel",null,null,null,"Laurent","Murphy","Jones",null,"Sanchez",null,"Salinas"],["Khan","Smith","Rodriguez","Chase","Kumaraswamy","Wang","Nguyen","De Bordeaux","O'Callaghan","Davis","Ali","Lopez","Abullahi","Contreras"],[1989,1970,1972,1954,2001,1988,1981,null,1969,1980,1942,1995,1960,1955],[11,9,4,3,1,12,6,null,4,7,1,1,1,3],[22,19,15,30,5,11,10,null,12,2,17,6,1,3],["River","River","Cty","City","Rural","Rural","Rural","River","Rural","City","City","City","River","River"],["positive","positive","negative","positive","positive","negative","positive","positive","negative","positive","negative","negative","positive","positive"]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":14,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7},{"name":"result","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,14,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<div id="khớp-theo-xác-suất-1" class="section level3 unnumbered">
<h3>Khớp theo xác suất</h3>
<p>Hàm <code>fastLink()</code> từ package <strong>fastLink</strong> có thể được sử dụng để áp dụng một thuật toán so khớp. Đây là thông tin cơ bản. Bạn có thể đọc chi tiết thêm bằng cách nhập <code>?fastLink</code> trong console của mình.</p>
<ul>
<li>Xác định hai data frame để so sánh với các đối số <code>dfA =</code> và <code>dfB =</code><br />
</li>
<li>Trong <code>varnames =</code> cung cấp tất cả các tên cột được sử dụng để khớp. Tất cả tên cột phải tồn tại trong cả hai <code>dfA</code> và <code>dfB</code>.<br />
</li>
<li>Trong <code>stringdist.match =</code> cung cấp các cột từ những cột trong <code>varnames</code> được đánh giá trên chuỗi “distance”.<br />
</li>
<li>Trong <code>numeric.match =</code> cung cấp các cột từ những cột trong <code>varnames</code> được đánh giá trên khoảng.<br />
</li>
<li>Các giá trị missing sẽ bị bỏ qua<br />
</li>
<li>Theo mặc định, mỗi hàng từ một trong hai data frame sẽ được khớp với nhiều nhất một hàng trong data frame còn lại. Nếu bạn muốn xem tất cả các kết quả khớp được đánh giá, hãy đặt <code>dedupe.matches = FALSE</code>. Việc loại bỏ trùng lặp được thực hiện bằng giải pháp gán tuyến tính của Winkler.</li>
</ul>
<p><em>Mẹo: tách một cột ngày thành ba cột số riêng biệt bằng cách sử dụng <code>day()</code>, <code>month()</code> và <code>year()</code> từ package <strong>lubridate</strong></em></p>
<p>Ngưỡng mặc định cho các kết quả khớp là 0,94 (<code>threshold.match =</code>) nhưng bạn có thể điều chỉnh nó cao hơn hoặc thấp hơn. Nếu bạn xác định ngưỡng, hãy cân nhắc việc ngưỡng cao hơn có thể mang lại nhiều âm tính giả hơn (các hàng không khớp sẽ thực sự khớp) và tương tự như vậy, ngưỡng thấp hơn có thể mang lại nhiều kết quả dương tính giả hơn.</p>
<p>Dưới đây, dữ liệu được đối sánh trên khoảng cách chuỗi trên các cột tên (name) và quận (district), cũng như khoảng cách số cho ngày (day), tháng month), năm sinh (year). Ngưỡng đối sánh với xác suất là 95% được thiết lập.</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="joining-matching.html#cb698-1" tabindex="-1"></a>fl_output <span class="ot">&lt;-</span> fastLink<span class="sc">::</span><span class="fu">fastLink</span>(</span>
<span id="cb698-2"><a href="joining-matching.html#cb698-2" tabindex="-1"></a>  <span class="at">dfA =</span> cases,</span>
<span id="cb698-3"><a href="joining-matching.html#cb698-3" tabindex="-1"></a>  <span class="at">dfB =</span> results,</span>
<span id="cb698-4"><a href="joining-matching.html#cb698-4" tabindex="-1"></a>  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;first&quot;</span>, <span class="st">&quot;middle&quot;</span>, <span class="st">&quot;last&quot;</span>, <span class="st">&quot;yr&quot;</span>, <span class="st">&quot;mon&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;district&quot;</span>),</span>
<span id="cb698-5"><a href="joining-matching.html#cb698-5" tabindex="-1"></a>  <span class="at">stringdist.match =</span> <span class="fu">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;middle&quot;</span>, <span class="st">&quot;last&quot;</span>, <span class="st">&quot;district&quot;</span>),</span>
<span id="cb698-6"><a href="joining-matching.html#cb698-6" tabindex="-1"></a>  <span class="at">numeric.match =</span> <span class="fu">c</span>(<span class="st">&quot;yr&quot;</span>, <span class="st">&quot;mon&quot;</span>, <span class="st">&quot;day&quot;</span>),</span>
<span id="cb698-7"><a href="joining-matching.html#cb698-7" tabindex="-1"></a>  <span class="at">threshold.match =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Deduping the estimated matches.
## Getting the match patterns for each estimated match.</code></pre>
<p><strong>Xem lại các kết quả khớp</strong></p>
<p>chúng ta đã định nghĩa đối tượng được trả về từ <code>fastLink()</code> là <code>fl_output</code>. Nó thuộc nhóm <code>list</code>, và nó thực sự chứa một số data frame bên trong nó, mô tả chi tiết kết quả của việc so khớp. Một trong những data frame này là <code>matches</code>, chứa các kết quả khớp có nhiều khả năng nhất giữa <code>cases</code> và <code>results</code>. Bạn có thể truy cập data frame “khớp” này với <code>fl_output$matches</code>. Dưới đây, nó được lưu dưới dạng <code>my_matches</code> để tiện cho việc truy cập sau này.</p>
<p>Khi <code>my_matches</code> được in, bạn sẽ thấy hai vectơ cột: các cặp số/chỉ số hàng (còn được gọi là “tên hàng (rownames)”) trong <code>cases</code> (“inds.a”) và trong <code>results</code> (“inds.b”) đại diện cho các kết quả khớp phù hợp nhất. Nếu số hàng từ data frame bị thiếu, có nghĩa là không tìm thấy kết quả khớp nào trong data frame khác ở ngưỡng đối sánh đã chỉ định.</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="joining-matching.html#cb700-1" tabindex="-1"></a><span class="co"># print matches</span></span>
<span id="cb700-2"><a href="joining-matching.html#cb700-2" tabindex="-1"></a>my_matches <span class="ot">&lt;-</span> fl_output<span class="sc">$</span>matches</span>
<span id="cb700-3"><a href="joining-matching.html#cb700-3" tabindex="-1"></a>my_matches</span></code></pre></div>
<pre><code>##   inds.a inds.b
## 1      1      1
## 2      2      2
## 3      3      3
## 4      4      4
## 5      8      8
## 6      7      9
## 7      6     10
## 8      5     12</code></pre>
<p>Những điều cần lưu ý:</p>
<ul>
<li><p>Các kết quả trùng khớp đã xảy ra mặc dù có sự khác biệt nhỏ về cách viết tên cũng như ngày sinh:</p>
<ul>
<li>“Tony B. Smith” khớp với “Anthony B Smith”<br />
</li>
<li>“Maria Rodriguez” khớp với “Marialisa Rodrigues”<br />
</li>
<li>“Betty Chase” khớp với “Elizabeth Chase”<br />
</li>
<li>“Olivier Laurent De Bordeaux” khớp với “Oliver Laurent De Bordow” (ngày sinh missing bị bỏ qua)<br />
</li>
</ul></li>
<li><p>Một hàng trong <code>cases</code> (đối với “Blessing Adebayo”, hàng 9) không có kết quả khớp tốt trong <code>results</code>, vì vậy nó không tồn tại <code>my_matches</code>.</p></li>
</ul>
<p><strong>Nối dựa trên việc khớp theo xác suất</strong></p>
<p>Để sử dụng các kết quả khớp này nhằm nối <code>results</code> vào <code>cases</code>, chiến lược là:</p>
<ol style="list-style-type: decimal">
<li>Sử dụng <code>left_join()</code> để nối <code>my_matches</code> vào <code>cases</code> (khớp tên hàng (rowname) trong <code>cases</code> với “inds.a” trong <code>my_matches</code>)<br />
</li>
<li>Sau đó sử dụng <code>left_join()</code> khác để nối <code>results</code> vào <code>cases</code> (khớp với “inds.b” mới có được trong <code>cases</code> với rowname trong <code>results</code>)</li>
</ol>
<p>Trước khi nối, chúng ta nên làm sạch ba data frame:</p>
<ul>
<li>Cả <code>dfA</code> và <code>dfB</code> nên có số hàng của chúng (“rowname”) được chuyển đổi thành một cột thích hợp.<br />
</li>
<li>Cả hai cột trong <code>my_matches</code> đều được chuyển đổi thành nhóm ký tự, vì vậy chúng có thể được nối với ký tự rownames</li>
</ul>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="joining-matching.html#cb702-1" tabindex="-1"></a><span class="co"># Clean data prior to joining</span></span>
<span id="cb702-2"><a href="joining-matching.html#cb702-2" tabindex="-1"></a><span class="do">#############################</span></span>
<span id="cb702-3"><a href="joining-matching.html#cb702-3" tabindex="-1"></a></span>
<span id="cb702-4"><a href="joining-matching.html#cb702-4" tabindex="-1"></a><span class="co"># convert cases rownames to a column </span></span>
<span id="cb702-5"><a href="joining-matching.html#cb702-5" tabindex="-1"></a>cases_clean <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb702-6"><a href="joining-matching.html#cb702-6" tabindex="-1"></a></span>
<span id="cb702-7"><a href="joining-matching.html#cb702-7" tabindex="-1"></a><span class="co"># convert test_results rownames to a column</span></span>
<span id="cb702-8"><a href="joining-matching.html#cb702-8" tabindex="-1"></a>results_clean <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()  </span>
<span id="cb702-9"><a href="joining-matching.html#cb702-9" tabindex="-1"></a></span>
<span id="cb702-10"><a href="joining-matching.html#cb702-10" tabindex="-1"></a><span class="co"># convert all columns in matches dataset to character, so they can be joined to the rownames</span></span>
<span id="cb702-11"><a href="joining-matching.html#cb702-11" tabindex="-1"></a>matches_clean <span class="ot">&lt;-</span> my_matches <span class="sc">%&gt;%</span></span>
<span id="cb702-12"><a href="joining-matching.html#cb702-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb702-13"><a href="joining-matching.html#cb702-13" tabindex="-1"></a></span>
<span id="cb702-14"><a href="joining-matching.html#cb702-14" tabindex="-1"></a></span>
<span id="cb702-15"><a href="joining-matching.html#cb702-15" tabindex="-1"></a></span>
<span id="cb702-16"><a href="joining-matching.html#cb702-16" tabindex="-1"></a><span class="co"># Join matches to dfA, then add dfB</span></span>
<span id="cb702-17"><a href="joining-matching.html#cb702-17" tabindex="-1"></a><span class="do">###################################</span></span>
<span id="cb702-18"><a href="joining-matching.html#cb702-18" tabindex="-1"></a><span class="co"># column &quot;inds.b&quot; is added to dfA</span></span>
<span id="cb702-19"><a href="joining-matching.html#cb702-19" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cases_clean, matches_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;rowname&quot;</span> <span class="ot">=</span> <span class="st">&quot;inds.a&quot;</span>))</span>
<span id="cb702-20"><a href="joining-matching.html#cb702-20" tabindex="-1"></a></span>
<span id="cb702-21"><a href="joining-matching.html#cb702-21" tabindex="-1"></a><span class="co"># column(s) from dfB are added </span></span>
<span id="cb702-22"><a href="joining-matching.html#cb702-22" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(complete, results_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;inds.b&quot;</span> <span class="ot">=</span> <span class="st">&quot;rowname&quot;</span>))</span></code></pre></div>
<p>Như được trình bày bằng cách sử dụng code trên, data frame kết quả <code>complete</code> sẽ chứa <em>tất cả</em> các cột từ cả <code>cases</code> và <code>results</code>. Nhiều cột sẽ được thêm vào bằng các hậu tố “.x” và “.y”, vì nếu không, tên cột sẽ bị trùng lặp.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-85b179fc52537d7fb22c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-85b179fc52537d7fb22c">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["M","M","F","F",null,"F","M","M",null],["Amir","Tony","Maria","Betty","Jose","Cassidy","Mike","Olivier",null],[null,"B","Contreras","Castel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodriguez","Chase","Lopez","Davis","O'Callaghan","De Bordeaux",null],[1989,1970,1972,1954,1995,1980,1969,null,null],[11,9,4,3,1,7,4,null,null],[22,19,15,30,6,2,12,null,null],["River","River","Cty","City","City","City","Rural","River",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender.x<\/th>\n      <th>first.x<\/th>\n      <th>middle.x<\/th>\n      <th>last.x<\/th>\n      <th>yr.x<\/th>\n      <th>mon.x<\/th>\n      <th>day.x<\/th>\n      <th>district.x<\/th>\n      <th>inds.b<\/th>\n      <th>gender.y<\/th>\n      <th>first.y<\/th>\n      <th>middle.y<\/th>\n      <th>last.y<\/th>\n      <th>yr.y<\/th>\n      <th>mon.y<\/th>\n      <th>day.y<\/th>\n      <th>district.y<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7,14,15,16]},{"name":"rowname","targets":0},{"name":"gender.x","targets":1},{"name":"first.x","targets":2},{"name":"middle.x","targets":3},{"name":"last.x","targets":4},{"name":"yr.x","targets":5},{"name":"mon.x","targets":6},{"name":"day.x","targets":7},{"name":"district.x","targets":8},{"name":"inds.b","targets":9},{"name":"gender.y","targets":10},{"name":"first.y","targets":11},{"name":"middle.y","targets":12},{"name":"last.y","targets":13},{"name":"yr.y","targets":14},{"name":"mon.y","targets":15},{"name":"day.y","targets":16},{"name":"district.y","targets":17},{"name":"result","targets":18}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Ngoài ra, để chỉ lấy 9 bản ghi “gốc” trong <code>cases</code> với (các) cột mới từ <code>results</code>, hãy sử dụng <code>select()</code> trên <code>results</code> trước khi nối, để nó chỉ chứa rownames và cột mà bạn muốn thêm vào <code>cases</code> (ví dụ: cột <code>result</code>).</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="joining-matching.html#cb703-1" tabindex="-1"></a>cases_clean <span class="ot">&lt;-</span> cases <span class="sc">%&gt;%</span> <span class="fu">rownames_to_column</span>()</span>
<span id="cb703-2"><a href="joining-matching.html#cb703-2" tabindex="-1"></a></span>
<span id="cb703-3"><a href="joining-matching.html#cb703-3" tabindex="-1"></a>results_clean <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb703-4"><a href="joining-matching.html#cb703-4" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb703-5"><a href="joining-matching.html#cb703-5" tabindex="-1"></a>  <span class="fu">select</span>(rowname, result)    <span class="co"># select only certain columns </span></span>
<span id="cb703-6"><a href="joining-matching.html#cb703-6" tabindex="-1"></a></span>
<span id="cb703-7"><a href="joining-matching.html#cb703-7" tabindex="-1"></a>matches_clean <span class="ot">&lt;-</span> my_matches <span class="sc">%&gt;%</span></span>
<span id="cb703-8"><a href="joining-matching.html#cb703-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), as.character))</span>
<span id="cb703-9"><a href="joining-matching.html#cb703-9" tabindex="-1"></a></span>
<span id="cb703-10"><a href="joining-matching.html#cb703-10" tabindex="-1"></a><span class="co"># joins</span></span>
<span id="cb703-11"><a href="joining-matching.html#cb703-11" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cases_clean, matches_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;rowname&quot;</span> <span class="ot">=</span> <span class="st">&quot;inds.a&quot;</span>))</span>
<span id="cb703-12"><a href="joining-matching.html#cb703-12" tabindex="-1"></a>complete <span class="ot">&lt;-</span> <span class="fu">left_join</span>(complete, results_clean, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;inds.b&quot;</span> <span class="ot">=</span> <span class="st">&quot;rowname&quot;</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-21b5d8951913c29e0069" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-21b5d8951913c29e0069">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9"],["M","M","F","F","M","F","M","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo"],[1989,1970,1972,1954,1996,1980,1969,1971,1955],[11,9,4,3,1,7,4,2,2],[22,19,15,3,6,20,12,4,14],["River","River","River","City","City","City","Rural","River","Rural"],["1","2","3","4","12","10","9","8",null],["positive","positive","negative","positive","negative","positive","negative","positive",null]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>rowname<\/th>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>inds.b<\/th>\n      <th>result<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":9,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[5,6,7]},{"name":"rowname","targets":0},{"name":"gender","targets":1},{"name":"first","targets":2},{"name":"middle","targets":3},{"name":"last","targets":4},{"name":"yr","targets":5},{"name":"mon","targets":6},{"name":"day","targets":7},{"name":"district","targets":8},{"name":"inds.b","targets":9},{"name":"result","targets":10}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Nếu bạn chỉ muốn lấy một trong hai bộ dữ liệu cho các hàng khớp, bạn có thể sử dụng code bên dưới:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="joining-matching.html#cb704-1" tabindex="-1"></a>cases_matched <span class="ot">&lt;-</span> cases[my_matches<span class="sc">$</span>inds.a,]  <span class="co"># Rows in cases that matched to a row in results</span></span>
<span id="cb704-2"><a href="joining-matching.html#cb704-2" tabindex="-1"></a>results_matched <span class="ot">&lt;-</span> results[my_matches<span class="sc">$</span>inds.b,]  <span class="co"># Rows in results that matched to a row in cases</span></span></code></pre></div>
<p>Hoặc, để chỉ xem các hàng <strong>không</strong> khớp::</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="joining-matching.html#cb705-1" tabindex="-1"></a>cases_not_matched <span class="ot">&lt;-</span> cases[<span class="sc">!</span><span class="fu">rownames</span>(cases) <span class="sc">%in%</span> my_matches<span class="sc">$</span>inds.a,]  <span class="co"># Rows in cases that did NOT match to a row in results</span></span>
<span id="cb705-2"><a href="joining-matching.html#cb705-2" tabindex="-1"></a>results_not_matched <span class="ot">&lt;-</span> results[<span class="sc">!</span><span class="fu">rownames</span>(results) <span class="sc">%in%</span> my_matches<span class="sc">$</span>inds.b,]  <span class="co"># Rows in results that did NOT match to a row in cases</span></span></code></pre></div>
</div>
<div id="loại-bỏ-trùng-lặp-theo-xác-suất" class="section level3 unnumbered">
<h3>Loại bỏ trùng lặp theo xác suất</h3>
<p>Khớp theo xác suất cũng có thể được sử dụng để loại bỏ trùng lặp trong một bộ dữ liệu. Xem chương về Loại bỏ trùng lặp để biết các phương pháp loại bỏ trùng lặp khác.</p>
<p>Ở đây chúng ta đã bắt đầu với bộ dữ liệu <code>cases</code>, nhưng bây giờ đang được gọi là <code>cases_dup</code>, vì nó có 2 hàng bổ sung mà có thể là bản trùng lặp của các hàng trước đó: Xem “Tony” với “Anthony”, và “Marialisa Rodrigues” với “Maria Rodriguez”.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5757fe0324eff0a2840b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5757fe0324eff0a2840b">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Chạy <code>fastLink()</code> giống nhu trước, nhưng so sánh data frame <code>cases_dup</code> với chính nó. Khai hai data frames được cung cấp giống hệt nhau, hàm sẽ giả định rằng bạn muốn loại bỏ trùng lặp. Lưu ý rằng chúng ta không chỉ định <code>stringdist.match =</code> hoặc <code>numeric.match =</code> như chúng ta đã làm trước đây.</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="joining-matching.html#cb706-1" tabindex="-1"></a><span class="do">## Run fastLink on the same dataset</span></span>
<span id="cb706-2"><a href="joining-matching.html#cb706-2" tabindex="-1"></a>dedupe_output <span class="ot">&lt;-</span> <span class="fu">fastLink</span>(</span>
<span id="cb706-3"><a href="joining-matching.html#cb706-3" tabindex="-1"></a>  <span class="at">dfA =</span> cases_dup,</span>
<span id="cb706-4"><a href="joining-matching.html#cb706-4" tabindex="-1"></a>  <span class="at">dfB =</span> cases_dup,</span>
<span id="cb706-5"><a href="joining-matching.html#cb706-5" tabindex="-1"></a>  <span class="at">varnames =</span> <span class="fu">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;first&quot;</span>, <span class="st">&quot;middle&quot;</span>, <span class="st">&quot;last&quot;</span>, <span class="st">&quot;yr&quot;</span>, <span class="st">&quot;mon&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;district&quot;</span>)</span>
<span id="cb706-6"><a href="joining-matching.html#cb706-6" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## 
## ==================== 
## fastLink(): Fast Probabilistic Record Linkage
## ==================== 
## 
## If you set return.all to FALSE, you will not be able to calculate a confusion table as a summary statistic.
## dfA and dfB are identical, assuming deduplication of a single data set.
## Setting return.all to FALSE.
## 
## Calculating matches for each variable.
## Getting counts for parameter estimation.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Running the EM algorithm.
## Getting the indices of estimated matches.
##     Parallelizing calculation using OpenMP. 1 threads out of 8 are used.
## Calculating the posterior for each pair of matched observations.
## Getting the match patterns for each estimated match.</code></pre>
<p>Bây giờ, bạn có thể xem xét các bản trùng lặp có thể xảy ra với <code>getMatches()</code>. Cung cấp data frame dưới dạng cả <code>dfA =</code> và <code>dfB =,</code> đồng thời cung cấp kết quả đầu ra của hàm <code>fastLink()</code> là <code>fl.out =</code>. <code>fl.out =</code> phải thuộc nhóm <code>fastLink.dedupe</code>, hay nói cách khác, là kết quả của <code>fastLink()</code>.</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="joining-matching.html#cb708-1" tabindex="-1"></a><span class="do">## Run getMatches()</span></span>
<span id="cb708-2"><a href="joining-matching.html#cb708-2" tabindex="-1"></a>cases_dedupe <span class="ot">&lt;-</span> <span class="fu">getMatches</span>(</span>
<span id="cb708-3"><a href="joining-matching.html#cb708-3" tabindex="-1"></a>  <span class="at">dfA =</span> cases_dup,</span>
<span id="cb708-4"><a href="joining-matching.html#cb708-4" tabindex="-1"></a>  <span class="at">dfB =</span> cases_dup,</span>
<span id="cb708-5"><a href="joining-matching.html#cb708-5" tabindex="-1"></a>  <span class="at">fl.out =</span> dedupe_output)</span></code></pre></div>
<p>Xem cột ngoài cùng bên phải, cột cho biết ID trùng lặp - hai hàng cuối cùng được xác định có thể là trùng lặp ở hàng 2 và 3.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-fa1a11d8c88d70473451" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fa1a11d8c88d70473451">{"x":{"filter":"none","vertical":false,"data":[["M","M","F","F","M","F","M","M","F","M","F"],["Amir","Anthony","Marialisa","Elizabeth","Jose","Cassidy","Michael","Oliver","Blessing","Tony","Maria"],[null,"B.","Contreras","Casteel","Sanchez","Jones","Murphy","Laurent",null,"B.","Contreras"],["Khan","Smith","Rodrigues","Chase","Lopez","Davis","O'Calaghan","De Bordow","Adebayo","Smith","Rodriguez"],[1989,1970,1972,1954,1996,1980,1969,1971,1955,1970,1972],[11,9,4,3,1,7,4,2,2,9,4],[22,19,15,3,6,20,12,4,14,19,15],["River","River","River","City","City","City","Rural","River","Rural","River","River"],[1,2,3,4,5,6,7,8,9,2,3]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>gender<\/th>\n      <th>first<\/th>\n      <th>middle<\/th>\n      <th>last<\/th>\n      <th>yr<\/th>\n      <th>mon<\/th>\n      <th>day<\/th>\n      <th>district<\/th>\n      <th>dedupe.ids<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":11,"columnDefs":[{"className":"dt-right","targets":[4,5,6,8]},{"name":"gender","targets":0},{"name":"first","targets":1},{"name":"middle","targets":2},{"name":"last","targets":3},{"name":"yr","targets":4},{"name":"mon","targets":5},{"name":"day","targets":6},{"name":"district","targets":7},{"name":"dedupe.ids","targets":8}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[10,11,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Để trả về số hàng của những hàng có khả năng trùng lặp, bạn có thể đếm số hàng trên mỗi giá trị duy nhất trong cột <code>dedupe.ids</code>, sau đó lọc để chỉ giữ lại những hàng có nhiều hơn một hàng. Trong trường hợp này, nó để lại hàng 2 và 3.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="joining-matching.html#cb709-1" tabindex="-1"></a>cases_dedupe <span class="sc">%&gt;%</span> </span>
<span id="cb709-2"><a href="joining-matching.html#cb709-2" tabindex="-1"></a>  <span class="fu">count</span>(dedupe.ids) <span class="sc">%&gt;%</span> </span>
<span id="cb709-3"><a href="joining-matching.html#cb709-3" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##   dedupe.ids n
## 1          2 2
## 2          3 2</code></pre>
<p>Để kiểm tra toàn bộ các hàng có khả năng trùng lặp, hãy đặt số hàng trong lệnh này:</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="joining-matching.html#cb711-1" tabindex="-1"></a><span class="co"># displays row 2 and all likely duplicates of it</span></span>
<span id="cb711-2"><a href="joining-matching.html#cb711-2" tabindex="-1"></a>cases_dedupe[cases_dedupe<span class="sc">$</span>dedupe.ids <span class="sc">==</span> <span class="dv">2</span>,]   </span></code></pre></div>
<pre><code>##    gender   first middle  last   yr mon day district dedupe.ids
## 2       M Anthony     B. Smith 1970   9  19    River          2
## 10      M    Tony     B. Smith 1970   9  19    River          2</code></pre>
</div>
</div>
<div id="gắn-vào-và-căn-chỉnh" class="section level2" number="14.4">
<h2><span class="header-section-number">14.4</span> Gắn vào và căn chỉnh</h2>
<p>Một phương pháp khác để kết hợp hai data frame là “ràng buộc” chúng với nhau. Bạn cũng có thể coi đây là hàng hoặc cột được “gắn vào” hoặc “thêm”.</p>
<p>Phần này cũng sẽ thảo luận về cách “căn chỉnh” thứ tự các hàng của một data frame với thứ tự các hàng trong data frame khác. Chủ đề này được thảo luận dưới đây trong phần về Gắn các cột.</p>
<div id="gắn-các-hàng" class="section level3 unnumbered">
<h3>Gắn các hàng</h3>
<p>Để gắn các hàng của một data frame này với phần cuối của một data frame khác, hãy sử dụng <code>bind_rows()</code> từ <strong>dplyr</strong>. Hàm này có tính dung nạp, vì vậy bất kỳ cột nào có trong một trong hai data frame sẽ được đưa vào kết quả đầu ra. Một số lưu ý:</p>
<ul>
<li>Không giống như <code>row.bind()</code> của phiên bản <strong>base</strong> R, <code>bind_rows()</code> của <strong>dplyr</strong> không yêu cầu thứ tự của các cột phải giống nhau trong cả hai data frame. Miễn là các tên cột được viết giống nhau, nó sẽ căn chỉnh chúng một cách chính xác.<br />
</li>
<li>Bạn có thể tùy chọn xác định đối số <code>.id =</code>. Cung cấp một tên cột ký tự. Điều này sẽ tạo ra một cột mới dùng để xác định mỗi hàng ban đầu đến từ data frame nào.<br />
</li>
<li>Bạn có thể sử dụng<code>bind_rows()</code> trên một <code>list</code> các data frame có cấu trúc tương tự để kết hợp chúng thành một. Xem ví dụ trong chương [Lặp, vòng lặp và danh sách] về việc nhập nhiều linelist với <strong>purrr</strong>.</li>
</ul>
<p>Một ví dụ phổ biến về row binding là gắn một hàng “tổng (total)” vào một bảng mô tả được tạo bằng hàm <code>summarise()</code> của <strong>dplyr</strong>. Dưới đây, chúng ta tạo một bảng đếm số trường hợp và giá trị CT trung bình theo bệnh viện với một hàng tổng.</p>
<p>Hàm <code>summarise()</code> được sử dụng trên dữ liệu đã nhóm theo bệnh viện để trả về một data frame tóm tắt theo bệnh viện. Nhưng hàm <code>summarise()</code> không tự động tạo ra hàng “tổng”, vì vậy chúng ta tạo ra nó bằng cách tổng hợp <em>lại</em> dữ liệu, nhưng với dữ liệu không bị nhóm theo bệnh viện. Điều này tạo ra một data frame thứ hai chỉ gồm một hàng. Sau đó, chúng ta có thể liên kết các data frame này với nhau để có được bảng cuối cùng.</p>
<p>Xem các ví dụ hoạt động khác tương tự như thế này trong chương <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a> và <a href="tables-presentation.html#tables-presentation">Trình bày bảng</a>.</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="joining-matching.html#cb713-1" tabindex="-1"></a><span class="co"># Create core table</span></span>
<span id="cb713-2"><a href="joining-matching.html#cb713-2" tabindex="-1"></a><span class="do">###################</span></span>
<span id="cb713-3"><a href="joining-matching.html#cb713-3" tabindex="-1"></a>hosp_summary <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb713-4"><a href="joining-matching.html#cb713-4" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span>                        <span class="co"># Group data by hospital</span></span>
<span id="cb713-5"><a href="joining-matching.html#cb713-5" tabindex="-1"></a>  <span class="fu">summarise</span>(                                    <span class="co"># Create new summary columns of indicators of interest</span></span>
<span id="cb713-6"><a href="joining-matching.html#cb713-6" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),                                  <span class="co"># Number of rows per hospital-outcome group     </span></span>
<span id="cb713-7"><a href="joining-matching.html#cb713-7" tabindex="-1"></a>    <span class="at">ct_value_med =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm=</span>T))     <span class="co"># median CT value per group</span></span></code></pre></div>
<p>Đây là data frame <code>hosp_summary</code>:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e87c901c7eb6d00c9356" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e87c901c7eb6d00c9356">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[22,21,21,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"hospital","targets":0},{"name":"cases","targets":1},{"name":"ct_value_med","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Tạo một data frame với thống kê “tổng” (<em>không bị nhóm theo bệnh viện</em>). Điều này sẽ trả về chỉ một hàng.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="joining-matching.html#cb714-1" tabindex="-1"></a><span class="co"># create totals</span></span>
<span id="cb714-2"><a href="joining-matching.html#cb714-2" tabindex="-1"></a><span class="do">###############</span></span>
<span id="cb714-3"><a href="joining-matching.html#cb714-3" tabindex="-1"></a>totals <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb714-4"><a href="joining-matching.html#cb714-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb714-5"><a href="joining-matching.html#cb714-5" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),                               <span class="co"># Number of rows for whole dataset     </span></span>
<span id="cb714-6"><a href="joining-matching.html#cb714-6" tabindex="-1"></a>    <span class="at">ct_value_med =</span> <span class="fu">median</span>(ct_blood, <span class="at">na.rm=</span>T))  <span class="co"># Median CT for whole dataset</span></span></code></pre></div>
<p>Và dưới đây là data frame <code>totals</code>. Lưu ý cách mà chỉ tạo ra hai cột. Những cột này cũng nằm trong <code>hosp_summary</code>, nhưng có một cột trong <code>hosp_summary</code> mà không nằm trong <code>totals</code> (<code>hospital</code>).</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-4e0fe1dc404c0d6a01b2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4e0fe1dc404c0d6a01b2">{"x":{"filter":"none","vertical":false,"data":[[5888],[22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[0,1]},{"name":"cases","targets":0},{"name":"ct_value_med","targets":1}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Bây giờ chúng ta có thể gắn các hàng với nhau bằng <code>bind_rows()</code>.</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="joining-matching.html#cb715-1" tabindex="-1"></a><span class="co"># Bind data frames together</span></span>
<span id="cb715-2"><a href="joining-matching.html#cb715-2" tabindex="-1"></a>combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(hosp_summary, totals)</span></code></pre></div>
<p>Bây giờ chúng ta có thể xem kết quả. Xem cách mà trong hàng cuối cùng, giá trị <code>NA</code> trống được điền vào cột trong <code>hospital</code> mà không có trong <code>hosp_summary</code>. Như đã giải thích trong chương <a href="tables-presentation.html#tables-presentation">Trình bày bảng</a>, bạn có thể “điền” vào ô này với “Tổng” bằng cách sử dụng <code>replace_na()</code>.</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-5c5e7042361eac92b45c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5c5e7042361eac92b45c">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)",null],[454,896,1469,885,1762,422,5888],[22,21,21,22,22,22,22]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>ct_value_med<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"hospital","targets":0},{"name":"cases","targets":1},{"name":"ct_value_med","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="gắn-các-cột" class="section level3 unnumbered">
<h3>Gắn các cột</h3>
<p>Có một hàm <strong>dplyr</strong> tuơng tự là <code>bind_cols()</code>, hàm mà bạn có thể sử dụng để kết hợp hai data frame theo chiều ngang. Lưu ý rằng các hàng được khớp với nhau theo <em>vị trí</em> (khác với <em>phép nối</em> ở trên) - ví dụ: hàng thứ 12 trong mỗi data frame sẽ được căn chỉnh.</p>
<p>Ví dụ, chúng ta liên kết một số bảng tóm tắt với nhau. Để làm điều này, chúng ta cũng trình bày cách sắp xếp lại thứ tự của các hàng trong một data frame để khớp với thứ tự hàng trong một data frame khác, với <code>match()</code>.</p>
<p>Ở đây chúng ta định nghĩa <code>case_info</code> là một data frame tóm tắt về các trường hợp trong linelist theo bệnh viện, với số trường hợp và số ca tử vong.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="joining-matching.html#cb716-1" tabindex="-1"></a><span class="co"># Case information</span></span>
<span id="cb716-2"><a href="joining-matching.html#cb716-2" tabindex="-1"></a>case_info <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb716-3"><a href="joining-matching.html#cb716-3" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb716-4"><a href="joining-matching.html#cb716-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb716-5"><a href="joining-matching.html#cb716-5" tabindex="-1"></a>    <span class="at">cases =</span> <span class="fu">n</span>(),</span>
<span id="cb716-6"><a href="joining-matching.html#cb716-6" tabindex="-1"></a>    <span class="at">deaths =</span> <span class="fu">sum</span>(outcome <span class="sc">==</span> <span class="st">&quot;Death&quot;</span>, <span class="at">na.rm=</span>T)</span>
<span id="cb716-7"><a href="joining-matching.html#cb716-7" tabindex="-1"></a>  )</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-f72142eca434a81d5640" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f72142eca434a81d5640">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],[454,896,1469,885,1762,422],[193,399,611,395,785,199]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>cases<\/th>\n      <th>deaths<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"name":"hospital","targets":0},{"name":"cases","targets":1},{"name":"deaths","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Và giả sử rằng đây là một data frame <code>contact_fu</code> khác chứa thông tin về phần trăm số liên hệ bị phơi nhiễm được điều tra và “theo dõi”, lại một lần nữa bởi bệnh viện.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="joining-matching.html#cb717-1" tabindex="-1"></a>contact_fu <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb717-2"><a href="joining-matching.html#cb717-2" tabindex="-1"></a>  <span class="at">hospital =</span> <span class="fu">c</span>(<span class="st">&quot;St. Mark&#39;s Maternity Hospital (SMMH)&quot;</span>, <span class="st">&quot;Military Hospital&quot;</span>, <span class="st">&quot;Missing&quot;</span>, <span class="st">&quot;Central Hospital&quot;</span>, <span class="st">&quot;Port Hospital&quot;</span>, <span class="st">&quot;Other&quot;</span>),</span>
<span id="cb717-3"><a href="joining-matching.html#cb717-3" tabindex="-1"></a>  <span class="at">investigated =</span> <span class="fu">c</span>(<span class="st">&quot;80%&quot;</span>, <span class="st">&quot;82%&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;78%&quot;</span>, <span class="st">&quot;64%&quot;</span>, <span class="st">&quot;55%&quot;</span>),</span>
<span id="cb717-4"><a href="joining-matching.html#cb717-4" tabindex="-1"></a>  <span class="at">per_fu =</span> <span class="fu">c</span>(<span class="st">&quot;60%&quot;</span>, <span class="st">&quot;25%&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;20%&quot;</span>, <span class="st">&quot;75%&quot;</span>, <span class="st">&quot;80%&quot;</span>)</span>
<span id="cb717-5"><a href="joining-matching.html#cb717-5" tabindex="-1"></a>)</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-7feef7f20d55a2681aea" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7feef7f20d55a2681aea">{"x":{"filter":"none","vertical":false,"data":[["St. Mark's Maternity Hospital (SMMH)","Military Hospital","Missing","Central Hospital","Port Hospital","Other"],["80%","82%",null,"78%","64%","55%"],["60%","25%",null,"20%","75%","80%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"hospital","targets":0},{"name":"investigated","targets":1},{"name":"per_fu","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Lưu ý rằng các bệnh viện đều như nhau, nhưng theo thứ tự khác nhau trong mỗi data frame. Giải pháp đơn giản nhất là sử dụng <code>left_join()</code> trên cột <code>hospital</code>, nhưng bạn cũng có thể sử dụng <code>bind_cols()</code> với một bước bổ sung.</p>
<div id="sử-dụng-match-để-sắp-xếp-thứ-tự" class="section level4 unnumbered">
<h4>Sử dụng <code>match()</code> để sắp xếp thứ tự</h4>
<p>Do thứ tự hàng khác nhau, một lệnh <code>bind_cols()</code> đơn giản sẽ dẫn đến khớp sai dữ liệu. Để khắc phục điều này, chúng ta có thể sử dụng hàm <code>match()</code> trong <strong>base</strong> R để căn chỉnh các hàng của data frame theo thứ tự giống với thứ tự trong data frame khác. Chúng ta giả định đối với phương pháp này rằng không có giá trị trùng lặp nào trong cả hai data frame.</p>
<p>Khi chúng ta sử dụng <code>match()</code>, với cú pháp là <code>match(TARGET ORDER VECTOR, DATA FRAME COLUMN TO CHANGE)</code>, trong đó đối số đầu tiên là thứ tự mong muốn (hoặc là một vectơ độc lập, hoặc trong trường hợp này là một cột trong data frame), và đối số thứ hai là cột data frame trong data frame mà sẽ được sắp xếp lại. Kết quả đầu ra của <code>match()</code> sẽ là một vectơ số đại diện cho thứ tự vị trí chính xác. Bạn có thể đọc thêm với <code>?match</code>.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="joining-matching.html#cb718-1" tabindex="-1"></a><span class="fu">match</span>(case_info<span class="sc">$</span>hospital, contact_fu<span class="sc">$</span>hospital)</span></code></pre></div>
<pre><code>## [1] 4 2 3 6 5 1</code></pre>
<p>Bạn có thể sử dụng vectơ số này để sắp xếp lại thứ tự data frame - đặt nó trong tập con của dấu ngoặc <code>[ ]</code> <em>trước dấu phẩy</em>. Đọc thêm về cú pháp tập con của dấu ngoặc <strong>base</strong> R trong chương <a href="basics.html#basics">R cơ bản</a>. Lệnh bên dưới tạo ra một data frame mới, được định nghĩa là data frame cũ mà trong đó các hàng được sắp xếp theo thứ tự trong vectơ số ở trên.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="joining-matching.html#cb720-1" tabindex="-1"></a>contact_fu_aligned <span class="ot">&lt;-</span> contact_fu[<span class="fu">match</span>(case_info<span class="sc">$</span>hospital, contact_fu<span class="sc">$</span>hospital),]</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-7137c19ed8aea8cdab7f" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7137c19ed8aea8cdab7f">{"x":{"filter":"none","vertical":false,"data":[["Central Hospital","Military Hospital","Missing","Other","Port Hospital","St. Mark's Maternity Hospital (SMMH)"],["78%","82%",null,"55%","64%","80%"],["20%","25%",null,"80%","75%","60%"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>hospital<\/th>\n      <th>investigated<\/th>\n      <th>per_fu<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"name":"hospital","targets":0},{"name":"investigated","targets":1},{"name":"per_fu","targets":2}],"order":[],"autoWidth":false,"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Bây giờ chúng ta có thể gắn các cột data frame với nhau, với thứ tự hàng chính xác. Lưu ý rằng một số cột bị trùng lặp và sẽ yêu cầu làm sạch bằng <code>rename()</code>. Đọc thêm về <code>bind_rows()</code> <a href="https://dplyr.tidyverse.org/reference/bind.html">tại đây</a>.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="joining-matching.html#cb721-1" tabindex="-1"></a><span class="fu">bind_cols</span>(case_info, contact_fu)</span></code></pre></div>
<pre><code>## New names:
## • `hospital` -&gt; `hospital...1`
## • `hospital` -&gt; `hospital...4`</code></pre>
<pre><code>## # A tibble: 6 × 6
##   hospital...1                         cases deaths hospital...4     investigated per_fu
##   &lt;chr&gt;                                &lt;int&gt;  &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt; 
## 1 Central Hospital                       454    193 St. Mark&#39;s Mate… 80%          60%   
## 2 Military Hospital                      896    399 Military Hospit… 82%          25%   
## 3 Missing                               1469    611 Missing          &lt;NA&gt;         &lt;NA&gt;  
## 4 Other                                  885    395 Central Hospital 78%          20%   
## 5 Port Hospital                         1762    785 Port Hospital    64%          75%   
## 6 St. Mark&#39;s Maternity Hospital (SMMH)   422    199 Other            55%          80%</code></pre>
<p>Một hàm trong <strong>base</strong> R thay thế cho <code>bind_cols</code> là <code>cbind()</code>, hàm này hoạt động tương tự với <code>bind_cols</code>.</p>
<!-- ======================================================= -->
</div>
</div>
</div>
<div id="tài-nguyên-học-liệu-2" class="section level2" number="14.5">
<h2><span class="header-section-number">14.5</span> Tài nguyên học liệu</h2>
<p><a href="https://dplyr.tidyverse.org/reference/join.html">tidyverse page on joins</a></p>
<p><a href="https://r4ds.had.co.nz/relational-data.html">R for Data Science page on relational data</a></p>
<p><a href="https://dplyr.tidyverse.org/reference/bind.html">tidyverse page on dplyr</a> về ràng buộc dữ liệu</p>
<p>Đặc trưng của <a href="https://github.com/kosukeimai/fastLink">fastLink</a> tại trang Github package</p>
<p>Xuất bản mô tả phương pháp luận của <a href="https://imai.fas.harvard.edu/research/files/linkage.pdf">fastLink</a></p>
<p>Xuất bản mô tả <a href="https://journal.r-project.org/archive/2010/RJ-2010-017/RJ-2010-017.pdf">package RecordLinkage</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
