<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>13 Nhóm dữ liệu | Cẩm nang dịch tễ học với R</title>

    <meta name="author" content="the handbook team" />
  
   <meta name="description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="13 Nhóm dữ liệu | Cẩm nang dịch tễ học với R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Nhóm dữ liệu | Cẩm nang dịch tễ học với R" />
  
  <meta name="twitter:description" content="The Epi R Handbook is a R reference manual for applied epidemiology and public health." />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.6.1/transition.js"></script>
    <script src="libs/bs3compat-0.6.1/tabs.js"></script>
    <script src="libs/bs3compat-0.6.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.31/datatables.js"></script>
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
    <link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
    <script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
    <link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
    <script src="libs/selectize-0.12.0/selectize.min.js"></script>
    <link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link href="libs/tabwid-1.1.3/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid-1.1.3/tabwid.js"></script>
    <link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-1.3.1/leaflet.js"></script>
    <link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
    <script src="libs/proj4-2.6.2/proj4.min.js"></script>
    <script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
    <link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
    <script src="libs/leaflet-binding-2.2.1/leaflet.js"></script>
    <script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
    <script src="libs/leaflet-providers-plugin-2.2.1/leaflet-providers-plugin.js"></script>
    <script src="libs/viz-1.8.2/viz.js"></script>
    <link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
    <script src="libs/grViz-binding-1.0.11/grViz.js"></script>
    <script src="libs/d3-4.5.0/d3.min.js"></script>
    <script src="libs/sankey-1/sankey.js"></script>
    <script src="libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
    <script src="libs/plotly-binding-4.10.4/plotly.js"></script>
    <script src="libs/typedarray-0.1/typedarray.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
    <link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
    <script src="libs/vis-9.1.0/vis-network.min.js"></script>
    <script src="libs/visNetwork-binding-2.1.2/visNetwork.js"></script>
    <link href="libs/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="libs/plotly-basic-2.11.1/plotly-basic-2.11.1.min.js"></script>
    <script src="libs/plotly-cartesian-2.11.1/plotly-cartesian-2.11.1.min.js"></script>
    <script src="libs/proj4js-2.3.15/proj4.js"></script>
    <link href="libs/highcharts-9.3.1/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts-9.3.1/highcharts.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-3d.js"></script>
    <script src="libs/highcharts-9.3.1/highcharts-more.js"></script>
    <script src="libs/highcharts-9.3.1/modules/stock.js"></script>
    <script src="libs/highcharts-9.3.1/modules/map.js"></script>
    <script src="libs/highcharts-9.3.1/modules/data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/offline-exporting.js"></script>
    <script src="libs/highcharts-9.3.1/modules/drilldown.js"></script>
    <script src="libs/highcharts-9.3.1/modules/item-series.js"></script>
    <script src="libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts-9.3.1/modules/annotations.js"></script>
    <script src="libs/highcharts-9.3.1/modules/export-data.js"></script>
    <script src="libs/highcharts-9.3.1/modules/funnel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/heatmap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/treemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sankey.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts-9.3.1/modules/organization.js"></script>
    <script src="libs/highcharts-9.3.1/modules/solid-gauge.js"></script>
    <script src="libs/highcharts-9.3.1/modules/streamgraph.js"></script>
    <script src="libs/highcharts-9.3.1/modules/sunburst.js"></script>
    <script src="libs/highcharts-9.3.1/modules/vector.js"></script>
    <script src="libs/highcharts-9.3.1/modules/wordcloud.js"></script>
    <script src="libs/highcharts-9.3.1/modules/xrange.js"></script>
    <script src="libs/highcharts-9.3.1/modules/tilemap.js"></script>
    <script src="libs/highcharts-9.3.1/modules/venn.js"></script>
    <script src="libs/highcharts-9.3.1/modules/gantt.js"></script>
    <script src="libs/highcharts-9.3.1/modules/timeline.js"></script>
    <script src="libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts-9.3.1/modules/bullet.js"></script>
    <script src="libs/highcharts-9.3.1/modules/coloraxis.js"></script>
    <script src="libs/highcharts-9.3.1/modules/dumbbell.js"></script>
    <script src="libs/highcharts-9.3.1/modules/lollipop.js"></script>
    <script src="libs/highcharts-9.3.1/modules/series-label.js"></script>
    <script src="libs/highcharts-9.3.1/plugins/motion.js"></script>
    <script src="libs/highcharts-9.3.1/custom/reset.js"></script>
    <script src="libs/highcharts-9.3.1/modules/boost.js"></script>
    <script src="libs/highchart-binding-0.9.4/highchart.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QXDW878QLX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QXDW878QLX');
    </script>

    <div class="alert alert-info alert-dismissible">
      <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
      <strong>Bạn cần trợ giúp khi học R?</strong> Hãy tham gia <a href="https://www.appliedepi.org/live/" class="alert-link">khóa học</a>, trải nghiệm <a href="https://www.appliedepi.org/tutorial/" class="alert-link">các học phần miễn phí</a>, gửi bài viết <a href="https://community.appliedepi.org/" class="alert-link">trên trang Cộng đồng</a>, hoặc liên hệ <a href="mailto:contact@appliedepi.org" class="alert-link">dịch vụ hỗ trợ của chúng tôi</a>.
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
      <link rel="stylesheet" href="style_bs4.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Cẩm nang dịch tễ học với R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="grouping" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Nhóm dữ liệu</h1>
<p><img src="images/Grouping_1500x500.png" width="100%" /></p>
<p>Chương này trình bày cách nhóm và tổng hợp dữ liệu phục vụ phân tích mô tả. Sử dụng các package trong hệ sinh thái <strong>tidyverse</strong> với các hàm phổ biến và dễ sử dụng.</p>
<p>Nhóm dữ liệu là một cấu phần cốt lõi trong quản lý và phân tích dữ liệu. Dữ liệu được nhóm tổng hợp thống kê theo nhóm và có thể được vẽ biểu đồ theo nhóm. Các hàm từ package <strong>dplyr</strong> (một phần của thư viện <strong>tidyverse</strong>) giúp việc nhóm dữ liệu và các thao tác tiếp theo trở nên dễ dàng hơn.</p>
<p>Chương này sẽ giải quyết các chủ đề sau:</p>
<ul>
<li>Nhóm dữ liệu với hàm <code>group_by()</code><br />
</li>
<li>Gỡ nhóm dữ liệu<br />
</li>
<li><code>summarise()</code> dữ liệu được nhóm với các thống kê<br />
</li>
<li>Sự khác biệt giữa hàm <code>count()</code> và <code>tally()</code><br />
</li>
<li>Ứng dụng hàm <code>arrange()</code> với dữ liệu được nhóm<br />
</li>
<li>Ứng dụng hàm <code>filter()</code> với dữ liệu được nhóm<br />
</li>
<li>Ứng dụng hàm <code>mutate()</code> với dữ liệu được nhóm<br />
</li>
<li>Ứng dụng hàm <code>select()</code> với dữ liệu được nhóm<br />
</li>
<li>Hàm <code>aggregate()</code> trong <strong>base</strong> R như một lựa chọn thay thế</li>
</ul>
<!-- ======================================================= -->
<div id="chuẩn-bị-4" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Chuẩn bị</h2>
<div id="gọi-package-2" class="section level3 unnumbered">
<h3>Gọi package</h3>
<p>Đoạn code này hiển thị cách gọi các package cần thiết cho phân tích. Trong cuốn này, chúng ta nhấn mạnh đến hàm <code>p_load()</code> từ package <strong>pacman</strong>, sẽ cài đặt packahe nếu cần <em>và</em> gọi để sử dụng. Bạn cũng có thể gọi các package đã cài đặt với hàm <code>library()</code> từ <strong>base</strong> R. Xem chương <a href="basics.html#basics">R cơ bản</a> để biết thêm thông tin về các package trong R.</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="grouping.html#cb623-1" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb623-2"><a href="grouping.html#cb623-2" tabindex="-1"></a>  rio,       <span class="co"># to import data</span></span>
<span id="cb623-3"><a href="grouping.html#cb623-3" tabindex="-1"></a>  here,      <span class="co"># to locate files</span></span>
<span id="cb623-4"><a href="grouping.html#cb623-4" tabindex="-1"></a>  tidyverse, <span class="co"># to clean, handle, and plot the data (includes dplyr)</span></span>
<span id="cb623-5"><a href="grouping.html#cb623-5" tabindex="-1"></a>  janitor)   <span class="co"># adding total rows and columns</span></span></code></pre></div>
</div>
<div id="nhập-dữ-liệu-6" class="section level3 unnumbered">
<h3>Nhập dữ liệu</h3>
<p>Chúng ta nhập bộ dữ liệu về các trường hợp mô phỏng từ một vụ dịch Ebola. Nếu bạn muốn cùng thực hành, <a href='https://github.com/appliedepi/epirhandbook_eng/raw/master/data/case_linelists/linelist_cleaned.rds' class='download-button'>bấm vào đây để tải bộ liệu <code>linelist</code> “sạch”</a> (tệp .rds). Bộ dữ liệu được nhập bằng hàm <code>import()</code> từ package <strong>rio</strong>. Xem chương <a href="importing.html#importing">Nhập xuất dữ liệu</a> để biết các cách nhập dữ liệu khác nhau.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="grouping.html#cb624-1" tabindex="-1"></a>linelist <span class="ot">&lt;-</span> <span class="fu">import</span>(<span class="st">&quot;linelist_cleaned.rds&quot;</span>)</span></code></pre></div>
<p>50 hàng đầu tiên của bộ số liệu <code>linelist</code>:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-cbb5f1bdb0f57deb7a11" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cbb5f1bdb0f57deb7a11">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2\" data-max=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399075200000\" data-max=\"1406419200000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1399939200000\" data-max=\"1407024000000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400025600000\" data-max=\"1407110400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"date\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1400371200000\" data-max=\"1410566400000\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"67\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-29&quot;,&quot;30-49&quot;,&quot;50-69&quot;,&quot;70+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;0-4&quot;,&quot;5-9&quot;,&quot;10-14&quot;,&quot;15-19&quot;,&quot;20-24&quot;,&quot;25-29&quot;,&quot;30-34&quot;,&quot;35-39&quot;,&quot;40-44&quot;,&quot;45-49&quot;,&quot;50-54&quot;,&quot;55-59&quot;,&quot;60-64&quot;,&quot;65-69&quot;,&quot;70-74&quot;,&quot;75-79&quot;,&quot;80-84&quot;,&quot;85+&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"-13.2697246824573\" data-max=\"-13.209391925612\" data-scale=\"13\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"8.45171855856465\" data-max=\"8.48802917129884\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"100\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"11\" data-max=\"241\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"20\" data-max=\"24\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"35.9\" data-max=\"38\" data-scale=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"428.994082840237\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"2\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["5fe599","8689b7","11f8ea","b8812a","893f25","be99c8","07e3e8","369449","f393b4","1389ca","2978ac","57a565","fc15ef","2eaa9a","bbfa93","c97dd9","f50e8a","3a7673","7f5a01","ddddee","99e8fa","567136","9371a9","bc2adf","403057","8bd1e8","f327be","42e1a9","90e5fe","959170","8ebf6e","e56412","6d788e","a47529","67be4e","da8ecb","148f18","2cb9a5","f5c142","70a9fe","3ad520","062638","c76676","baacc1","497372","23e499","38cc4a","3789ee","c71dcd","6b70f0"],[4,4,2,3,3,3,4,4,4,4,4,4,6,5,6,9,10,8,7,6,7,6,8,6,10,8,6,12,5,8,7,9,11,5,8,5,6,11,7,9,7,8,9,12,13,9,8,10,8,7],["2014-05-08",null,null,"2014-05-04","2014-05-18","2014-05-03","2014-05-22","2014-05-28",null,null,"2014-05-30","2014-05-28","2014-06-14","2014-06-07","2014-06-09",null,null,null,"2014-06-23","2014-06-18","2014-06-24",null,null,"2014-07-03",null,"2014-07-10","2014-06-14",null,"2014-06-18","2014-06-29","2014-07-02","2014-07-12","2014-07-12","2014-06-13","2014-07-15","2014-06-20",null,null,"2014-07-20",null,"2014-07-12","2014-07-19","2014-07-18","2014-07-18","2014-07-27",null,"2014-07-19","2014-07-26","2014-07-24",null],["2014-05-13","2014-05-13","2014-05-16","2014-05-18","2014-05-21","2014-05-22","2014-05-27","2014-06-02","2014-06-05","2014-06-05","2014-06-06","2014-06-13","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-22","2014-06-23","2014-06-25","2014-06-26","2014-06-28","2014-07-02","2014-07-08","2014-07-09","2014-07-09","2014-07-10","2014-07-12","2014-07-12","2014-07-13","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-22","2014-07-22","2014-07-24","2014-07-24","2014-07-25","2014-07-25","2014-07-27","2014-07-29","2014-07-30",null,"2014-08-01","2014-08-02","2014-08-03"],["2014-05-15","2014-05-14","2014-05-18","2014-05-20","2014-05-22","2014-05-23","2014-05-29","2014-06-03","2014-06-06","2014-06-07","2014-06-08","2014-06-15","2014-06-17","2014-06-17","2014-06-20","2014-06-19","2014-06-23","2014-06-24","2014-06-27","2014-06-28","2014-06-29","2014-07-03","2014-07-09","2014-07-09","2014-07-11","2014-07-11","2014-07-13","2014-07-14","2014-07-14","2014-07-13","2014-07-14","2014-07-17","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-20","2014-07-22","2014-07-24","2014-07-26","2014-07-24","2014-07-27","2014-07-25","2014-07-27","2014-07-31","2014-08-01","2014-08-03","2014-08-02","2014-08-02","2014-08-04"],[null,"2014-05-18","2014-05-30",null,"2014-05-29","2014-05-24","2014-06-01","2014-06-07","2014-06-18","2014-06-09","2014-06-15",null,"2014-07-09",null,"2014-06-30","2014-07-11","2014-07-01","2014-06-25","2014-07-06","2014-07-02","2014-07-09","2014-07-07","2014-07-20",null,"2014-07-22","2014-07-16","2014-07-14","2014-07-20","2014-07-16","2014-07-19","2014-07-27","2014-07-19",null,"2014-07-26","2014-08-14","2014-08-01","2014-07-23","2014-08-28","2014-07-28","2014-07-19",null,"2014-08-03",null,null,null,"2014-08-06","2014-08-21","2014-09-13","2014-08-04",null],[null,"Recover","Recover",null,"Recover","Recover","Recover","Death","Recover","Death","Death","Death","Recover","Recover",null,"Recover",null,null,"Death","Death","Recover",null,null,null,"Death",null,"Death","Death",null,"Death","Recover","Death","Recover","Death","Recover",null,"Death","Recover","Recover","Death",null,null,"Death","Death","Death","Death","Recover",null,"Death","Death"],["m","f","m","f","m","f","f","f","m","f","m","m","m","f","f","m","f","f","f","f","m","m","f","m","f","m","m","f","m","f","f","f","m","m","f","m","f","f","f","m","f","m","f","m","m","f","m","f","m","m"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years","years"],[2,3,56,18,3,16,16,0,61,27,12,42,19,7,7,13,35,17,11,11,19,54,14,28,6,3,31,6,67,14,10,21,20,45,1,12,3,15,20,36,7,13,14,3,10,1,0,20,26,14],["0-4","0-4","50-69","15-19","0-4","15-19","15-19","0-4","50-69","20-29","10-14","30-49","15-19","5-9","5-9","10-14","30-49","15-19","10-14","10-14","15-19","50-69","10-14","20-29","5-9","0-4","30-49","5-9","50-69","10-14","10-14","20-29","20-29","30-49","0-4","10-14","0-4","15-19","20-29","30-49","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-29","20-29","10-14"],["0-4","0-4","55-59","15-19","0-4","15-19","15-19","0-4","60-64","25-29","10-14","40-44","15-19","5-9","5-9","10-14","35-39","15-19","10-14","10-14","15-19","50-54","10-14","25-29","5-9","0-4","30-34","5-9","65-69","10-14","10-14","20-24","20-24","45-49","0-4","10-14","0-4","15-19","20-24","35-39","5-9","10-14","10-14","0-4","10-14","0-4","0-4","20-24","25-29","10-14"],["Other","Missing","St. Mark's Maternity Hospital (SMMH)","Port Hospital","Military Hospital","Port Hospital","Missing","Missing","Missing","Missing","Port Hospital","Military Hospital","Missing","Missing","Other","Port Hospital","Port Hospital","Port Hospital","Missing","Other","Port Hospital","Port Hospital","St. Mark's Maternity Hospital (SMMH)","Missing","Other","Missing","St. Mark's Maternity Hospital (SMMH)","Military Hospital","Port Hospital","Central Hospital","Military Hospital","Central Hospital","Missing","Military Hospital","Other","Missing","Missing","Port Hospital","Port Hospital","Port Hospital","Missing","Central Hospital","Military Hospital","Other","Other","Other","Missing","St. Mark's Maternity Hospital (SMMH)","St. Mark's Maternity Hospital (SMMH)","Missing"],[-13.2157351064963,-13.2152339775486,-13.212910703914,-13.2363711169728,-13.2228638912441,-13.222625321098,-13.2331547837254,-13.2320975453153,-13.2225511595637,-13.2572163655863,-13.2206286746001,-13.253989309478,-13.2385127873491,-13.209391925612,-13.2157278814899,-13.2243437095992,-13.2336087079551,-13.21422143145,-13.2339681355349,-13.2535640411465,-13.2250089377786,-13.2160657166043,-13.2680671272333,-13.2266742923612,-13.2160179088168,-13.2482584611565,-13.2156319199566,-13.2142410663192,-13.2614879104088,-13.2452992638476,-13.2630592726116,-13.2343341712241,-13.2199077448676,-13.2227293309912,-13.2343062806506,-13.218781651651,-13.2483677722899,-13.2097478342339,-13.2680867723786,-13.2587535457526,-13.262635786914,-13.2697246824573,-13.2209026809759,-13.2330734719715,-13.2680923666905,-13.2547212675054,-13.2573683214693,-13.2137356012883,-13.2175973322257,-13.2486407324245],[8.46897295100924,8.45171855856465,8.46481700596819,8.4754761613651,8.46082377490923,8.461830626007281,8.462729314626459,8.461443675342711,8.46191259217774,8.472923276435059,8.48401630165138,8.458371253408441,8.477617055125091,8.47570184950483,8.477799468789719,8.47145134147474,8.478048406853629,8.48528034195779,8.469575303958671,8.45957352078114,8.474048895115439,8.488029171298839,8.473437335922,8.484082637344621,8.46242233645879,8.470268221265719,8.463984474805329,8.464134789434199,8.456230946296071,8.48334624336805,8.47493999153642,8.47832062438022,8.469393389176499,8.48480589906514,8.47121232619015,8.48438437371817,8.484661585743391,8.477141599844281,8.462381270106089,8.455685978131131,8.4632880274758,8.47940722413856,8.46353857052336,8.461789681588639,8.47508713872833,8.458258081280711,8.4532568143863,8.4732571907655,8.479115866419329,8.48480340615605],["f547d6",null,null,"f90f5f","11f8ea","aec8ec","893f25","133ee7",null,null,"996f3a","133ee7","37a6f6","9f6884","4802b1",null,null,null,"a75c7f","8e104d","ab634e",null,null,"b799eb",null,"5d9e4d","a15e13",null,"ea3740","beb26e","567136","894024","36e2e7","a2086d","7baf73","eb2277",null,null,"d6584f",null,"312ecf","52ea64","cfd79c","d145b7","174288",null,"53608c","3b096b","f5c142",null],["other",null,null,"other","other","other","other","other",null,null,"other","other","other","other","other",null,null,null,"other","other","other",null,null,"other",null,"other","other",null,"other","funeral","other","funeral","other","other","other","funeral",null,null,"other",null,"other","other","other","other","other",null,"funeral","other","other",null],[27,25,91,41,36,56,47,0,86,69,67,84,68,44,34,66,78,47,53,47,71,86,53,69,38,46,68,37,100,56,50,57,65,72,29,69,37,48,54,71,47,61,47,35,53,16,13,59,69,67],[48,59,238,135,71,116,87,11,226,174,112,186,174,90,91,152,214,137,117,131,150,241,131,161,80,69,188,66,233,142,110,182,164,214,26,157,39,154,133,168,100,125,123,67,134,31,36,125,183,169],[22,22,21,23,23,21,21,22,22,22,22,22,22,21,23,22,23,21,22,23,21,23,21,24,23,22,24,23,20,24,24,20,24,21,22,21,23,22,23,23,23,22,23,22,22,22,23,22,22,22],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","no","no","no","no","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","no","yes","no",null,"no","no","no","yes","no",null,"no","no","yes",null,null,"no","no",null,"no","no",null,null,"no","no",null,"no","no",null,"no","yes","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","yes","yes","yes","yes","yes","yes","yes","yes","yes",null,"yes","yes","yes","yes","yes",null,"yes","yes","yes",null,null,"yes","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","yes","yes","yes","no",null],["no",null,null,"no","no","no",null,"no","no","no","no","no","no","no","no","yes","no","no",null,"no","no","no","no","no",null,"no","no","no",null,null,"no","no",null,"no","no",null,null,"yes","yes",null,"no","no",null,"no","no","no","no","no","no",null],["yes",null,null,"no","yes","yes",null,"yes","yes","no","yes","no","no","no","yes","no","no","no",null,"no","yes","no","no","no",null,"no","no","no",null,null,"no","yes",null,"yes","yes",null,null,"yes","yes",null,"yes","yes",null,"yes","yes","no","yes","yes","yes",null],[36.8,36.9,36.9,36.8,36.9,37.6,37.3,37,36.4,35.9,36.5,36.9,36.5,37.1,36.5,37.3,37,38,38,36,37,36.7,36.9,36.5,37,36.5,37.6,36.6,36.6,36.2,36.4,37.1,37.5,37.5,37.4,36.9,36.4,37.3,37,37.8,36.5,37.5,36.7,37,37.3,36.6,36.5,36.6,37.6,36.8],[null,"09:36","16:48","11:22","12:60","14:13","14:33","09:25","11:16","10:55","16:03","11:14","12:42","11:06","09:10","08:45",null,"15:41","13:34","18:58","12:43","16:33","14:29","07:18","08:11","16:32","16:17","07:32","17:45",null,"13:24","14:43","02:33","11:36","17:28","16:27",null,"20:49",null,"11:38","14:25","13:42","21:22","13:33","19:06","17:14","20:09",null,"10:23","09:09"],[117.1875,71.81844297615629,16.06524962926347,22.49657064471879,71.41440190438405,41.61712247324614,62.09538908706566,0,16.83765369253662,22.79032897344431,53.41198979591836,24.28026361429067,22.46003435064077,54.32098765432099,41.05784325564545,28.56648199445983,17.03205520132763,25.04129149128882,38.7172182043977,27.3876813705495,31.55555555555556,14.80690759456621,30.88398111998135,26.61934338952972,59.37499999999999,96.61835748792272,19.23947487550928,84.94031221303948,18.41993774061044,27.77226740726046,41.32231404958677,17.20806665861611,24.16716240333135,15.72189710891781,428.9940828402366,27.99302202929125,243.2610124917817,20.23950075898128,30.52744643563797,25.15589569160998,47,39.04,31.06616432017979,77.96836711962574,29.51659612385831,166.4932362122789,100.3086419753086,37.76,20.60378034578518,23.45856237526698],[2,1,2,2,1,1,2,1,1,2,2,2,1,0,2,0,1,1,2,2,1,1,1,0,2,1,1,2,1,0,0,2,1,1,2,2,1,0,2,2,0,2,0,0,2,2,null,1,0,1]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>case_id<\/th>\n      <th>generation<\/th>\n      <th>date_infection<\/th>\n      <th>date_onset<\/th>\n      <th>date_hospitalisation<\/th>\n      <th>date_outcome<\/th>\n      <th>outcome<\/th>\n      <th>gender<\/th>\n      <th>age<\/th>\n      <th>age_unit<\/th>\n      <th>age_years<\/th>\n      <th>age_cat<\/th>\n      <th>age_cat5<\/th>\n      <th>hospital<\/th>\n      <th>lon<\/th>\n      <th>lat<\/th>\n      <th>infector<\/th>\n      <th>source<\/th>\n      <th>wt_kg<\/th>\n      <th>ht_cm<\/th>\n      <th>ct_blood<\/th>\n      <th>fever<\/th>\n      <th>chills<\/th>\n      <th>cough<\/th>\n      <th>aches<\/th>\n      <th>vomit<\/th>\n      <th>temp<\/th>\n      <th>time_admission<\/th>\n      <th>bmi<\/th>\n      <th>days_onset_hosp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":[1,8,10,14,15,18,19,20,26,28,29]},{"name":"case_id","targets":0},{"name":"generation","targets":1},{"name":"date_infection","targets":2},{"name":"date_onset","targets":3},{"name":"date_hospitalisation","targets":4},{"name":"date_outcome","targets":5},{"name":"outcome","targets":6},{"name":"gender","targets":7},{"name":"age","targets":8},{"name":"age_unit","targets":9},{"name":"age_years","targets":10},{"name":"age_cat","targets":11},{"name":"age_cat5","targets":12},{"name":"hospital","targets":13},{"name":"lon","targets":14},{"name":"lat","targets":15},{"name":"infector","targets":16},{"name":"source","targets":17},{"name":"wt_kg","targets":18},{"name":"ht_cm","targets":19},{"name":"ct_blood","targets":20},{"name":"fever","targets":21},{"name":"chills","targets":22},{"name":"cough","targets":23},{"name":"aches","targets":24},{"name":"vomit","targets":25},{"name":"temp","targets":26},{"name":"time_admission","targets":27},{"name":"bmi","targets":28},{"name":"days_onset_hosp","targets":29}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<!-- ======================================================= -->
</div>
</div>
<div id="nhóm" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Nhóm</h2>
<p>Hàm <code>group_by()</code> từ <strong>dplyr</strong> nhóm các hàng theo các giá trị duy nhất trong cột chỉ định. Nếu nhiều cột được chỉ định, các hàng được nhóm theo sự tổ hợp các giá trị thành giá trị duy nhất từ các cột. Mỗi giá trị duy nhất (hoặc tổ hợp các giá trị) tạo thành một nhóm. Những thay đổi sau đó đối với bộ dữ liệu hoặc các phép tính có thể thực hiện tùy theo đặc điểm của mỗi nhóm.</p>
<p>Ví dụ: lệnh bên dưới truy vấn bộ số liệu <code>linelist</code> và nhóm các hàng theo giá trị duy nhất trong cột <code>outcome</code>, lưu kết quả đầu ra dưới dạng bộ dữ liệu mới có tên <code>ll_by_outcome</code>. (Các) cột được nhóm được đặt bên trong dấu ngoặc đơn của hàm <code>group_by()</code>.</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="grouping.html#cb625-1" tabindex="-1"></a>ll_by_outcome <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb625-2"><a href="grouping.html#cb625-2" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome)</span></code></pre></div>
<p><strong>Lưu ý rằng không có thay đổi dễ nhận thấy nào đối với bộ dữ liệu</strong> sau khi chạy lệnh <code>group_by()</code>, <em>cho đến khi</em> phối hợp thêm một số hàm từ <strong>dplyr</strong> khác như <code>mutate()</code>, <code>summarise()</code>, hoặc <code>arrange()</code> trong bộ dữ liệu “đã được nhóm”.</p>
<p>Tuy nhiên, bạn có thể “xem” các nhóm bằng cách in bộ dữ liệu. Khi bạn in một bộ dữ liệu được nhóm, bạn sẽ thấy nó đã được chuyển đổi thành một <a href="https://tibble.tidyverse.org/">đối tượng dạng <code>tibble</code></a>, mà khi được in ra, sẽ hiển thị những nhóm nào đã được áp dụng và có bao nhiêu nhóm - được viết ngay phía trên hàng tiêu đề.</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="grouping.html#cb626-1" tabindex="-1"></a><span class="co"># print to see which groups are active</span></span>
<span id="cb626-2"><a href="grouping.html#cb626-2" tabindex="-1"></a>ll_by_outcome</span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 30
## # Groups:   outcome [3]
##    case_id generation date_infection date_onset date_hospitalisation date_outcome
##    &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;               &lt;date&gt;      
##  1 5fe599           4 2014-05-08     2014-05-13 2014-05-15           NA          
##  2 8689b7           4 NA             2014-05-13 2014-05-14           2014-05-18  
##  3 11f8ea           2 NA             2014-05-16 2014-05-18           2014-05-30  
##  4 b8812a           3 2014-05-04     2014-05-18 2014-05-20           NA          
##  5 893f25           3 2014-05-18     2014-05-21 2014-05-22           2014-05-29  
##  6 be99c8           3 2014-05-03     2014-05-22 2014-05-23           2014-05-24  
##  7 07e3e8           4 2014-05-22     2014-05-27 2014-05-29           2014-06-01  
##  8 369449           4 2014-05-28     2014-06-02 2014-06-03           2014-06-07  
##  9 f393b4           4 NA             2014-06-05 2014-06-06           2014-06-18  
## 10 1389ca           4 NA             2014-06-05 2014-06-07           2014-06-09  
## # ℹ 5,878 more rows
## # ℹ 24 more variables: outcome &lt;chr&gt;, gender &lt;chr&gt;, age &lt;dbl&gt;, age_unit &lt;chr&gt;,
## #   age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, hospital &lt;chr&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;, ct_blood &lt;dbl&gt;,
## #   fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;, vomit &lt;chr&gt;, temp &lt;dbl&gt;,
## #   time_admission &lt;chr&gt;, bmi &lt;dbl&gt;, days_onset_hosp &lt;dbl&gt;</code></pre>
<div id="nhóm-duy-nhất" class="section level3 unnumbered">
<h3>Nhóm duy nhất</h3>
<p><strong>Các nhóm được tạo phản ánh từng tổ hợp giá trị duy nhất dọc theo các cột được sử dụng để nhóm.</strong></p>
<p>Để xem các nhóm <em>và số hàng trong mỗi nhóm</em>, hãy chuyển tiếp dữ liệu được nhóm đến hàm <code>tally()</code>. Nếu chỉ cần xem các nhóm duy nhất mà không cần số lượng, bạn có thể sử dụng hàm <code>group_keys()</code>.</p>
<p>Dưới đây là ba giá trị duy nhất trong cột được nhóm là <code>outcome</code>: “Death”, “Recover”, và <code>NA</code>. Ta thấy rằng đã có <code>nrow(linelist %&gt;% filter(outcome == "Death"))</code> tử vong, <code>nrow(linelist %&gt;% filter(outcome == "Recover"))</code> hồi phục, và <code>nrow(linelist %&gt;% filter(is.na(outcome)))</code> không có outcome nào được ghi nhận.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="grouping.html#cb628-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb628-2"><a href="grouping.html#cb628-2" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb628-3"><a href="grouping.html#cb628-3" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
<p>Bạn có thể nhóm nhiều hơn một cột. Dưới đây, bộ dữ liệu được nhóm theo <code>outcome</code> và <code>gender</code>, sau đó được đánh số. Lưu ý cách mỗi kết hợp duy nhất của <code>outcome</code> và <code>gender</code> được tổ hợp thành nhóm riêng - bao gồm cả các giá trị bị thiếu ở một trong hai cột.</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="grouping.html#cb630-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb630-2"><a href="grouping.html#cb630-2" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome, gender) <span class="sc">%&gt;%</span> </span>
<span id="cb630-3"><a href="grouping.html#cb630-3" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 9 × 3
## # Groups:   outcome [3]
##   outcome gender     n
##   &lt;chr&gt;   &lt;chr&gt;  &lt;int&gt;
## 1 Death   f       1227
## 2 Death   m       1228
## 3 Death   &lt;NA&gt;     127
## 4 Recover f        953
## 5 Recover m        950
## 6 Recover &lt;NA&gt;      80
## 7 &lt;NA&gt;    f        627
## 8 &lt;NA&gt;    m        625
## 9 &lt;NA&gt;    &lt;NA&gt;      71</code></pre>
</div>
<div id="cột-mới" class="section level3 unnumbered">
<h3>Cột mới</h3>
<p>Bạn cũng có thể tạo một cột mới dùng để nhóm <em>trong</em> câu lệnh <code>group_by()</code>. Điều này tương đương với việc sử dụng hàm <code>mutate()</code> trước khi sử dụng hàm <code>group_by()</code>. Để tạo cột nhanh, cách này có thể hữu ích, nhưng để rõ ràng hơn trong code của bạn, hãy cân nhắc cách tạo cột này ở bước <code>mutate()</code> và sau đó chuyển tiếp đến hàm <code>group_by()</code>.</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="grouping.html#cb632-1" tabindex="-1"></a><span class="co"># group dat based on a binary column created *within* the group_by() command</span></span>
<span id="cb632-2"><a href="grouping.html#cb632-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb632-3"><a href="grouping.html#cb632-3" tabindex="-1"></a>  <span class="fu">group_by</span>(</span>
<span id="cb632-4"><a href="grouping.html#cb632-4" tabindex="-1"></a>    <span class="at">age_class =</span> <span class="fu">ifelse</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>, <span class="st">&quot;adult&quot;</span>, <span class="st">&quot;child&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb632-5"><a href="grouping.html#cb632-5" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">sort =</span> T)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   age_class     n
##   &lt;chr&gt;     &lt;int&gt;
## 1 child      3618
## 2 adult      2184
## 3 &lt;NA&gt;         86</code></pre>
</div>
<div id="thêmbỏ-cột-được-nhóm" class="section level3 unnumbered">
<h3>Thêm/bỏ cột được nhóm</h3>
<p>Mặc định, nếu bạn chạy lệnh <code>group_by()</code> trên dữ liệu đã được nhóm, các nhóm cũ sẽ bị xóa và (các) nhóm mới sẽ được áp dụng. Nếu bạn muốn thêm nhóm mới vào nhóm hiện có, hãy thêm đối số <code>.add = TRUE</code>.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="grouping.html#cb634-1" tabindex="-1"></a><span class="co"># Grouped by outcome</span></span>
<span id="cb634-2"><a href="grouping.html#cb634-2" tabindex="-1"></a>by_outcome <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb634-3"><a href="grouping.html#cb634-3" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome)</span>
<span id="cb634-4"><a href="grouping.html#cb634-4" tabindex="-1"></a></span>
<span id="cb634-5"><a href="grouping.html#cb634-5" tabindex="-1"></a><span class="co"># Add grouping by gender in addition</span></span>
<span id="cb634-6"><a href="grouping.html#cb634-6" tabindex="-1"></a>by_outcome_gender <span class="ot">&lt;-</span> by_outcome <span class="sc">%&gt;%</span> </span>
<span id="cb634-7"><a href="grouping.html#cb634-7" tabindex="-1"></a>  <span class="fu">group_by</span>(gender, <span class="at">.add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
</div>
<div id="giữ-tất-cả-các-nhóm" class="section level2" number="13.3">
<h2><span class="header-section-number">13.3</span> Giữ tất cả các nhóm</h2>
<p>Nếu bạn nhóm trên một cột dạng factor, có thể có các thứ bậc của factor mà không có trong dữ liệu. Nếu bạn nhóm trên cột này, mặc định, những thứ bậc không có trong dữ liệu đó sẽ bị loại bỏ và không thuộc dạng nhóm. Để thay đổi điều này để tất cả các thứ bậc xuất hiện dưới dạng nhóm (ngay cả khi không có trong dữ liệu), đặt <code>.drop = FALSE</code> trong lệnh <code>group_by()</code>.</p>
</div>
<div id="loại-bỏ-nhóm" class="section level2" number="13.4">
<h2><span class="header-section-number">13.4</span> Loại bỏ nhóm</h2>
<p>Dữ liệu đã được nhóm sẽ vẫn được nhóm cho đến khi hủy nhóm bởi lệnh <code>ungroup()</code>. Nếu bạn quên hủy nhóm, nó có thể gây ra tính toán không chính xác! Dưới đây là ví dụ về việc loại bỏ tất cả các nhóm:</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="grouping.html#cb635-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb635-2"><a href="grouping.html#cb635-2" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome, gender) <span class="sc">%&gt;%</span> </span>
<span id="cb635-3"><a href="grouping.html#cb635-3" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-4"><a href="grouping.html#cb635-4" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Bạn cũng có thể loại bỏ nhóm với các cột cụ thể, bằng cách đặt tên cột bên trong lệnh <code>ungroup()</code>.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="grouping.html#cb636-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb636-2"><a href="grouping.html#cb636-2" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome, gender) <span class="sc">%&gt;%</span> </span>
<span id="cb636-3"><a href="grouping.html#cb636-3" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb636-4"><a href="grouping.html#cb636-4" tabindex="-1"></a>  <span class="fu">ungroup</span>(gender) <span class="co"># remove the grouping by gender, leave grouping by outcome</span></span></code></pre></div>
<p><span style="color: black;"><strong><em>GHI CHÚ</em></strong>: Hàm <code>count()</code> tự động hủy nhóm dữ liệu sau khi đếm.</span></p>
</div>
<div id="group_summarise" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> Tổng hợp</h2>
<p>Xem package <strong>dplyr</strong> trong chương <a href="tables-descriptive.html#tables-descriptive">Bảng mô tả</a> để biết mô tả chi tiết về cách tạo bảng tổng hợp với hàm <code>summarise()</code>. Ở đây chúng ta giải quyết ngắn gọn cách hoạt động thay đổi khi áp dụng cho dữ liệu được nhóm.</p>
<p>Hàm <strong>dplyr</strong> <code>summarise()</code> (hoặc <code>summarize()</code>) lấy một data frame và chuyển nó thành một data frame tổng hợp <em>mới</em>, với các cột chứa thông tin các giá trị thống kê do bạn xác định. Trên bộ dữ liệu chưa nhóm, các tổng hợp thống kê sẽ được tính toán từ tất cả các hàng. Việc áp dụng hàm <code>summarise()</code> vào dữ liệu được nhóm sẽ tổng hợp những giá trị thống kê cho từng nhóm.</p>
<p>Cú pháp của hàm <code>summarise()</code> là bạn cung cấp tên của (các) cột tổng hợp mới, một dấu bằng và sau đó là một hàm thống kê để áp dụng cho dữ liệu, như được trình bày bên dưới. Ví dụ: <code>min()</code>, <code>max()</code>, <code>median()</code>, hoặc <code>sd()</code>. Trong hàm thống kê, hãy liệt kê cột sẽ được áp dụng và bất kỳ đối số nào có liên quan (ví dụ: <code>na.rm = TRUE</code>). Bạn có thể sử dụng hàm <code>sum()</code> để đếm số hàng đáp ứng tiêu chí logic (với dấu bằng kép <code>==</code>).</p>
<p>Dưới đây là một ví dụ về hàm <code>summarise()</code> được áp dụng mà <em>không có dữ liệu được nhóm</em>. Các giá trị thống kê trả về được tạo ra từ toàn bộ bộ dữ liệu.</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="grouping.html#cb637-1" tabindex="-1"></a><span class="co"># summary statistics on ungrouped linelist</span></span>
<span id="cb637-2"><a href="grouping.html#cb637-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb637-3"><a href="grouping.html#cb637-3" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb637-4"><a href="grouping.html#cb637-4" tabindex="-1"></a>    <span class="at">n_cases  =</span> <span class="fu">n</span>(),</span>
<span id="cb637-5"><a href="grouping.html#cb637-5" tabindex="-1"></a>    <span class="at">mean_age =</span> <span class="fu">mean</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb637-6"><a href="grouping.html#cb637-6" tabindex="-1"></a>    <span class="at">max_age  =</span> <span class="fu">max</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb637-7"><a href="grouping.html#cb637-7" tabindex="-1"></a>    <span class="at">min_age  =</span> <span class="fu">min</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb637-8"><a href="grouping.html#cb637-8" tabindex="-1"></a>    <span class="at">n_males  =</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span>, <span class="at">na.rm=</span>T))</span></code></pre></div>
<pre><code>##   n_cases mean_age max_age min_age n_males
## 1    5888 16.01831      84       0    2803</code></pre>
<p>Ngược lại, bên dưới là câu lệnh <code>summarise()</code> tương tự được áp dụng cho dữ liệu được nhóm. Các số liệu thống kê được tính toán cho từng nhóm kết quả. Lưu ý cách các cột dùng để nhóm sẽ chuyển sang data frame mới.</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="grouping.html#cb639-1" tabindex="-1"></a><span class="co"># summary statistics on grouped linelist</span></span>
<span id="cb639-2"><a href="grouping.html#cb639-2" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb639-3"><a href="grouping.html#cb639-3" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb639-4"><a href="grouping.html#cb639-4" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb639-5"><a href="grouping.html#cb639-5" tabindex="-1"></a>    <span class="at">n_cases  =</span> <span class="fu">n</span>(),</span>
<span id="cb639-6"><a href="grouping.html#cb639-6" tabindex="-1"></a>    <span class="at">mean_age =</span> <span class="fu">mean</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb639-7"><a href="grouping.html#cb639-7" tabindex="-1"></a>    <span class="at">max_age  =</span> <span class="fu">max</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb639-8"><a href="grouping.html#cb639-8" tabindex="-1"></a>    <span class="at">min_age  =</span> <span class="fu">min</span>(age_years, <span class="at">na.rm=</span>T),</span>
<span id="cb639-9"><a href="grouping.html#cb639-9" tabindex="-1"></a>    <span class="at">n_males    =</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span>, <span class="at">na.rm=</span>T))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##   outcome n_cases mean_age max_age min_age n_males
##   &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;
## 1 Death      2582     15.9      76       0    1228
## 2 Recover    1983     16.1      84       0     950
## 3 &lt;NA&gt;       1323     16.2      69       0     625</code></pre>
<p><span style="color: darkgreen;"><strong><em>MẸO</em></strong>: Hàm tổng hợp hoạt động với cả cách viết của kiểu Anh và Mỹ - <code>summarise()</code> và <code>summarize()</code> đều chỉ định cùng cùng một hàm.</span></p>
</div>
<div id="counts-và-tallies" class="section level2" number="13.6">
<h2><span class="header-section-number">13.6</span> Counts và tallies</h2>
<p><code>count()</code> và <code>tally()</code> đều cung cấp tính năng tương tự nhưng thực chất là khác nhau. Đọc thêm về sự khác biệt giữa <code>tally()</code> và <code>count()</code> <a href="https://dplyr.tidyverse.org/reference/tally.html">tại đây</a>.</p>
<div id="tally" class="section level3 unnumbered">
<h3><code>tally()</code></h3>
<p><code>tally()</code> là viết tắt của <code>summarise(n = n())</code> và <em>không</em> nhóm dữ liệu. Do đó, để có thể kiểm đếm theo nhóm, nó phải theo sau lệnh <code>group_by()</code>. Bạn có thể thêm <code>sort = TRUE</code> để xem các nhóm lớn nhất trước tiên.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="grouping.html#cb641-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb641-2"><a href="grouping.html#cb641-2" tabindex="-1"></a>  <span class="fu">tally</span>()</span></code></pre></div>
<pre><code>##      n
## 1 5888</code></pre>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="grouping.html#cb643-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb643-2"><a href="grouping.html#cb643-2" tabindex="-1"></a>  <span class="fu">group_by</span>(outcome) <span class="sc">%&gt;%</span> </span>
<span id="cb643-3"><a href="grouping.html#cb643-3" tabindex="-1"></a>  <span class="fu">tally</span>(<span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   outcome     n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Death    2582
## 2 Recover  1983
## 3 &lt;NA&gt;     1323</code></pre>
</div>
<div id="count" class="section level3 unnumbered">
<h3><code>count()</code></h3>
<p>Ngược lại, hàm <code>count()</code> hoạt động như sau:</p>
<ol style="list-style-type: decimal">
<li>Áp dụng <code>group_by()</code> trên (các) cột đã chỉ định<br />
</li>
<li>Áp dụng <code>summarise()</code> và trả về cột <code>n</code> với số lượng dòng mỗi nhóm<br />
</li>
<li>Áp dụng <code>ungroup()</code></li>
</ol>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="grouping.html#cb645-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb645-2"><a href="grouping.html#cb645-2" tabindex="-1"></a>  <span class="fu">count</span>(outcome)</span></code></pre></div>
<pre><code>##   outcome    n
## 1   Death 2582
## 2 Recover 1983
## 3    &lt;NA&gt; 1323</code></pre>
<p>Cũng giống như với hàm <code>group_by()</code>, bạn có thể tạo một cột mới trong lệnh <code>count()</code>:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="grouping.html#cb647-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb647-2"><a href="grouping.html#cb647-2" tabindex="-1"></a>  <span class="fu">count</span>(<span class="at">age_class =</span> <span class="fu">ifelse</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>, <span class="st">&quot;adult&quot;</span>, <span class="st">&quot;child&quot;</span>), <span class="at">sort =</span> T)</span></code></pre></div>
<pre><code>##   age_class    n
## 1     child 3618
## 2     adult 2184
## 3      &lt;NA&gt;   86</code></pre>
<p><code>count()</code> có thể được sử dụng nhiều lần, với tính năng “cuộn lên”. Ví dụ: để tổng hợp số lượng bệnh viện hiện có cho mỗi giới tính, hãy chạy lệnh như sau. Lưu ý, tên của cột cuối cùng đã được thay đổi từ tên mặc định là “n” để cho rõ ràng (với <code>name  =</code>).</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="grouping.html#cb649-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb649-2"><a href="grouping.html#cb649-2" tabindex="-1"></a>  <span class="co"># produce counts by unique outcome-gender groups</span></span>
<span id="cb649-3"><a href="grouping.html#cb649-3" tabindex="-1"></a>  <span class="fu">count</span>(gender, hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb649-4"><a href="grouping.html#cb649-4" tabindex="-1"></a>  <span class="co"># gather rows by gender (3) and count number of hospitals per gender (6)</span></span>
<span id="cb649-5"><a href="grouping.html#cb649-5" tabindex="-1"></a>  <span class="fu">count</span>(gender, <span class="at">name =</span> <span class="st">&quot;hospitals per gender&quot;</span> ) </span></code></pre></div>
<pre><code>##   gender hospitals per gender
## 1      f                    6
## 2      m                    6
## 3   &lt;NA&gt;                    6</code></pre>
</div>
<div id="thêm-giá-trị-đếm" class="section level3 unnumbered">
<h3>Thêm giá trị đếm</h3>
<p>Ngược lại với <code>count()</code> và <code>summarise()</code>, bạn có thể sử dụng <code>add_count()</code> để <em>thêm</em> một cột mới <code>n</code> với số lượng hàng cho mỗi nhóm <em>trong khi vẫn giữ lại tất cả các cột khác trong dữ liệu</em>.</p>
<p>Điều này có nghĩa là số lượng của nhóm, trong cột mới <code>n</code>, sẽ được in ra trong mỗi hàng của nhóm. Với mục đích minh họa, chúng tôi thêm cột này và sau đó sắp xếp lại các cột để dễ xem hơn. Xem mục bên dưới về <a href="grouping.html#group_filter_grp_size">bộ lọc theo kích thước nhóm</a> để biết một ví dụ khác.</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="grouping.html#cb651-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb651-2"><a href="grouping.html#cb651-2" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span>                   <span class="co"># convert to tibble for nicer printing </span></span>
<span id="cb651-3"><a href="grouping.html#cb651-3" tabindex="-1"></a>  <span class="fu">add_count</span>(hospital) <span class="sc">%&gt;%</span>           <span class="co"># add column n with counts by hospital</span></span>
<span id="cb651-4"><a href="grouping.html#cb651-4" tabindex="-1"></a>  <span class="fu">select</span>(hospital, n, <span class="fu">everything</span>()) <span class="co"># re-arrange for demo purposes</span></span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 31
##    hospital          n case_id generation date_infection date_onset date_hospitalisation
##    &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;              
##  1 Other           885 5fe599           4 2014-05-08     2014-05-13 2014-05-15          
##  2 Missing        1469 8689b7           4 NA             2014-05-13 2014-05-14          
##  3 St. Mark&#39;s M…   422 11f8ea           2 NA             2014-05-16 2014-05-18          
##  4 Port Hospital  1762 b8812a           3 2014-05-04     2014-05-18 2014-05-20          
##  5 Military Hos…   896 893f25           3 2014-05-18     2014-05-21 2014-05-22          
##  6 Port Hospital  1762 be99c8           3 2014-05-03     2014-05-22 2014-05-23          
##  7 Missing        1469 07e3e8           4 2014-05-22     2014-05-27 2014-05-29          
##  8 Missing        1469 369449           4 2014-05-28     2014-06-02 2014-06-03          
##  9 Missing        1469 f393b4           4 NA             2014-06-05 2014-06-06          
## 10 Missing        1469 1389ca           4 NA             2014-06-05 2014-06-07          
## # ℹ 5,878 more rows
## # ℹ 24 more variables: date_outcome &lt;date&gt;, outcome &lt;chr&gt;, gender &lt;chr&gt;, age &lt;dbl&gt;,
## #   age_unit &lt;chr&gt;, age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;, ct_blood &lt;dbl&gt;,
## #   fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;, vomit &lt;chr&gt;, temp &lt;dbl&gt;,
## #   time_admission &lt;chr&gt;, bmi &lt;dbl&gt;, days_onset_hosp &lt;dbl&gt;</code></pre>
</div>
<div id="thêm-giá-trị-tổng" class="section level3 unnumbered">
<h3>Thêm giá trị tổng</h3>
<p>Để dễ dàng thêm <em>tổng</em> các hàng hoặc cột sau khi sử dụng <code>tally()</code> hoặc <code>count()</code>, hãy xem mục <strong>janitor</strong> trong chương <a href="tables-descriptive.html#tbl_janitor">Bảng mô tả</a>. Package này cung cấp các hàm như <code>adorn_totals()</code> và <code>adorn_percentages()</code> để thêm tổng và chuyển đổi sang hiển thị tỷ lệ phần trăm. Dưới đây là một ví dụ ngắn gọn:</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb653-1"><a href="grouping.html#cb653-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span>                                  <span class="co"># case linelist</span></span>
<span id="cb653-2"><a href="grouping.html#cb653-2" tabindex="-1"></a>  <span class="fu">tabyl</span>(age_cat, gender) <span class="sc">%&gt;%</span>                  <span class="co"># cross-tabulate counts of two columns</span></span>
<span id="cb653-3"><a href="grouping.html#cb653-3" tabindex="-1"></a>  <span class="fu">adorn_totals</span>(<span class="at">where =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span>             <span class="co"># add a total row</span></span>
<span id="cb653-4"><a href="grouping.html#cb653-4" tabindex="-1"></a>  <span class="fu">adorn_percentages</span>(<span class="at">denominator =</span> <span class="st">&quot;col&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># convert to proportions with column denominator</span></span>
<span id="cb653-5"><a href="grouping.html#cb653-5" tabindex="-1"></a>  <span class="fu">adorn_pct_formatting</span>() <span class="sc">%&gt;%</span>                  <span class="co"># convert proportions to percents</span></span>
<span id="cb653-6"><a href="grouping.html#cb653-6" tabindex="-1"></a>  <span class="fu">adorn_ns</span>(<span class="at">position =</span> <span class="st">&quot;front&quot;</span>) <span class="sc">%&gt;%</span>            <span class="co"># display as: &quot;count (percent)&quot;</span></span>
<span id="cb653-7"><a href="grouping.html#cb653-7" tabindex="-1"></a>  <span class="fu">adorn_title</span>(                                <span class="co"># adjust titles</span></span>
<span id="cb653-8"><a href="grouping.html#cb653-8" tabindex="-1"></a>    <span class="at">row_name =</span> <span class="st">&quot;Age Category&quot;</span>,</span>
<span id="cb653-9"><a href="grouping.html#cb653-9" tabindex="-1"></a>    <span class="at">col_name =</span> <span class="st">&quot;Gender&quot;</span>)</span></code></pre></div>
<pre><code>##                       Gender                            
##  Age Category              f              m          NA_
##           0-4   640  (22.8%)   416  (14.8%)  39  (14.0%)
##           5-9   641  (22.8%)   412  (14.7%)  42  (15.1%)
##         10-14   518  (18.5%)   383  (13.7%)  40  (14.4%)
##         15-19   359  (12.8%)   364  (13.0%)  20   (7.2%)
##         20-29   468  (16.7%)   575  (20.5%)  30  (10.8%)
##         30-49   179   (6.4%)   557  (19.9%)  18   (6.5%)
##         50-69     2   (0.1%)    91   (3.2%)   2   (0.7%)
##           70+     0   (0.0%)     5   (0.2%)   1   (0.4%)
##          &lt;NA&gt;     0   (0.0%)     0   (0.0%)  86  (30.9%)
##         Total 2,807 (100.0%) 2,803 (100.0%) 278 (100.0%)</code></pre>
<p>Để thêm các hàng tổng phức tạp hơn bao gồm các thống kê tổng hợp khác, hãy xem <a href="tables-descriptive.html#tbl_dplyr_totals">mục sau trong chương Bảng mô tả</a>.</p>
</div>
</div>
<div id="nhóm-theo-ngày" class="section level2" number="13.7">
<h2><span class="header-section-number">13.7</span> Nhóm theo ngày</h2>
<p>Khi nhóm dữ liệu theo ngày, bạn phải có (hoặc tạo) một cột cho đơn vị ngày quan tâm - ví dụ: “ngày”, “tuần dịch tễ”, “tháng”, v.v. Bạn có thể tạo cột này bằng cách sử dụng <code>floor_date()</code> từ <strong>lubridate</strong>, như được giải thích trong phần <a href="dates.html#dates_epi_wks">Tuần dịch tễ học</a> trong chương <a href="dates.html#dates">Làm việc với ngày tháng</a>. Khi bạn có cột này, bạn có thể sử dụng <code>count()</code> từ <strong>dplyr</strong> để nhóm các hàng theo các giá trị ngày duy nhất đó và thu về giá trị số lượng tổng hợp.</p>
<p>Một bước bổ sung phổ biến cho các tình huống với ngày/tháng, là “điền vào” bất kỳ ngày nào trong chuỗi ngày không có trong dữ liệu. Sử dụng <code>complete()</code> từ <strong>tidyr</strong> để chuỗi ngày tổng hợp được <em>hoàn chỉnh</em> bao gồm <em>tất cả các đơn vị ngày có thể có</em> trong phạm vi. Nếu không có bước này, một tuần không có trường hợp nào được báo cáo có thể không xuất hiện trong dữ liệu của bạn!</p>
<p>Trong <code>complete()</code>, bạn <em>xác định lại</em> cột ngày của mình dưới dạng một <em>chuỗi</em> ngày <code>seq.Date()</code> từ giá trị nhỏ nhất đến giá trị lớn nhất - do đó mà ngày/tháng được mở rộng. Mặc định, giá trị số lượng trong bất kỳ hàng “mở rộng” mới nào sẽ là <code>NA</code>. Bạn có thể đặt chúng thành 0 bằng cách sử dụng argument <code>fill =</code> của hàm <code>complete()</code>, trong đó yêu cầu một danh sách được đặt tên (nếu cột số lượng của bạn được đặt tên là <code>n</code>, hãy thêm <code>fill = list(n = 0)</code>). Xem <code>?complete</code> để biết chi tiết và xem ví dụ trong chương <a href="dates.html#dates_epi_wks">Làm việc với ngày tháng</a>.</p>
<div id="các-trường-hợp-trong-linelist-theo-ngày" class="section level3 unnumbered">
<h3>Các trường hợp trong <code>linelist</code> theo ngày</h3>
<p>Dưới đây là một ví dụ về nhóm các trường hợp theo ngày mà <em>không</em> sử dụng <code>complete()</code>. Lưu ý các hàng đầu tiên bỏ qua các ngày mà không có trường hợp nào.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="grouping.html#cb655-1" tabindex="-1"></a>daily_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb655-2"><a href="grouping.html#cb655-2" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span>        <span class="co"># remove that were missing date_onset</span></span>
<span id="cb655-3"><a href="grouping.html#cb655-3" tabindex="-1"></a>  <span class="fu">count</span>(date_onset)              <span class="co"># count number of rows per unique date</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-00d59dfdd4d506fc5fe1" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-00d59dfdd4d506fc5fe1">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-10","2014-05-11","2014-05-12","2014-05-13","2014-05-14","2014-05-16","2014-05-17","2014-05-18","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-24","2014-05-25","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-05-31","2014-06-02","2014-06-03","2014-06-05","2014-06-06","2014-06-07","2014-06-08","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-14","2014-06-15","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-22","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-22","2014-07-23","2014-07-24","2014-07-25","2014-07-26","2014-07-27","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-09","2014-08-10","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-08","2014-09-09","2014-09-10","2014-09-11","2014-09-12","2014-09-13","2014-09-14","2014-09-15","2014-09-16","2014-09-17","2014-09-18","2014-09-19","2014-09-20","2014-09-21","2014-09-22","2014-09-23","2014-09-24","2014-09-25","2014-09-26","2014-09-27","2014-09-28","2014-09-29","2014-09-30","2014-10-01","2014-10-02","2014-10-03","2014-10-04","2014-10-05","2014-10-06","2014-10-07","2014-10-08","2014-10-09","2014-10-10","2014-10-11","2014-10-12","2014-10-13","2014-10-14","2014-10-15","2014-10-16","2014-10-17","2014-10-18","2014-10-19","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-25","2014-10-26","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-01","2014-11-02","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-08","2014-11-09","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-15","2014-11-16","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-22","2014-11-23","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28","2014-11-29","2014-11-30","2014-12-01","2014-12-02","2014-12-03","2014-12-04","2014-12-05","2014-12-06","2014-12-07","2014-12-08","2014-12-09","2014-12-10","2014-12-11","2014-12-12","2014-12-13","2014-12-14","2014-12-15","2014-12-16","2014-12-17","2014-12-18","2014-12-19","2014-12-20","2014-12-21","2014-12-22","2014-12-23","2014-12-24","2014-12-25","2014-12-26","2014-12-27","2014-12-28","2014-12-29","2014-12-30","2014-12-31","2015-01-01","2015-01-02","2015-01-03","2015-01-04","2015-01-05","2015-01-06","2015-01-07","2015-01-08","2015-01-09","2015-01-10","2015-01-11","2015-01-12","2015-01-13","2015-01-14","2015-01-15","2015-01-16","2015-01-17","2015-01-18","2015-01-19","2015-01-20","2015-01-21","2015-01-22","2015-01-23","2015-01-24","2015-01-25","2015-01-26","2015-01-27","2015-01-28","2015-01-29","2015-01-30","2015-01-31","2015-02-01","2015-02-02","2015-02-03","2015-02-04","2015-02-05","2015-02-06","2015-02-07","2015-02-08","2015-02-09","2015-02-10","2015-02-11","2015-02-12","2015-02-13","2015-02-14","2015-02-15","2015-02-16","2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-21","2015-02-22","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-02-28","2015-03-01","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-07","2015-03-08","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-14","2015-03-15","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-21","2015-03-22","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-28","2015-03-29","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-03","2015-04-04","2015-04-05","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-11","2015-04-12","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-18","2015-04-19","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-25","2015-04-26","2015-04-27","2015-04-28","2015-04-29","2015-04-30"],[1,1,2,1,1,1,2,1,1,1,3,2,2,2,1,1,2,3,3,2,3,4,2,1,3,1,2,1,3,3,10,1,1,1,2,5,3,4,4,5,1,5,5,3,1,1,2,5,6,4,2,3,7,3,4,2,6,5,3,1,2,2,6,4,3,5,6,5,3,3,7,7,5,4,6,6,10,10,6,6,10,7,11,4,6,11,9,10,7,12,6,15,14,8,9,16,13,18,18,9,9,9,10,13,17,7,17,12,17,31,13,14,14,19,17,26,19,25,21,16,24,23,25,25,22,27,25,28,30,22,33,30,36,33,23,31,27,30,42,40,50,37,38,38,49,52,35,50,37,38,33,33,39,39,45,34,44,29,40,50,41,39,35,28,36,34,37,36,36,34,43,28,38,33,37,29,33,44,43,24,37,30,35,24,37,44,34,40,30,34,26,29,33,31,22,26,26,19,30,24,29,24,21,19,11,22,20,23,32,33,28,15,20,24,18,20,19,22,17,32,21,20,23,17,15,18,20,19,18,21,18,16,20,15,18,15,18,18,15,15,19,18,19,11,15,19,11,13,13,12,11,14,18,17,10,15,16,12,17,19,14,12,18,14,14,15,11,13,21,11,14,11,13,12,14,11,10,16,10,15,13,13,10,11,8,11,11,11,8,9,8,8,10,8,9,11,13,13,16,13,11,16,6,8,10,16,11,11,8,11,16,9,10,8,14,7,10,11,11,7,5,11,6,8,9,13,9,7,9,4,9,7,13,2,7,9,5,5,10,12,10,3,6,4,5,11,3,7,6,7,9,3,7,4,9,6,5,5,9,4,4,4,9,7,8,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1},{"name":"date_onset","targets":0},{"name":"n","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
<p>Dưới đây, chúng ta thêm lệnh <code>complete()</code> để đảm bảo mỗi ngày trong phạm vi đều được hiển thị.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="grouping.html#cb656-1" tabindex="-1"></a>daily_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb656-2"><a href="grouping.html#cb656-2" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span>                 <span class="co"># remove case missing date_onset</span></span>
<span id="cb656-3"><a href="grouping.html#cb656-3" tabindex="-1"></a>  <span class="fu">count</span>(date_onset) <span class="sc">%&gt;%</span>                   <span class="co"># count number of rows per unique date</span></span>
<span id="cb656-4"><a href="grouping.html#cb656-4" tabindex="-1"></a>  <span class="fu">complete</span>(                               <span class="co"># ensure all days appear even if no cases</span></span>
<span id="cb656-5"><a href="grouping.html#cb656-5" tabindex="-1"></a>    <span class="at">date_onset =</span> <span class="fu">seq.Date</span>(                <span class="co"># re-define date colume as daily sequence of dates</span></span>
<span id="cb656-6"><a href="grouping.html#cb656-6" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(date_onset, <span class="at">na.rm=</span>T), </span>
<span id="cb656-7"><a href="grouping.html#cb656-7" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">max</span>(date_onset, <span class="at">na.rm=</span>T),</span>
<span id="cb656-8"><a href="grouping.html#cb656-8" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;day&quot;</span>),</span>
<span id="cb656-9"><a href="grouping.html#cb656-9" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))                   <span class="co"># set new filled-in rows to display 0 in column n (not NA as default) </span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-48b8e0a9608585a626cb" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-48b8e0a9608585a626cb">{"x":{"filter":"none","vertical":false,"data":[["2014-04-07","2014-04-15","2014-04-21","2014-04-25","2014-04-26","2014-04-27","2014-05-01","2014-05-03","2014-05-04","2014-05-05","2014-05-06","2014-05-07","2014-05-08","2014-05-09","2014-05-10","2014-05-11","2014-05-12","2014-05-13","2014-05-14","2014-05-16","2014-05-17","2014-05-18","2014-05-19","2014-05-20","2014-05-21","2014-05-22","2014-05-23","2014-05-24","2014-05-25","2014-05-26","2014-05-27","2014-05-28","2014-05-29","2014-05-30","2014-05-31","2014-06-02","2014-06-03","2014-06-05","2014-06-06","2014-06-07","2014-06-08","2014-06-09","2014-06-10","2014-06-11","2014-06-12","2014-06-13","2014-06-14","2014-06-15","2014-06-16","2014-06-17","2014-06-18","2014-06-19","2014-06-20","2014-06-21","2014-06-22","2014-06-23","2014-06-24","2014-06-25","2014-06-26","2014-06-27","2014-06-28","2014-06-29","2014-06-30","2014-07-01","2014-07-02","2014-07-03","2014-07-04","2014-07-05","2014-07-06","2014-07-07","2014-07-08","2014-07-09","2014-07-10","2014-07-11","2014-07-12","2014-07-13","2014-07-14","2014-07-15","2014-07-16","2014-07-17","2014-07-18","2014-07-19","2014-07-20","2014-07-21","2014-07-22","2014-07-23","2014-07-24","2014-07-25","2014-07-26","2014-07-27","2014-07-28","2014-07-29","2014-07-30","2014-07-31","2014-08-01","2014-08-02","2014-08-03","2014-08-04","2014-08-05","2014-08-06","2014-08-07","2014-08-08","2014-08-09","2014-08-10","2014-08-11","2014-08-12","2014-08-13","2014-08-14","2014-08-15","2014-08-16","2014-08-17","2014-08-18","2014-08-19","2014-08-20","2014-08-21","2014-08-22","2014-08-23","2014-08-24","2014-08-25","2014-08-26","2014-08-27","2014-08-28","2014-08-29","2014-08-30","2014-08-31","2014-09-01","2014-09-02","2014-09-03","2014-09-04","2014-09-05","2014-09-06","2014-09-07","2014-09-08","2014-09-09","2014-09-10","2014-09-11","2014-09-12","2014-09-13","2014-09-14","2014-09-15","2014-09-16","2014-09-17","2014-09-18","2014-09-19","2014-09-20","2014-09-21","2014-09-22","2014-09-23","2014-09-24","2014-09-25","2014-09-26","2014-09-27","2014-09-28","2014-09-29","2014-09-30","2014-10-01","2014-10-02","2014-10-03","2014-10-04","2014-10-05","2014-10-06","2014-10-07","2014-10-08","2014-10-09","2014-10-10","2014-10-11","2014-10-12","2014-10-13","2014-10-14","2014-10-15","2014-10-16","2014-10-17","2014-10-18","2014-10-19","2014-10-20","2014-10-21","2014-10-22","2014-10-23","2014-10-24","2014-10-25","2014-10-26","2014-10-27","2014-10-28","2014-10-29","2014-10-30","2014-10-31","2014-11-01","2014-11-02","2014-11-03","2014-11-04","2014-11-05","2014-11-06","2014-11-07","2014-11-08","2014-11-09","2014-11-10","2014-11-11","2014-11-12","2014-11-13","2014-11-14","2014-11-15","2014-11-16","2014-11-17","2014-11-18","2014-11-19","2014-11-20","2014-11-21","2014-11-22","2014-11-23","2014-11-24","2014-11-25","2014-11-26","2014-11-27","2014-11-28","2014-11-29","2014-11-30","2014-12-01","2014-12-02","2014-12-03","2014-12-04","2014-12-05","2014-12-06","2014-12-07","2014-12-08","2014-12-09","2014-12-10","2014-12-11","2014-12-12","2014-12-13","2014-12-14","2014-12-15","2014-12-16","2014-12-17","2014-12-18","2014-12-19","2014-12-20","2014-12-21","2014-12-22","2014-12-23","2014-12-24","2014-12-25","2014-12-26","2014-12-27","2014-12-28","2014-12-29","2014-12-30","2014-12-31","2015-01-01","2015-01-02","2015-01-03","2015-01-04","2015-01-05","2015-01-06","2015-01-07","2015-01-08","2015-01-09","2015-01-10","2015-01-11","2015-01-12","2015-01-13","2015-01-14","2015-01-15","2015-01-16","2015-01-17","2015-01-18","2015-01-19","2015-01-20","2015-01-21","2015-01-22","2015-01-23","2015-01-24","2015-01-25","2015-01-26","2015-01-27","2015-01-28","2015-01-29","2015-01-30","2015-01-31","2015-02-01","2015-02-02","2015-02-03","2015-02-04","2015-02-05","2015-02-06","2015-02-07","2015-02-08","2015-02-09","2015-02-10","2015-02-11","2015-02-12","2015-02-13","2015-02-14","2015-02-15","2015-02-16","2015-02-17","2015-02-18","2015-02-19","2015-02-20","2015-02-21","2015-02-22","2015-02-23","2015-02-24","2015-02-25","2015-02-26","2015-02-27","2015-02-28","2015-03-01","2015-03-02","2015-03-03","2015-03-04","2015-03-05","2015-03-06","2015-03-07","2015-03-08","2015-03-09","2015-03-10","2015-03-11","2015-03-12","2015-03-13","2015-03-14","2015-03-15","2015-03-16","2015-03-17","2015-03-18","2015-03-19","2015-03-20","2015-03-21","2015-03-22","2015-03-23","2015-03-24","2015-03-25","2015-03-26","2015-03-27","2015-03-28","2015-03-29","2015-03-30","2015-03-31","2015-04-01","2015-04-02","2015-04-03","2015-04-04","2015-04-05","2015-04-06","2015-04-07","2015-04-08","2015-04-09","2015-04-10","2015-04-11","2015-04-12","2015-04-13","2015-04-14","2015-04-15","2015-04-16","2015-04-17","2015-04-18","2015-04-19","2015-04-20","2015-04-21","2015-04-22","2015-04-23","2015-04-24","2015-04-25","2015-04-26","2015-04-27","2015-04-28","2015-04-29","2015-04-30"],[1,1,2,1,1,1,2,1,1,1,3,2,2,2,1,1,2,3,3,2,3,4,2,1,3,1,2,1,3,3,10,1,1,1,2,5,3,4,4,5,1,5,5,3,1,1,2,5,6,4,2,3,7,3,4,2,6,5,3,1,2,2,6,4,3,5,6,5,3,3,7,7,5,4,6,6,10,10,6,6,10,7,11,4,6,11,9,10,7,12,6,15,14,8,9,16,13,18,18,9,9,9,10,13,17,7,17,12,17,31,13,14,14,19,17,26,19,25,21,16,24,23,25,25,22,27,25,28,30,22,33,30,36,33,23,31,27,30,42,40,50,37,38,38,49,52,35,50,37,38,33,33,39,39,45,34,44,29,40,50,41,39,35,28,36,34,37,36,36,34,43,28,38,33,37,29,33,44,43,24,37,30,35,24,37,44,34,40,30,34,26,29,33,31,22,26,26,19,30,24,29,24,21,19,11,22,20,23,32,33,28,15,20,24,18,20,19,22,17,32,21,20,23,17,15,18,20,19,18,21,18,16,20,15,18,15,18,18,15,15,19,18,19,11,15,19,11,13,13,12,11,14,18,17,10,15,16,12,17,19,14,12,18,14,14,15,11,13,21,11,14,11,13,12,14,11,10,16,10,15,13,13,10,11,8,11,11,11,8,9,8,8,10,8,9,11,13,13,16,13,11,16,6,8,10,16,11,11,8,11,16,9,10,8,14,7,10,11,11,7,5,11,6,8,9,13,9,7,9,4,9,7,13,2,7,9,5,5,10,12,10,3,6,4,5,11,3,7,6,7,9,3,7,4,9,6,5,5,9,4,4,4,9,7,8,2,2]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>date_onset<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1},{"name":"date_onset","targets":0},{"name":"n","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="các-trường-hợp-trong-linelist-theo-tuần" class="section level3 unnumbered">
<h3>Các trường hợp trong <code>linelist</code> theo tuần</h3>
<p>Nguyên tắc tương tự có thể được áp dụng cho tuần. Đầu tiên, hãy tạo một cột mới các trường hợp theo tuần bằng cách sử dụng <code>floor_date()</code> với <code>unit = "week"</code>. Sau đó, sử dụng <code>count()</code> như trên để đạt được số lượng ca hàng tuần. Kết thúc bằng hàm <code>complete()</code> để đảm bảo rằng tất cả các tuần đều được hiển thị, ngay cả khi chúng không chứa ca nào.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="grouping.html#cb657-1" tabindex="-1"></a><span class="co"># Make dataset of weekly case counts</span></span>
<span id="cb657-2"><a href="grouping.html#cb657-2" tabindex="-1"></a>weekly_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb657-3"><a href="grouping.html#cb657-3" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span>                 <span class="co"># remove cases missing date_onset</span></span>
<span id="cb657-4"><a href="grouping.html#cb657-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_onset, <span class="at">unit =</span> <span class="st">&quot;week&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># new column of week of onset</span></span>
<span id="cb657-5"><a href="grouping.html#cb657-5" tabindex="-1"></a>  <span class="fu">count</span>(week) <span class="sc">%&gt;%</span>                         <span class="co"># group data by week and count rows per group</span></span>
<span id="cb657-6"><a href="grouping.html#cb657-6" tabindex="-1"></a>  <span class="fu">complete</span>(                               <span class="co"># ensure all days appear even if no cases</span></span>
<span id="cb657-7"><a href="grouping.html#cb657-7" tabindex="-1"></a>    <span class="at">week =</span> <span class="fu">seq.Date</span>(                      <span class="co"># re-define date colume as daily sequence of dates</span></span>
<span id="cb657-8"><a href="grouping.html#cb657-8" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">min</span>(week, <span class="at">na.rm=</span>T), </span>
<span id="cb657-9"><a href="grouping.html#cb657-9" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">max</span>(week, <span class="at">na.rm=</span>T),</span>
<span id="cb657-10"><a href="grouping.html#cb657-10" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;week&quot;</span>),</span>
<span id="cb657-11"><a href="grouping.html#cb657-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))                   <span class="co"># set new filled-in rows to display 0 in column n (not NA as default) </span></span></code></pre></div>
<p>Đây là 50 hàng đầu tiên của bộ dữ liệu khi trả kết quả:</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-6d4bc4239916e3b88851" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6d4bc4239916e3b88851">{"x":{"filter":"none","vertical":false,"data":[["2014-04-06","2014-04-13","2014-04-20","2014-04-27","2014-05-04","2014-05-11","2014-05-18","2014-05-25","2014-06-01","2014-06-08","2014-06-15","2014-06-22","2014-06-29","2014-07-06","2014-07-13","2014-07-20","2014-07-27","2014-08-03","2014-08-10","2014-08-17","2014-08-24","2014-08-31","2014-09-07","2014-09-14","2014-09-21","2014-09-28","2014-10-05","2014-10-12","2014-10-19","2014-10-26","2014-11-02","2014-11-09","2014-11-16","2014-11-23","2014-11-30","2014-12-07","2014-12-14","2014-12-21","2014-12-28","2015-01-04","2015-01-11","2015-01-18","2015-01-25","2015-02-01","2015-02-08","2015-02-15","2015-02-22","2015-03-01","2015-03-08","2015-03-15","2015-03-22","2015-03-29","2015-04-05","2015-04-12","2015-04-19","2015-04-26"],[1,1,4,4,12,14,14,21,21,18,30,23,31,35,55,58,80,86,114,122,159,187,210,294,278,270,263,252,243,241,223,176,140,170,151,130,123,122,94,101,106,99,87,80,66,80,80,76,68,61,51,58,39,45,37,28]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>week<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1},{"name":"week","targets":0},{"name":"n","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="các-trường-hợp-trong-linelist-theo-tháng" class="section level3 unnumbered">
<h3>Các trường hợp trong <code>linelist</code> theo tháng</h3>
<p>Để tổng hợp các trường hợp theo tháng, hãy sử dụng lại <code>floor_date()</code> từ package <strong>lubridate</strong>, nhưng với argument <code>unit = "months"</code>. Điều này làm tròn xuống các ngày thành ngày đầu tiên của tháng. Đầu ra sẽ là định dạng ngày. Lưu ý rằng trong bước <code>complete()</code>, chúng ta cũng sử dụng <code>by = "months"</code>.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="grouping.html#cb658-1" tabindex="-1"></a><span class="co"># Make dataset of monthly case counts</span></span>
<span id="cb658-2"><a href="grouping.html#cb658-2" tabindex="-1"></a>monthly_counts <span class="ot">&lt;-</span> linelist <span class="sc">%&gt;%</span> </span>
<span id="cb658-3"><a href="grouping.html#cb658-3" tabindex="-1"></a>  <span class="fu">drop_na</span>(date_onset) <span class="sc">%&gt;%</span> </span>
<span id="cb658-4"><a href="grouping.html#cb658-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> lubridate<span class="sc">::</span><span class="fu">floor_date</span>(date_onset, <span class="at">unit =</span> <span class="st">&quot;months&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># new column, 1st of month of onset</span></span>
<span id="cb658-5"><a href="grouping.html#cb658-5" tabindex="-1"></a>  <span class="fu">count</span>(month) <span class="sc">%&gt;%</span>                          <span class="co"># count cases by month</span></span>
<span id="cb658-6"><a href="grouping.html#cb658-6" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb658-7"><a href="grouping.html#cb658-7" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb658-8"><a href="grouping.html#cb658-8" tabindex="-1"></a>      <span class="fu">min</span>(month, <span class="at">na.rm=</span>T),     <span class="co"># include all months with no cases reported</span></span>
<span id="cb658-9"><a href="grouping.html#cb658-9" tabindex="-1"></a>      <span class="fu">max</span>(month, <span class="at">na.rm=</span>T),</span>
<span id="cb658-10"><a href="grouping.html#cb658-10" tabindex="-1"></a>      <span class="at">by=</span><span class="st">&quot;month&quot;</span>),</span>
<span id="cb658-11"><a href="grouping.html#cb658-11" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>))</span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-65aaac2ea75d67fc34de" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-65aaac2ea75d67fc34de">{"x":{"filter":"none","vertical":false,"data":[["2014-04-01","2014-05-01","2014-06-01","2014-07-01","2014-08-01","2014-09-01","2014-10-01","2014-11-01","2014-12-01","2015-01-01","2015-02-01","2015-03-01","2015-04-01"],[7,64,100,226,528,1070,1112,763,562,431,306,277,186]],"container":"<table class=\"white-space: nowrap\">\n  <thead>\n    <tr>\n      <th>month<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"scrollX":true,"columnDefs":[{"className":"dt-right","targets":1},{"name":"month","targets":0},{"name":"n","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]},"selection":{"mode":"multiple","selected":null,"target":"row","selectable":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="số-lượng-đếm-hàng-ngày-theo-tuần" class="section level3 unnumbered">
<h3>Số lượng đếm hàng ngày theo tuần</h3>
<p>Để tổng hợp số lượng hàng ngày thành số lượng hàng tuần, hãy sử dụng <code>floor_date()</code> như trên. Tuy nhiên, hãy sử dụng <code>group_by()</code> và <code>summarize()</code> thay vì <code>count()</code> bởi vì chúng ta cần tính tổng <code>sum()</code> số lượng trường hợp hàng ngày thay vì chỉ đếm số hàng mỗi tuần.</p>
</div>
<div id="số-lượng-đếm-hàng-ngày-theo-tuần-1" class="section level3 unnumbered">
<h3>Số lượng đếm hàng ngày theo tuần</h3>
<p>Để tổng hợp số lượng hàng ngày thành số lượng hàng tháng, hãy sử dụng <code>floor_date()</code> với <code>unit = "month"</code> như trên. Tuy nhiên, hãy sử dụng <code>group_by()</code> và <code>summarize()</code> thay vì <code>count()</code> bởi vì chúng ta cần tính tổng <code>sum()</code> số lượng trường hợp hàng ngày thay vì chỉ đếm số hàng mỗi tháng.</p>
</div>
</div>
<div id="sắp-xếp-dữ-liệu-đã-nhóm" class="section level2" number="13.8">
<h2><span class="header-section-number">13.8</span> Sắp xếp dữ liệu đã nhóm</h2>
<p>Sử dụng hàm <strong>dplyr</strong> <code>arrange()</code> để sắp xếp các hàng trong bộ dữ liệu tương tự khi dữ liệu được nhóm lại, <em>trừ khi</em> bạn thiết lập đối số <code>.by_group =TRUE</code>. Trong trường hợp này, các hàng được sắp xếp thứ tự đầu tiên theo các cột nhóm và sau đó theo bất kỳ cột nào khác mà bạn chỉ định để <code>arrange()</code>.</p>
</div>
<div id="lọc-trên-nhóm-dữ-liệu-đã-nhóm" class="section level2" number="13.9">
<h2><span class="header-section-number">13.9</span> Lọc trên nhóm dữ liệu đã nhóm</h2>
<div id="filter" class="section level3 unnumbered">
<h3><code>filter()</code></h3>
<p>Khi được áp dụng cùng với các hàm đánh giá bộ dữ liệu (như <code>max()</code>, <code>min()</code>, <code>mean()</code>), các hàm này sẽ được áp dụng cho các nhóm. Ví dụ: nếu bạn muốn lọc và giữ các hàng có bệnh nhân trên độ tuổi trung vị, hàm này sẽ áp dụng cho mỗi nhóm - lọc để giữ các hàng trên độ tuổi trung bình của <em>nhóm</em>.</p>
</div>
<div id="cắt-hàng-theo-nhóm" class="section level3 unnumbered">
<h3>Cắt hàng theo nhóm</h3>
<p>Hàm <strong>dplyr</strong> <code>slice()</code>, mà <a href="https://dplyr.tidyverse.org/reference/slice.html">lọc hàng dựa trên vị trí</a> trong dữ liệu, cũng có thể được áp dụng cho mỗi nhóm. Hãy nhớ sắp xếp dữ liệu trong mỗi nhóm để có được “lát cắt” mong muốn.</p>
<p>Ví dụ: chỉ lấy 5 lần nhập viện gần nhất từ mỗi bệnh viện:</p>
<ol style="list-style-type: decimal">
<li>Nhóm bộ số liệu <code>linelist</code> theo cột <code>hospital</code><br />
</li>
<li>Sắp xếp bản ghi từ gần nhất đến xa nhất theo <code>date_hospitalisation</code> <em>trong mỗi nhóm bệnh viện</em><br />
</li>
<li>Cắt để lấy 5 hàng đầu tiên từ mỗi bệnh viện</li>
</ol>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="grouping.html#cb659-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span></span>
<span id="cb659-2"><a href="grouping.html#cb659-2" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span></span>
<span id="cb659-3"><a href="grouping.html#cb659-3" tabindex="-1"></a>  <span class="fu">arrange</span>(hospital, date_hospitalisation) <span class="sc">%&gt;%</span></span>
<span id="cb659-4"><a href="grouping.html#cb659-4" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb659-5"><a href="grouping.html#cb659-5" tabindex="-1"></a>  <span class="fu">arrange</span>(hospital) <span class="sc">%&gt;%</span>                            <span class="co"># for display</span></span>
<span id="cb659-6"><a href="grouping.html#cb659-6" tabindex="-1"></a>  <span class="fu">select</span>(case_id, hospital, date_hospitalisation)  <span class="co"># for display</span></span></code></pre></div>
<pre><code>## # A tibble: 30 × 3
## # Groups:   hospital [6]
##    case_id hospital          date_hospitalisation
##    &lt;chr&gt;   &lt;chr&gt;             &lt;date&gt;              
##  1 20b688  Central Hospital  2014-05-06          
##  2 d58402  Central Hospital  2014-05-10          
##  3 b8f2fd  Central Hospital  2014-05-13          
##  4 acf422  Central Hospital  2014-05-28          
##  5 275cc7  Central Hospital  2014-05-28          
##  6 d1fafd  Military Hospital 2014-04-17          
##  7 974bc1  Military Hospital 2014-05-13          
##  8 6a9004  Military Hospital 2014-05-13          
##  9 09e386  Military Hospital 2014-05-14          
## 10 865581  Military Hospital 2014-05-15          
## # ℹ 20 more rows</code></pre>
<p><code>slice_head()</code> - chọn n hàng từ trên xuống dưới<br />
<code>slice_tail()</code> - chọn n hàng từ dưới lên trên<br />
<code>slice_sample()</code> - chọn ngẫu nhiên n dòng<br />
<code>slice_min()</code> - chọn n dòng với giá trị cao nhất trong cột <code>order_by =</code>, sử dụng <code>with_ties = TRUE</code> để giữ mối liên hệ<br />
<code>slice_max()</code> - chọn n dòng với giá trị thấp nhất trong cột <code>order_by =</code>,sử dụng <code>with_ties = TRUE</code> để giữ mối liên hệ</p>
<p>Xem chương <a href="cleaning.html#loại-bỏ-trùng-lặp">Loại bỏ trùng lặp</a> để tham khảo thêm ví dụ và chi tiết về hàm <code>slice()</code>.</p>
</div>
<div id="group_filter_grp_size" class="section level3 unnumbered">
<h3>Lọc theo quy mô nhóm</h3>
<p>Hàm <code>add_count()</code> thêm một cột <code>n</code> vào dữ liệu gốc cho biết số hàng trong nhóm của hàng đó.</p>
<p>Như trình bày bên dưới, <code>add_count()</code> được áp dụng cho cột <code>hospital</code>, vì vậy các giá trị trong cột mới <code>n</code> phản ánh số hàng trong nhóm bệnh viện của hàng đó. Lưu ý cách các giá trị trong cột <code>n</code> được lặp lại. Trong ví dụ dưới đây, tên cột <code>n</code> có thể được thay đổi bằng cách sử dụng đối số <code>name =</code> trong <code>add_count()</code>. Với mục đích diễn giải, chúng ta sắp xếp lại các cột với <code>select()</code>.</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="grouping.html#cb661-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb661-2"><a href="grouping.html#cb661-2" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb661-3"><a href="grouping.html#cb661-3" tabindex="-1"></a>  <span class="fu">add_count</span>(hospital) <span class="sc">%&gt;%</span>          <span class="co"># add &quot;number of rows admitted to same hospital as this row&quot; </span></span>
<span id="cb661-4"><a href="grouping.html#cb661-4" tabindex="-1"></a>  <span class="fu">select</span>(hospital, n, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 31
##    hospital          n case_id generation date_infection date_onset date_hospitalisation
##    &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;              
##  1 Other           885 5fe599           4 2014-05-08     2014-05-13 2014-05-15          
##  2 Missing        1469 8689b7           4 NA             2014-05-13 2014-05-14          
##  3 St. Mark&#39;s M…   422 11f8ea           2 NA             2014-05-16 2014-05-18          
##  4 Port Hospital  1762 b8812a           3 2014-05-04     2014-05-18 2014-05-20          
##  5 Military Hos…   896 893f25           3 2014-05-18     2014-05-21 2014-05-22          
##  6 Port Hospital  1762 be99c8           3 2014-05-03     2014-05-22 2014-05-23          
##  7 Missing        1469 07e3e8           4 2014-05-22     2014-05-27 2014-05-29          
##  8 Missing        1469 369449           4 2014-05-28     2014-06-02 2014-06-03          
##  9 Missing        1469 f393b4           4 NA             2014-06-05 2014-06-06          
## 10 Missing        1469 1389ca           4 NA             2014-06-05 2014-06-07          
## # ℹ 5,878 more rows
## # ℹ 24 more variables: date_outcome &lt;date&gt;, outcome &lt;chr&gt;, gender &lt;chr&gt;, age &lt;dbl&gt;,
## #   age_unit &lt;chr&gt;, age_years &lt;dbl&gt;, age_cat &lt;fct&gt;, age_cat5 &lt;fct&gt;, lon &lt;dbl&gt;,
## #   lat &lt;dbl&gt;, infector &lt;chr&gt;, source &lt;chr&gt;, wt_kg &lt;dbl&gt;, ht_cm &lt;dbl&gt;, ct_blood &lt;dbl&gt;,
## #   fever &lt;chr&gt;, chills &lt;chr&gt;, cough &lt;chr&gt;, aches &lt;chr&gt;, vomit &lt;chr&gt;, temp &lt;dbl&gt;,
## #   time_admission &lt;chr&gt;, bmi &lt;dbl&gt;, days_onset_hosp &lt;dbl&gt;</code></pre>
<p>Sau đó, nó trở nên dễ dàng để lọc các hàng trường hợp nhập viện tại một bệnh viện “nhỏ”, chẳng hạn như một bệnh viện tiếp nhận ít hơn 500 bệnh nhân:</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="grouping.html#cb663-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb663-2"><a href="grouping.html#cb663-2" tabindex="-1"></a>  <span class="fu">add_count</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb663-3"><a href="grouping.html#cb663-3" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&lt;</span> <span class="dv">500</span>)</span></code></pre></div>
</div>
</div>
<div id="tạo-cột-mới-trên-dữ-liệu-được-nhóm" class="section level2" number="13.10">
<h2><span class="header-section-number">13.10</span> Tạo cột mới trên dữ liệu được nhóm</h2>
<p>Để giữ lại tất cả các cột và hàng (không tổng hợp) và <em>thêm một cột mới chứa thống kê theo nhóm</em>, hãy sử dụng hàm <code>mutate()</code> sau <code>group_by()</code> thay vì <code>summarise()</code>.</p>
<p>Điều này hữu ích nếu bạn muốn nhóm thống kê trong bộ dữ liệu gốc <em>với tất cả các cột khác được hiển thị</em> - ví dụ: cho các phép tính so sánh một hàng với nhóm của nó.</p>
<p>Ví dụ: code dưới đây tính toán sự khác biệt giữa thời gian trễ nhập viện của một hàng và thời gian chậm trễ trung vị đối với bệnh viện đó. Các bước lần lượt là:</p>
<ol style="list-style-type: decimal">
<li>Nhóm dữ liệu theo bệnh viện<br />
</li>
<li>Sử dụng cột <code>days_onset_hosp</code> (nhập viện trễ) để tạo một cột mới chứa giá trị trễ trung bình tại bệnh viện của <em>hàng đó</em><br />
</li>
<li>Tính toán sự khác biệt giữa hai cột</li>
</ol>
<p>Chúng ta chỉ lựa chọn <code>select()</code> những cột cần hiển thị, cho mục đích diễn giải.</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="grouping.html#cb664-1" tabindex="-1"></a>linelist <span class="sc">%&gt;%</span> </span>
<span id="cb664-2"><a href="grouping.html#cb664-2" tabindex="-1"></a>  <span class="co"># group data by hospital (no change to linelist yet)</span></span>
<span id="cb664-3"><a href="grouping.html#cb664-3" tabindex="-1"></a>  <span class="fu">group_by</span>(hospital) <span class="sc">%&gt;%</span> </span>
<span id="cb664-4"><a href="grouping.html#cb664-4" tabindex="-1"></a>  </span>
<span id="cb664-5"><a href="grouping.html#cb664-5" tabindex="-1"></a>  <span class="co"># new columns</span></span>
<span id="cb664-6"><a href="grouping.html#cb664-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb664-7"><a href="grouping.html#cb664-7" tabindex="-1"></a>    <span class="co"># mean days to admission per hospital (rounded to 1 decimal)</span></span>
<span id="cb664-8"><a href="grouping.html#cb664-8" tabindex="-1"></a>    <span class="at">group_delay_admit =</span> <span class="fu">round</span>(<span class="fu">mean</span>(days_onset_hosp, <span class="at">na.rm=</span>T), <span class="dv">1</span>),</span>
<span id="cb664-9"><a href="grouping.html#cb664-9" tabindex="-1"></a>    </span>
<span id="cb664-10"><a href="grouping.html#cb664-10" tabindex="-1"></a>    <span class="co"># difference between row&#39;s delay and mean delay at their hospital (rounded to 1 decimal)</span></span>
<span id="cb664-11"><a href="grouping.html#cb664-11" tabindex="-1"></a>    <span class="at">diff_to_group     =</span> <span class="fu">round</span>(days_onset_hosp <span class="sc">-</span> group_delay_admit, <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb664-12"><a href="grouping.html#cb664-12" tabindex="-1"></a>  </span>
<span id="cb664-13"><a href="grouping.html#cb664-13" tabindex="-1"></a>  <span class="co"># select certain rows only - for demonstration/viewing purposes</span></span>
<span id="cb664-14"><a href="grouping.html#cb664-14" tabindex="-1"></a>  <span class="fu">select</span>(case_id, hospital, days_onset_hosp, group_delay_admit, diff_to_group)</span></code></pre></div>
<pre><code>## # A tibble: 5,888 × 5
## # Groups:   hospital [6]
##    case_id hospital                      days_onset_hosp group_delay_admit diff_to_group
##    &lt;chr&gt;   &lt;chr&gt;                                   &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;
##  1 5fe599  Other                                       2               2             0  
##  2 8689b7  Missing                                     1               2.1          -1.1
##  3 11f8ea  St. Mark&#39;s Maternity Hospita…               2               2.1          -0.1
##  4 b8812a  Port Hospital                               2               2.1          -0.1
##  5 893f25  Military Hospital                           1               2.1          -1.1
##  6 be99c8  Port Hospital                               1               2.1          -1.1
##  7 07e3e8  Missing                                     2               2.1          -0.1
##  8 369449  Missing                                     1               2.1          -1.1
##  9 f393b4  Missing                                     1               2.1          -1.1
## 10 1389ca  Missing                                     2               2.1          -0.1
## # ℹ 5,878 more rows</code></pre>
</div>
<div id="chọn-trên-dữ-liệu-được-nhóm" class="section level2" number="13.11">
<h2><span class="header-section-number">13.11</span> Chọn trên dữ liệu được nhóm</h2>
<p>Hàm <code>select()</code> hoạt động trên dữ liệu được nhóm, nhưng các cột được nhóm luôn được bao gồm (ngay cả khi không được đề cập trong <code>select()</code>). Nếu bạn không muốn nhóm các cột này, trước tiên hãy bỏ nhóm bằng hàm <code>ungroup()</code>.</p>
<!-- ======================================================= -->
</div>
<div id="tài-nguyên-học-liệu-1" class="section level2" number="13.12">
<h2><span class="header-section-number">13.12</span> Tài nguyên học liệu</h2>
<p>Dưới đây là một số tài nguyên hữu ích cung cấp thêm thông tin:</p>
<p>Bạn có thể thực hiện bất kỳ hàm tổng hợp nào trên dữ liệu được nhóm; xem <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">RStudio cheat sheet về biến đổi dữ liệu</a></p>
<p>Trang Data Carpentry của <a href="https://datacarpentry.org/R-genomics/04-dplyr.html"><strong>dplyr</strong></a><br />
Chương tham khảo hệ sinh thái <strong>tidyverse</strong> về <a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a> và <a href="https://dplyr.tidyverse.org/articles/grouping.html">grouping</a></p>
<p>Trang này về <a href="https://itsalocke.com/files/DataManipulationinR.pdf">Thao tác dữ liệu</a></p>
<p><a href="https://stackoverflow.com/questions/23528862/summarize-with-conditions-in-dplyr">Tổng hợp có điều kiện với dplyr</a></p>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Cẩm nang dịch tễ học với R</strong>" was written by the handbook team. It was last built on 2024-02-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
